
function PXTextEdit($a,$b,$c,$d){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c,PXTextEdit.properties);__px_cm(this).registerAutoSize(this,$c);this.allowRepaintText=true;this.elemText=this.getTextElem();this.elemText.altDisColor=this.disableColor;if(this.getDisabled())__px_cm(this).repaintEditState(this);this.maxLength=this.elemText.maxLength;this.hasEditLink=this.elemText.tagName=="A";this.trackSelection=this.hasFocus=this.trackPosition=false;this.trange=new PXTextRange($a,this.elemText);__px_cm(this).setStackElements(this);this.eventsH=Function.createDelegate(this,this.handleEvents);this.attachEventHandlers();this.elemText.object=this;this.events=new PXEventList(this,PXTextEdit.events,$c.clientEvents);this.viewState=new PXStateBag(this,"PXText",$d);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.wrapLanguage();};PXTextEdit.properties=[["autoPostBack",JSType.Bool,false],["allowNull",JSType.Bool,true],["nullText",JSType.String,""],["required",JSType.Bool,false],["selectOnFocus",JSType.Bool,true],["hideEnterKey",JSType.Bool,false],["bindingContainer",JSType.String,""],["labelID",JSType.String,""],["validateExp",JSType.String,""],["asciiCharSet",JSType.Bool,false],["disableColor",JSType.String,null],["onValueChange",JSType.Int,0],["syncStateWithCommand",JSType.Bool,false],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc],["linkCommand",JSType.Object,PXCallbackManager.settingsDesc],["language",JSType.String,""],["dataField",JSType.Empty,null],["localizationInfo",JSType.Empty,null]];PXTextEdit.callbackProps=[["language",JSType.String,""],["defaultLocale",JSType.String,""],["hidden",JSType.Bool,false,PXControl.setHidden],["enabled",JSType.Bool,true,"setEnabled"],["readOnly",JSType.Bool,false,"setReadOnly"],["value",JSType.Empty,null,"setValue"],["dataField",JSType.Empty,null],["localizationInfo",JSType.Empty,null],["required",JSType.Bool,null]];PXTextEdit.prototype.setProperties=function($c){if(this.syncStateWithCommand)$c.readOnly=this.getReadOnly();__px_cm(this).readProperties(this,$c,PXTextEdit.callbackProps);this.wrapLanguage();};PXTextEdit.prototype.initInlineEditor=function($e){if(this.isTextArea())__px(this).registerAutoSizedText(this.element);};PXTextEdit.prototype.isTextArea=function(){return this.element.tagName=="TEXTAREA";};PXTextEdit.events={$initialize:0,$keyDown:1,$keyPress:2,$keyUp:3,$mouseDown:4,$mouseUp:5,$mouseMove:6,$mouseOver:7,$mouseOut:8,$click:9,$focus:10,$blur:11,$valueChanging:12,$valueChanged:13};PXTextEdit.prototype.attachEventHandlers=function(){__px_cm(this).addBaseHandlers(this.elemText,this.eventsH);__px(this).addEventHandler(this.elemText,"beforepaste",this.eventsH,false);__px(this).addEventHandler(this.elemText,"paste",this.eventsH,false);__px(this).addEventHandler(this.elemText,"cut",this.eventsH,false);__px(this).addEventHandler(this.elemText,"input",this.eventsH,false);};PXTextEdit.prototype.detachEventHandlers=function(){__px_cm(this).removeBaseHandlers(this.elemText,this.eventsH);__px(this).removeEventHandler(this.elemText,"beforepaste",this.eventsH,false);__px(this).removeEventHandler(this.elemText,"paste",this.eventsH,false);__px(this).removeEventHandler(this.elemText,"cut",this.eventsH,false);__px(this).removeEventHandler(this.elemText,"input",this.eventsH,false);};PXTextEdit.prototype.onLoad=function(){if(this.syncStateWithCommand)__px_cm(this).registerCommandExecutor(this);};PXTextEdit.prototype.localeEditor=function(e){var bc=__px_all(this)[this.bindingContainer];if(bc instanceof PXGrid){bc.localizedInlineEditor=this;if(bc.activeCell.language||(bc.activeRow.isNew()&&bc.activeCell.column.defaultLocale&&!bc.activeCell.getReadOnly()))__px_cm(this).showLocalizePopup(bc.dataSourceID,bc.dataMember,bc.activeCell.column.getKey(),bc,this.getValue(),bc.activeCell.language);}else if(bc&&this.language){if(!this.getReadOnly()){__px_cm(this).showLocalizePopup(bc.dataSourceID,bc.dataMember,this.dataField,this,this.getValue(),this.language);}}else if(this.localizationInfo){var $f=this.localizationInfo.split(';');__px_cm(this).showLocalizePopup($f[0],$f[1],$f[2],this,this.getValue(),this.language);};__px(this).cancelEvent(e);return false;};PXTextEdit.prototype.localeUpdated=function($g){if(!$g)return;var $h=$g.split(';');if($h.length>1){this.language=$h[0];this.setValue($h[1]);}};PXTextEdit.prototype.commandStateCallback=function($i,$j){this.setReadOnly(!$i.getEnabled());};PXTextEdit.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXTextEdit.prototype.setEnabled=function($k){if($k!=this.getEnabled()){__px_cm(this).setEnabled(this,$k);this.recreateEditor($k);}};PXTextEdit.prototype.getReadOnly=function(){return __px(this).getReadOnly(this.elemText);};PXTextEdit.prototype.setReadOnly=function($l){__px_cm(this).setReadOnly(this,$l);this.wrapLanguage();};PXTextEdit.prototype.getDisabled=function(){return !this.getEnabled()||this.getReadOnly();};PXTextEdit.prototype.getVisible=function(){return this.element.style.display!="none";};PXTextEdit.prototype.setVisible=function(v){if(v!=this.getVisible()){var $m=v?"":"none";__px_cm(this).setStackElementsVisible(this,v);this.element.style.display=$m;if(this.boundImage)this.boundImage.style.display=$m;if(this.labelID){var $n=__px(this).elemByID(this.labelID);if($n)$n.style.display=$m;};var a=this.element.nextElementSibling;if(a&&a.getAttribute('data-lang')=='indi')a.style.display=$m;}};PXTextEdit.prototype.getLabelText=function(){var $n,$o="";if(this.labelID)$n=__px(this).elemByID(this.labelID);else if(this.labelWrapper)$n=this.labelWrapper.getElementsByTagName("label")[0];if($n)$o=__px(this).getElemText($n);return $o;};PXTextEdit.prototype.focus=function(){try{this.elemText.focus();}catch(e){}};PXTextEdit.prototype.getTextElem=function(){return this.element;};PXTextEdit.prototype.getText=function(){return this.hasEditLink?__px(this).getElemText(this.elemText):this.elemText.value;};PXTextEdit.prototype.$U=function($b){return window.getComputedStyle($b).position;};PXTextEdit.prototype.removeLanguage=function(){if(this.elemLanguage&&this.elemLanguage.parentNode)this.elemLanguage.parentNode.removeChild(this.elemLanguage);};PXTextEdit.prototype.wrapLanguage=function($p){var $q=$p||this.language||this.defaultLocale;if(!!$q){if(this.elemLanguage&&this.elemLanguage.parentNode){this.elemLanguage.innerHTML=$q;this.elemLanguage.style.display=this.getReadOnly()?"none":"";return;};var $r=this.elemText&&this.elemText.nextElementSibling;var parent=this.elemText&&this.elemText.parentNode;if(parent){this.elemLanguage=document.createElement('a');this.elemLanguage.className="langindi2";this.elemLanguage.innerHTML=$q;this.elemLanguage.href="javascript:void 0";this.elemLanguage.style.display=this.getReadOnly()?"none":"";var $s=this.$U(parent);if($s=='static')parent.style.position="relative";this.elemLanguage.setAttribute('style','position:absolute;top:2px; /* background-color: rgba(255,255,255,0.8);*/ ');this.elemLanguage.style[__px(this).isRTL()?'left':'right']="-30px";parent.insertBefore(this.elemLanguage,$r);__px(this).addEventHandler(this.elemLanguage,"click",Function.createDelegate(this,this.localeEditor));}}};PXTextEdit.prototype.adjustInline=function($q){this.wrapLanguage($q);if(this.elemLanguage&&this.elemLanguage.parentNode){this.elemLanguage.style.display="";var $t=__px(this).isRTL()?["multiLangRTL"]:["multiLang"];if(this.elemText)__px(this).appendCss(this.elemText,$t,true);var $u=this.$U(this.elemLanguage.parentNode);if(($u=="absolute"||$u=='relative')){var st=window.getComputedStyle(this.elemText);var $v=__px(this).isRTL()?((this.elemText.offsetLeft||0)+6):((this.elemText.offsetLeft||0)+parseInt(st.width,10)-27);this.elemLanguage.style['right']='';this.elemLanguage.style['left']=$v+"px";this.elemLanguage.style.top=this.elemText.offsetTop+3+"px";if(this.elemText.style.zIndex)this.elemLanguage.style.zIndex=parseInt(this.elemText.style.zIndex)+1;}}};PXTextEdit.prototype.hideInline=function(){if(this.elemLanguage){this.elemLanguage.style.display="none";if(this.elemText)__px(this).excludeCss(this.elemText,["multiLang","multiLangRTL"],true);}};PXTextEdit.prototype.setText=function($w){var $o=$w?$w.trimEnd():"";if(this.hasEditLink)__px(this).setElemText(this.elemText,$o);else this.elemText.value=$o;this.wrapLanguage();};PXTextEdit.prototype.getValue=function($x){if(this.$V===undefined||$x)this.$V=this.validateValue(this.getText(),true);return this.$V;};PXTextEdit.prototype.setValue=function(v){var $w=this.validateValue(v);if(!__px(this).equals($w,this.getValue())){this.$V=this.oldValue=$w;this.repaintText($w);if(this.hasFocus&&__px(this).isVisible(this.element))this.selectContent(true);if(this.isTextArea()){var $y=this.elemText.value;this.$V=this.oldValue=this.isNullValue($y)?null:$y;}}};PXTextEdit.prototype.repaintText=function(v){var $o=(this.hasFocus&&!this.hasEditLink)?this.getEditText(v):this.getDisplayText(v);if($o!=this.getText())this.setText($o);};PXTextEdit.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return this.nullText;else return(v!=null)?v.toString():"";};PXTextEdit.prototype.getEditText=function(v){return(v!=null)?v.toString():"";};PXTextEdit.prototype.isNullValue=function(v){var $z=String(v);if(v==null||$z=="")return true;if(this.allowNull&&$z==this.nullText)return true;return false;};PXTextEdit.prototype.select=function($A,$B){if(this.getVisible()){this.trange.select($A,$B);this.selStart=this.trange.selStart;this.selEnd=this.trange.selEnd;}};PXTextEdit.prototype.getSelectedText=function(){var $o=this.trange.getSelectedText();this.selStart=this.trange.selStart;this.selEnd=this.trange.selEnd;return $o;};PXTextEdit.prototype.updateValue=function($w){var $y=($w===undefined)?this.getValue(true):$w;if(!__px(this).equals($y,this.oldValue)){var $C=this.fireEvent(12,null);if($C){this.setValue(this.oldValue);return false;};var $f=new Object(),$D=this.oldValue;($w!==undefined)?this.setValue($y):this.repaintText($y);this.oldValue=$y;this.fireEvent(13,null);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this,$f);if($f.commandCanceled){this.setValue($D);return false;};return true;}};PXTextEdit.prototype.validateValue=function($o){if(this.isNullValue($o)){$o=this.allowNull?null:"";}else if(this.validateExp){var $E=new RegExp(this.validateExp),$F;if(($F=$E.exec($o))!=null)$o=$F[0];else $o=this.allowNull?null:"";};if(this.asciiCharSet&&$o){var $G=$o;$o="";for(var i=0;i<$G.length;i++)if($G.charCodeAt(i)<127)$o+=$G.charAt(i);};return $o;};PXTextEdit.prototype.fireEvent=function(id,ev){var $H=new Object();switch(id){case 1:case 2:case 3:if(ev.keyCode)$H["keyCode"]=ev.keyCode;if(ev.which!=null)$H["keyCode"]=ev.which;break;case 12:$H["oldValue"]=this.oldValue;$H["value"]=this.getValue();break;case 13:$H["value"]=this.getValue();break;};return this.events.fireEvent(id,ev,$H);};PXTextEdit.prototype.recreateEditor=function($k){var et=null,$I=null,lc=this.linkCommand;if(this.hasEditLink&&$k){et=__doc(this).createElement("input"),$I=this.elemText;et.type="text";this.hasEditLink=false;}else if(!$k&&lc&&lc.enabled&&lc.command){et=__doc(this).createElement("a"),$I=this.elemText;et.href="javascript:void 0";this.hasEditLink=true;};if(et){et.id=$I.id;et.name=$I.name;et.className=$I.className;this.detachEventHandlers();if(this.elemText==this.element)this.element=et;$I.parentNode.replaceChild(this.elemText=this.elemFocus=et,$I);if(this.trange)this.trange.element=et;this.attachEventHandlers();}};PXTextEdit.prototype.onFocus=function(e){};PXTextEdit.prototype.onBlur=function(e){};PXTextEdit.prototype.onKeyDown=function(e){return true;};PXTextEdit.prototype.onKeyPress=function(e){return true;};PXTextEdit.prototype.onKeyUp=function(e){return true;};PXTextEdit.prototype.onMouseDown=function(e){return true;};PXTextEdit.prototype.handleEvents=function(e){var $J=PXEvent.baseEventID(e.type);if(this.fireEvent($J,e)&&$J<10){__px(this).cancelEvent(e);return;};switch(e.type){case "keydown":case "keypress":case "keyup":if((this.elemText.tagName=="INPUT"&&this.trackSelection)||this.trackPosition)this.getSelectedText();this.processKey(e,$J);break;case "input":if(__px(this).isVisible(this.element))__px_cm(this).notifyOwnerTyping(this);break;case "focus":this.processFocus(e);delete this.mouseClicked;break;case "blur":this.processBlur(e);break;case "mousedown":if(!this.onMouseDown(e))__px(this).cancelEvent(e);else this.mouseClicked=true;break;case "mouseup":if(this.lockMouseUp){__px(this).cancelEvent(e);delete this.lockMouseUp;};delete this.mouseClicked;break;case "click":if(this.hasEditLink)__px_callback(this).exec(this,this.linkCommand);break;case "paste":if(this.getDisabled()){__px(this).cancelEvent(e);return;};var $g=e.clipboardData?e.clipboardData:__win(this).clipboardData;if($g!=null){var $K=$g.getData("Text"),$L=this.getText();var $M=this.processPaste($K);if($K&&(!$M||$L!=this.getText()))__px_cm(this).notifyOwnerTyping(this);if($M)__px(this).cancelEvent(e);}else __px_cm(this).notifyOwnerTyping(this);break;case "beforepaste":e.returnValue=false;break;case "selectstart":if(!this.selectOnFocus){__px(this).cancelEvent(e);};break;}};PXTextEdit.prototype.processFocus=function(e){if(this.hasFocus)return;this.hasFocus=true;this.onFocus(e);this.oldValue=this.getValue();if(!this.getDisabled()&&this.allowRepaintText&&!this.hasEditLink){var $N=this.getEditText(this.getValue());if(this.elemText.value!=$N)this.elemText.value=$N;};this.selectContent(this.trackPosition);this.getSelectedText();if(this.allowRepaintText)__px_cm(this).notifyOwnerActivate(this);};PXTextEdit.prototype.selectContent=function($O){if(!__px(this).isVisible(this.element))return;var me=this;if((this.selectOnFocus||this.getDisabled())&&this.elemText.select){this.select();this.lockMouseUp=true;if(this.mouseClicked&&__px(this).IsEdge)setTimeout(function(){me.select();},0);}else if(this.elemText.tagName=="INPUT"||this.trackPosition){var $P=$O?this.selStart:0,$Q=$O?this.selEnd:0;if(__px(this).IsIE)this.select($P,$Q);else setTimeout(function(){me.select($P,$Q);},0);}};PXTextEdit.prototype.processBlur=function(e){this.hasFocus=false;this.onBlur(e);if(this.allowRepaintText&&!this.hasEditLink){this.updateValue();var $o=this.getDisplayText(this.getValue());if($o!=this.elemText.value)this.elemText.value=$o;}};PXTextEdit.prototype.processPaste=function($R){return false;};PXTextEdit.prototype.blockCtrlAlt=function(){return true;};PXTextEdit.prototype.processKey=function(e,$J){var k=e.keyC=e.keyCode;switch($J){case 1:if(e.keyCode==76&&e.ctrlKey&&e.shiftKey&&!e.altKey)return this.localeEditor(e);this.processKeyDefault(e,$J);if(!this.onKeyDown(e))__px(this).cancelEvent(e);switch(k){case 8:case 46:if(this.getDisabled()){__px(this).cancelEvent(e);break;};if(__px(this).IsAnyIE||__px(this).IsSafari||__px(this).IsFirefoxFrom65){e.keyC=(k==46)?7:k;if(!this.onKeyPress(e))__px(this).cancelEvent(e);}};break;case 2:if(this.getDisabled()){if(!e.ctrlKey)__px(this).cancelEvent(e);break;};if(!this.blockCtrlAlt()||!e.ctrlKey&&!e.altKey&&!e.metaKey){if(e.which!=null){k=e.keyC=e.which;if(e.keyCode==46&&k==0)k=e.keyC=7;};if(k){if(this.asciiCharSet&&k>127)__px(this).cancelEvent(e);else if(k!=13){if(!this.onKeyPress(e))__px(this).cancelEvent(e);}}};break;case 3:if(k&&!this.onKeyUp(e))__px(this).cancelEvent(e);break;}};PXTextEdit.prototype.processKeyDefault=function(e){var k=e.keyCode?e.keyCode:e.which;switch(k){case 8:if(this.getReadOnly())__px(this).cancelEvent(e);break;case 27:__px(this).cancelEvent(e,false);break;case 13:if(this.isTextArea()&&(e.ctrlKey||e.metaKey)){var et=this.elemText,$S=et.selectionEnd,$T=et.resizer;et.value=et.value.substring(0,$S)+'\n'+et.value.substring($S);et.selectionEnd=$S+1;if($T&&$T.adjust)$T.adjust();__px(this).cancelEvent(e);break;};if(!e.shiftKey){if(this.hideEnterKey)__px(this).cancelEvent(e);if(this.allowRepaintText)this.updateValue();};break;}};



function PXMaskEdit($a,$b,$c,$d){PXMaskEdit.initializeBaseA(this,[$a,$b,$c,$d]);this.trackSelection=true;__px_cm(this).readProperties(this,$c,PXMaskEdit.properties);this.setInputMask($c.inputMask);};PXMaskEdit.__baseType=PXTextEdit;PXMaskEdit.properties=[["promptChar",JSType.String,'_'],["emptyChar",JSType.String,' '],["valueMode",JSType.Int,0]];PXMaskEdit.callbackProps=[["inputMask",JSType.String,"","setInputMask"]];PXMaskEdit.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXMaskEdit.callbackProps);PXMaskEdit.callBase(this,"setProperties",[$c]);};PXMaskEdit.prototype.getValue=function($e){if(this.$P===undefined||$e){var $f=this.calculateValue(this.getText(),this.valueMode,1);if($f===undefined&&this.hasFocus&&this.validateEdit===false)$f=this.calculateValue(this.getText(),this.valueMode,0);if($f!==undefined)this.$P=$f;};return this.$P;};PXMaskEdit.prototype.setValue=function(v){var $f=this.calculateValue(v,this.valueMode,this.valueMode);if($f!==undefined){this.$P=this.oldValue=$f;this.repaintText($f);if(this.hasFocus&&__px(this).isVisible(this.element))this.selectContent(true);}};PXMaskEdit.prototype.initInlineEditor=function($g){this.mask=$g.mask;this.rawMask=$g.rawMask;this.maskFull=$g.maskFull;this.maskExclude=$g.maskExclude;this.maskInclude=$g.maskInclude;};PXMaskEdit.prototype.getInputMask=function(){return this.rawMask;};PXMaskEdit.prototype.setInputMask=function($h){if($h==null)$h="";if(this.rawMask==$h)return;var $i=this.mask?this.calculateValue(this.getText(),0,1):null,ar;this.maskFull=PXMaskEdit.encode($h);ar=PXMaskEdit.split(this.maskFull);this.mask=ar[0];this.maskExclude=ar[1];this.maskInclude=ar[2];if($i!=null){this.setText(this.getDisplayValue($i,0));this.$P=undefined;};this.rawMask=$h;this.viewState.update("InputMask",this.rawMask);};PXMaskEdit.prototype.getDisplayValue=function($j,$k,$l){if(this.mask){if($l==null)$l=this.promptChar;return PXMaskEdit.format(this.maskFull,$j,$l,$k);};return($j!=null)?$j:"";};PXMaskEdit.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return this.nullText;return this.getDisplayValue(v,this.valueMode,this.emptyChar);};PXMaskEdit.prototype.getEditText=function(v){if(this.validateEdit===false)return(v!=null)?v:"";return this.getDisplayValue(v,this.valueMode);};PXMaskEdit.prototype.calculateValue=function($m,$n,$o){if(this.isNullValue($m))return this.allowNull?null:"";if(!this.mask)return $m;var $p=new RegExp('\\'+this.promptChar,"g");$m=$m.toString().replace($p,String.fromCharCode(0));var j=0,c,$q,$r=true,$j="";for(var i=0;i<this.mask.length;i++){if(($q=this.mask.charCodeAt(i))<21){c=null;if(j<$m.length){c=PXMaskEdit.$Q($q,$m,j,null,this.maskExclude,this.maskInclude);j++;};$j+=c?c:this.emptyChar;if(c)$r=false;}else{if($o>0&&j<$m.length){if(this.mask.charAt(i)!=$m.charAt(j))return undefined;j++;};if($n>0)$j+=this.mask.charAt(i);}};return $r?(this.allowNull?null:""):$j.trimEnd();};PXMaskEdit.prototype.onKeyPress=function(e){if(!this.mask||this.validateEdit===false)return true;var k=e.keyC;if(k<7||(k>8&&k<32))return;var t=this.elemText.value,i=t.length;var $s=this.selStart,$t=this.selEnd;var $u=this.emptyChar.charCodeAt(0),$v=32;if($s!=$t){while(--$t>=$s){var ch=this.promptChar;if(this.mask.charCodeAt($t)>=21)ch=this.mask.charAt($t);t=t.substring(0,$t)+ch+t.substring($t+1);};$t++;}else if(k==7||(k==$v)){while($t<i&&this.mask.charCodeAt($t)>=21)$t++;if($t>=i)return;t=t.substring(0,$t)+this.promptChar+t.substring($t+1);$t++;}else if(k==8){while($t>0&&this.mask.charCodeAt($t-1)>=21)$t--;if($t--<1)return;t=t.substring(0,$t)+this.promptChar+t.substring($t+1);};if(k>8&&(k!=$v)&&$t<i){var c=String.fromCharCode(k);var $w=[t];$s=this.insertCharAt($w,c,$t);t=$w[0];if($s<0)return;$t=this.locatePromptPos($s);};this.elemText.value=t;this.select($t);__px_cm(this).notifyOwnerTyping(this);};PXMaskEdit.prototype.processPaste=function($x){if(!this.mask||this.validateEdit===false){return false;};var $s=this.selStart,$t=this.selEnd;var $y=this.elemText.value;$y=this.clearMaskedContent($y,$s,$t);var $w=[$y];var $z=$s;for(var i=0;i<$x.length;i++){if(this.mask.charCodeAt($z)<=20&&$x.charAt(i)==this.promptChar){$z++;continue;};$z=this.insertCharAt($w,($x.charAt(i)),$z);if($z<0||$z>=this.mask.length)break;};this.elemText.value=$w[0];this.select($t>0?$t:$s);return true;};PXMaskEdit.prototype.clearMaskedContent=function($A,$s,$t){if($s==null||$s<0)$s=0;if($t==null||$t>this.mask.length)$t=this.mask.length;if($s>$t){var $B=$t;$t=$s;$s=$B;};if($s!=$t){while(--$t>=$s){var ch=this.promptChar;if(this.mask.charCodeAt($t)>=21)ch=this.mask.charAt($t);$A=$A.substring(0,$t)+ch+$A.substring($t+1);};$t++;};return $A;};PXMaskEdit.prototype.locatePromptPos=function($C,$D){var $E=this.mask.length;while($C>=0&&$C<$E&&this.mask.charCodeAt($C)>=21){if($D)$C--;else $C++;};return $C;};PXMaskEdit.prototype.insertCharAt=function($F,$G,$C){var i=this.mask.length;var $s=$C;var $H=$F[0];if($C<i){if(this.__checkField){var $I=new Object();$I.txt=$H;$s=this.__checkField($G.charCodeAt(0),$G,$H,$C,$I);if($s>=0){$H=$I.txt;$F[0]=$H;return $s;}else return -1;}else{if(this.mask.charCodeAt($s)>=21&&this.mask.charAt($s)==$G)return ++$s;while(this.mask.charCodeAt($s)>=21)if(++$s>=i)return;if(($G=PXMaskEdit.$Q(this.mask.charCodeAt($s),$G,0,null,this.maskExclude,this.maskInclude))==null){return -1;};$H=$H.substring(0,$s)+$G+$H.substring($s+1);$F[0]=$H;$s++;return $s;}}};PXMaskEdit.format=function($J,$j,$K,$L){if($L==null)$L=0;if($j==null)$j="";var $m="",c,$q,j=0,ar=PXMaskEdit.split($J);var $h=ar[0],$M=ar[1],$N=ar[2];for(var i=0;i<$h.length;i++){if(($q=$h.charCodeAt(i))<21){c=null;if(j<$j.length){c=PXMaskEdit.$Q($q,$j,j,null,$M,$N);j++;};$m+=c?c:$K;}else{$m+=$h.charAt(i);if($L>0)j++;}};return $m;};PXMaskEdit.encode=function($O){var x,c,up=0,n="",$q=PXMaskEdit.$R;var ar=PXMaskEdit.split($O);var $h=ar[0],$M=ar[1],$N=ar[2];for(var i=0;i<$h.length;i++){c=$h.charAt(i);if((x=$q(c,up))!=0){if(x<0){up=(up==-x)?0:-x;continue;};n+=String.fromCharCode(x);}else if(c=="\\"&&(i+1)<$h.length){c=$h.charAt(i+1);if($q(c,0)!=0){n+=c;i++;}}else n+=c;};if($M)n+='|'+$M;if($N){if(!$M)n+='|';n+='|'+$N;};return n;};PXMaskEdit.split=function($h){var ar=$h.split('|');if(ar.length==1)ar[1]="";if(ar.length==2)ar[2]="";return ar;};PXMaskEdit.$R=function(c,up){switch(c){case '>':return -1;case '<':return -2;case '&':c=1;break;case 'C':c=2;break;case 'A':c=7;break;case 'a':c=8;break;case 'L':c=13;break;case '?':c=14;break;case '#':case '0':return 19;case '9':return 20;default:return 0;};return c+up*2;};PXMaskEdit.$Q=function($q,s,i,sf,$M,$N){if(i>=s.length)return sf;var x=s.charCodeAt(i),c=s.charAt(i);if(x<21||($M&&$M.indexOf(c)!=-1))return sf;if($N&&$N.indexOf(c)!=-1)return c;var f=Math.floor(($q-1)/6);switch(f){case 0:break;case 1:if(x>47&&x<58)return c;case 2:if(x>255||c.toUpperCase()!=c.toLowerCase())break;return sf;case 3:return(x>47&&x<58)?c:sf;};if(($q=Math.floor(($q-1)/2)%3)==0)return c;c=($q==2)?c.toLowerCase():c.toUpperCase();if($M&&$M.indexOf(c)!=-1)return sf;return c;};



function PXButtonEdit($a,$b,$c,$d){PXButtonEdit.initializeBaseA(this,[$a,$b,$c,$d]);this.trackSelection=true;this.blockTabletEnter=false;__px_cm(this).readProperties(this,$c,PXButtonEdit.properties);this.isSimple=($b.tagName=="INPUT");this.elemFocus=this.getTextElem();this.elemButton=this.getButtonElem();this.attachEventHandlers(true);this.events.appendEvents(PXButtonEdit.events,$c.clientEvents);};PXButtonEdit.imagesDesc=[["normal",JSType.String,"control@SelectorN"],["disabled",JSType.String,"control@SelectorD"],["hover",JSType.String,"control@SelectorH"],["pushed",JSType.String,"control@SelectorP"]];PXButtonEdit.properties=[["images",JSType.Object,null],["styles",JSType.Object,null],["commandSourceID",JSType.String,""],["commandName",JSType.String,""],["popupPanel",JSType.String,""],["popupCommand",JSType.Object,PXCallbackManager.settingsDesc],["activeButton",JSType.Bool,false],["readOnlyAlways",JSType.Bool,false]];PXButtonEdit.__baseType=PXTextEdit;PXButtonEdit.events={$buttonClick:14};PXButtonEdit.prototype.attachEventHandlers=function($e){if(!$e){__px_cm(this).addBaseHandlers(this.elemText,this.eventsH);__px(this).addEventHandler(this.elemText,"beforepaste",this.eventsH,false);__px(this).addEventHandler(this.elemText,"paste",this.eventsH,false);__px(this).addEventHandler(this.elemText,"input",this.eventsH,false);};if(this.elemButton){if(__px(this).IsTablet&&this.blockTabletEnter){if(this.touchEventsH==null)this.touchEventsH=Function.createDelegate(this,this.handleTouchEvents);__px(this).addEventHandler(this.elemText,"touchstart",this.touchEventsH);};var bh=PXButtonEdit.handleButtonEvents;__px(this).addEventHandler(this.elemButton,"mousedown",bh);__px(this).addEventHandler(this.elemButton,"mouseup",bh);__px(this).addEventHandler(this.elemButton,"mouseover",bh);__px(this).addEventHandler(this.elemButton,"mouseout",bh);}};PXButtonEdit.prototype.detachEventHandlers=function(){__px_cm(this).removeBaseHandlers(this.elemText,this.eventsH);__px(this).removeEventHandler(this.elemText,"beforepaste",this.eventsH,false);__px(this).removeEventHandler(this.elemText,"paste",this.eventsH,false);__px(this).removeEventHandler(this.elemText,"input",this.eventsH,false);if(this.elemButton){if(__px(this).IsTablet)__px(this).removeEventHandler(this.elemText,"touchstart",this.touchEventsH);var bh=PXButtonEdit.handleButtonEvents;__px(this).removeEventHandler(this.elemButton,"mousedown",bh);__px(this).removeEventHandler(this.elemButton,"mouseup",bh);__px(this).removeEventHandler(this.elemButton,"mouseover",bh);__px(this).removeEventHandler(this.elemButton,"mouseout",bh);}};PXButtonEdit.prototype.setSize=function($f,$g){var w=parseInt($f),h=parseInt($g);if(!this.isSimple){this.element.style.width=w+"px";this.element.style.height=h+"px";}else{this.elemText.style.width=w+"px";this.elemText.style.height=h+"px";}};PXButtonEdit.prototype.adjustTextSize=function(){if(!this.isSimple){var c1=this.elemText.parentNode,c2=this.elemButton.parentNode;var $h=this.element.clientWidth;$h-=c2.offsetWidth+(c1.offsetWidth-__px(this).getStyleWidth(c1));this.elemText.style.width=__px(this).getStyleWidth(this.elemText,$h)+"px";}};PXButtonEdit.prototype.getTextElem=function(){var $i=__px(this).elemByID(this.element.id+"_text");return $i?$i:this.element;};PXButtonEdit.prototype.getButtonElem=function(){var $j=this.element.getElementsByTagName("div"),$k=null;if($j)for(var i=0;i<$j.length;i++){var $l=$j[i].getAttribute("type");if($l=="sel"){$k=$j[i];break;}};return $k;};PXButtonEdit.prototype.setEnabled=function($m){if($m!=this.getEnabled()){__px_cm(this).setEnabled(this,$m);this.afterSetState();}};PXButtonEdit.prototype.setReadOnly=function($n){if(!this.readOnlyAlways&&$n!=this.getReadOnly()){__px_cm(this).setReadOnly(this,$n);this.afterSetState();}};PXButtonEdit.prototype.afterSetState=function(){this.$v=this.$w=false;var eb=this.elemButton,$o=0;if(eb){this.setButtonStyle();eb.style.display=(this.getDisabled()&&!this.activeButton)?"none":"";$o=(eb.style.display=="")?1:0;};if($o==1)this.element.removeAttribute("buttons");else this.element.setAttribute("buttons",$o);if(this.hasFocus){this.elemText.blur();this.elemText.value=this.getDisplayText(this.getValue());this.hasFocus=false;}};PXButtonEdit.prototype.setButtonStyle=function(){var st=this.styles,im=this.images;var $p,$q,$r=new Array();if(this.getDisabled()&&!this.activeButton){if(st)$q=st.disabled;if(im)$p=im.disabled;}else if(this.$w){if(st)$q=st.pushed;if(im)$p=im.pushed;}else if(this.$v){if(st)$q=st.hover;if(im)$p=im.hover;};if(st){if(st.normal)$r.push(st.normal);if($q)$r.push($q);};if(this.elemButton&&im){if(!$p)$p=im.normal;__px_cm(this).repaintImage(this.elemButton,$p);}};PXButtonEdit.handleButtonEvents=function(e){var $s=__px(this).eventObject(e);if($s){if(!$s.getDisabled()||$s.activeButton)switch(e.type){case "mouseover":$s.$v=true;$s.setButtonStyle();break;case "mouseout":$s.$w=$s.$v=false;$s.setButtonStyle();break;case "mousedown":$s.$w=true;$s.setButtonStyle();if(!$s.fireEvent(14,e))$s.onButtonClick(e);__px(this).cancelEvent(e,false);break;case "mouseup":$s.$w=false;$s.setButtonStyle();break;}}};PXButtonEdit.prototype.onKeyDown=function(e){switch(e.keyCode){case 114:if(!this.fireEvent(14,e))this.onButtonClick(e);return false;};return PXButtonEdit.callBase(this,"onKeyDown",[e]);};PXButtonEdit.prototype.onButtonClick=function(e){var $s=__px(this).eventObject(e);if($s){$s.$w=false;$s.setButtonStyle();};if(this.commandSourceID&&this.commandName){var $t=__px_all(this)[this.commandSourceID];if($t&&$t.executeCommand){$t.sourceEvent=e;$t.executeCommand(this.commandName,this.commandArgument);return true;}};if(this.popupPanel){var $u=__px_all(this)[this.popupPanel];if($u){if(!$u.getVisible()){$u.closeCallback=this.popupCommand;$u.show(this);}else $u.hide();return true;}};return false;};PXButtonEdit.prototype.handleTouchEvents=function(e){switch(e.type){case "touchstart":this.onButtonClick(e);__px(this).cancelEvent(e);break;}}


function PXDateTimeEdit($a,$b,$c,$d){PXDateTimeEdit.initializeBaseA(this,[$a,$b,$c,$d]);this.century=29;__px_cm(this).readProperties(this,$c,PXDateTimeEdit.properties);if(this.durationMode)this.timeMode=true;this.blockTabletEnter=true;this.elemFocus=this.getTextElem();this.elemButton=this.getButtonElem();this.AM=_dateFormatInfo.am?_dateFormatInfo.am:"AM";this.PM=_dateFormatInfo.pm?_dateFormatInfo.pm:"PM";this.lengthAmPm=(this.AM.length>this.PM.length)?this.AM.length:this.PM.length;this.yearFix=_dateFormatInfo.yearFix?_dateFormatInfo.yearFix:0;if(this.fullMonth)this.monthNames=_dateFormatInfo.monthNames.split(",");else this.monthNames=_dateFormatInfo.abbrMonthNames.split(",");if(this.fullDOW)this.dowNames=_dateFormatInfo.dayNames.split(",");else this.dowNames=_dateFormatInfo.abbrDayNames.split(",");this.$0H();this.attachEventHandlers(true);this.dropCall=__px_callback(this).createCommand("DropDown",true);};PXDateTimeEdit.__baseType=PXMaskEdit;PXDateTimeEdit.prototype.$0H=function(){this.mask0=this.$0I(this.editMask,false);this.mask1=this.$0I(this.displayMask,true);this.$0J();this.setInputMask(this.mask0);};PXDateTimeEdit.prototype.$0J=function(){this.emptyText=this.mask0.replace(/[#LC]/g,this.promptChar);};PXDateTimeEdit.prototype.initInlineEditor=function($e){this.editMask=$e.editMask;this.displayMask=$e.displayMask;this.$0H();};PXDateTimeEdit.$0K=new Date(1900,0,1);PXDateTimeEdit.$0L=new Date(9999,11,31);PXDateTimeEdit.properties=[["editMask",JSType.String,""],["displayMask",JSType.String,""],["minValue",JSType.Date,PXDateTimeEdit.$0K],["maxValue",JSType.Date,PXDateTimeEdit.$0L],["timeMode",JSType.Bool,false],["durationMode",JSType.Bool,false],["fullDOW",JSType.Bool,false],["fullMonth",JSType.Bool,false],["selectOnFocus",JSType.Bool,false],["images",JSType.Object,null],["dropDownStyles",JSType.Object,null],["maxVisibleItems",JSType.Int,20],["allowStrings",JSType.Bool,false],["allowCustomItems",JSType.Bool,false],["roundUpTime",JSType.Int,false]];PXDateTimeEdit.callbackProps=[["minValue",JSType.Date,PXDateTimeEdit.$0K],["maxValue",JSType.Date,PXDateTimeEdit.$0L]];PXDateTimeEdit.prototype.setProperties=function($c){if($c.editMask){this.editMask=$c.editMask;this.displayMask=$c.displayMask;this.$0H();};__px_cm(this).readProperties(this,$c,PXDateTimeEdit.callbackProps);__px_cm(this).readProperties(this,$c,PXTextEdit.callbackProps);};PXDateTimeEdit.prototype.getTextElem=PXButtonEdit.prototype.getTextElem;PXDateTimeEdit.prototype.getButtonElem=PXButtonEdit.prototype.getButtonElem;PXDateTimeEdit.prototype.adjustTextSize=PXButtonEdit.prototype.adjustTextSize;PXDateTimeEdit.prototype.setSize=PXButtonEdit.prototype.setSize;PXDateTimeEdit.prototype.getEnabled=PXButtonEdit.prototype.getEnabled;PXDateTimeEdit.prototype.setEnabled=PXButtonEdit.prototype.setEnabled;PXDateTimeEdit.prototype.setReadOnly=PXButtonEdit.prototype.setReadOnly;PXDateTimeEdit.prototype.setButtonStyle=PXButtonEdit.prototype.setButtonStyle;PXDateTimeEdit.prototype.afterSetState=PXButtonEdit.prototype.afterSetState;PXDateTimeEdit.prototype.attachEventHandlers=PXButtonEdit.prototype.attachEventHandlers;PXDateTimeEdit.prototype.detachEventHandlers=PXButtonEdit.prototype.detachEventHandlers;PXDateTimeEdit.prototype.handleTouchEvents=PXButtonEdit.prototype.handleTouchEvents;PXDateTimeEdit.prototype.getValue=function($f){if(this.$0M===undefined||$f){var $g=this.$0N(this.elemText.value,true);if(this.allowStrings||!isNaN($g))this.$0M=$g;};return this.$0M;};PXDateTimeEdit.prototype.setValue=function(v){var $g=this.$0O(v);if(this.allowStrings||(!isNaN($g)&&__px(this).equals(this.$0P($g),$g))){this.$0M=this.oldValue=$g;if(this.hasFocus){this.elemText.value=this.getEditText(this.$0M);if(__px(this).isVisible(this.element))this.select(this.selStart);}else this.elemText.value=this.getDisplayText(this.$0M);}};PXDateTimeEdit.prototype.setDateMask=function($h,$i){this.mask0=this.$0I($h,false);this.mask1=this.$0I($i,true);this.setInputMask(this.mask0);this.$0J();};PXDateTimeEdit.prototype.setTimeMode=function($j){if($j==this.timeMode)return;this.timeMode=$j;this.clearDropDown();if(this.sourceID&&__px_all(this)[this.sourceID])__px_all(this)[this.sourceID].clearDropDown();};PXDateTimeEdit.prototype.getMaxValue=function(){return this.maxValue;};PXDateTimeEdit.prototype.setMaxValue=function(v){var $g=this.$0O(v);if(!isNaN($g)&&$g!=this.maxValue){this.maxValue=$g;this.viewState.update("MaxValue",__px(this).getInvariantText($g));this.setValue(this.$0P(this.getValue()));}};PXDateTimeEdit.prototype.getMinValue=function(){return this.minValue;};PXDateTimeEdit.prototype.setMinValue=function(v){var $g=this.$0O(v);if(!isNaN($g)&&$g!=this.minValue){this.minValue=$g;this.viewState.update("MinValue",__px(this).getInvariantText($g));this.setValue(this.$0P(this.getValue()));}};PXDateTimeEdit.prototype.clearDropDown=function(){if(this.dropDown!=null){if(this.dropDown.parentNode)this.dropDown.parentNode.removeChild(this.dropDown);this.dropDown=null;}};PXDateTimeEdit.prototype.$0I=function(v,$k){if($k){if(this.field1ID==null)this.field1ID=new Array();this.field1ID.length=0;}else{if(this.field0ID==null)this.field0ID=new Array();this.field0ID.length=0;};if(v==null)v="";var x,i,i0=0,$l=-1,t="";for(i=0;i<v.length;i++){x=v.charCodeAt(i);if(x<48||x>57){$l=v.charAt(i);if($k==true&&$l=="\\"&&(i+1)<v.length){if((x=v.charAt(++i))=="\\")continue;if(x=="0"||x=="9")t+=$l;t+=x;}else t+=$l;continue;};$l=(x-48)*10+v.charCodeAt(++i)-48;if($k==true){this.field1ID[i0++]=$l;t+="\x01";}else{this.field0ID[i0++]=$l;if($l==14)t+="L";else if($l==15)t+=Array(this.lengthAmPm+1).join('C');else if($l==22)t+="#";else{t+="##";if($l==3)t+="##";while($l-->23)t+="#";}}};return t;};PXDateTimeEdit.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return this.nullText;return this.$0Q(v,false);};PXDateTimeEdit.prototype.getEditText=function(v){return this.$0Q(v,true);};PXDateTimeEdit.prototype.$0Q=function(d,$m){if(this.allowStrings&&!(d instanceof Date))return d!=null?d.toString():"";if(d==null||d=="")return this.getDisplayValue("",1);var t="",$n=$m?this.mask:this.mask1;var $o=$m?this.field0ID:this.field1ID;var c,k,i=-1,f0=0;while(++i<$n.length){c=$n.charAt(i);if((k=$n.charCodeAt(i))<21){t+=this.$0R($o[f0++],d,$m,c);if($m){while((i+1)<$n.length)if($n.charCodeAt(i+1)==k)i++;else break;}}else t+=c;};return $m?this.getDisplayValue(t,1):t;};PXDateTimeEdit.prototype.$0N=function(t,$p){var d;if(this.isNullValue(t)||t==this.emptyText){if(this.allowNull)return null;d=new Date();}else{if(t instanceof Date)d=t;else{d=this.$0S(t,this.hasFocus,$p);if(isNaN(d))d=this.$0S(t,!this.hasFocus,$p);}};if(this.timeMode&&!isNaN(d)){d.setFullYear(1900);d.setMonth(0);if(!this.durationMode)d.setDate(1);};if(this.allowCustomItems)this.$0T(d);if(this.allowStrings&&(d==undefined||isNaN(d)))d=t;return $p?this.$0P(d):d;};PXDateTimeEdit.prototype.$0O=function(t){var d;if(this.isNullValue(t)){if(this.allowNull)return null;d=new Date();}else{if(t instanceof Date)d=t;else{if(this.timeMode||t.indexOf(':')>0){var $q=Date.parse(t);if(!isNaN($q))d=new Date($q);}else{var $r=t.split("/");if($r.length>=3){var y=parseInt($r[2]),m=parseInt($r[0]),d=parseInt($r[1]);if(!isNaN(y)&&!isNaN(m)&&!isNaN(d))d=PXCalendar.createDate(y,m-1,d);}}}};if(this.timeMode&&!isNaN(d)){d.setFullYear(1900);d.setMonth(0);if(!this.durationMode)d.setDate(1);};if(this.allowCustomItems)this.$0T(d);if(this.allowStrings&&(d==undefined||isNaN(d)))d=t;return d;};PXDateTimeEdit.prototype.$0P=function(d){if(!this.timeMode&&!this.allowStrings&&d!=null&&!isNaN(d)){var v=d.getTime(),$s=this.minValue,$t=this.maxValue;if($s!=null)$s=$s.getTime();if($t!=null)$t=$t.getTime();if($s!=null&&v<$s){d=new Date($s);};if($t!=null&&v>$t){d=new Date($t);}};return d;};PXDateTimeEdit.prototype.$0S=function(t,$m,$p){var $u=this.$0U(t,$m);var v,i0,$v=0,i=-1,$w=$u.length,c;var y=-1,mo=-1,$x=-1,h=-1,m=-1,s=-1,ms=-1,pm=-1;while(++i<$w){v=$u[i];i0=$m?this.field0ID[i]:this.field1ID[i];if(i0<4){if(v>100&&v>this.yearFix)v-=this.yearFix;if(v<0)$v++;else{y=v;c=this.century;if(v<100){if(i0<3&&c<0)c=29;if(c>=0)y+=(v>c)?1900:2000;}}}else if(i0<8){if(v<1||v>12)$v++;else mo=v;}else if(i0<10){if(v<1||v>31)$v++;else $x=v;}else if(i0<14){if(v==24)v=0;if(i0>11)pm=-4;else{if(v==12)v=0;if(v>12)$v++;};if(v>23)$v++;else h=v;}else if(i0<16){if(v>0)pm++;continue;}else if(i0<18){if(v>59)$v++;else m=v;}else if(i0<20){if(v>59)$v++;else s=v;}else if(i0<22){continue;}else{while(i0++<24)v*=10;while(i0-->25)v=Math.floor(v/10);ms=v;}};if(pm==0&&h>=0&&h<12)h+=12;var d=NaN;if($v==0){if(y>0&&mo>0){d=new Date(y,mo-1);d.setFullYear(y,mo-1);}else d=new Date();if(d!=null){if(mo>0)d.setMonth(mo-1);if($x>0)d.setDate($x);d.setHours(h>=0?h:0);d.setMinutes(m>=0?m:0);d.setSeconds(s>=0?s:0);d.setMilliseconds(ms>=0?ms:0);if(y>0&&mo>0&&$x>0)d.setFullYear(y,mo-1,$x);};if($p)d=this.$0P(d);};return d;};PXDateTimeEdit.prototype.$0V=function(t){if(t==null)t="";var $u=new Array();var x,k,i=-1,v=-1,$y=-1,n=22;while(++i<this.mask.length){if((x=this.mask.charCodeAt(i))>21&&n>21)continue;if(x>21){if($y>=0)$u[$y]=v;}else{if(n>21){v=-1;$y++;};if(i>=t.length)continue;if(x>18){k=t.charCodeAt(i)-48;if(k>=0&&k<=9){if(v<0)v=k;else v=v*10+k;}}else if(n!=x){if(this.PM.charAt(0).toUpperCase()==t.charAt(i).toUpperCase())v=1;}};n=x;};$u[$y]=v;return $u;};PXDateTimeEdit.prototype.$0U=function(t,$m){var $o=($m&&!this.getDisabled())?this.field0ID:this.field1ID;var $w=$o.length;var i=-1,v=0,$y=0,$u=new Array($w);while(++i<$w)$u[i]=-1;if(t==null)return $u;t=t.toUpperCase();i=-1;while(++i<t.length&&$y<$w){var k=t.charCodeAt(i)-48,j=$o[$y];if(t.charAt(i)==this.promptChar)continue;if(j==20||j==21)j=$o[++$y];if(j==14||j==15){if(k>=0&&k<=9){v=-1;$y++;i--;continue;};if(this.PM.charAt(0).toUpperCase()==t.charAt(i)){$u[$y++]=1;v=-1;}}else if(j==6||j==7){v=-1;while(v-->-3){for(k=0;k<12;k++){var m=this.monthNames[k].toUpperCase();if((j=m.length)<1)continue;if(v==-3){if(j<4)continue;m=m.substring(0,3);};if((j=t.indexOf(m)-1)>-2)if(j<0||t.charAt(j).toLowerCase()==t.charAt(j))break;};if(k<12){$u[$y]=k+1;break;}};$y++;}else{if(k>=0&&k<=9){if(v<=0)v=k;else v=v*10+k;}else if(v>=0){$u[$y++]=v;v=0;}}};if($y<$w)$u[$y]=v;return $u;};PXDateTimeEdit.prototype.$0W=function($z,$A){var x,n=22,$y=$A.n0=$A.n1=-1;for(var i=0;i<this.mask.length;i++){if(((x=this.mask.charCodeAt(i))>21)==(n>21))continue;if(x>21){if(i>=$z)break;}else{$A.n0=i;$y++;};n=x;};if($A.n0>=0)$A.n1=i;if(($y=this.field0ID[$y])==null)return -1;if($y<8)return($y<4)?0:1;if($y<20)return Math.floor(($y-4)/2);return($y>21)?8:-1;};PXDateTimeEdit.prototype.$0R=function($y,d,$m,ch){var v,i=($y&1)*2;if($y<4){v=d.getFullYear()+this.yearFix;if($y==3)i=4;else{v%=100;i=($y==2)?2:0;}}else if($y<8){v=d.getMonth()+1;if($y>5){$y=this.monthNames[v-1];if($y.length>0)return $y;}}else if($y<10)v=d.getDate();else if($y<16){v=d.getHours();if($y>13){v=(v<12)?this.AM:this.PM;if(($y-=13)==(i=v.length))return v;if(i<$y)v+=" ";return($y==1)?v.substring(0,$y):v;};if($y<12){v%=12;if(v==0)v=12;}}else if($y<18)v=d.getMinutes();else if($y<20)v=d.getSeconds();else if($y<22)return this.dowNames[d.getDay()];else{v=d.getMilliseconds();var j=i=$y-21;while(j-->3)v*=10;while(j++<2)v=Math.floor(v/10);};v=v.toString();if($y<20){$y=v.length;if($m){if(i==0)i=2;else $m=false;};if(i>0){if(i<$y)v=v.substring(0,i);else while($y++<i)v=($m?ch:"0")+v;}};return v;};PXDateTimeEdit.prototype.__checkField=function(k,c,t,$z,$B){var i=t.length,$A=new Object();var n=0,v=-1,$y=this.$0W($z,$A);if(c==this.mask.charAt($z))return ++$z;if($z>=$A.n1){$z--;if(t.charAt($z)!=this.promptChar)return this.__checkField(k,c,t,$z+2,$B);};if($y<0)return -1;if($y==5){if($z<$A.n1){v=this.PM;if(v.charAt(0).toUpperCase()!=c.toUpperCase())v=this.AM;if($A.n1==($A.n0+1))v=v.charAt(0);else{if((i=v.length)<this.lengthAmPm)v+=" ";else if(i>this.lengthAmPm)v=v.substring(0,this.lengthAmPm);};$B.txt=t.substring(0,$A.n0)+v+t.substring($A.n1);};return $A.n1;};if(k<48||k>57){if(k==46||k==58){$z=$A.n1;while(++$z<i)if(this.mask.charCodeAt($z)<21)break;return $z;};return -1;};k-=48;if($A.n0==$z){v=(t.charAt($z+1)==this.promptChar)?0:(t.charCodeAt($z+1)-48);switch($y){case 4:k--;v-=2;case 3:case 1:if(k>1)n=1;else if(k==1&&v>2)n=2;break;case 2:if(k>3)n=1;else if(k==3&&v>1)n=2;break;case 6:case 7:if(k>5)n=1;break;}};if(($A.n0+1)==$z){v=(t.charAt($z-1)==this.promptChar)?0:(t.charCodeAt($z-1)-48);switch($y){case 4:v--;k-=2;case 3:case 1:if(v>1||(v==1&&k>2))n=3;break;case 2:if(v>3||(v==3&&k>1))n=3;break;case 6:case 7:if(v>6||(v==6&&k>0))n=3;break;}};if(n==1){t=t.substring(0,$z)+this.promptChar+t.substring($z+1);$z++;};if(n==2)t=t.substring(0,$z+1)+this.promptChar+t.substring($z+2);if(n==3){while(++$z<i)if(this.mask.charCodeAt($z)<21)break;if($z>=i)return -1;return this.__checkField(k+48,c,t,$z,$B);};$B.txt=t.substring(0,$z)+c+t.substring($z+1);return ++$z;};PXDateTimeEdit.prototype.showDropDown=function(){if(this.dropDownOpen||this.getDisabled())return;__px_cm(this).closeActiveDropDown(this);if(this.sourceID){var $e=__px_all(this)[this.sourceID];if($e.dropDown&&$e.timeMode==this.timeMode)this.dropDown=$e.dropDown;};if(this.timeMode){if(!this.dropDown)this.$0X();__px_cm(this).setDropDownVisible(this,true);__px(this).setDropDownPos(this.element,this.dropDown,2);if(!this.hasFocus)this.focus();PXDropDown.hilightRow(this,this.dropDownStyles,this.$0Y());return;};if(this.dropDown==null){var $C=Function.createDelegate(this,this.$0Z);__px_callback(this).execI(this,this.dropCall,"",$C);}else{if(!this.calendar)this.$10();this.calendar.$11=this;var $j=this.getValue(true);if($j!=null)this.calendar.setSelectedDate($j);__px_cm(this).setDropDownVisible(this,true);if(this.calendar){__px(this).setDropDownPos(this.element,this.dropDown,2);this.calendar.element.style.zIndex=parseInt(this.dropDown.style.zIndex);this.calendar.focus();}}};PXDateTimeEdit.prototype.$0Z=function($D,$a){if($D){var $E=this.$12()+"_div",me=this;var $F=__px_cm(this).processHtmlData($D,$E);if(this.sourceID){var $e=__px_all(this)[this.sourceID];if($e&&$e.timeMode==this.timeMode)$e.dropDown=$F;};this.dropDown=$F;setTimeout(function(){me.showDropDown();},0);}};PXDateTimeEdit.prototype.$10=function(){var $G=this.$12()+"_drop";var $H=this.sourceID?(this.sourceID+"_drop"):null;if(!__px_all(this)[$G]){this.calendar=__px_cm(this).createControl("PXCalendar",$G,$H);__px_all(this)[$G]=this.calendar;}else this.calendar=__px_all(this)[$G];if(!this.calendar.$13){var ev=this.calendar.events;ev.addEventHandler("dayClick",PXDateTimeEdit.$14);ev.addEventHandler("itemClick",PXDateTimeEdit.$14);ev.addEventHandler("keyDown",PXDateTimeEdit.$15);this.calendar.$13=true;}};PXDateTimeEdit.prototype.hideDropDown=function($I,$J){if(!this.dropDown||!this.dropDownOpen)return;try{if($I){var $K=null;if(this.timeMode){var i=(this.currentRow!=null)?this.currentRow.rowIndex:-1;if(i>=0){$K=this.timeItems[i].value;if(this.durationMode){var $j=this.getValue();if($j!=null)$K.setDate($j.getDate());}}}else{$K=$J?$J:this.calendar.getSelectedDate();this.$0T($K);if(this.allowStrings)this.allowCustomItems=true;};if($K)this.updateValue($K);}}finally{__px_cm(this).setDropDownVisible(this,false);}};PXDateTimeEdit.prototype.$12=function(){return this.sourceID?this.sourceID:this.ID;};PXDateTimeEdit.prototype.$0T=function(d){this.allowStrings=!(d instanceof Date);this.validateEdit=!this.allowStrings;};PXDateTimeEdit.prototype.$0X=function(){this.timeItems=new Array();for(var h=0;h<24;h++){var $L=(h==0&&this.durationMode)?15:30;for(var m=0;m<60;m+=$L){var $M=new Object();var $N=new Date(1900,0,1,h,m,0);$M.value=$N;$M.text=this.getDisplayText($N);$M.enabled=true;this.timeItems.push($M);}};PXDropDown.createDropDown(this,this.timeItems,this.dropDownStyles,false);};PXDateTimeEdit.prototype.$0Y=function($j){if($j==null)$j=this.getValue();for(var i=0;i<this.timeItems.length;i++){if(__px(this).equals($j,this.timeItems[i].value))return i;};return -1;};PXDateTimeEdit.prototype.processDDEvents=function(e,$O){switch(e.type){case "mouseover":if($O&&($O!=this.currentRow))PXDropDown.hilightRow(this,this.dropDownStyles,$O);break;case "mousedown":this.focus();return __px(this).cancelEvent(e,true);case "mouseup":if($O){this.hideDropDown(true);this.focus();};break;}};PXDateTimeEdit.prototype.executeCallback=function($P,$Q){switch($P){case "DropDown":this.showDropDown();break;}};PXDateTimeEdit.prototype.onFocus=function(e){if(!this.$16){}};PXDateTimeEdit.prototype.onKeyDown=function(e){if(PXDateTimeEdit.callBase(this,"onKeyDown",[e])){var $R=!(e.ctrlKey||e.metaKey||e.altKey);switch(e.keyC){case PX.key_down:case PX.key_minus:case PX.key_dash:case PX.key_F3:if(!this.timeMode&&(e.keyC==PX.key_F3||e.altKey)){this.onButtonClick();if(__px(this).IsIE)e.keyCode=0;return false;}else if((e.keyC!=PX.key_F3)&&!e.shiftKey&&!this.inlineEditor&&!this.allowStrings){this.incrementActivePart(-1);return false;};break;case PX.key_up:case PX.key_plus:case PX.key_plus2:var $S=($R&&e.shiftKey&&e.keyC==PX.key_plus2)||($R&&!e.shiftKey&&e.keyC!=PX.key_plus2);if($S&&!this.inlineEditor&&!this.allowStrings){this.incrementActivePart(1);return false;};break;case PX.key_right:if($R&&!e.shiftKey&&!this.allowStrings){this.selectActivePart(this.getActivePartIndex()+1);return false;};break;case PX.key_left:if($R&&!e.shiftKey&&!this.allowStrings){this.selectActivePart(this.getActivePartIndex()-1);return false;};break;case PX.key_dot:case PX.key_dot2:case PX.key_slash:case PX.key_slash2:if($R&&!this.allowStrings){if(e.shiftKey)this.selectActivePart(this.getActivePartIndex()-1);else this.selectActivePart(this.getActivePartIndex()+1);return false;};break;}};return true;};PXDateTimeEdit.prototype.separate=function($T){var $U=function(c){return '\\/.:- '.indexOf(c)>-1;};var $V=function($T){var $D=[];for(var i=0;i<$T.length;i++){if($U($T[i]))$D.push(i);};return $D;};var $W=function($T,$A,$X,$Y){for(var i=0;i<$Y.length;i++){var $Z=$Y[i];var $00=$T.substr($A-$Z,$X.length);if($00==$X)return true;};return false;};var $01=$V(this.AM);var $02=$V(this.PM);var $D=[];var $03='';for(var i=0;i<$T.length;i++){var c=$T[i];if($U(c)&&!($W($T,i,this.AM,$01)||$W($T,i,this.PM,$02))){$D.push($03);$03='';}else $03+=c;};if($03!='')$D.push($03);return $D;};PXDateTimeEdit.prototype.getPartCount=function($T){return this.separate($T).length;};PXDateTimeEdit.prototype.getActivePartIndex=function(){var $04=this.trange.selEnd;var $05=this.getText().substring(0,$04);return this.getPartCount($05)-1;};PXDateTimeEdit.prototype.getPartLen=function($Z){return this.separate(this.editMask)[$Z].length;};PXDateTimeEdit.prototype.selectActivePart=function($Z){if(this.getDisabled())return;var $06=function($07){return $07.reduce(function(n0,n1){return n0+n1.length+1;},0)};var $08=this.getText();var $09=this.getPartCount($08);if($Z>=0&&$Z<$09){var $0a=this.separate($08);var $0b=$06($0a.slice(0,$Z));var end=$06($0a.slice(0,$Z+1));if(end>0)end--;this.trange.select($0b,end);}};PXDateTimeEdit.prototype.incrementActivePart=function($j){if(this.getDisabled())return;var $0c=this.trange.selStart;var $0d=this.trange.selEnd;var $Z=this.getActivePartIndex();if(!this.field0ID)return;var $0e=this.field0ID[this.getActivePartIndex()];var $0f=this.getValue(true);if(!$0f)$0f=new Date();switch($0e){case 1:case 2:case 3:$0f.setFullYear($0f.getFullYear()+$j);break;case 4:case 5:case 6:case 7:$0f.setMonth($0f.getMonth()+$j);break;case 8:case 9:$0f.setDate($0f.getDate()+$j);break;case 10:case 11:case 12:case 13:$0f.setHours($0f.getHours()+$j);break;case 16:case 17:$0f.setMinutes($0f.getMinutes()+$j);break;case 18:case 19:$0f.setSeconds($0f.getSeconds()+$j);break;};this.elemText.value=this.getEditText($0f);__px_cm(this).notifyOwnerTyping(this);this.trange.select($0c,$0d);};PXDateTimeEdit.prototype.onButtonClick=function(e){if(this.dropDownOpen){this.hideDropDown();this.focus();}else this.showDropDown();};PXDateTimeEdit.$17=function($0g,$J){if($0g!=null)$0g.hideDropDown(true,$J);};PXDateTimeEdit.$14=function($0h,ev){var $0g=$0h.$11;if($0g){var $0i=300,$J;if(typeof(ev.value)=="string")$J=ev.value;setTimeout(function(){PXDateTimeEdit.$17($0g,$J);},$0i);setTimeout(function(){__px($0g).selectElement($0g.elemText.id,1);},$0i+1);}};PXDateTimeEdit.$15=function($0h,ev){var $0g=null;switch(ev.key){case 13:$0g=$0h.$11;if($0g)$0g.hideDropDown(true);break;case 27:$0g=$0h.$11;if($0g)$0g.hideDropDown();break;};if($0g){setTimeout(function(){__px($0g).selectElement($0g.elemText.id,1);},10);ev.cancel=true;}};PXDateTimeEdit.prototype.inside=function($s,$j,$t){return $s<=$j&&$t>=$j;};PXDateTimeEdit.prototype.getMergedDateTime=function($0j){var $0k=function($T){return $T[0],$0l()+$T.substring(1).toLowerCase()};var $0m=$0n=$x=-1;var $0o=$0p=$0q=ms=0;var $0r=-1;for(var i=0;i<$0j.length;i++){var $j=parseInt($0j[i],10);$j=isNaN($j)?$0j[i]:$j;var $n=this.field0ID[i];switch($n){case 1:case 2:case 3:$0m=$j;break;case 4:case 5:$0n=$j;break;case 6:case 7:$0n=this.monthNames.indexOf($0k($j));break;case 8:case 9:$x=$j;break;case 10:case 11:case 12:case 13:$0o=$j;break;case 14:case 15:$0r=$j==_dateFormatInfo.pm?1:0;break;case 16:case 17:$0p=$j;break;case 18:case 19:$0s=$j;break;case 22:case 23:case 24:case 25:case 26:case 27:case 28:ms=$j;break;}};if($0r==0){if($0o==12)$0o=0;}else if($0r==1){if($0o>12)$0o+=12;};var $0t=function($0m){if($0m%4)return false;if($0m%100)return true;if($0m%400)return false;return true;};var $0u=1582;var $0v=275760;var $0w=false;if(this.inside($0u,$0m,$0v)&&this.inside(1,$0n,12)){var $0x=31;switch($0n){case 2:$0x=$0t($0m)?29:28;break;case 4:case 6:case 9:case 11:$0x=30;};if(this.inside(1,$x,$0x)){$0w=true;}};var $0y=this.inside(0,$0o,23)&&this.inside(0,$0p,60)&&this.inside(0,$0q,60)&&this.inside(0,ms,9999);if($0w&&$0y)return new Date($0m,$0n-1,$x,$0o,$0p,$0q,ms);};PXDateTimeEdit.prototype.$18=function($Z){return this.field0ID[$Z]<10;};PXDateTimeEdit.prototype.isZeroTime=function($0j,$0z,i){var $j=$0j[i];if($j===0){var $n=this.field0ID[i];var $0A=this.inside(10,$n,13)||this.inside(16,$n,28);if($0A){var $08=Array.prototype.slice.call($0z[i]);while($08.length&&$08[0]==this.promptChar)$08.shift();$08.reverse();while($08.length&&$08[0]==this.promptChar)$08.shift();$08.reverse();return 0==parseInt($08.join(),10);}};return false;};PXDateTimeEdit.prototype.onBlur=function(e){if(this.allowStrings||this.getDisabled())return;var $08=this.elemText.value;var $0j=this.$0U($08,true);var $0z=this.separate($08);if(this.emptyText!=$08&&$0j.some(function(n){return !n;})){var $0B=new Date();if(this.roundUpTime){$0B.setHours(23);$0B.setMinutes(59);$0B.setSeconds(59);$0B.setMilliseconds(999);}else{$0B.setHours(0);$0B.setMinutes(0);$0B.setSeconds(0);$0B.setMilliseconds(0);};for(var i=0;i<$0j.length;i++){var $0C=$0j[i];if(this.$18(i)&&!$0C){$0j[i]=this.$0R(this.field0ID[i],$0B,true,0);}else if(this.inside(10,this.field0ID[i],13)&&!$0C&&!this.isZeroTime($0j,$0z,i)){$0j[i]=$0B.getHours();}else if(this.inside(16,this.field0ID[i],17)&&!$0C&&!this.isZeroTime($0j,$0z,i)){$0j[i]=$0B.getMinutes();}};var $0D=function($07,$0E,$0F){return $07.some(function(x){return x>=$0E&&x<=$0F;})};var $0G=this.getMergedDateTime($0j.slice());if($0G!=undefined){if(!$0D(this.field0ID,10,13))$0G.setHours($0B.getHours());if(!$0D(this.field0ID,16,17))$0G.setMinutes($0B.getMinutes());if(!$0D(this.field0ID,18,19))$0G.setSeconds($0B.getSeconds());if(!$0D(this.field0ID,22,28))$0G.setMilliseconds($0B.getMilliseconds());this.elemText.value=this.getEditText($0G);}}};PX.key_down=40;PX.key_F3=114;PX.key_left=37;PX.key_right=39;PX.key_up=38;PX.key_dot=190;PX.key_dot2=110;PX.key_slash=191;PX.key_slash2=111;PX.key_dash=189;PX.key_plus=107;PX.key_minus=109;PX.key_plus2=187;



function PXNumberEdit($a,$b,$c,$d){PXNumberEdit.initializeBaseA(this,[$a,$b,$c,$d]);this.trackSelection=true;__px_cm(this).readProperties(this,$c,PXNumberEdit.properties);this.minusSymbol=_numbFormatInfo.negativeSign;this.dotSymbol=".";this.decimalSeparator=_numbFormatInfo.number.decimalSeparator;this.groupSeparator=_numbFormatInfo.number.groupSeparator;};PXNumberEdit.__baseType=PXTextEdit;PXNumberEdit.$K=Number.MAX_SAFE_INTEGER||9007199254740991;PXNumberEdit.$L=Number.MIN_SAFE_INTEGER||-9007199254740991;PXNumberEdit.properties=[["decimals",JSType.Int,0],["minValue",JSType.Float,PXNumberEdit.$L],["maxValue",JSType.Float,PXNumberEdit.$K],["valueType",JSType.Int,9],["editFormat",JSType.String,""],["displayFormat",JSType.String,""],["allowNull",JSType.Bool,false]];PXNumberEdit.callbackProps=[["decimals",JSType.Int,0],["minValue",JSType.Float,PXNumberEdit.$L],["maxValue",JSType.Float,PXNumberEdit.$K]];PXNumberEdit.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXNumberEdit.callbackProps);PXNumberEdit.callBase(this,"setProperties",[$c]);};PXNumberEdit.prototype.getValue=function($e){if(this.$M===undefined||$e){var $f=this.$N(this.getText(),true);if(!isNaN($f))this.$M=$f;};return this.$M;};PXNumberEdit.prototype.setValue=function(v){var $f=this.$N(v,true);if(!isNaN($f)){this.$M=this.oldValue=$f;this.repaintText($f);if(this.hasFocus&&__px(this).isVisible(this.element))this.selectContent(true);}};PXNumberEdit.prototype.initInlineEditor=function($g){this.decimals=$g.decimals;this.maxValue=$g.maxValue;this.minValue=$g.minValue;};PXNumberEdit.prototype.getDecimals=function(){return this.decimals<0?0:this.decimals;};PXNumberEdit.prototype.setDecimals=function(v){this.decimals=v<0?0:v;};PXNumberEdit.prototype.getMaxValue=function(){return this.maxValue;};PXNumberEdit.prototype.setMaxValue=function(v){var $f=this.$N(v,false);if(!isNaN($f)&&$f!=this.maxValue){this.maxValue=$f;var $h=this.$O(this.getValue());if(this.getValue()!=$h)this.setValue($h);}};PXNumberEdit.prototype.getMinValue=function(){return this.minValue;};PXNumberEdit.prototype.setMinValue=function(v){var $f=this.$N(v,false);if(!isNaN($f)&&$f!=this.minValue){this.minValue=$f;var $h=this.$O(this.getValue());if(this.getValue()!=$h)this.setValue($h);}};PXNumberEdit.prototype.$N=function(t,$i){var $j;if(this.isNullValue(t)){if(this.allowNull)return null;$j=0;}else{switch(typeof t){case "number":$j=Number(t.toFixed(this.getDecimals()));break;case "boolean":$j=Number(t);break;default:$j=this.parseValue(t);break;}};return $i?this.$O($j):$j;};PXNumberEdit.prototype.parseValue=function($k){var $j=0.0,$l="";if(this.decimalSeparator!=' ')$k=$k.replace(/\s/g,'');else $k=$k.replace(/[\t\n\r\f]/g,'');for(var i=0;i<$k.length;i++){var ch=$k.charAt(i);if(__px(this).isDigit(ch)||ch==this.minusSymbol)$l+=ch;else if(ch==this.decimalSeparator||(ch==this.dotSymbol&&this.groupSeparator!=this.dotSymbol))$l+=this.dotSymbol;};$j=this.parseFloat($l);return isNaN($j)?$j:Number($j.toFixed(this.getDecimals()));};PXNumberEdit.prototype.getEditText=function(v){if(this.allowNull&&v==null)return "";if(this.editFormat)return v.format(this.editFormat,_numbFormatInfo);try{var t=v.toFixed(this.getDecimals());}catch(ex){t=(0).toFixed(this.getDecimals());};return t.replace(this.dotSymbol,this.decimalSeparator);};PXNumberEdit.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return this.nullText;if(this.displayFormat)return v.format(this.displayFormat,_numbFormatInfo);var t=this.getEditText(v);if(this.valueType>=NetType.Single&&this.valueType<=NetType.Decimal){var i=t.indexOf(this.decimalSeparator);if(i<0)i=t.length;var g=3,$m=(v<0)?1:0;while(--i>$m)if(--g==0){t=t.substring(0,i)+this.groupSeparator+t.substring(i);g=3;}};return t;};PXNumberEdit.prototype.$O=function(v){if(v!=null&&!isNaN(v)){var $n=this.minValue,$o=this.maxValue;if($n!=null&&v<$n)return $n;if($o!=null&&v>$o)return $o;};return v;};PXNumberEdit.prototype.isMinus=function(k){return k==this.minusSymbol.charCodeAt(0)||k==45;};PXNumberEdit.prototype.onKeyPress=function(e){var k=e.keyC;if(k<7||(k>8&&k<32))return;var t=this.elemText.value,$p=t.length;var $q=this.selStart,$r=this.selEnd;if($q!=$r){t=t.substring(0,$q)+t.substring($r);$r=$q;$p=t.length;}else if(k==7||k==8){return true;};var $s=0,$t=$p,$u=false;if(this.editFormat){var $l="",ch,$v;for(var i=0;i<t.length;i++){ch=t.charAt(i);if(__px(this).isDigit(ch)||ch==this.minusSymbol)$l+=ch;else if(ch==this.decimalSeparator)$l+=this.dotSymbol;else{$p--;if(i<$q)$q--;if(i<$r){$r--;$s++;}}};t=$l;};if(k==this.dotSymbol.charCodeAt(0))k=this.decimalSeparator.charCodeAt(0);if(k>8&&(this.maxLength<=0||this.maxLength>$p)){var $w=(k==this.decimalSeparator.charCodeAt(0));var ok=__px(this).isDigit(k)||($w&&this.getDecimals()>0)||($q==0&&this.isMinus(k)&&this.minValue<0);if(!ok)return;if($p>0&&$q==0)if(this.isMinus(t.charCodeAt(0)))return;var $x=t.indexOf(this.decimalSeparator);if($w){if($x>=0){if($x==$q||$x==($q-1))return;$p--;if($x<$q)$q=--$r;t=t.substring(0,$x)+t.substring($x+1);};if(($p-$q)>this.getDecimals())return;}else if(this.getDecimals()>0&&$x>=0){var $y=$p-$x-1;if($y==this.getDecimals()&&$q>$x)$u=true;};var c=String.fromCharCode(k);if($r>=$p){if($u)t=t.substring(0,$p-1);t+=c;}else{var $z=$u?($r+1):$r;t=t.substring(0,$q)+c+t.substring($z);}};var $A=t.length;$x=t.indexOf(this.decimalSeparator);if($x>=0){$A=$x;if(this.maxDecimals){var $B=parseInt(t.substring($x+1));if($B>this.maxDecimals)return;}};if($A<15){if(this.editFormat){var $j=this.parseFloat(t);if(!isNaN($j)){t=$j.format(this.editFormat,_numbFormatInfo);$s+=t.length-$t-($u?0:1);}};if(this.validateInputText&&!(t=this.validateInputText(t)))return;this.elemText.value=t;this.select($r+1+$s);__px_cm(this).notifyOwnerTyping(this);}};PXNumberEdit.prototype.processPaste=function($C){var t=$C&&$C.trim();var $D=this.elemText.value;var $E=new String($D);var $q=this.selStart,$r=this.selEnd;t=t.toString().replace(new RegExp(this.groupSeparator,"g"),"");t=t.toString().replace(new RegExp(" ","g"),"");t=t.toString().replace(new RegExp("\s","g"),"");t=t.toString().replace(this.decimalSeparator,this.dotSymbol);t=t.toString().replace(/\+/,"");var $z=t.search(/[^0-9.\-]/);if($z>=0)return true;if($q!=0&&t.search(/[\-\+]/)>=0)return true;if($q>=0)$D=$D.substring(0,$q)+t+$D.substring($r);else $D=t;var $F=this.parseValue($D);if(!isNaN($F)&&(this.$O($F)===$F)){this.elemText.value=this.getEditText($F);}else{this.elemText.value=$E;};return true;};PXNumberEdit.prototype.parseFloat=function($l){var $A=$l.length,$x=$l.indexOf(this.decimalSeparator);if($x<0)$x=$l.indexOf(this.dotSymbol);if($x>=0)$A=$x;var $G=(PXNumberEdit.$L).toString().length+1;if($A>$G){var $H=$A-$G,$I=$l.substr($H);var $J=$l.substr(0,$H);return parseFloat($I);};return parseFloat($l);}


function PXLinkEdit($a,$b,$c,$d){PXLinkEdit.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXLinkEdit.properties);};PXLinkEdit.__baseType=PXButtonEdit;PXLinkEdit.properties=[["target",JSType.String,""]];PXLinkEdit.prototype.validateValue=function($e,$f){$e=PXLinkEdit.callBase(this,"validateValue",[$e,$f]);return $e;};PXLinkEdit.prototype.onButtonClick=function(e){this.updateValue();this.elemText.value=this.getDisplayText(this.getValue());var $g=this.getValue();if($g){if($g.indexOf("://")<0){if($g.startsWith("/"))$g=$g.substring(1);$g="http://"+$g;};var $h=$g;while($h.indexOf("javascript:")>-1)$h=$h.replace("javascript:","");__px(this).openUrl($h,this.target?this.target:"_blank");}};



function PXMailEdit($a,$b,$c,$d){PXMailEdit.initializeBaseA(this,[$a,$b,$c,$d]);};PXMailEdit.__baseType=PXButtonEdit;PXMailEdit.prototype.validateValue=function($e,$f){$e=PXMailEdit.callBase(this,"validateValue",[$e,$f]);return $e;};PXMailEdit.prototype.onButtonClick=function(e){if(PXMailEdit.callBase(this,"onButtonClick",[e])==true)return;this.updateValue();this.elemText.value=this.getDisplayText(this.getValue());var $g=this.getValue();if($g){if(this.frame==null){this.frame=__doc(this).createElement("iframe");this.frame.style.display="none";__doc(this).body.appendChild(this.frame);};try{this.frame.src="mailto:"+$g;}catch(ex){}}};



function PXPanelEdit($a,$b,$c,$d){PXPanelEdit.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXPanelEdit.properties);this.docHandler=Function.createDelegate(this,this.handleDocMouseDown);};PXPanelEdit.__baseType=PXButtonEdit;PXPanelEdit.properties=[["popupPanel",JSType.String,""],["dataField",JSType.String,""],["valueField",JSType.String,""],["textField",JSType.String,""],["value",JSType.String,null],["editors",JSType.Empty,null],["allowSelectValue",JSType.Bool,true]];PXPanelEdit.prototype.showDropDown=function(){var $e=__doc(this).dropDownElem;if($e){var $f=__px_all(this)[$e.getAttribute("controlID")];if($f)$f.hideDropDown();};var $g=this.getPanel();if($g){$g.dialogResult=PXDialogResult.Cancel;$g.show(this);}};PXPanelEdit.prototype.hideDropDown=function(){var $g=this.getPanel();if($g!=null&&$g.getVisible())$g.hide();};PXPanelEdit.prototype.getPanel=function(){if(this.popupPanel&&this.panel==null){this.panel=__px_all(this)[this.popupPanel];if(this.panel){var h1=Function.createDelegate(this,this.handlePanelHide);var h2=Function.createDelegate(this,this.handlePanelShow);var h3=Function.createDelegate(this,this.handlePanelKeyDown);this.panel.events.addEventHandler("afterHide",h1);this.panel.events.addEventHandler("afterShow",h2);__px(this).addEventHandler(this.panel.element,"keydown",h3);this.panel.position=3;this.restorePanelCallback();}};return this.panel;};PXPanelEdit.prototype.getValue=function(){if(this.textField)return this.value;var v=this.elemText.value;return(this.allowNull&&this.isNullValue(v))?null:v;};PXPanelEdit.prototype.setValue=function(v,$h){if(v!=this.getValue())this.restorePanelCallback();if(this.textField){this.value=v;if($h!=null)this.elemText.value=$h.trimEnd();this.viewState.update("Value",(v!=null)?v:"");}else{if(this.hasFocus){this.elemText.value=this.getEditText(v);if(this.selectOnFocus&&this.getVisible())this.elemText.select();}else this.elemText.value=this.getDisplayText(v);};this.oldValue=this.getValue();};PXPanelEdit.prototype.getValues=function(){return this.values;};PXPanelEdit.prototype.restorePanelCallback=function(){if(this.panel==null)return;var cs=this.panel.autoCallBack;if(cs.callbackHidden){this.panel.autoCallBack.enabled=true;cs.callbackHidden=false;}};PXPanelEdit.prototype.getDisplayText=function(v){if(this.textField)return this.elemText.value;return PXPanelEdit.callBase(this,"getDisplayText",[v]);};PXPanelEdit.prototype.getEditText=function(v){if(this.textField)return this.elemText.value;return PXPanelEdit.callBase(this,"getEditText",[v]);};PXPanelEdit.prototype.onButtonClick=function(e){var $g=this.getPanel(),me=this;if($g)setTimeout(function(){$g.getVisible()?me.hideDropDown():me.showDropDown();},0);};PXPanelEdit.prototype.handlePanelShow=function($g,ev){__px(this).addEventHandler(__doc(this),"mousedown",this.docHandler,true);var cs=$g.autoCallBack;if(cs&&cs.enabled){cs.enabled=false;cs.callbackHidden=true;};if(this.editors&&this.editors.length>0){var $f=__px_all(this)[this.editors[0][0]];$f.focus?$f.focus():$f.element.focus();}else $g.element.focus();};PXPanelEdit.prototype.handleDocMouseDown=function(e){var $g=this.getPanel();if($g&&$g.getVisible()){var se=__px(this).eventElem(e);if(__doc(this).dropDownElem==null&&se!=__doc(this).waitDiv&&__doc(this).activePanel==$g&&$g.element!=se&&!__px(this).contains(this.element,se)&&!__px(this).contains($g.element,se)){this.hideDropDown();}}};PXPanelEdit.prototype.handlePanelKeyDown=function(e){var $i=null;switch(e.keyCode){case 27:$i=PXDialogResult.Cancel;break;case 13:break;};if($i!=null){__px(this).cancelEvent(e);this.panel.dialogResult=$i;this.hideDropDown();}};PXPanelEdit.prototype.handlePanelHide=function($g,ev){__px(this).removeEventHandler(__doc(this),"mousedown",this.docHandler,true);this.focus();if($g.dialogResult!=PXDialogResult.OK||!this.allowSelectValue)return;var $j=null,$h=null;if(this.editors!=null){if(this.valueField||this.textField){for(var i=0;i<this.editors.length;i++){var $k=this.editors[i],$f=__px_all(this)[$k[0]];if($f){if($k[1]==this.valueField)$j=$f.getValue();if($k[1]==this.textField)$h=$f.getValue();}};this.updateValue($j);if(this.textField)this.elemText.value=$h?$h:"";}else{this.values=new Array();$j="";for(var i=0;i<this.editors.length;i++){var $k=this.editors[i],$f=__px_all(this)[$k[0]];if(!$f)continue;var $l=$f.getValue();var $h=$f.getDisplayText?$f.getDisplayText($l):null;this.values.push([$k[1],$l,$h]);if($l){if($j)$j+=",";$j+=$h?$h:$l;}};this.updateValue($j);}}else{if($g.getText)$j=$g.getText();else if($g.getValue)$j=$g.getValue();if($j!=null)this.setValue($j);}};



function PXFormulaEditor($a,$b,$c,$d){PXFormulaEditor.initializeBaseA(this,[$a,$b,$c,$d]);if($c.parameters)this.parameters=$c.parameters.split(",");if($c.appFunctions)this.appFunctions=$c.appFunctions.split(",");if($c.fields)this.fields=$c.fields.split(",");this.errLabel=this.popupPanel+"_lblValidate";};PXFormulaEditor.__baseType=PXPanelEdit;PXFormulaEditor.prototype.setProperties=function($c){PXFormulaEditor.callBase(this,"setProperties",[$c]);if($c.fields)this.fields=$c.fields.split(",");if(this.inlineControl)this.inlineControl.setProperties($c);};PXFormulaEditor.prototype.initInlineEditor=function($e){this.fields=$e.fields;this.parameters=$e.parameters;$e.inlineControl=this;};PXFormulaEditor.prototype.initializeTreeNodes=function($f){var $g,$h,$i;for(var i=0;i<$f.length;i++){$g=$f.getNode(i);if($g.value){$h=this.getItemsListByIndex($i=parseInt($g.value));if($i!=2&&(!$h||$h.length==0)){$g.remove();i--;continue;}};if($g.hasChild)this.initializeTreeNodes($g.childNodes);}};PXFormulaEditor.prototype.handlePanelShow=function($j,ev){if(!__px(this).isVisible(this.element))return;PXFormulaEditor.callBase(this,"handlePanelShow",[$j,ev]);if(this.text==null){var h=Function.createDelegate(this,this.handleItemClick);if(this.sourceID){var $k=__px_all(this)[this.sourceID];if($k.list){this.list=$k.list;this.tree=$k.tree;this.text=$k.text;}else{$k.tree=this.tree=__px_all(this)[this.popupPanel+"_sp1_sp2_cat"];$k.text=this.text=__px_all(this)[this.popupPanel+"_sp1_txt"];$k.list=this.list=__px(this).elemByID(this.popupPanel+"_sp1_sp2_lst");if(__px(this).IsSafari)__px(this).addEventHandler(this.list,"click",h);__px(this).addEventHandler(this.list,"dblclick",h);}}else{this.tree=__px_all(this)[this.popupPanel+"_sp1_sp2_cat"];this.text=__px_all(this)[this.popupPanel+"_sp1_txt"];this.list=__px(this).elemByID(this.popupPanel+"_sp1_sp2_lst");if(__px(this).IsSafari)__px(this).addEventHandler(this.list,"click",h);__px(this).addEventHandler(this.list,"dblclick",h);};h=Function.createDelegate(this,this.handleNodeSelect);this.tree.events.addEventHandler("afterSelect",h);h=Function.createDelegate(this,this.handleNodeClick);this.tree.events.addEventHandler("nodeClick",h);this.initializeTreeNodes(this.tree.nodes);};if(this.tree.selectedNode){var ev=new Object();ev.node=this.tree.selectedNode;this.handleNodeSelect(this.tree,ev);};this.text.setValue(this.getValue());this.text.selectOnFocus=true;this.text.focus();this.text.selectOnFocus=false;this.text.trackPosition=__px(this).IsIE;};PXFormulaEditor.prototype.handlePanelHide=function($j,ev){if(!__px(this).isVisible(this.element))return;PXFormulaEditor.callBase(this,"handlePanelHide",[$j,ev]);try{var $l=__doc(this).getElementById(this.errLabel);if($l!=null){$l.style.visibility="hidden";}}catch(e){};if($j.dialogResult==PXDialogResult.OK){var $m=this.text.getValue();if($m&&!$m.startsWith('='))$m='='+$m;this.updateValue($m);}};PXFormulaEditor.opGlobals=[];PXFormulaEditor.opParameters=[];PXFormulaEditor.opArithmetic=["+","-","*","/","%"];PXFormulaEditor.opComparison=["=","<>","<",">","<=",">="];PXFormulaEditor.opLogical=["And","Not","Or"];PXFormulaEditor.opOther=["False","In","Null","True"];PXFormulaEditor.funConversion=["CBool( x )","CDate( x )","CDbl( x )","CDec( x )","CShort( x )","CSng( x )","CStr( x )","CInt( x )","CLong( x )"];PXFormulaEditor.funAggregates=["Avg( expr )","Count( expr )","First( expr )","Last( expr )","Max( expr )","Min( expr )","Next( expr )","Prev( expr )","Sum( expr )"];PXFormulaEditor.funText=["Format( format, args )","InStr( str, findStr )","InStrRev( str, findStr )","Len( str )","Left( str, length )","LCase( str )","LTrim( str )","PadLeft( str, width, paddingChar )","PadRight( str, width, paddingChar )","Replace( str, oldValue, newValue )","Right( str, length )","RTrim( str )","Trim( str )","UCase( str )","Substring( str, start, length )"];PXFormulaEditor.funMath=["Abs( x )","Ceiling( x )","Floor( x )","Max( x, y )","Min( x, y )","Pow( x, pow )","Round( x, decimals )"];PXFormulaEditor.funDateTime=["DateAdd( date, interval, number )","DateDiff( interval, date1, date2 )","Hour( date )","Day( date )","DayOfWeek( date )","DayOfYear( date )","DayOrdinal( day )","Minute( date )","Month( date )","MonthName( date )","Now()","Second( date )","Today()","Year( date )"];PXFormulaEditor.funProgram=["IIf( expr, truePart, falsePart )","IsNull( value, nullValue )","Sort( from, to, column )","SortD( from, to, column )","Sum( from, to )","Switch( expr1, value1, expr2, value2, ...)","NullIf( value1, value2 )","Value( row , column )"];PXFormulaEditor.funApp=[];PXFormulaEditor.prototype.handleNodeSelect=function($n,ev){while(this.list.options.length>0)this.list.remove(0);if(ev.node.value==null)return;var $h=this.getItemsListByIndex(parseInt(ev.node.value));if($h)for(var i=0;i<$h.length;i++)this.addListItem($h[i]);this.text.focus();};PXFormulaEditor.prototype.handleNodeClick=function($n,ev){this.text.focus();};PXFormulaEditor.prototype.getItemsListByIndex=function($o){var $h=null;switch($o){case 0:$h=PXFormulaEditor.opGlobals;break;case 2:$h=this.fields;break;case 1:$h=this.parameters?this.parameters:PXFormulaEditor.opParameters;break;case 11:$h=PXFormulaEditor.opArithmetic;break;case 12:$h=PXFormulaEditor.opLogical;break;case 13:$h=PXFormulaEditor.opComparison;break;case 14:$h=PXFormulaEditor.opOther;break;case 21:$h=PXFormulaEditor.funConversion;break;case 22:$h=PXFormulaEditor.funText;break;case 23:$h=PXFormulaEditor.funMath;break;case 24:$h=PXFormulaEditor.funDateTime;break;case 25:$h=PXFormulaEditor.funProgram;break;case 26:$h=this.appFunctions?this.appFunctions:PXFormulaEditor.funApp;break;};return $h;};PXFormulaEditor.prototype.addListItem=function($m){var $p=this.list.options;$p[$p.length]=new Option($m,$m,false,false);};PXFormulaEditor.prototype.handleItemClick=function(e){if(e.type=="click"){var $p=__px(this).eventElem(e);if($p)$p.selected=true;return;};var lv=this.list.value,$g=this.tree.selectedNode;if($g&&parseInt($g.value)==26)lv="Report."+lv;this.text.updateValue();var $q=this.text.getSelectedText(),$m=this.text.getValue();var $r=this.text.selStart,$s=this.text.selEnd;if(!$q){$m=$m.substring(0,$r)+lv+$m.substring($r);this.text.setValue($m);$s=$r=$r+lv.length;}else{this.text.setValue($m.substring(0,$r)+$m.substring($r).replace($q,lv));$s=$r+lv.length;};this.text.select($r,$s);};PXFormulaEditor.pnlHeader_ExceptionChange=function($t,$a){try{var $u=$t.split("&");var $v=__doc(this.control).getElementById($u[0]);if($v!=null){$v.style.visibility="visible";$v.innerHTML=($u[1]!="")?$u[1]:$u[2];$v.title=($u[1]!="")?$u[1]:$u[2];$v.style.color=($u[1]=="")?"black":"red";}}catch(e){}};



function PXDropDown($a,$b,$c,$d){PXDropDown.initializeBaseA(this,[$a,$b,$c,$d]);this.trackSelection=true;__px_cm(this).readProperties(this,$c,PXDropDown.properties);this.elemFocus=this.getTextElem();var $e=$b.getElementsByTagName("div");if($e)for(var i=0;i<$e.length;i++){var $f=$e[i].getAttribute("type");switch($f){case "clear":this.elemClear=$e[i];break;case "sel":this.elemButton=$e[i];break;case "edit":this.elemEdit=$e[i];break;}};this.forceFocus=!__px(this).IsTablet;if(this.items==null)this.items=new Array();this.currentRow=null;this.$12=null;this.$13=false;this.hasDisabledItems=false;this.dropDown=null;this.ddTable=null;this.$14="";this.$15=null;this.$16=100;this.caseSensSearch=false;this.caseSensItems=true;this.$17=false;this.$18=Function.createDelegate(this,this.$19);this.events.appendEvents(PXDropDown.events,$c.clientEvents);this.attachEventHandlers(true);this.$1a();this.$1b();if(this.colorBox){this.allowRepaintText=false;var $g=this.items[this.selectedIndex];if($g){this.elemText.style.backgroundColor=$g.value;this.elemText.value="";}}};PXDropDown.__baseType=PXTextEdit;PXDropDown.invalidItemText="";PXDropDown.dropDownItemDesc=[["value",JSType.String,""],["text",JSType.String,""],["enabled",JSType.Bool,true],["selected",JSType.Bool,false],["imageUrl",JSType.String,""]];PXDropDown.imagesDesc=[["normal",JSType.String,"control@DropDownN"],["disabled",JSType.String,"control@DropDownD"],["hover",JSType.String,"control@DropDownH"],["pushed",JSType.String,"control@DropDownP"]];PXDropDown.imagesDescE=[["normal",JSType.String,"control@EditN"],["disabled",JSType.String,"control@EditD"],["hover",JSType.String,"control@EditH"],["pushed",JSType.String,"control@EditP"]];PXDropDown.imagesDescC=[["normal",JSType.String,"control@ClearN"],["disabled",JSType.String,"control@ClearD"],["hover",JSType.String,"control@ClearH"],["pushed",JSType.String,"control@ClearP"]];PXDropDown.properties=[["selectedIndex",JSType.Int,0],["dropDownWidth ",JSType.Int,100],["searchTimeoutMS",JSType.Int,1000],["nullText",JSType.String,""],["allowNull",JSType.Bool,true],["required",JSType.Bool,false],["allowEdit",JSType.Bool,false],["maxVisibleItems",JSType.Int,20],["allowMultiSelect",JSType.Bool,false],["valuesSeparator",JSType.String,","],["allowFocus",JSType.Bool,true],["valueType",JSType.Int,9],["bindingContainer",JSType.String,""],["autoSuggest",JSType.Bool,null],["images",JSType.Object,PXDropDown.imagesDesc],["imagesE",JSType.Object,PXDropDown.imagesDescE],["imagesC",JSType.Object,PXDropDown.imagesDescC],["styles",JSType.Object,null],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc],["items",JSType.Array,PXDropDown.dropDownItemDesc],["colorMode",JSType.Bool,false],["colorBox",JSType.Bool,false]];PXDropDown.callbackProps=[["items",JSType.Empty,null,"setItems"]];PXDropDown.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXDropDown.callbackProps);PXDropDown.callBase(this,"setProperties",[$c]);};PXDropDown.events={$selectionChanging:14,$selectionChanged:15,$showDropDown:16,$editButtonClick:17};PXDropDown.prototype.initInlineEditor=function($h){this.items=$h.items;};PXDropDown.prototype.onVisibleChanged=function($i){if($i){var $j=this.elemText.parentNode;if($j)__px(this).setTitle($j,$j.scrollWidth>$j.clientWidth?this.elemText.value:"");}};PXDropDown.prototype.attachEventHandlers=function($k){if(!$k){if(!this.allowEdit){var pe=this.elemText.parentNode;this.textClickH=Function.createDelegate(this,this.onMouseDown);if(__px(this).IsTablet)__px(this).addEventHandler(pe,"touchstart",this.textClickH);else __px(this).addEventHandler(pe,"mousedown",this.textClickH);};__px_cm(this).addBaseHandlers(this.elemText,this.eventsH);__px(this).addEventHandler(this.elemText,"paste",this.eventsH,false);};PXDropDown.attachDDEventHandlers(this);if(this.elemButton)this.attachButtonEvents(this.elemButton,this.$18);if(this.elemEdit)this.attachButtonEvents(this.elemEdit,this.$18);if(this.elemClear)this.attachButtonEvents(this.elemClear,this.$18);};PXDropDown.prototype.detachEventHandlers=function(){__px_cm(this).removeBaseHandlers(this.elemText,this.eventsH);__px(this).removeEventHandler(this.elemText,"paste",this.eventsH,false);if(this.textClickH){var pe=this.elemText.parentNode;if(__px(this).IsTablet)__px(this).removeEventHandler(pe,"touchstart",this.textClickH);else __px(this).removeEventHandler(pe,"mousedown",this.textClickH);};PXDropDown.detachDDEventHandlers(this);if(this.elemButton)this.detachButtonEvents(this.elemButton,this.$18);if(this.elemEdit)this.detachButtonEvents(this.elemEdit,this.$18);if(this.elemClear)this.detachButtonEvents(this.elemClear,this.$18);};PXDropDown.prototype.attachButtonEvents=function($b,h){__px(this).addEventHandler($b,"mousedown",h);__px(this).addEventHandler($b,"mouseup",h);__px(this).addEventHandler($b,"mouseover",h);__px(this).addEventHandler($b,"mouseout",h);};PXDropDown.prototype.detachButtonEvents=function($b,h){__px(this).removeEventHandler($b,"mousedown",h);__px(this).removeEventHandler($b,"mouseup",h);__px(this).removeEventHandler($b,"mouseover",h);__px(this).removeEventHandler($b,"mouseout",h);};PXDropDown.attachDDEventHandlers=function($l,$m){var $n=$l.ddTable,$m=PXDropDown.$1c;if($n){__px($l).addEventHandler($n,"mousedown",$m);__px($l).addEventHandler($n,"mouseup",$m);__px($l).addEventHandler($n,"mouseout",$m);__px($l).addEventHandler($n,"mouseover",$m);__px($l).addEventHandler($n,"selectstart",$m);__px($l).addEventHandler($n,"contextmenu",$m);}};PXDropDown.detachDDEventHandlers=function($l,$m){var $n=$l.ddTable,$m=PXDropDown.$1c;if($l.ddTable){__px($l).removeEventHandler($n,"mousedown",$m);__px($l).removeEventHandler($n,"mouseup",$m);__px($l).removeEventHandler($n,"mouseout",$m);__px($l).removeEventHandler($n,"mouseover",$m);__px($l).removeEventHandler($n,"selectstart",$m);__px($l).removeEventHandler($n,"contextmenu",$m);}};PXDropDown.prototype.setEnabled=function($o){if($o!=this.getEnabled()){__px_cm(this).setEnabled(this,$o);this.$1d();}};PXDropDown.prototype.setReadOnly=function($p){if($p!=this.getReadOnly()){__px_cm(this).setReadOnly(this,$p);this.$1d();}};PXDropDown.prototype.setAllowEdit=function($q){this.allowEdit=$q;this.$1e();};PXDropDown.prototype.getTextElem=function(){return __px(this).elemByID(this.element.id+"_text");};PXDropDown.prototype.hasSelection=function(){return this.items!=undefined&&(this.selectedIndex>=0&&this.selectedIndex<this.items.length);};PXDropDown.prototype.focus=function(){if(this.allowFocus&&!__px(this).IsTablet)PXDropDown.callBase(this,"focus");};PXDropDown.prototype.$1d=function(){var $r=this.getDisabled();if(this.elemButton){var $s=this.getDisabled()?this.images.disabled:this.images.normal;__px_cm(this).repaintImage(this.elemButton,$s?$s:$t.normal);this.elemButton.style.display=$r?"none":"";};if(this.elemClear)this.elemClear.style.display=$r?"none":"";var $u=[this.elemButton,this.elemEdit,this.elemClear],$v=0;for(var i=0;i<$u.length;i++){var $w=$u[i];if($w&&$w.style.display=="")$v++;};if($v==1)this.element.removeAttribute("buttons");else this.element.setAttribute("buttons",$v);};PXDropDown.prototype.$1e=function(){if(this.allowEdit||this.autoSuggestFinal)this.elemText.removeAttribute("invisible");else this.elemText.setAttribute("invisible",1);};PXDropDown.prototype.$1b=function(){this.autoSuggestFinal=this.autoSuggest==null?(this.items.length>10):this.autoSuggest;this.searchElem=this.autoSuggestFinal?this.elemFocus:null;this.$1e();};PXDropDown.prototype.setSize=function(wd,ht){var w=parseInt(wd),h=parseInt(ht),et=this.elemText;this.element.style.width=w+"px";this.element.style.height=h+"px";};PXDropDown.prototype.adjustTextSize=function(){var $x=this.element.clientWidth,et=this.elemText;var $u=[this.elemButton,this.elemEdit,this.elemClear];for(var i=0;i<$u.length;i++){if($u[i]==null)continue;$x-=$u[i].parentNode.offsetWidth;};var $y=this.elemText.parentNode;$x-=$y.offsetWidth-__px(this).getStyleWidth($y);if($x>0){et.style.width=__px(this).getStyleWidth(et,$x)+"px";return true;};return false;};PXDropDown.prototype.getDisplayText=function(v){if(this.allowEdit&&!this.hasSelection())return v;if(this.allowMultiSelect&&v){var ar=v.toString().split(this.valuesSeparator),$z=new Array();for(var i=0;i<ar.length;i++){var $A=this.$1f(ar[i]),$g=this.items[$A];if($g!=null)$z.push($g.text);};return $z.length>0?$z.join(this.valuesSeparator+' '):"";};return this.$1g(this.$1f(v));};PXDropDown.prototype.getEditText=function(v){return this.getDisplayText(v);};PXDropDown.prototype.$1h=function(v){if(this.colorBox){var $g=this.items[this.selectedIndex];if($g){this.elemText.style.backgroundColor=$g.value;this.elemText.value="";}}else{v=(v!=null)?v.toString():"";this.elemText.value=v;if(!this.allowEdit&&this.elemText.parentNode){{var $e=this.elemText.parentNode.getElementsByTagName("span");for(var i=0;i<$e.length;i++)if($e[i].className=="text"){this.textSpan=$e[i];break;}};if(this.textSpan)__px(this).setElemText(this.textSpan,v);}}};PXDropDown.prototype.getValue=function(){if(this.allowMultiSelect){var ar=new Array();for(var i=0;i<this.items.length;i++)if(this.items[i].selected)ar.push(this.items[i].value);return ar.length>0?ar.join(this.valuesSeparator):null;};var $B=this.hasSelection();if(this.allowEdit&&!$B)$B=this.$1i();if(this.allowEdit&&!$B)return this.elemText.value;return $B?this.items[this.selectedIndex].value:null;};PXDropDown.prototype.setValue=function(v){if(this.allowMultiSelect){for(var i=0;i<this.items.length;i++){this.items[i].selected=false;if(this.dropDown){this.$1j(i,false);}}};if(v==null){this.setNull();return true;};if(this.allowMultiSelect){var ar=v.toString().split(this.valuesSeparator);var $C=v;v=null;for(var i=0;i<ar.length;i++){var $A=this.$1f(ar[i]),$g=this.items[$A];if($g!=null){$g.selected=true;if($g.enabled&&v==null)v=this.items[$A].value;if(this.dropDown)this.$1j($A,true);}};if(v==null&&this.allowEdit)v=$C;};var $A=this.$1f(v),$D=true;if($A!=undefined&&this.items[$A].enabled){if(this.dropDownOpen){this.$1k(this.$1l(this.selectedIndex),false);this.$1k(this.$1l($A),true);};this.selectedIndex=$A;this.$1a();this.$1m();}else if(this.allowEdit){this.$1h(v);this.selectedIndex=-1;this.$1a();}else $D=false;if($D)this.oldValue=this.getValue();return $D;};PXDropDown.prototype.$1f=function($E){if(this.items!=undefined){for(var $A=0;$A<this.items.length;$A++){var $g=this.items[$A];if($g.value==$E||(!this.caseSensItems&&String.compare($g.value,$E,true)))break;};if($A<this.items.length)return $A;};return null;};PXDropDown.prototype.setNull=function($F){if(!this.allowNull)return false;this.forceSetNull($F);};PXDropDown.prototype.forceSetNull=function($F){var $G=this.selectedIndex;if($F){if($G!=undefined&&$G!=PXDropDown.$1n){if(this.onSelectionChanging($G,this.selectedIndex))return false;if(this.fireEvent(12,null))return false;}};this.$1o();this.$1a();this.$1m();var $H=this.$1l($G);this.$1k($H,false);if($F){this.onSelectionChanged($G,this.selectedIndex);this.fireEvent(13,null);};this.oldValue=this.getValue();return true;};PXDropDown.$1n=-1;PXDropDown.prototype.$1o=function(){if(this.allowMultiSelect)for(var i=0;i<this.items.length;i++)this.items[i].selected=false;this.selectedIndex=PXDropDown.$1n;if(this.allowEdit)this.elemText.value="";delete this.currentRow;};PXDropDown.prototype.$1a=function(){var $E=this.getValue();this.viewState.update("Value",($E!=null)?$E:"");};PXDropDown.prototype.$1i=function(){var $I=this.elemText.value.toLowerCase();if($I)for(var i=0;i<this.items.length;i++){var t=this.items[i].text;if(t&&t.toLowerCase()==$I){this.selectedIndex=i;return true;}};return false;};PXDropDown.prototype.addItem=function($J){var $A=this.$1f($J.value);var $K=true;if($A!=null){$K=!(PXDropDown.compareItems(this.items[$A],$J));this.items[$A]=$J;}else{$A=this.items.length;this.items[$A]=$J;};if(this.dropDown&&$K)this.$1p();return $A;};PXDropDown.prototype.addItemByValues=function($L,$M,$N,$O){var $g=new Object();$g.value=$L;$g.text=$M;$g.enabled=($N==undefined)?true:$N;$g.imageUrl=($O==undefined)?"":$O;return this.addItem($g);};PXDropDown.prototype.enableItem=function($L,$P){var $A=this.$1f($L);var $K=false;if($A!=null){$K=(this.items[$A].enabled!=$P);this.items[$A].enabled=$P;if($A==this.selectedIndex&&!$P){this.selectedIndex=PXDropDown.$1n;this.$1a();}};if(this.dropDown&&$K)this.$1p();};PXDropDown.prototype.removeItem=function($L){var $A=this.$1f($L);var $K=false;if($A!=null){this.items.splice($A,1);if($A==this.selectedIndex){if(!this.allowNull){this.selectedIndex=0;this.$1a();this.$1m();}else this.setNull();};$K=true;};if(this.dropDown&&$K)this.$1p();};PXDropDown.prototype.setItems=function($Q){var $K=false;if(typeof($Q)=="string"){var $R=$Q.split(";"),$S=new Array($R.length);for(var i=0;i<$R.length;i++){$S[i]=new Object();PXDropDown.parseItem($S[i],$R[i]);};if(this.items!=undefined&&(this.items.length==$S.length)){for(var j=0;j<$S.length;j++){if(!PXDropDown.compareItems(this.items[j],$S[j])){$K=true;break;}}}else $K=true;}else if($Q instanceof Array){$K=true;$S=$Q;for(var j=0;j<$Q.length;j++)$Q[j].value=NetType.convert($Q[j].value,this.valueType);}else if($Q==null){$K=true;$S=new Array();};if($K){this.items=$S;this.setValue(this.getValue());if(this.dropDown){PXDropDown.fillDropDown(this,this.items,this.styles);PXDropDown.setDropDownSize(this);};if(this.$1b)this.$1b();}};PXDropDown.parseItem=function($J,$T){var $U="|";var $R=$T.split($U);$J.value=($R.length>0)?NetType.convert($R[0],this.valueType):"";$J.text=($R.length>1)?$R[1]:$J.value;$J.enabled=($R.length>2)?Boolean($R[2]):true;$J.imageUrl=($R.length>3)?$R[3]:"";};PXDropDown.compareItems=function($V,$W){if($V.value!==$W.value)return false;if($V.text!==$W.text)return false;if($V.imageURL!==$W.imageURL)return false;if(Boolean($V.enabled)!=Boolean($W.enabled))return false;return true;};PXDropDown.prototype.showDropDown=function(){if(this.items.length==0||this.fireEvent(16,null))return;__px_cm(this).closeActiveDropDown(this);this.$1q();this.$17=true;if(!this.dropDown)this.$1r();var $X=this.$1l(this.selectedIndex);__px_cm(this).setDropDownVisible(this,true);PXDropDown.setDropDownSize(this);__px(this).setDropDownPos(this.element,this.dropDown,2);this.$1s($X);if(this.hasFilterBar){var se=this.searchElem;setTimeout(function(){se.focus();se.selectionStart=se.value.length;},10);}else if(!this.hasFocus)this.focus();PXDropDown.$1t=this;setTimeout(function(){PXDropDown.$1u();},50);};PXDropDown.$1t=null;PXDropDown.$1u=function(){var $Y=PXDropDown.$1t;if($Y){$Y.$17=false;PXDropDown.$1t=null;}};PXDropDown.prototype.hideDropDown=function(){this.$1q();__px_cm(this).setDropDownVisible(this,false);if(this.currentRow){this.$1k(this.currentRow,false);delete this.currentRow;};delete this.activeRowIndex;if(this.autoSuggestFinal)this.$1v("");};PXDropDown.prototype.filterInlineKey=function(e){var k=e.keyCode?e.keyCode:e.which;if(this.inlineEditor==true){switch(k){case PX.key_esc:case PX.key_enter:if(this.dropDownOpen)return true;break;case PX.key_del:case PX.key_backspace:case PX.key_up:case PX.key_down:return true;break;}};return false;};PXDropDown.prototype.selectRow=function($Z,$00){var $01=this.$1w($Z);if($01==undefined||$01<0||$01>=this.items.length){if($00)this.hideDropDown();return false;};var $G=this.selectedIndex;if(!this.allowMultiSelect&&$G!=undefined&&$G===$01){if($00)this.hideDropDown();return true;};var $02=new Object();$02.oldIndex=$G;$02.newIndex=$01;var $03=this.fireEvent(14,null,$02);if($03==true){this.hideDropDown();return;};$03=this.fireEvent(12,null,$02);if($03==true){this.hideDropDown();return;};var $H=this.$1l($G);this.$1k($H,false);if(this.ddTable!=undefined&&$Z>=0){var $04=this.ddTable.rows[$Z];this.$1s($04);};if(this.allowMultiSelect)this.$1j($01);this.selectedIndex=$01;this.$1a();this.$1m();if($00)this.hideDropDown();var $05=new Object(),$06=this.oldValue;this.oldValue=this.getValue();this.fireEvent(15,null,$02);this.fireEvent(13,null);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this,$05);if($05.commandCanceled){this.setValue($06);return false;};return true;};PXDropDown.prototype.onSelectionChanged=function($G,$07){var $02=new Object();$02.oldIndex=$G;$02.newIndex=$07;this.fireEvent(15,null,$02);};PXDropDown.prototype.onSelectionChanging=function($G,$07){var $02=new Object();$02["oldIndex"]=$G;$02["newIndex"]=$07;var $08=this.fireEvent(14,null,$02);return $08;};PXDropDown.prototype.$1w=function($Z){if(!this.hasDisabledItems)return $Z;var $v=-1;for(var i=0;i<this.items.length;i++){if(this.items[i].enabled)$v++;if($v>=$Z)break;};return($v==$Z)?i:-1;};PXDropDown.prototype.$1x=function($09){if(!this.hasDisabledItems||$09==undefined)return $09;if($09<0||$09>=this.items.length)return -1;if(!(this.items[$09].enabled))return -1;var $v=-1;for(var i=0;i<=$09;i++)if(this.items[i].enabled)$v++;return $v;};PXDropDown.prototype.$1l=function($0a){var $0b=this.$1x($0a);var $04=null;if(this.ddTable!=undefined&&$0b!=undefined&&$0b>=0)$04=this.ddTable.rows[$0b];return $04;};PXDropDown.prototype.$1j=function($0a,$0c){var $04=this.$1l($0a);if($04==null)return;var $g=this.items[$0a];for(var i=0;i<$04.cells[0].childNodes.length;i++){var $b=$04.cells[0].childNodes[i];if($b.getAttribute&&$b.getAttribute("data-type")=="check"){$g.selected=($0c!=null)?$0c:!$g.selected;__px_cm(this).repaintImage($b,$g.selected?"control@GridCheck":"control@GridUncheck");break;}}};PXDropDown.prototype.$1y=function($0d){var $0e=this.$1x(this.selectedIndex);if($0e==null||$0e<0)$0e=0;else $0e=$0d?($0e-1):($0e+1);if($0e>=0)this.selectRow($0e,false);};PXDropDown.prototype.$1z=function($0d,$A){var $0e=this.$1x($A),$0f=$0e,$0g=this.ddTable.rows.length;if($0e==null||$0e<0)$0e=$0f=$0d?($0g-1):0;else $0e=$0d?($0e-1):($0e+1);if($0e<0)$0e=0;else if($0e>=$0g)$0e=$0g-1;while(this.ddTable.rows[$0e].style.display=="none"){$0e=$0d?($0e-1):($0e+1);if($0e<0||$0e>=$0g){$0e=$0f;break;}};if($0e>=0)this.$1s(this.ddTable.rows[$0e]);return $0e;};PXDropDown.prototype.$1m=function(){var $0h="";if(this.allowMultiSelect){var ar=new Array();for(var i=0;i<this.items.length;i++)if(this.items[i].selected)ar.push(this.$1g(i));$0h=ar.length>0?ar.join(this.valuesSeparator+' '):"";}else $0h=this.$1g(this.selectedIndex);this.$1h($0h);if(this.hasFocus&&!__px(this).IsTablet)this.elemText.select();var $j=this.elemText.parentNode;if($j)__px(this).setTitle($j,$j.scrollWidth>$j.clientWidth?$0h:"");};PXDropDown.prototype.$1g=function($A){if($A!=null&&$A>=0&&$A<this.items.length)return this.items[$A].text?this.items[$A].text:this.items[$A].value;return this.allowNull?this.nullText:PXDropDown.invalidItemText;};PXDropDown.createDropDown=function($l,$Q,$0i,$0j,$0k){var $j=__px($l).createElement("div",__doc($l).forms[0]);$j.className=$0i.dropDown;$j.style.position="absolute";$j.style.left=$j.style.top="-999px";if($0k){var $0l=__px($l).createElement("div",$j);$0l.className="caption";$0l.innerHTML=$0k;};if($0j){var $0m=$l.searchDiv=__px($l).createElement("div",$j);$0m.className="searchCont";var $0n=__px($l).createElement("div",$0m);$0n.className="searchWrap";var $0o=$l.searchElem=__px($l).createElement("input",$0n);$0o.type="text";var $0p=__px_cm($l).createSpriteOrImage($0m,"control@SelectorN");$0p.className+=" searchIcon";var h=Function.createDelegate($l,$l.$1A);__px($l).addEventHandler($0o,"keypress",h);h=Function.createDelegate($l,$l.$1B);__px($l).addEventHandler($0o,"keydown",h);};var $0q=__px($l).createElement("div",$j);$0q.style.overflowY="auto";$0q.style.overflowX="hidden";var $0r=__px($l).createElement("table",$0q);$0r.id=$l.ID+"_dd";$0r.cellSpacing=$0r.cellPadding=0;$l.ddTable=$0r;$l.dropDown=$j;$0r.object=$j.object=$l;PXDropDown.fillDropDown($l,$Q,$0i);PXDropDown.attachDDEventHandlers($l);PXDropDown.setDropDownSize($l);};PXDropDown.prototype.$1r=function(){PXDropDown.createDropDown(this,this.items,this.styles);};PXDropDown.setDropDownSize=function($l){var scroll=false,$0r=$l.ddTable,$0q=$0r.parentNode;var $j=$l.dropDown,$i=($j.style.display=="");if(!$i){$j.style.top=$j.style.left="-999px";$j.style.display="";};var $0s=$0r.rows.length;if($l.maxVisibleItems>0&&$0s>0){var $0t=0,$0u=($j.offsetHeight-$0q.offsetHeight);for(var i=0;i<$0s;i++)if($0r.rows[i].offsetHeight>0){$0t=$0r.rows[i].offsetHeight;break;};$0t*=$l.maxVisibleItems;var $0v=__doc($l).documentElement,$0w=__px($l).getDocScrollElem();var top=__px($l).getElemTopPosAbs($l.element,null,false)-$0w.scrollTop;var $0x=($0v.clientHeight-top-$l.element.offsetHeight-1),$0y;if(($0t+$0u)>Math.max(top,$0x)){$0t=Math.max(top,$0x)-$0u;$0y=true;};$0r.style.width="";if($0t>0&&($0t<$0r.offsetHeight||($0y&&$0q.offsetHeight>$0t))){$0q.style.height=$0t+"px";$0q.style.width=($0r.offsetWidth+17)+"px";scroll=true;}else{$0q.style.width=$0q.style.height="";}};PXDropDown.setDropDownWidth($l);if(!$i)$j.style.display="none";};PXDropDown.setDropDownWidth=function($l){var ew=$l.element.offsetWidth,sd=$l.searchDiv;if(sd&&sd.offsetWidth>ew){var sw=sd.offsetWidth+__px($l).getStyleIntElement(sd,"marginLeft")+__px($l).getStyleIntElement(sd,"marginRight");if(sw>ew)ew=sw;};var $0r=$l.ddTable,$0q=$0r.parentNode;$0r.style.width="";if(ew>$0r.offsetWidth){var $0z=($0q.offsetHeight<$0r.offsetHeight)?17:0;ew=__px($l).getStyleWidth($l.dropDown,ew);$0r.style.width=ew-$0z+"px";var w=$0r.offsetWidth+$0z;$0q.style.width=(ew>w?ew:w)+"px";}};PXDropDown.prototype.$1C=function(){PXDropDown.setDropDownSize(this);};PXDropDown.prototype.$1D=function(){this.$1C();__px(this).setDropDownPos(this.element,this.dropDown,2,this.dropDown.dropDownAbove);};PXDropDown.fillDropDown=function($l,$Q,$0i){if($Q==null)return;var $0r=$l.ddTable,$04=null;var $y=null,$0A=false;while($0r.rows.length>0)$0r.deleteRow(-1);if($l.searchDiv&&$l.searchElem)$l.searchElem.value="";var $0B=0;for(var i=0;i<$Q.length;i++){var $g=$Q[i];if(!$g.enabled)continue;$04=$0r.insertRow($0B);var $0h=$g.text?$g.text:$g.value;var $0C=$04.insertCell(0);if($l.allowMultiSelect){var $0D=__px_cm($l).createSpriteOrImage($0C,$g.selected?"control@GridCheck":"control@GridUncheck");$0D.style.marginLeft="2px";$0D.style.marginRight="5px";$0D.setAttribute("data-type","check");};if($g.imageUrl!=undefined&&$g.imageUrl.length>0){var $0D=__px_cm($l).createSpriteOrImage($0C,$g.imageUrl);$0D.style.marginRight="5px";if($0D.tagName=="IMG")$0D.align="left";};if(__px($l).isRTL())$0C.style.textAlign="right";$0C.className=$0i.item;if($g.startGroup)$0C.setAttribute("data-group","1");if(this.colorBox||$0h==""||$0h!=null&&$0h.trim&&$0h.trim().length==0)$0C.innerHTML="&nbsp;";else{if($l.colorMode)__px($l).setElemText($0C,' '+$0h,true);else __px($l).setElemText($0C,$0h,true);};if($l.colorMode){var $0E=$0C.ownerDocument.createElement('span');$0E.style.backgroundColor=$g.value;$0E.innerHTML='&nbsp;&nbsp;&nbsp;&nbsp;';$0C.insertBefore($0E,$0C.firstChild);};if($g.note){var $0F=__px($l).createElement("div",$0C);$0F.className="note";$0F.innerHTML=$g.note;};$0B++;};$l.hasDisabledItems=($0B<$Q.length);if($l.searchDiv){$l.searchDiv.style.display=($0B<10)?"none":"";$l.hasFilterBar=($0B>=10);}};PXDropDown.prototype.$1p=function(){PXDropDown.fillDropDown(this,this.items,this.styles);};PXDropDown.hilightRow=function($l,$0i,$04){if(typeof $04=="number"){var $0G=$l.ddTable.rows;if($04>=0&&$04<$0G.length)$04=$0G[$04];else $04=null;};if($04){if($l.currentRow!=null)PXDropDown.markSelected($l,$0i,$l.currentRow,false);$l.currentRow=$04;$l.activeRowIndex=$04?$04.rowIndex:null;PXDropDown.markSelected($l,$0i,$04,true);}};PXDropDown.prototype.$1s=function($04){PXDropDown.hilightRow(this,this.styles,$04);};PXDropDown.markSelected=function($l,$0i,$04,on){if($04==null||$04.cells==null)return;var $y=($04.cells.length>0)?$04.cells[0]:null;if($y!=null){var $0H=$0i.selection,$0I=$0i.item;$y.className=on?($0H+" "+$0I):$0I;if(on)__px($l).scrollToView($l.ddTable.parentNode,$y,1);}};PXDropDown.prototype.$1k=function($04,on){PXDropDown.markSelected(this,this.styles,$04,on);};PXDropDown.prototype.onButtonClick=function(e){var me=this;if(this.dropDownOpen){this.hideDropDown();setTimeout(function(){__px(me).selectElement(me.ID,1);},1);}else{this.showDropDown();PXDropDown.$1E(true,this);setTimeout(function(){__px(me).selectElement(me.ID,1);},1);}};PXDropDown.prototype.onMouseDown=function(e){if(!this.allowEdit&&!this.autoSuggestFinal&&!this.getDisabled()){this.onButtonClick(e);__px(this).cancelEvent(e);return false;};return true;};PXDropDown.prototype.$19=function(e){var $0J=__px(this).eventObject(e,PXDropDown),$0K=__px(this).eventElem(e);if($0J&&$0K){if($0K&&__px_cm(this).isSpriteOrImage($0K.parentNode))$0K=$0K.parentNode;var $0L=($0K==$0J.elemButton),$0M=($0K==$0J.elemEdit);var $0N=($0K==$0J.elemClear);var $t=$0N?$0J.imagesC:($0M?$0J.imagesE:$0J.images);if(!$0J.getDisabled()||$0M)switch(e.type){case "mouseover":$0K.$1F=true;if($t.hover)__px_cm(this).repaintImage($0K,$t.hover);break;case "mouseout":$0K.$1F=false;if($t.hover)__px_cm(this).repaintImage($0K,$t.normal);break;case "mousedown":if($t.pushed)__px_cm(this).repaintImage($0K,$t.pushed);if($0L)$0J.onButtonClick(e);else if($0N)this.updateValue(null);else $0J.fireEvent(17,e);__px(this).cancelEvent(e,false);if(__px(this).IsSafari){this.$1G=true;setTimeout(function(){delete $0J.$1G;},500);};break;case "mouseup":if($t.pushed)__px_cm(this).repaintImage($0K,$0K.$1F?$t.hover:$t.normal);break;}}};PXDropDown.$1c=function(e){var $0J=__px(this).eventObject(e);if($0J&&!$0J.getDisabled()){switch(e.type){case "selectstart":case "contextmenu":return __px(this).cancelEvent(e,false);case "mouseover":case "mouseout":case "mouseup":case "mousedown":if(e.type=="mouseup"&&$0J.$1G){delete $0J.$1G;return;};var $04=PXDropDown.$1H(__px(this).eventElem(e));$0J.processDDEvents(e,$04);break;}}};PXDropDown.prototype.fireEvent=function($0O,ev,$0P){if($0P==undefined)$0P=new Object();switch($0O){case 1:case 2:case 3:if(ev.keyCode)$0P["keyCode"]=ev.keyCode;break;case 12:$0P["oldValue"]=this.oldValue;$0P["value"]=this.getValue();break;case 13:$0P["value"]=this.getValue();break;};return this.events.fireEvent($0O,ev,$0P);};PXDropDown.prototype.processDDEvents=function(e,$04){switch(e.type){case "mouseover":if(!this.$17&&$04&&($04!==this.currentRow)){this.$1s($04);this.activeRowIndex=$04.rowIndex;};break;case "mousedown":this.$1q();if(this.forceFocus)this.focus();return __px(this).cancelEvent(e);case "mouseup":if($04){this.selectRow($04.rowIndex,!this.allowMultiSelect);if(this.forceFocus)this.focus();};break;}};PXDropDown.prototype.onKeyDown=function(e){var k=e.keyCode?e.keyCode:e.which;var $0Q=e.altKey,me=this;switch(k){case PX.key_esc:if(this.dropDownOpen){setTimeout(function(){me.hideDropDown();me.focus();},0);__px(this).cancelEvent(e);};return true;case PX.key_tab:case PX.key_enter:if(this.dropDownOpen){if(this.activeRowIndex==null)this.hideDropDown();else this.selectRow(this.activeRowIndex,true);__px(this).cancelEvent(e);if(k==PX.key_enter)setTimeout(function(){me.focus();},0);}else{if(k==PX.key_enter){if(this.hideEnterKey)__px(this).cancelEvent(e);this.updateValue();}};return true;case PX.key_up:case PX.key_down:if($0Q){if(this.dropDownOpen)this.hideDropDown();else this.showDropDown();__px(this).cancelEvent(e,false);return false;};if(!this.getDisabled()){var $0d=(k==PX.key_up);if(this.dropDownOpen){var $A=(this.activeRowIndex!=null)?this.activeRowIndex:this.selectedIndex;this.activeRowIndex=this.$1z($0d,$A);}else if(!this.allowMultiSelect)this.$1y($0d);};__px(this).cancelEvent(e,false);return false;};return true;};PXDropDown.prototype.processKeyDefault=function(e){};PXDropDown.prototype.onKeyPress=function(e){if(this.allowEdit){this.$1I();if(this.autoSuggestFinal){if(!this.dropDown)this.$1r();this.$1J();};return true;};var k=e.keyC,me=this;if((!this.autoSuggestFinal||!this.dropDownOpen)&&(k==PX.key_del||k==PX.key_backspace)){if(this.allowNull)this.updateValue(null);return;};if(this.items){if(!this.dropDown)this.$1r();if(this.autoSuggestFinal){this.$1J();return true;}else if(this.hasFilterBar){this.searchElem.value=String.fromCharCode(k);this.$1v();this.showDropDown();this.$1D();}else{var c=String.fromCharCode(k).toLowerCase();this.$1K(c);}}};PXDropDown.prototype.processPaste=function($0R){if(this.allowEdit)this.$1I();return false;};PXDropDown.prototype.$1J=function(){var me=this;setTimeout(function(){if(me.searchElem.value){me.$1v();if(!me.dropDownOpen)me.showDropDown();else me.$1D();}else me.hideDropDown();},1);};PXDropDown.prototype.$1I=function(){var me=this;this.selectedIndex=-1;setTimeout(function(){me.$1a();},1);};PXDropDown.prototype.$1K=function(ch){var $0S=this.$14+ch;var $A=-1,$0T=true;var $0U=!(this.$14.length>0);var $0V=this.hasSelection()?(this.selectedIndex+($0U?1:0)):0;for(var i=0;i<this.items.length;i++){var $0W=($0V+i)%(this.items.length),$g=this.items[$0W];if(!$g.enabled)continue;var $0h=($g.text?$g.text:$g.value).trimStart();if(!this.caseSensSearch)$0h=$0h.toLowerCase();if($0h.substr(0,$0S.length)==$0S){if($A<0){$A=$0W;}else{$0T=false;break;}}};this.$14="";if($A>=0){var $0b=this.$1x($A);if(!$0T){this.selectRow($0b,false);this.showDropDown();this.$1L();this.$14=$0S;}else this.selectRow($0b,false);}};PXDropDown.prototype.$1L=function(){if(this.$15!=null)clearTimeout(this.$15);PXDropDown.$1M=this;this.$15=setTimeout(function(){PXDropDown.$1N();},this.$16);};PXDropDown.$1M=null;PXDropDown.$1N=function(){var $Y=PXDropDown.$1M;$Y.$14="";PXDropDown.$1M=null;};PXDropDown.prototype.$1A=function(e){if(this.items)this.$1O();};PXDropDown.prototype.$1B=function(e){switch(e.keyCode){case PX.key_up:case PX.key_down:case PX.key_enter:case PX.key_esc:this.onKeyDown(e);break;case 8:case 46:if(this.items)this.$1O();break;}};PXDropDown.prototype.$1O=function(){if(this.$15!=null)clearTimeout(this.$15);var me=this;this.$15=setTimeout(function(){me.$1v();},this.$16);};PXDropDown.prototype.$1v=function($q){var $0X=($q===undefined)?this.searchElem.value:$q;var $0Y=null,$0Z=false;for(var i=0;i<this.items.length;i++){var $g=this.items[i];if(!$g.enabled)continue;var $04=this.$1l(i);if($04){var $0h=($g.text?$g.text:$g.value).trimStart();if(!this.caseSensSearch){$0h=$0h.toLowerCase();$0X=$0X.toLowerCase();};if($0h.indexOf($0X)>=0){$04.style.display="";if($0Y==null)$0Y=$04;}else{if($04==this.currentRow)$0Z=true;$04.style.display="none";}}};if($0Z)this.$1s($0Y);if(this.dropDown&&this.dropDown.style.display=="")this.$1D();};PXDropDown.activeObject=null;PXDropDown.$1E=function(on,$Y){if(on){if(PXDropDown.activeObject==$Y&&$Y.$13==on)return;PXDropDown.activeObject=$Y;$Y.$13=on;var $10=120;setTimeout(function(){PXDropDown.$1E(false);},$10);}else{$Y=PXDropDown.activeObject;if($Y){$Y.$13=on;PXDropDown.activeObject=null;}}};PXDropDown.prototype.$1q=function(){if(this.$12!=null){clearTimeout(this.$12);this.$12=null;}};PXDropDown.$1H=function($b){var $y=$b;function isRowElement($11){return($11.tagName=="TR");}while($y!=null&&!isRowElement($y))$y=$y.parentNode;return $y;};PX.key_up=38;PX.key_down=40;PX.key_esc=27;PX.key_enter=13;PX.key_del=7;PX.key_backspace=8;PX.key_tab=9;


function PXTimeSpan($a,$b,$c,$d){PXTimeSpan.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXTimeSpan.properties);this.emptyChar='0';this.elemFocus=this.getTextElem();this.elemButton=this.getButtonElem();this.attachEventHandlers(true);this.$J=parseInt(this.maxHours.toString()[0]);this.$K=parseInt(this.maxHours.toString()[1]);this.styles=this.dropDownStyles;};PXTimeSpan.__baseType=PXMaskEdit;PXTimeSpan.properties=[["summaryMode",JSType.Bool,false],["promptChar",JSType.String,'_'],["maxVisibleItems",JSType.Int,20],["maxHours",JSType.Int,24],["segments",JSType.Object,null],["items",JSType.Array,PXDropDown.dropDownItemDesc],["dropDownStyles",JSType.Object,null]];PXTimeSpan.prototype.setProperties=function($c){$c.inputMask=this.rawMask;PXTimeSpan.callBase(this,"setProperties",[$c]);};PXTimeSpan.prototype.getTextElem=PXButtonEdit.prototype.getTextElem;PXTimeSpan.prototype.getButtonElem=PXButtonEdit.prototype.getButtonElem;PXTimeSpan.prototype.adjustTextSize=PXButtonEdit.prototype.adjustTextSize;PXTimeSpan.prototype.setSize=PXButtonEdit.prototype.setSize;PXTimeSpan.prototype.setItems=PXDropDown.prototype.setItems;PXTimeSpan.prototype.getEnabled=PXButtonEdit.prototype.getEnabled;PXTimeSpan.prototype.setEnabled=PXButtonEdit.prototype.setEnabled;PXTimeSpan.prototype.setReadOnly=PXButtonEdit.prototype.setReadOnly;PXTimeSpan.prototype.setButtonStyle=PXButtonEdit.prototype.setButtonStyle;PXTimeSpan.prototype.afterSetState=PXButtonEdit.prototype.afterSetState;PXTimeSpan.prototype.attachEventHandlers=PXButtonEdit.prototype.attachEventHandlers;PXTimeSpan.prototype.detachEventHandlers=PXButtonEdit.prototype.detachEventHandlers;PXTimeSpan.prototype.handleTouchEvents=PXButtonEdit.prototype.handleTouchEvents;PXTimeSpan.prototype.setInputMask=function($e){PXTimeSpan.callBase(this,"setInputMask",[$e]);this.viewState.remove("InputMask");};PXTimeSpan.prototype.getValue=function($f){if(this.$L===undefined||$f){var $g=this.calculateValue(this.elemText.value);if($g!==undefined)this.$L=$g;};return this.$L;};PXTimeSpan.prototype.setValue=function(v){var $g=(v!=null)?parseInt(v):null;if($g!==undefined&&!isNaN($g)){this.$L=this.oldValue=$g;this.$M($g<0);if(this.hasFocus){this.elemText.value=this.getEditText($g);if(__px(this).isVisible(this.element))this.selectContent(true);}else this.elemText.value=this.getDisplayText($g);}};PXTimeSpan.prototype.getDisplayValue=function($g,$h,$i){if($i==null)$i=this.promptChar;$g=parseInt($g);if(isNaN($g))return PXMaskEdit.format(this.mask,null,$i);var $j=false;if($g<0){$g=-$g;$j=true;};var $k=this.getValueParts($g);var $l=$k[0],$m=$k[1],$n=$k[2];if($l>0&&(this.summaryMode||this.maxHours>23))while((this.summaryMode||($m+24)<=this.maxHours)&&$l>0){$m+=24;$l--;};if(this.summaryMode){var $o=$m.format("d2",_numbFormatInfo)+_dateFormatInfo.timeSeparator+$n.format("d2",_numbFormatInfo);return($j?"-":"")+$o;};var $p="";for(var i=0;i<this.segments.length;i++){var v=0,$q=this.segments[i];switch($q[0]){case 'm':v=$n;break;case 'h':v=$m;break;case 'd':v=$l;break;};var $r=$q[2]-$q[1]+1,$o=(v==0)?' ':v.toString();if($o.length<$r){var $s=$r-$o.length;for(var j=0;j<$s;j++)$o=' '+$o;}else if($o.length>$r)$o=$o.substr($o.length-$r);$p+=$o;};return PXMaskEdit.format(this.mask,$p,$i);};PXTimeSpan.prototype.getValueParts=function($g){var $l=Math.floor($g/1440);$g=$g%1440;var $m=Math.floor($g/60),$n=$g%60;if($l>0&&(this.summaryMode||this.maxHours>23))while((this.summaryMode||($m+24)<=this.maxHours)&&$l>0){$m+=24;$l--;};return[$l,$m,$n];};PXTimeSpan.prototype.calculateValue=function($t){if(typeof $t=="number")return $t;if(this.isNullValue($t))return this.allowNull?null:0;var $g=0,$j=false,$u;if($t.indexOf("-")==0){$t=$t.substr(1);$j=true;};if(this.summaryMode){var ar=$t.split(_dateFormatInfo.timeSeparator);if(ar.length>1&&!isNaN($u=parseInt(ar[1])))$g+=$u;if(!isNaN($u=parseInt(ar[0])))$g+=$u*60;}else{for(var i=0;i<this.segments.length;i++){var $q=this.segments[i],$v=$q[1],to=$q[2];if($v>=$t.length)continue;var $w=$t.substr($v,to-$v+1);if(this.promptChar!='0')$w=$w.replace(new RegExp(this.promptChar,"g"),"");$u=parseInt($w);if(!isNaN($u)){switch($q[0]){case 'm':$g+=$u;break;case 'h':$g+=$u*60;break;case 'd':$g+=$u*60*24;break;}}}};if(this.allowNull&&$g==0&&this.$L==null)return null;return $j?-$g:$g;};PXTimeSpan.prototype.$N=function($x){var x,n=22,$q=null;for(var i=0;i<this.segments.length;i++){var $y=this.segments[i];if($x<$y[1]||($x>=$y[1]&&$x<=$y[2])){$q=$y;break;}};return $q;};PXTimeSpan.prototype.onKeyPress=function(e){if(this.summaryMode)return false;if(e.keyC==45){var t=this.elemText.value;var $z=this.selStart,$A=this.selEnd;var $j=(t.indexOf('-')==0);t=$j?t.substr(1):('-'+t);this.$M(!$j);if($j){if($z>0)$z--;if($A>0)$A--;}else{$z++;$A++;};this.elemText.value=t;this.select($z,$A);__px_cm(this).notifyOwnerTyping(this);return false;};PXTimeSpan.callBase(this,"onKeyPress",[e]);};PXTimeSpan.prototype.$M=function($j){var $B=this.rawMask.indexOf('-')==0;if($B==$j)return;if($j){this.mask='-'+this.mask;this.rawMask='-'+this.rawMask;}else{this.mask=this.mask.substr(1);this.rawMask=this.rawMask.substr(1);}};PXTimeSpan.prototype.needSuppressMinutes=function($t){if(this.maxHours==24){var $m=this.getValueParts(this.calculateValue($t))[1];return $m==24;};return false;};PXTimeSpan.prototype.clearMinutes=function($t){for(var i=0;i<this.segments.length;i++){var $q=this.segments[i],$v=$q[1],to=$q[2];if($v>=$t.length)continue;if($q[0]=='m'){$t=$t.substring(0,$v)+new Array(to-$v+2).join(this.promptChar)+$t.substring(to+1);break;}};return $t;};PXTimeSpan.prototype.__checkField=function(k,c,t,$x,$C){if(c==this.mask.charAt($x))return ++$x;var $j=(t.indexOf('-')==0);var $y=this.$N($x-($j?1:0));if($y==null)return -1;var i=t.length,n=0,v=-1;var $D=$y[0],$E=$y[1],end=$y[2];if($j){$E++;end++;};if($x<$E)$x=$E;if(k<48||k>57){if(k==46||k==58){$x=end;while(++$x<i)if(this.mask.charCodeAt($x)<21)break;return $x;};return -1;};k-=48;if($x==$E){v=(t.charAt($x+1)==this.promptChar)?0:(t.charCodeAt($x+1)-48);switch($D){case 'h':if(k>this.$J)n=1;else if(k==this.$J&&v>this.$K)n=2;break;case 'm':if(k>5)n=1;break;}};if($x==($E+1)){v=(t.charAt($x-1)==this.promptChar)?0:(t.charCodeAt($x-1)-48);switch($D){case 'h':if(v>this.$J||(v==this.$J&&k>this.$K))n=3;break;case 'm':if(v>6||(v==6&&k>0))n=3;break;}};if(n==1){t=t.substring(0,$x)+this.promptChar+t.substring($x+1);$x++;};if(n==2)t=t.substring(0,$x+1)+this.promptChar+t.substring($x+2);if(n==3){while(++$x<i)if(this.mask.charCodeAt($x)<21)break;if($x>=i)return -1;return this.__checkField(k+48,c,t,$x,$C);};$C.txt=t.substring(0,$x)+c+t.substring($x+1);if(this.needSuppressMinutes($C.txt))$C.txt=this.clearMinutes($C.txt);return ++$x;};PXTimeSpan.prototype.onButtonClick=function(e){if(this.dropDownOpen){this.hideDropDown();this.focus();}else this.showDropDown();};PXTimeSpan.prototype.onKeyDown=function(e){if(PXTimeSpan.callBase(this,"onKeyDown",[e])){switch(e.keyC){case PX.key_down:case PX.key_F3:if(!this.timeMode&&(e.keyC==PX.key_F3||e.altKey)){this.onButtonClick();if(__px(this).IsIE)e.keyCode=0;return false;};break;}};return true;};PXTimeSpan.prototype.processDDEvents=function(e,$F){switch(e.type){case "mouseover":if($F&&($F!=this.currentRow))PXDropDown.hilightRow(this,this.dropDownStyles,$F);break;case "mousedown":this.focus();return __px(this).cancelEvent(e,true);case "mouseup":if($F){this.hideDropDown(true);this.focus();};break;}};PXTimeSpan.prototype.showDropDown=function(){if(this.dropDownOpen||this.getDisabled())return;__px_cm(this).closeActiveDropDown(this);if(!this.dropDown)PXDropDown.createDropDown(this,this.items,this.dropDownStyles,false);__px_cm(this).setDropDownVisible(this,true);__px(this).setDropDownPos(this.element,this.dropDown,2);if(!this.hasFocus)this.focus();PXDropDown.hilightRow(this,this.dropDownStyles,this.$O());};PXTimeSpan.prototype.hideDropDown=function($G){if(!this.dropDown||!this.dropDownOpen)return;try{if($G){var i=(this.currentRow!=null)?this.currentRow.rowIndex:-1;var $H=(i>=0)?this.items[i].value:null;if($H)this.updateValue(parseInt($H));}}finally{__px_cm(this).setDropDownVisible(this,false);}};PXTimeSpan.prototype.$O=function($I){if($I==null)$I=this.getValue();for(var i=0;i<this.items.length;i++){if(__px(this).equals($I,parseInt(this.items[i].value)))return i;};return -1;};


function PXTimeEdit($a,$b,$c,$d){PXTimeEdit.initializeBaseA(this,[$a,$b,$c,$d]);this.trackSelection=true;__px_cm(this).readProperties(this,$c,PXTimeEdit.properties);this.dotSymbol=".";this.decimalSeparator=":";this.minusSymbol=_numbFormatInfo.negativeSign;this.groupSeparator=_numbFormatInfo.number.groupSeparator;this.decimals=2;this.maxDecimals=59;};PXTimeEdit.__baseType=PXTextEdit;PXTimeEdit.prototype.onKeyPress=PXNumberEdit.prototype.onKeyPress;PXTimeEdit.prototype.isMinus=PXNumberEdit.prototype.isMinus;PXTimeEdit.prototype.parseValue=PXNumberEdit.prototype.parseValue;PXTimeEdit.prototype.parseFloat=PXNumberEdit.prototype.parseFloat;PXTimeEdit.prototype.getDecimals=PXNumberEdit.prototype.getDecimals;PXTimeEdit.$p=0;PXTimeEdit.$q=1000;PXTimeEdit.properties=[["minValue",JSType.Float,PXTimeEdit.$p],["maxValue",JSType.Float,PXTimeEdit.$q],["editFormat",JSType.String,""],["displayFormat",JSType.String,""],["allowNull",JSType.Bool,false]];PXTimeEdit.prototype.getValue=function($e){if(this.$r===undefined||$e){var $f=this.$s(this.elemText.value);if($f!==undefined)this.$r=$f;};return this.$r;};PXTimeEdit.prototype.setValue=function(v){var $f=(v!=null)?parseInt(v):null;if($f!==undefined&&!isNaN($f)){this.$r=this.oldValue=$f;this.repaintText($f);if(this.hasFocus&&__px(this).isVisible(this.element))this.selectContent(true);}};PXTimeEdit.prototype.getEditText=function(v){if(this.allowNull&&v==null)return "";return this.$t(v,this.editFormat);};PXTimeEdit.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return this.nullText;return this.$t(v,this.displayFormat);};PXTimeEdit.prototype.validateInputText=function($g){return this.$u($g);};PXTimeEdit.prototype.$s=function($g){if(this.isNullValue($g))if(this.allowNull)return null;else return 0;var $h=this.$v(this.parseValue($g));var $i=Math.floor($h),$j=Math.round(($h-$i)*100);return $i*60+$j;};PXTimeEdit.prototype.$t=function(v,$k){var $i=Math.floor(v/60),$l=v%60;var $m=$i+$l/100.0,fs=$k?$k:"n2";return this.$u($m.format(fs,_numbFormatInfo));};PXTimeEdit.prototype.$u=function($g){$g=$g.replace(_numbFormatInfo.number.decimalSeparator,this.decimalSeparator);return $g.replace(new RegExp('\\'+this.groupSeparator,"g"),"");};PXTimeEdit.prototype.$v=function(v){if(v!=null&&!isNaN(v)){var $n=this.minValue,$o=this.maxValue;if($n!=null&&v<$n)return $n;if($o!=null&&v>$o)return $o;};return v;};



function PXCheckBox($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);this.isInput=($b.tagName=="INPUT");this.elemSpan=this.elemWrapper=$b.parentNode;this.elemSpan.object=this;this.attachEventHandlers();this.elemLabel=$b.nextSibling;if(this.elemLabel&&this.elemLabel.tagName!="LABEL")this.elemLabel=null;if(this.elemLabel==null){this.elemLabel=$b.previousSibling;if(this.elemLabel&&this.elemLabel.tagName!="LABEL")this.elemLabel=null;};__px_cm(this).setStackElements(this);this.events=new PXEventList(this,PXCheckBox.events,$c.clientEvents);this.viewState=new PXStateBag(this,"PXCheckBox");__px_cm(this).registerRequiresOnLoad(this,$b.id);};PXCheckBox.prototype.onLoad=function(){if(this.syncStateWithCommand)__px_cm(this).registerCommandExecutor(this);};PXCheckBox.prototype.commandStateCallback=function($d,$e){this.setEnabled($d.getEnabled());};PXCheckBox.convertValue=function($f,$g){return NetType.convert($g,$f.valueType);};PXCheckBox.properties=[["autoPostBack",JSType.Bool,false],["valueType",JSType.Int,3],["trueValue",JSType.Empty,"",PXCheckBox.convertValue],["falseValue",JSType.Empty,"",PXCheckBox.convertValue],["bindingContainer",JSType.String,""],["onValueChange",JSType.Int,0],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc],["syncStateWithCommand",JSType.Bool,false],["checkImages",JSType.Object,null],["uncheckImages",JSType.Object,null]];PXCheckBox.callbackProps=[["hidden",JSType.Bool,false,PXControl.setHidden],["enabled",JSType.Bool,true,"setEnabled"],["value",JSType.Empty,null,"setValue"]];PXCheckBox.prototype.setProperties=function($c){if(this.syncStateWithCommand)$c.enabled=this.getEnabled();__px_cm(this).readProperties(this,$c,PXCheckBox.callbackProps);};PXCheckBox.events={$initialize:0,$keyDown:1,$keyPress:2,$keyUp:3,$mouseDown:4,$mouseUp:5,$mouseMove:6,$mouseOver:7,$mouseOut:8,$click:9,$focus:10,$blur:11,$valueChanging:12,$valueChanged:13,$valueInitialized:14};PXCheckBox.prototype.attachEventHandlers=function(){var h=PXCheckBox.$t;__px_cm(this).addBaseHandlers(this.isInput?this.element:this.elemSpan,h);h=PXCheckBox.$u;__px(this).addEventHandler(this.elemSpan,"mouseover",h);__px(this).addEventHandler(this.elemSpan,"mouseout",h);__px(this).addEventHandler(this.elemSpan,"mousedown",h);__px(this).addEventHandler(this.elemSpan,"mouseup",h);};PXCheckBox.prototype.detachEventHandlers=function(){var h=PXCheckBox.$t;__px_cm(this).removeBaseHandlers(this.isInput?this.element:this.elemSpan,h);h=PXCheckBox.$u;__px(this).removeEventHandler(this.elemSpan,"mouseover",h);__px(this).removeEventHandler(this.elemSpan,"mouseout",h);__px(this).removeEventHandler(this.elemSpan,"mousedown",h);__px(this).removeEventHandler(this.elemSpan,"mouseup",h);};PXCheckBox.prototype.focus=function(){try{this.element.focus();}catch(e){}};PXCheckBox.prototype.getValue=function(){var $h=this.getChecked();if(this.valueType==NetType.Boolean)return $h;return $h?this.trueValue:this.falseValue;};PXCheckBox.prototype.setValue=function(v){var $i=NetType.convert(v,this.valueType);if(this.valueType==NetType.Boolean)this.setChecked($i);else this.setChecked($i==this.trueValue);this.fireEvent(14,null)};PXCheckBox.prototype.getChecked=function(){if(this.isInput)return this.element.checked;return this.element.getAttribute("checked")!=null;};PXCheckBox.prototype.setChecked=function(v){if(this.isInput)this.element.checked=v;else{if(v)this.element.setAttribute("checked",v);else this.element.removeAttribute("checked");this.$v();this.viewState.update("Checked",Boolean(v));}};PXCheckBox.prototype.updateValue=function(v){$j=this.fireEvent(12,null);if(!$j){this.setChecked(v);this.fireEvent(13,null);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this);}};PXCheckBox.prototype.getVisible=function(){return this.element.style.display!="none";};PXCheckBox.prototype.setVisible=function(v){if(v!=this.getVisible()){var $k=v?"":"none";__px_cm(this).setStackElementsVisible(this,v);this.element.style.display=this.elemSpan.style.display=$k;if(this.elemLabel)this.elemLabel.style.display=$k;}};PXCheckBox.prototype.getEnabled=function(){return __px(this).getEnabled(this.elemSpan);};PXCheckBox.prototype.setEnabled=function($l){if($l!=this.getEnabled()){__px(this).setEnabled(this.elemSpan,$l);__px(this).setEnabled(this.element,$l);}};PXCheckBox.prototype.getText=function(){return this.elemLabel?__px(this).getElemText(this.elemLabel):"";};PXCheckBox.prototype.setText=function(v){if(this.elemLabel)__px(this).setElemText(this.elemLabel,v);};PXCheckBox.prototype.fireEvent=function(id,ev){var $m=new Object();$m.value=this.element.checked;if(id==12)$m.oldValue=!$m.value;return this.events.fireEvent(id,ev,$m);};PXCheckBox.prototype.$w=function($n,$h){var im=$h?this.checkImages:this.uncheckImages,$o;switch($n){case 0:$o=im.normal;break;case 1:$o=im.disabled;break;case 2:$o=im.hover;break;case 3:$o=im.pushed;break;};if(!$o){if($n>0)$o=this.$w(($n==3)?2:0,$h);};return $o;};PXCheckBox.prototype.$v=function(){var $p,$h=this.getChecked();if(!this.getEnabled()){$p=this.$w(1,$h);}else if(this.$x){$p=this.$w(3,$h);}else if(this.$y){$p=this.$w(2,$h);};if(__px_cm(this).isSpriteOrImage(this.element)){if(!$p)$p=this.$w(0,$h);__px_cm(this).repaintImage(this.element,$p);}};PXCheckBox.$t=function(e){var $q=__px(this).eventObject(e,PXCheckBox);if(!$q)return;var $n=PXEvent.baseEventID(e.type);var $r=($n==9)?__px(this).isActiveWC():false;var $j=$q.fireEvent($n,e);if(!$j&&$q.getEnabled()&&$n==9){if(!$r){__px(this).unregisterWaitTask($q);$j=$q.$z();}};if($n==10)__px_cm(this).notifyOwnerActivate(this);if($j)__px(this).cancelEvent(e);};PXCheckBox.prototype.$z=function($s){var $j=this.fireEvent(12,null);if(!$j){if(!this.isInput||$s)this.setChecked(!this.getChecked());this.fireEvent(13,null);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this);};return $j;};PXCheckBox.$u=function(e){var $q=__px(this).eventObject(e,PXCheckBox);if($q&&$q.getEnabled()){switch(e.type){case "mouseover":$q.$y=true;break;case "mouseout":$q.$x=$q.$y=false;break;case "mousedown":__px(this).registerWaitTask($q,$q.$z,true);$q.$x=true;break;case "mouseup":$q.$x=false;break;};$q.$v();}};



function PXComboBox($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);this.attachEventHandlers();this.events=new PXEventList(this,PXComboBox.events,$c.clientEvents);this.viewState=new PXStateBag(this,"PXComboBox");};PXComboBox.properties=[["autoPostBack",JSType.Bool,false],["valueType",JSType.Int,9],["bindingContainer",JSType.String,""]];PXComboBox.callbackProps=[["hidden",JSType.Bool,false,PXControl.setHidden],["enabled",JSType.Bool,true,"setEnabled"],["value",JSType.Empty,null,"setValue"]];PXComboBox.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXComboBox.callbackProps);};PXComboBox.events={$initialize:0,$keyDown:1,$keyPress:2,$keyUp:3,$mouseDown:4,$mouseUp:5,$mouseMove:6,$mouseOver:7,$mouseOut:8,$click:9,$focus:10,$blur:11,$valueChanging:12,$valueChanged:13};PXComboBox.prototype.attachEventHandlers=function(){__px_cm(this).addBaseHandlers(this.element,PXComboBox.$p);__px(this).addEventHandler(this.element,"change",PXComboBox.$p);};PXComboBox.prototype.detachEventHandlers=function(){__px_cm(this).removeBaseHandlers(this.element,PXComboBox.$p);__px(this).removeEventHandler(this.element,"change",PXComboBox.$p);};PXComboBox.prototype.fireEvent=function(id,ev){var $d=new Object();return this.events.fireEvent(id,ev,$d);};PXComboBox.prototype.getVisible=function(){return this.element.style.display!="none";};PXComboBox.prototype.setVisible=function($e){if($e!=this.getVisible()){this.element.style.display=($e?"":"none");}};PXComboBox.prototype.getEnabled=function(){return !this.element.disabled;};PXComboBox.prototype.setEnabled=function($f){if($f!=this.getEnabled()){this.element.disabled=!$f;}};PXComboBox.prototype.getValue=function($g){if(this.value===undefined||$g)this.value=NetType.convert(this.element.value,this.valueType);return this.value;};PXComboBox.prototype.setValue=function(v){if(v==null){this.element.selectedIndex=-1;this.value=null;}else{this.value=NetType.convert(v,this.valueType);this.element.value=this.value;}};PXComboBox.prototype.addItem=function($h,$i){$i=NetType.convert($i,this.valueType);var $j=this.element.options;$j[$j.length]=new Option($h,$i,false,false);};PXComboBox.prototype.removeItem=function($i){$i=NetType.convert($i,this.valueType);var $k=this.element.options;for(var i=0;i<$k.length;i++){var $j=$k[i];var $l=NetType.convert($j.value,this.valueType);if($l==$i){this.element.remove(i);break;}}};PXComboBox.$p=function(e){var $m=__px(this).eventElem(e).object;if($m){var $n;if(e.type=="change"){$n=$m.fireEvent(12,null);if($n)$m.element.value=$m.value;else{$m.value=NetType.convert($m.element.value,$m.valueType);$m.fireEvent(13,null);__px_cm(this).notifyOwnerChanged($m);}}else{var $o=PXEvent.baseEventID(e.type);$n=$m.fireEvent($o,e);};if($n)__px(this).cancelEvent(e);}};



function PXGroupBox($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);if($b.tagName=="TABLE")this.elemCap=$b.rows[0].cells[1];else{var ec=$b.firstChild;while(ec&&ec.tagName!="LEGEND")ec=ec.nextSibling;this.elemCap=ec;};__px_cm(this).setStackElements(this);var h=Function.createDelegate(this,this.$t);for(var i=0;i<this.buttons.length;i++)__px(this).addEventHandler(__px(this).elemByID(this.buttons[i]),"click",h);this.events=new PXEventList(this,PXGroupBox.events,$c.clientEvents);this.viewState=new PXStateBag(this,"PXGroupBox");};PXGroupBox.convertButtons=function($d,$e){var $f=[];if($e){$f=$e.split(",");for(var i=0;i<$f.length;i++)$f[i]=$d.ID+"_"+$f[i];};return $f;};PXGroupBox.properties=[["autoPostBack",JSType.Bool,false],["value",JSType.Empty,null],["valueType",JSType.Int,9],["allowNull",JSType.Bool,false],["bindingContainer",JSType.String,""],["buttons",JSType.Empty,null,PXGroupBox.convertButtons],["onValueChange",JSType.Int,0],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc]];PXGroupBox.callbackProps=[["hidden",JSType.Bool,false,PXControl.setHidden],["enabled",JSType.Bool,true,"setEnabled"],["value",JSType.Empty,null,"setValue"]];PXGroupBox.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXGroupBox.callbackProps);};PXGroupBox.events={$initialize:0,$valueChanging:1,$valueChanged:2};PXGroupBox.prototype.getVisible=function(){return this.element.style.display!="none";};PXGroupBox.prototype.setVisible=function($g){if($g!=this.getVisible()){this.element.style.display=($g?"":"none");__px_cm(this).setStackElementsVisible(this,$g);this.$u($g);}};PXGroupBox.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXGroupBox.prototype.setEnabled=function($h){if($h!=this.getEnabled()){__px(this).setEnabled(this.element,$h);for(var i=0;i<this.buttons.length;i++){var rb=__px(this).elemByID(this.buttons[i]);rb.disabled=!$h;rb.parentNode.disabled=!$h;}}};PXGroupBox.prototype.getCaption=function(){return __px(this).getElemText(this.elemCap);};PXGroupBox.prototype.setCaption=function(v){__px(this).setElemText(this.elemCap,v);};PXGroupBox.prototype.getValue=function(){return this.value;};PXGroupBox.prototype.setValue=function(v){var $i=this.buttons.length;v=this.$v(v);if(this.allowNull&&v==null){this.$w("");for(var i=0;i<$i;i++)__px(this).elemByID(this.buttons[i]).checked=false;return;};for(var i=0;i<$i;i++){var rb=__px(this).elemByID(this.buttons[i]);var $j=this.$v(rb.getAttribute("value"));if($j==v){this.$w(v);if(!rb.checked)rb.checked=true;break;}}};PXGroupBox.prototype.$w=function(v){this.value=this.$v(v);this.viewState.update("Value",this.value);};PXGroupBox.prototype.$v=function(v){if(this.allowNull&&(v==""||v==null))return null;return NetType.convert(v,this.valueType);};PXGroupBox.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return "";for(var i=0;i<this.buttons.length;i++){var rb=__px(this).elemByID(this.buttons[i]);var $j=this.$v(rb.getAttribute("value"));if($j==v){var $k=rb.nextSibling;if($k&&$k.htmlFor==rb.id)return $k.innerHTML;}}};PXGroupBox.prototype.fireEvent=function(id,ev){var $l=new Object();return this.events.fireEvent(id,ev,$l);};PXGroupBox.prototype.$t=function(e){var $m=__px(this).eventElem(e);if($m.tagName!="INPUT")$m=$m.previousSibling;if($m&&!$m.disabled&&this.getEnabled()){var $e=this.$v($m.getAttribute("value"));if($e!=this.getValue()){var $n=this.fireEvent(1,e);if($n)this.setValue(this.value);else{this.$w($e);this.fireEvent(2,e);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this);}}}};PXGroupBox.prototype.$x=function(){if(this.controls!=null)return this.controls;this.controls=new Object();this.controlsV=new Object();var $o=this.element.id;for(var name in __px_all(this)){var $p=__px_all(this)[name];if(!$p.ID.startsWith($o))continue;var $b=$p.element?$p.element.parentNode:null;var $q=false;while($b){if($b.object!=null){$q=($b.object==this);break;};$b=$b.parentNode;};if($q){if($p.onVisibleChanged)this.controlsV[name]=$p;this.controls[name]=$p;}};return this.controls;};PXGroupBox.prototype.$u=function($r){this.$x();var $s=this.controlsV;for(var id in $s){var $p=$s[id];if($p.onVisibleChanged)$p.onVisibleChanged($r&&__px(this).isVisible($p.element));}};



function PXBaseDataSource($a,$b,$c){this.px_context=$a;this.element=$b;if($b.id)this.ID=$b.id;else this.ID=$b;this.toolBar=__px_all(this)[this.ID+"_ToolBar"];__px_cm(this).readProperties(this,$c,PXBaseDataSource.properties);this.$19=false;this.$1a=true;this.isClientDirty=false;if(this.isDefault){var h=Function.createDelegate(this,this.$1b);__px(this).addEventHandler(__doc(this).documentElement,"keydown",h);};__px_cm(this).registerRequiresOnLoad(this,$b.id);this.events=new PXEventList(this,PXBaseDataSource.events,$c.clientEvents);this.viewState=new PXStateBag(this,"PXBaseDataSource");};PXBaseDataSource.prototype.dispose=function(){var $d=__px(this).frameElement();if($d){var $a=__px_context($d),$e=$a?$a.layerResizer:null;if($e&&($e.layerOwner==null||$e.layerOwner==this)){delete $e.layerOwner;delete $e.control;delete $e.element;delete $e.px_context;delete $a.layerResizer;}};delete this.layerObject;delete this.layerValidate;delete this.layerCallback;delete this.toolBar;delete this.commandControls;};PXBaseDataSource.events={$initialize:0,$commandPerformed:1,$buttonClick:2,$keyChanged:3,$beforeRedirect:4};PXBaseDataSource.elapsedCommandName="ElapsedTime";PXBaseDataSource.confirmations=[["commandName",JSType.String,""],["checkDirty",JSType.Bool,false],["message",JSType.String,"Any unsaved changes will be discarded."],["shortcutChar",JSType.Int,0],["shortcutCtrl",JSType.Bool,false],["shortcutShift",JSType.Bool,false]];PXBaseDataSource.properties=[["autoPostBack",JSType.Bool,false],["confirmations",JSType.Array,PXBaseDataSource.confirmations],["callbacks",JSType.Array,PXCallbackManager.commandDesc],["commandStates",JSType.Array,null],["isDirty",JSType.Bool,false],["sourceName",JSType.String,null],["saveCommandName",JSType.String,null],["cancelCommandName",JSType.String,null],["isDefault",JSType.Bool,false],["isNewRecord",JSType.Bool,false],["message",JSType.String,"Any unsaved changes will be discarded."],["primaryView",JSType.String,null],["gridID",JSType.String,null],["layeredActions",JSType.Array,null]];PXBaseDataSource.behavior=true;PXBaseDataSource.prototype.onLoad=function(){if(this.toolBar){for(var i=0;i<this.toolBar.items.length;i++){var $f=this.toolBar.items[i];if($f.commandName=="LongRun"){this.longRunIndex=i;break;}};if(this.longRunIndex!=null){var $g=this.toolBar.items[this.longRunIndex];$g.setVisible(false);};var bh=Function.createDelegate(this,this.$1c);this.toolBar.events.addEventHandler("buttonClick",bh);};this.notifyCommandState();if(this.isDefault){var $d=__px(this).frameElement();if(!$d||$d.id=='main')this.renderLayerActions();}};PXBaseDataSource.prototype.$1c=function($h,$i){if($i.button.commandName){this.callbackFromUI=true;this.viewState.update("CallbackFromUI",this.callbackFromUI);};this.events.fireEvent("buttonClick",null,$i);};PXBaseDataSource.prototype.notifyCommandState=function(){var $j=new Object();if(this.commandStates){for(var $k=0;$k<this.commandStates.length;$k++){$j[$k]=this.commandStates[$k].name;}};__px_cm(this).notifyCommandState(this,$j);};PXBaseDataSource.prototype.executeCallback=function($l,$m,$n){this.$1d($l,$m,null,$n);};PXBaseDataSource.prototype.getChanged=function(){return this.isDirty;};PXBaseDataSource.prototype.setChanged=function(){this.isDirty=true;this.notifyCommandState();};PXBaseDataSource.prototype.setClientChanged=function(){this.isClientDirty=true;this.notifyCommandState();};PXBaseDataSource.prototype.getCallback=function($l){var $o=null;for(var c in this.callbacks){if(this.callbacks[c].name&&String.compare(this.callbacks[c].name,$l,true)){$o=this.callbacks[c];break;}};return $o;};PXBaseDataSource.prototype.$1d=function($l,$m,$p,$n){if(this.elapsedId){clearTimeout(this.elapsedId);this.elapsedId=null;};var $q;var $r=false;if(this.confirmations){for(var i=0;i<this.confirmations.length;i++){var $s=this.confirmations[i];var $t=$s.commandName&&$s.commandName.toLowerCase();var $u=$l&&$l.toLowerCase();if($u!=null&&($t==$u||$u.startsWith($t+"@"))){$q=$s.message;$r=$s.checkDirty;break;}}};var $v=false;if($r&&!this.isDirty)$v=__px_cm(this).checkDataChanges(true);delete this.commandCanceled;if($q&&(!$r||$v||this.isDirty)){var ae=__doc(this).activeElement,$w=true;if(ae&&ae.blur)ae.blur();try{$w=confirm($q);}catch(ex){$w=true;};if(!$w){$l="";this.commandCanceled=true;}else{if("viewDashboard"==$l)__win(this).suppressChangesForReq=true;}};var $x;var $o=this.getCallback($l);var $y=false;try{if($o){if($n){$o=__px_callback(this).copyCommand($l,$o);if($n.blockPage!=undefined)$o.blockPage=$n.blockPage;if($n.commitChanges!=undefined)$o.commitChanges=$n.commitChanges;if($n.commitChangesIDs!=undefined)$o.commitChangesIDs=$n.commitChangesIDs;if($n.repaintControls!=undefined)$o.repaintControls=$n.repaintControls;if($n.repaintControlsIDs!=undefined)$o.repaintControlsIDs=$n.repaintControlsIDs;if($n.selectControlsIDs!=undefined)$o.selectControlsIDs=$n.selectControlsIDs;if($n.postData!=undefined)$o.postData=$n.postData;if($n.postDataControls!=undefined)$o.postDataControls=$n.postDataControls;if($n.container!=undefined)$o.container=$n.container;if($n.sendSettings!=undefined)$o.sendSettings=$n.sendSettings;};var $a=new Object();$a.id=this.ID;$a.command=$l;$a.commandArg=$m;$x=$m;if(($p==null||!$p.command)&&$o.popupCommand){var pt=__px_alls(this)[$o.popupCommandTarget];$p=new Object();$p.command=$o.popupCommand;$p.target=pt?pt.ID:this.ID;$p.enabled=true;$p.checkSave=$o.popupCheckSave;};if(($p==null||!$p.command)&&String.compare($a.command,PXBaseDataSource.elapsedCommandName,true)){$p=this.$1e;};try{if(this.toolBar&&this.toolBar.events&&this.toolBar.events.eventArgs&&this.toolBar.events.eventArgs.event){$a.openFrameset=this.toolBar.events.eventArgs.event.shiftKey||this.toolBar.events.eventArgs.event.ctrlKey;}}catch(e){;};var cb=__px_callback(this);if(cb){cb.execI(this,$o,$x,Function.createDelegate(this,this.$1f),$a,$p);$y=true;if(String.compare(this.saveCommandName,$l,true)||$l=="SaveClose"||$l=="SaveCloseToList"||$l.toLowerCase().indexOf("delete")>=0||!$o.popupCheckSave){__win(this).savePerformed=true;}}}}catch(ex){__win(this).suppressChangesForReq=undefined;throw ex;};if(!$y)__win(this).suppressChangesForReq=undefined;};PXBaseDataSource.prototype.$1f=function($z,$a){var ds=__px_all(this)[$a.id];if($z){if(ds){var $A=new PXXmlDoc("",$z);if(!String.compare($a.command,PXBaseDataSource.elapsedCommandName,true)){var cs=this.getCallback($a.command);if(cs&&(cs.commitChanges||$a.command==this.cancelCommandName))this.isClientDirty=false;};__px_cm(this).readProperties(ds,ds.$1g($A.rootNode),PXBaseDataSource.callbackProps);ds.callbackResult($a);ds.processRefresh($z);}};if(ds&&!ds.longRunInProcess){delete ds.callbackFromUI;ds.viewState.remove("CallbackFromUI");}};PXBaseDataSource.prototype.callbackResult=function($a){this.events.fireEvent("commandPerformed",null,$a);};PXBaseDataSource.callbackProps=[["alert",JSType.String,null],["isDirty",JSType.Bool,false],["callbackResultArg",JSType.String,null],["longRunMessage",JSType.String,"Nothing in progress"],["longRunAbort",JSType.String,"Press to abort"],["longRunCompleted",JSType.String,null],["longRunInProcess",JSType.String,null],["longRunAborted",JSType.String,null],["sessionID",JSType.String,null],["isNewRecord",JSType.Bool,false],["dataKey",JSType.String,"","setDataKey"],["showImportErrors",JSType.Bool,false],["attributesFound",JSType.Bool,true,"displayAttributes"],["showProcessWindow",JSType.Bool,false]];PXBaseDataSource.prototype.notifyRedirect=function($a,$B){this.events.fireEvent("beforeRedirect",null,$a);if(this.longRunInProcess&&!this.elapsedId){var me=this;this.elapsedId=setTimeout(function(){me.checkElapsed();},5000);};if(this.layerObject){if(this.willbeLayerAction)this.activeLayerAction=this.willbeLayerAction;delete this.willbeLayerAction;this.layerObject.setState({'msg':$B});}};PXBaseDataSource.prototype.notifyRedirectFailed=function($a){if(this.layerObject&&this.oldLayerIndex!=null){this.layerObject.setState({'active':this.oldLayerIndex});}else{if(this.willbeLayerAction)this.activeLayerAction=this.willbeLayerAction;};delete this.willbeLayerAction;};PXBaseDataSource.prototype.setDataKey=function($C){if($C!=null&&this.dataKey!=$C){this.dataKey=$C;this.events.fireEvent("keyChanged");}};PXBaseDataSource.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXBaseDataSource.callbackProps);if(this.sessionID!=null){var ds=__px(this).elemByID("__DataSourceSessionID");if(ds)ds.value=this.sessionID;};if($c.commandStates.length){for(var i=0;i<$c.commandStates.length;i++){var $D=$c.commandStates[i];if($D.enabled==undefined)$D.enabled=true;if($D.visible==undefined)$D.visible=true;var find=false;for(var j=0;j<this.commandStates.length;j++){var $E=this.commandStates[j];if(String.compare($E.name,$D.name,true)){find=true;$E.enabled=$D.enabled;$E.visible=$D.visible;if($D.displayName!=undefined)$E.displayName=$D.displayName;if($D.tooltip!=undefined)$E.tooltip=$D.tooltip;}};if(!find)this.commandStates.push($D);}};if(this.alert){__px_callback(this).processRedirect(this.alert);};if(this.toolBar&&this.longRunIndex!=null){var $q=this.longRunMessage,$F=this.pnlQuickInfo;var $G=this.longRunCompleted;var $g=this.toolBar.items[this.longRunIndex];var $H=this.toolBar.items[this.longRunIndex+1];$g.element.removeAttribute("error");if(this.showProcessWindow)__px_alls(this)["PanelProgress"].show(null);if($G){if(this.$19){this.$1h($g);};if(!this.showProcessWindow){$H.setVisible(true);$g.setVisible(true);};if(!this.timerId)$H.setText($G);$g.setTooltip($q);$H.element.setAttribute("status","completed");$g.element.setAttribute("status","completed");this.$1i();if($F){var $I=this.$1j($c);__px(this).appendCss($F.element,[$I?"not-completed":"completed"],true);};this.$1k();}else{var $J=this.longRunInProcess;if($J){this.$1l(false,__px_callback(this).command);this.$1j($c);}else{this.$1i();var $K=this.longRunAborted;if($K){if(!this.$19){this.$1h($g);};if(!this.showProcessWindow){$H.setVisible(true);$g.setVisible(true);};if(!this.timerId)$H.setText($K);$g.setTooltip($q);this.$1j($c);}else{if(this.$19){this.$1h($g);};$H.setVisible(false);$g.setVisible(false);$H.setText("");$g.setTooltip($q);};$H.element.setAttribute("status","aborted");$g.element.setAttribute("status","aborted");$g.element.setAttribute("error","2");this.$1k();if($F&&$F.getVisible())__px(this).appendCss($F.element,["not-completed"],true);}}};if(this.showImportErrors){var me=this;setTimeout(function(){me.showImportGraphErrors();},1);};this.notifyCommandState();if($c.popupMessage){var $L=__px_all(this)["msgBox"];clearTimeout(this.$1m);this.$1m=setTimeout(function(){if($L){$L.setText($c.popupMessage);$L.show();}else alert($c.popupMessage);},1);}};PXBaseDataSource.prototype.$1i=function(){this.$1a=true;this.$1e=null;};PXBaseDataSource.prototype.displayAttributes=function($M){if($M){var $N=this.element.ownerDocument.querySelector('.lurkingAttrib');if($N)$N.classList.remove('lurkingAttrib');}};PXBaseDataSource.prototype.checkElapsed=function(){this.$1d(PXBaseDataSource.elapsedCommandName);};PXBaseDataSource.prototype.processDirective=function($x,$O){var ar=$x?$x.split('|'):[],$P=$O.context;if(ar&&ar[0]=="InProcess"){this.longRunMessage=ar[1];this.longRunInProcess=ar[2];this.showProcessWindow=ar.length>3?ar[3].trim()==="ProcessWindow":false;this.$1l(true,$P&&$P.context&&$P.context.info);}};PXBaseDataSource.prototype.$1n=function(){if(!this.toolBar)return;if(this.startTime==null)this.startTime=new Date();var $Q=new Date()-this.startTime,me=this;var $H=this.toolBar.items[this.longRunIndex+1];var $R=Math.floor($Q/1000);var $S=Math.floor($R/86400);$R-=$S*86400;var $T=Math.floor($R/3600);$R-=$T*(3600);var $U=Math.floor($R/60);$R-=$U*(60);$H.setText([$T.format('d2'),$U.format('d2'),$R.format('d2')].join(':'));this.timerId=setTimeout(function(){me.$1n();},200);};PXBaseDataSource.prototype.$1k=function(){if(this.timerId){clearTimeout(this.timerId);delete this.timerId;};delete this.startTime;delete this.longRunInfo;__px_cm(this).notifyOnResize();};PXBaseDataSource.prototype.$1l=function($V,$W){var $g=this.toolBar.items[this.longRunIndex];var $H=this.toolBar.items[this.longRunIndex+1];$g.element.removeAttribute("error");var $q=this.longRunMessage,$X=this.longRunAbort;var $J=this.longRunInProcess,me=this,$Y=$W&&$W.showProcessInfo;if(this.$19){this.$1h($g);};if(!this.showProcessWindow){$H.setVisible(true);$g.setVisible(!$Y);};$H.setText($J);$g.setTooltip($q+". "+$X);$H.element.setAttribute("status","inprocess");$g.element.setAttribute("status","inprocess");__px_cm(this).notifyOnResize();if(this.showProcessWindow)__px_alls(this)["PanelProgress"].show(null);if($V){$H.setEnabled(true);$g.setEnabled(true);this.$1n();Array.clear(__px_callback(this).pendingCallbacks);}else{__px(this).stopWC();if(this.$1a){this.elapsedId=setTimeout(function(){me.checkElapsed();},2000);this.$1a=false;var $P=__px_callback(this).context;if($P&&$P.popupCommand)this.$1e=$P.popupCommand;}else this.elapsedId=setTimeout(function(){me.checkElapsed();},5000);};if($Y){var $Z=this.pnlQuickInfo=__px_all(this)[this.ID+"_pnlQuickInfo"];if($Z&&!$Z.getVisible()){if(this.btnSpinner==null){var $00=this.btnSpinner=__px_all(this)[$Z.ID+"_btnSpin"],ds=this;$00.events.addEventHandler("click",function(){ds.executeCommand("LongRun");});};var $01=__px(this).elemByID($Z.ID+"_content");ReactDOM.unmountComponentAtNode($01);$Z.focusInnerControl=false;__px(this).excludeCss($Z.element,["completed","not-completed"],true);$Z.show();}}};PXBaseDataSource.prototype.$1j=function($c){if(!this.pnlQuickInfo)return;var $02=__px(this).elemByID(this.pnlQuickInfo.ID+"_content");var $a=__px_callback(this).context;var $03=__px_all(this)[this.pnlQuickInfo.ID+"_btnOk"];var $04=this.longRunInfo=$c.longRunInfo;ReactDOM.render(React.createElement(PXBaseDataSource.ProcessInfo,{'items':$04,'context':$a}),$02);if(!$04)return;if(this.longRunCompleted){$05=$04.filter(function($f){return $f.autoRedirect;});$05.forEach(function($f,i){setTimeout(function($06,$07,$08){__px_callback($06).processRedirect($08.url,$07);},i*5000,this,$a,$f);})};if($03)$03.setEnabled(!!this.longRunCompleted);var $I=false;$I=($04.find(function(i){return i.docNbr==null;})!=null);return $I;};PXBaseDataSource.prototype.$1h=function($g){if($g){var $09=$g.images;if($09){var $0a=$09.hover;var $0b=$09.disabled;if($0a&&$0b){$09.disabled=$0a;$09.hover=$0b;this.$19=!this.$19;$g.setStyle();}}}};PXBaseDataSource.prototype.executeCommand=function($l,$m,$p,$n){if($l=="CancelClose"||$l=="CancelCloseToList"){if((this.isDirty||__px_cm(this).checkDataChanges())&&!confirm(this.message))return;if(__px(this).isPopupWindow(__loc(this).href)){var $p=__win(this).popupCommand;if($p)$p.checkSave=true;__px(this).closePopupWindow(true);return;}};this.$1d($l,$m,$p,$n);};PXBaseDataSource.prototype.registerCommandControl=function($0c,$l){__px_cm(this).registerCommandControl(this,$0c,$l);};PXBaseDataSource.prototype.getCommandState=function($0d,$l){var $0e=true;var $0f=true;var $0g=true;var $0h=true;if(this.longRunCompleted){$0f=false;$0h=false;}else if(this.longRunAborted){$0f=false;$0h=false;}else if(this.longRunInProcess){var $Z=this.pnlQuickInfo;if($Z&&$Z.getVisible())$0e=false;}else{$0e=false;$0f=false;$0g=false;$0h=false;};if(this.showProcessWindow){$0e=false;$0g=false;};if(String.compare($l,"LongRun",true))return new PXCommandState($0e,$0f,null,null);if(String.compare($l,PXBaseDataSource.elapsedCommandName,true))return new PXCommandState($0g,$0h,null,null);if(this.commandStates){var $0i=this.saveCommandName?this.saveCommandName.toLowerCase():"";for(var $k=0;$k<this.commandStates.length;$k++){var $0j=this.commandStates[$k];if(String.compare($0j.name,$l,true)){if(this.toolBar==$0d){for(var $0k=0;$0k<this.callbacks.length;$0k++){if($l==this.callbacks[$0k].name){if(this.callbacks[$0k].hideText){$0j.displayName=String.Empty;}}}};var $0l=true;if($0i&&$l.toLowerCase().startsWith($0i)){$0l=this.isDirty||this.isClientDirty||__win(this).isClientDirty===true;};var $0m=$0j.enabled==null?$0l:($0l&&$0j.enabled);return new PXCommandState($0j.visible,$0m,$0j.displayName,$0j.tooltip);}}};return new PXCommandState(true,true,null);};PXBaseDataSource.prototype.fireEvent=function(id,ev){var $i=new Object();return this.events.fireEvent(id,ev,$i);};PXBaseDataSource.prototype.$1g=function($0n){var $props=$0n.getAttribute("Props");if($props!=null)eval("$props = "+$props.replace(/\u2028/g,""));return $props;};PXBaseDataSource.prototype.processRefresh=function($0o){var $A=new PXXmlDoc("",$0o);this.setProperties(this.$1g($A.rootNode));};PXBaseDataSource.prototype.$1b=function(e){var $0p=e.keyCode,$W=null;if($0p&&!e.altKey&&this.confirmations){for(var i=0;i<this.confirmations.length;i++){var $s=this.confirmations[i];var $0j;if($s.shortcutChar==$0p&&e.ctrlKey==$s.shortcutCtrl&&e.shiftKey==$s.shortcutShift&&($0j=this.getCommandState(this.element,$s.commandName))&&$0j.getVisible()&&$0j.getEnabled()){$W=$s.commandName;break;}}};if($W){if(__px(this).IsIE)e.keyCode=0;__px(this).cancelEvent(e);this.callbackFromUI=true;this.viewState.update("CallbackFromUI",this.callbackFromUI);this.executeCommand($W);}};PXBaseDataSource.prototype.processKeyDown=function(e){this.$1b(e);};PXBaseDataSource.prototype.pressSave=function($0q){if(this.saveCommandName){var $0r=this;var $0j=this.getCommandState(px_alls['ToolBar'],this.saveCommandName);if($0j.getEnabled&&$0j.getEnabled()){this.executeCallback(this.saveCommandName);if($0q){var $0s=function(){$0r.events.removeEventHandler("commandPerformed",$0s);$0q();};this.events.addEventHandler("commandPerformed",$0s);};return;}};if($0q)$0q();};PXBaseDataSource.prototype.showImportGraphErrors=function(){if(this.importGraphErrorPanel==null){var $0t=Function.createDelegate(this,this.processImportGraphErrorsShow);var $0u=this.getCallback("ShowImportGraphErrors");if($0u){__px_callback(this).execI(this,$0u,"",$0t);}}else{this.importGraphErrorPanel.show();}};PXBaseDataSource.prototype.processImportGraphErrorsShow=function($z,$a){if($z){__px_cm(this).processHtmlData($z);var me=this;setTimeout(function(){me.initImportGraphErrorPanel($a);},0);}};PXBaseDataSource.prototype.initImportGraphErrorPanel=function(){var $0v=__px_all(this)[this.ID+"_iges"];if($0v){$0v.show();}};PXBaseDataSource.ProcessInfo=window.createReactClass({'onClick':function(e){var $0w=$(e.target).closest('A'),$0x;if(($0x=$0w.attr("data-url"))!=null){__px_callback($0w[0]).processRedirect($0x,this.props.context);}},'render':function(){if(this.props.items==null)return null;var $0y=this.props.items,$0z=this.onClick;var $0A="javascript: void 0";return React.createElement("div",{'className':"list-docs",'onClick':$0z},$0y.map(function(w){if(w.docNbr){var t=w.text,i1=t.indexOf('<'),i2=t.indexOf('>');var t1=t.substring(0,i1),t2=t.substring(i1+1,i2),t3=t.substring(i2+1);if(t2=='*')t2=w.docNbr;var $0w=React.createElement("a",{'href':$0A,'data-url':w.url},t2);};var $0B=React.createElement(PXBaseDataSource.ReactSprite,{'icon':w.docNbr?'Complete':'PriorityHigh'});return React.createElement("div",{'className':"list-item",'key':$0y.indexOf(w)},w.docNbr?React.createElement("div",null,$0B,React.createElement("div",{'className':"text"},t1,$0w,t3)):React.createElement("div",null,$0B,React.createElement("div",{'className':"text"},React.createElement("span",null,w.text),React.createElement("br"),React.createElement("span",{'className':"error"},w.url))));}));}});PXBaseDataSource.ReactSprite=window.createReactClass({'render':function(){var $0B=this.props.icon,$0C=this.props.type;return React.createElement("div",{'className':'sprite-icon control-icon','icon':$0B,'data-type':$0C},React.createElement("div",{'className':'control-icon-img control-'+$0B},'\u00a0'));}});PXBaseDataSource.prototype.renderLayerActions=function(){var $d=__px(this).frameElement(),$0D=__px(this).getInlineFrameContainer();var $0y=this.layeredActions,$0E=($0y!=null&&$0y.length>0);if($0D==null&&!$0E)return;if($0D==null){$0D=__doc($d?$d:this).createElement("div");$0D.id=PX.layerContID;$0D.className="layer-cont min";$0D.style.display="none";$0D.setAttribute("collapsible",1);}else{__px(this).appendCss($0D,["min"],true);__px(this).excludeCss($0D,["max"],true);};if($0D.parentNode==null){if($d)$d.parentNode.insertBefore($0D,$d.nextSibling);else __win(this).theForm.appendChild($0D);};var $a=__px_context($d?$d:this);if($a.layerResizer==null){var $0F={'px_context':$a,'element':$0D,'onAfterResize':function(){var $0G=this.resizeManager.layerOwner.$1o();__px(this).setLocalStorageItem($0G,parseInt($0D.style.width));}};var rm=$a.layerResizer=$a.px_cm.registerResizableControl($0F);rm.minWidth=250;rm.allowResizeY=rm.setPositionX=rm.enabled=false;};var $0H=$0D.parentNode,me=this;__px(this).toggleCss($0E,$0H,["layer-visible"],true);this.layerCallback=function($0I,$0J){if(!me.isLayerEnabled())return;var $0K=!__px(this).hasCss($0D,["min"]);switch($0I){case 'expand':if(!$0K){me.$1p($a.layerResizer);if(me.activeLayerAction==null){var $0L=$0D.querySelector("div.list-group-item.active");__px(me).setLayerShadowVisible(true);me.executeCommand(me.willbeLayerAction=$0L.getAttribute("data-cmd"));}};break;case 'collapse':if($0K){__px(this).appendCss($0D,["min"],true);__px(this).excludeCss($0D,["max"],true);$a.layerResizer.setEnabled(false);};break;case 'maximize':__px(this).appendCss($0D,["max"],true);$a.layerResizer.setEnabled(false);__px(this).setLocalStorageItem(me.$1q(),1);break;case 'restore':__px(this).excludeCss($0D,["max"],true);$a.layerResizer.setEnabled(true);__px(this).removeLocalStorageItem(me.$1q());break;default:if(($0J||!me.activeLayerAction)&&!__px(me).isLayerShadowVisible()){__px(me).setLayerShadowVisible(true);me.executeCommand(me.willbeLayerAction=$0I);};if(!$0K)me.$1p($a.layerResizer);break;}};var $0F=$0E?this.$1r():null;var $0M=($0F&&$0F.__className=="PXGrid")?$0F:null;this.layerValidate=function($0I,$k){if(!$0F||($0M&&!$0M.hasRows()))return false;var $0K=!__px(this).hasCss($0D,["min"]);if($0K&&!me.$1s())return false;if($0K)me.oldLayerIndex=$k;return me.isLayerEnabled()&&!__px(me).isLayerShadowVisible();};var $c={'items':$0y,'active':0,'callback':this.layerCallback,'validate':this.layerValidate,'max':this.$1t()};this.layerObject=ReactDOM.render(React.createElement(PXBaseDataSource.ReactLayerCont,$c),$0D);$0D.style.display=$0E?"":"none"
$a.layerResizer.setEnabled(false);$a.layerResizer.layerOwner=$0E?this:null;if($0E){var w=__px(this).getLocalStorageItem(this.$1o());$0D.style.width=(w!=null)?(w+'px'):'';var h=Function.createDelegate(this,this.$1u);if($0M){$0M.events.addEventHandler("afterRowChange",h);h=Function.createDelegate(this,this.$1v);$0M.events.addEventHandler("beforeRowChange",h);}else if($0F){this.events.addEventHandler("keyChanged",h);};setTimeout(function(){__px_tm($0D).register($0D);},1);}};PXBaseDataSource.prototype.$1o=function(){return __px(this).getScreenID()+"_layerW";};PXBaseDataSource.prototype.$1q=function(){return __px(this).getScreenID()+"_max";};PXBaseDataSource.prototype.$1t=function(){return __px(this).getLocalStorageItem(this.$1q())!=null;};PXBaseDataSource.prototype.$1p=function($0N){var $0D=__px(this).getInlineFrameContainer();if(this.$1t()){__px(this).appendCss($0D,["max"],true);this.layerObject.setState({'max':true});};__px(this).excludeCss($0D,["min"],true);$0N.setEnabled(true);};PXBaseDataSource.prototype.setLayerEnabled=function($C){var $0D=__px(this).getInlineFrameContainer();if($0D){if($C)__px(this).excludeCss($0D,["disabled"],true);else __px(this).appendCss($0D,["disabled","min"],true);}};PXBaseDataSource.prototype.isLayerEnabled=function(){var $0D=__px(this).getInlineFrameContainer();return $0D!=null&&!__px(this).hasCss($0D,["disabled"]);};PXBaseDataSource.prototype.isLayerVisible=function(){var $0D=__px(this).getInlineFrameContainer();return $0D!=null&&!__px(this).hasCss($0D,["min"]);};PXBaseDataSource.prototype.$1u=function($0F,ev){var $0O=($0F.__className=='PXGrid');if(!$0O||ev.keyChanged){if(!$0O)this.setLayerEnabled(!this.isNewRecord);if(this.isLayerVisible()&&this.activeLayerAction){var me=this;if(this.$1w){clearTimeout(this.$1w);delete this.$1w;};this.$1w=setTimeout(function(){me.executeCommand(me.activeLayerAction);},300);}else delete this.activeLayerAction;}};PXBaseDataSource.prototype.$1v=function($0F,ev){if($0F.__className!='PXGrid'||ev.keyChanged){if(this.isLayerVisible()&&this.activeLayerAction)if(!this.$1s())ev.cancel=true;}};PXBaseDataSource.prototype.$1s=function(){var $0P=null,$0Q=__win(this)["_confirmMsg"];try{$0P=__px(this).layerFrame.contentWindow;}catch(x){};if($0P&&$0P.px_cm&&$0P.px_cm.checkDataChanges())if(!confirm($0Q))return false;return true;};PXBaseDataSource.prototype.$1r=function(){if(this.gridID)return __px_alls(this)[this.gridID];var $0R=__px_data(this);for(var i in $0R)if($0R[i].dataMember==this.primaryView)return $0R[i];return null;};PXBaseDataSource.ReactLayerCont=window.createReactClass({'getInitialState':function(){var i=this.props.active;return{'msg':null,'title':'','active':(i!=null)?i:0,'max':false,'viewBar':null,'hasNote':false,'filesCount':0};},'componentWillReceiveProps':function($0S){this.setState({'title':''});if($0S.active!=null&&$0S.active!==this.state.active)this.setState({'active':$0S.active});if($0S.max!=null&&$0S.max!==this.state.max)this.setState({'max':$0S.max});},'actionClick':function($0I,$k){var $o=this.props.callback,$0T=this.props.validate;if($0T==null||$0T($0I,this.state.active)){var $0J=(this.state.active!=$k);this.setState({'active':$k},function(){if($o)$o($0I,$0J);});}},'onNoteChanged':function($0U){this.setState({'hasNote':$0U});},'onFilesChanged':function($0V){this.setState({'filesCount':$0V});},'onFrameLoad':function(e){var title='',$0P,$0W=null;try{$0P=e.target.contentWindow;title=e.target.contentDocument.title;}catch(x){};this.setState({'title':title});if($0P){var $0X=__px_all($0P),cm=__px_cm($0P),me=this;var $0Y=function(){for(var k in $0X){if($0X[k].__className=="PXDataViewBar")$0W=$0X[k];};if($0W&&$0W.getButton('NoteShow')==null)$0W=null;me.setState({'viewBar':$0W});cm.unregisterAfterLoad($0Y);if($0W){$0W.noteStateCallback=Function.createDelegate(me,me.onNoteChanged);$0W.filesStateCallback=Function.createDelegate(me,me.onFilesChanged);}};if(cm)cm.registerAfterLoad($0Y);var $0Z=function(){me.setState({'viewBar':null});};__px($0P).addEventHandler($0P,"beforeunload",$0Z);}},'onMaximize':function(){var $D=!this.state.max,$o=this.props.callback;this.setState({'max':$D},function(){if($o)$o($D?'maximize':'restore');});},'onCollapse':function(){this.setState({'max':false});},'render':function(){var $04=this.props.items,$10='_layer_frame';if($04==null||$04.length==0)return null;var $11={'title':this.state.title,'msg':this.state.msg,'onMaximize':this.onMaximize,'max':this.state.max,'viewBar':this.state.viewBar,'hasNote':this.state.hasNote,'filesCount':this.state.filesCount};return[React.createElement("div",{'className':'actions','key':'actions'},React.createElement(PXBaseDataSource.ReactLayerActions,{'items':$04,'callback':this.props.callback,'onCollapse':this.onCollapse,'active':this.state.active,'validate':this.props.validate,'onClick':this.actionClick}),React.createElement("div",{'className':'spacer'})),React.createElement("div",{'className':'content','key':'content'},React.createElement(PXBaseDataSource.ReactLayerCaption,$11),React.createElement("iframe",{'id':$10,'name':$10,'className':'layer','frameBorder':'0','onLoad':this.onFrameLoad}),React.createElement("div",{'className':'frame-shadow spinner','style':{'display':"none"}}))];}});PXBaseDataSource.ReactLayerCaption=window.createReactClass({'onMaximize':function(){var $o=this.props.onMaximize;if($o)$o();},'onNoteClick':function(){this.props.viewBar.showNote();},'onFilesClick':function(){this.props.viewBar.showFiles();},'render':function(){var title=this.props.title,$0Q=this.props.msg,$12=(this.props.viewBar!=null);var $0B=this.props.max?'ac-fullscreen_exit':'ac-fullscreen';var $13='main-Note'+(this.props.hasNote?'':'Empty');var $14='main-Files'+(this.props.filesCount>0?'':'Empty');return React.createElement("div",{'className':'caption'},React.createElement("div",{'className':'buttons'},$12?React.createElement("i",{'className':'ac '+$13,'onClick':this.onNoteClick}):null,$12?React.createElement("i",{'className':'ac '+$14,'onClick':this.onFilesClick}):null,React.createElement("i",{'className':'ac ac-fw '+$0B,'onClick':this.onMaximize})),React.createElement("div",{'className':'title'},title),$0Q?React.createElement("div",{'className':'msg'},$0Q):null);}});PXBaseDataSource.ReactLayerActions=window.createReactClass({'onClick':function(e){var $15=$(e.target).closest('DIV'),$0I=$15.attr("data-cmd");var $o=this.props.callback,$0T=this.props.validate;switch($0I){case 'expand':if($0T==null||$0T($0I))if($o)$o($0I);if(this.props.onExpand)this.props.onExpand();break;case 'collapse':if($o)$o($0I);if(this.props.onCollapse)this.props.onCollapse();break;default:this.props.onClick($0I,$15.index()-2);break;}},'render':function(){var $0y=this.props.items,$c=this.props;var $16="list-group-item",$17='folder_open';return React.createElement("div",{'className':"list-group layer-actions",'onClick':this.onClick},React.createElement("div",{'className':$16+" min",'data-cmd':'expand'},React.createElement("i",{'className':'ac ac-fw ac-keyboard_arrow_left'})),React.createElement("div",{'className':$16+" max",'data-cmd':'collapse'},React.createElement("i",{'className':'ac ac-fw ac-keyboard_arrow_right'})),$0y.map(function(a){var i=$0y.indexOf(a),$18=(i==$c.active)?" active":"";return React.createElement("div",{'className':$16+$18,'key':i,'data-cmd':a.action,'title':a.toolTip},React.createElement("i",{'className':'ac ac-fw ac-'+(a.icon?a.icon:$17)}));}));}});



var PXPanelCommand={Refresh:"Refresh",PageNext:"PageNext",PagePrev:"PagePrev",PageFirst:"PageFirst",PageLast:"PageLast",Save:"Save",Delete:"Delete",AddNew:"AddNew",Search:"Search",NoteShow:"NoteShow",FilesMenuShow:"FilesMenuShow",ActivityShow:"ActivityShow",LinkShow:"LinkShow",LinkUpdate:"LinkUpdate",LinkSend:"LinkSend",NotifyMenuShow:"NotifyMenuShow",NotifyShow:"NotifyShow",CreateProviderFile:"CreateProviderFile"};function PXBoundPanel($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;this.viewState=new PXStateBag(this,"PXBoundPanel");this.requiredControls=new Array();this.imageState=__px(this).elemByID($b.id+"_ims");__px_cm(this).readProperties(this,$c,PXBoundPanel.properties);__px_cm(this).registerAutoSize(this,$c);if(this.autoSize&&this.autoSize.enabled)this.allowCollapse=false;if(this.allowedFiles){this.allowedFilesMsg=this.allowedFilesMsg.replace("{0"+String.fromCharCode(125),this.allowedFiles);this.allowedFiles=this.allowedFiles.toLowerCase().split(';');};if(!this.dataBound)this.canAddFiles=0;if(this.contextMenuID){var h=Function.createDelegate(this,this.handleContextMenu);__px(this).addEventHandler($b,"contextmenu",h);};var h=Function.createDelegate(this,this.$0R);__px(this).addEventHandler($b,"keydown",h);h=Function.createDelegate(this,this.$0S);__px(this).addEventHandler($b,"mousedown",h);__px(this).addEventHandler($b,"selectstart",h);this.uploadFileCall=__px_callback(this).createCommand("UploadFile",true,false,false);var $d=this.elemContent?this.elemContent:this.element;__px(this).addEventHandler((this.canAddFiles==2)?__doc(this):$d,"drop",Function.createDelegate(this,this.$0T));this.imageNote=__px(this).elemByID($b.id+"_imn");this.imageFiles=__px(this).elemByID($b.id+"_imf");this.imageActivity=__px(this).elemByID($b.id+"_ima");this.imageLink=__px(this).elemByID($b.id+"_iml");this.imageNotify=__px(this).elemByID($b.id+"_imc");if(this.imageNote){__px(this).addEventHandler(this.imageNote,"click",Function.createDelegate(this,this.$0U));var $e=this.$0V(this.imageNote);if($e!=null){if(this.hasNote)this.images.note=$e;else this.images.noteEmpty=$e;}};if(this.imageFiles){__px(this).addEventHandler(this.imageFiles,"click",Function.createDelegate(this,this.$0W));var $e=this.$0V(this.imageFiles);if($e!=null){if(this.hasFiles)this.images.files=$e;else this.images.filesEmpty=$e;}};if(this.imageActivity){__px(this).addEventHandler(this.imageActivity,"click",Function.createDelegate(this,this.$0X));var $e=this.$0V(this.imageActivity);if($e!=null){if(this.hasActivity)this.images.activity=$e;else this.images.activityEmpty=$e;}};if(this.imageLink){__px(this).addEventHandler(this.imageLink,"click",Function.createDelegate(this,this.$0Y));};if(this.imageNotify){__px(this).addEventHandler(this.imageNotify,"click",Function.createDelegate(this,this.$0Z));};var $f=[2,3,4];for(var i=0;i<$f.length;i++)this.callbacks[$f[i]].ownCommit=true;this.events=new PXEventList(this,PXBoundPanel.events,$c.clientEvents);this.$10=new Array();__px_cm(this).registerRequiresOnLoad(this,$b.id);};PXBoundPanel.convertKey=function($g,$h){var ar=null;if($h)ar=$h.split(",");return ar;};PXBoundPanel.imagesDesc=[["required",JSType.String,"control@Required"],["error",JSType.String,"control@Error"],["warning",JSType.String,"control@Warning"],["info",JSType.String,"control@Info"],["expanded",JSType.String,"main@Collapse"],["collapsed",JSType.String,"main@Expand"],["note",JSType.String,"main@Note"],["noteEmpty",JSType.String,"main@NoteEmpty"],["files",JSType.String,"main@Files"],["filesEmpty",JSType.String,"main@FilesEmpty"],["activity",JSType.String,"main@Activity"],["activityEmpty",JSType.String,"main@ActivityEmpty"],["link",JSType.String,"main@LinkWB"],["notify",JSType.String,"main@Notify"]];PXBoundPanel.properties=[["dataBound",JSType.Bool,false],["searchField",JSType.String,""],["dataSourceID",JSType.String,""],["dataMember",JSType.String,""],["pageCount",JSType.Int,0,"setPageCount"],["pageIndex",JSType.Int,0,"setPageIndex"],["dataKey",JSType.String,"","setDataKey"],["isPrimary",JSType.Bool,false],["canAddFiles",JSType.Int,1],["hasNote",JSType.Bool,false],["hasActivity",JSType.Bool,false],["hasFiles",JSType.Bool,false],["allowDelete",JSType.Bool,true],["allowInsert",JSType.Bool,true],["allowUpdate",JSType.Bool,true],["markRequired",JSType.Int,1],["checkChanges",JSType.Bool,true],["errorCss",JSType.String,""],["warningCss",JSType.String,""],["infoCss",JSType.String,""],["contextMenuID",JSType.String,""],["images",JSType.Object,PXBoundPanel.imagesDesc],["keyControls",JSType.Empty,"",PXBoundPanel.convertKey],["keyFields",JSType.Empty,"",PXBoundPanel.convertKey],["callbacks",JSType.Array,PXCallbackManager.commandDesc],["allowFocus",JSType.Bool,true],["statusText",JSType.String,""],["defaultFocusCtrl",JSType.String,null],["maxFileSize",JSType.Int,25000],["maxFileSizeMsg",JSType.String,""],["allowedFiles",JSType.String,""],["allowedFilesMsg",JSType.String,""],["postChangesOnly",JSType.Bool,true],["viewHash",JSType.String,""],["allowCollapse",JSType.Bool,false],["expanded",JSType.Bool,true],["minHeight",JSType.Int,0]];PXBoundPanel.callbackProps=[["pageCount",JSType.Int,0,"setPageCount"],["pageIndex",JSType.Int,0,"setPageIndex"],["dataKey",JSType.String,"","setDataKey"],["hasNote",JSType.Bool,false,"setNoteState"],["hasActivity",JSType.Bool,false,"setActivityState"],["hasFiles",JSType.Bool,false,"setFilesState"],["allowAddNew",JSType.Bool,true],["allowUpdate",JSType.Bool,true],["allowDelete",JSType.Bool,true],["statusText",JSType.String,""]];PXBoundPanel.events={$initialize:0,$afterRepaint:1,$keyDown:2,$filesMenuShown:3,$uploaderShown:4,$focusDefaultControl:5,$notifyMenuShown:6,$stateChanging:7,$stateChanged:8};PXBoundPanel.prototype.fireEvent=function(id,ev,$i){return this.events.fireEvent(id,ev,$i);};PXBoundPanel.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXBoundPanel.callbackProps);if($c.hidden!=null)this.setVisible(!$c.hidden);};PXBoundPanel.prototype.onVisibleChanged=function($j){if($j)this.paintDelayImages();else if(this.getChanged())this.commitChanges();};PXBoundPanel.prototype.onLoad=function(){this.onLoadInternal();var me=this;__px_cm(this).AureliaEnhanceAwaitQueue.push(function(){me.onLoadInternal();});};PXBoundPanel.prototype.onLoadInternal=function(){this.focusDefaultControl();if(this.isPrimary)for(var i=0;i<this.keyControls.length;i++){var $k=__px_all(this)[this.keyControls[i]];if($k&&!$k.isPrimaryKey){$k.isPrimaryKey=true;$k.dataField=this.keyFields[i];}}};PXBoundPanel.prototype.$11=function($g){if($g.isPrimaryKey){if(__win(this).keyFields==null)__win(this).keyFields=new Object();__win(this).keyFields[$g.dataField]=$g.getValue();}};PXBoundPanel.prototype.switchState=function(e){if(this.getEnabled()&&this.allowCollapse){if(this.fireEvent("stateChanging",e))return;this.setState(!this.getState(),e);var $l=this.getState();if(!$l)__px(this).setLocalStorageItem(this.getCollapsedStateKey(),$l);else __px(this).removeLocalStorageItem(this.getCollapsedStateKey());this.fireEvent("stateChanged",e);}};PXBoundPanel.prototype.getCollapsedStateKey=function(){return __px(this).getPageName(this)+"_"+this.ID;};PXBoundPanel.prototype.setInitialExpandedState=function(){if(this.allowCollapse&&this.setState){var $m=__px(this).getLocalStorageItem(this.getCollapsedStateKey());if(undefined !=$m)this.expanded=false;if(!this.expanded)this.setState(false);}};PXBoundPanel.prototype.switchStateIndicator=function($n){if(this.imageState){var $o=$n?this.images.expanded:this.images.collapsed;if($o)__px_cm(this).repaintImage(this.imageState,$o);}};PXBoundPanel.prototype.getVisible=function(){return this.element.style.display!="none";};PXBoundPanel.prototype.setVisible=function($p){if($p!=this.getVisible()){this.element.style.display=($p?"":"none");__px_cm(this).setStackElementsVisible(this,$p);}};PXBoundPanel.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXBoundPanel.prototype.setEnabled=function($q){if($q!=this.getEnabled()){__px(this).setEnabled(this.element,$q);}};PXBoundPanel.prototype.setNoteState=function($r){this.hasNote=$r;this.$12(this.imageNote,$r?this.images.note:this.images.noteEmpty);};PXBoundPanel.prototype.setFilesState=function($s){this.hasFiles=$s;this.$12(this.imageFiles,$s?this.images.files:this.images.filesEmpty);};PXBoundPanel.prototype.setActivityState=function($t){this.hasActivity=$t;this.$12(this.imageActivity,$t?this.images.activity:this.images.activityEmpty);};PXBoundPanel.prototype.focus=function(){__px_cm(this).setFocus(this,this.$13);__px_cm(this).repaintStatusBar(this);};PXBoundPanel.prototype.getStatusText=function(){return this.statusText;};PXBoundPanel.prototype.$0V=function($b){var $u=$b;if($u.tagName!="IMG")$u=$u.getElementsByTagName("IMG")[0];return $u?$u.src:null;};PXBoundPanel.prototype.$12=function($b,$e){if($b!=null){var $v=$b.object;if($v){if($v.setImage)$v.setImage($e);}else __px_cm(this).repaintImage($b,$e);}};PXBoundPanel.prototype.refresh=function(){this.$14(this.callbacks[0]);};PXBoundPanel.prototype.search=function(){this.viewState.update("PageIndex",this.pageIndex=0);this.$14(this.callbacks[1]);};PXBoundPanel.prototype.saveRow=function(){this.$14(this.callbacks[2]);};PXBoundPanel.prototype.deleteRow=function(){this.$14(this.callbacks[3]);};PXBoundPanel.prototype.addNew=function(){this.$14(this.callbacks[4]);};PXBoundPanel.prototype.showNote=function(){if((this.noteText==undefined&&this.hasNote)||this.$15==null){var $w=this.callbacks[5];if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,"",Function.createDelegate(this,this.$16),$a);}}else{this.$15.setText(this.noteText?this.noteText:"");this.$15.show();this.$15.elemText.setSelectionRange(10000,10000);}};PXBoundPanel.prototype.saveNote=function($x){var $w=this.callbacks[6];var $a=new Object();$a.id=this.ID;$a.command=$w.name;$a.text=$x;__px_callback(this).execI(this,$w,$x,Function.createDelegate(this,this.$17),$a);};PXBoundPanel.prototype.showFilesMenu=function(){var ds=__px_alls(this)[this.dataSourceID];if(ds!=null){if(this.$18==null)this.$18=Function.createDelegate(this,this.$19);if(this.$1a==null)this.$1a="AttachEntity;"+this.ID;ds.events.addEventHandler("commandPerformed",this.$18);ds.executeCommand(ds.saveCommandName,this.$1a);}};PXBoundPanel.prototype.$19=function($y,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$18);if($a.commandArg==this.$1a&&($a.alert===undefined||$a.alert==null||$a.alert=="")&&(ds.alert===undefined||ds.alert==null||ds.alert=="")){var $w=this.callbacks[7];if(this.$1b){this.$1b.show(__px(this).elemByID(this.element.id+"_imf"),true);var $z=new Object();$z.menu=this.$1c;$z.uploader=this.$1d;this.fireEvent("filesMenuShown",null,$z);}else if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,this.$1d?"":"1",Function.createDelegate(this,this.$1e),$a);}}};PXBoundPanel.prototype.showUploadPanel=function(){var $w=this.callbacks[7];if(this.$1d){this.$1d.show();var ev=new Object();ev.uploader=this.$1d;this.fireEvent("uploaderShown",null,ev);}else if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;$a.showUploader=true;__px_callback(this).execI(this,$w,"1",Function.createDelegate(this,this.$1e),$a);}};PXBoundPanel.prototype.showActivity=function(){if(!this.$1f){var $w=this.callbacks[8];if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,"",Function.createDelegate(this,this.$1g),$a);}}else{var $A=this.$1f.containerPanel;var $B=__px(this).getElemLeftPos(this.imageActivity);var top=__px(this).getElemTopPos(this.imageActivity)+this.imageActivity.offsetHeight;var $C=__px(this).getElemLeftPos(this.element);$A.show();if($A.element.offsetWidth+$B>$C+this.element.offsetWidth)$B-=$A.element.offsetWidth;$A.element.style.left=$B+"px";$A.element.style.top=top+"px";}};PXBoundPanel.prototype.$1g=function($D,$a){if($D){var $E=__px_all(this)[$a.id];var $F=new PXXmlDoc("",$D),$G=$F.rootNode;var $H=$E.$1f;if($G.childNodes.length>0){__px_cm(this).processHtmlData($G.childNodes[0].nodeValue);setTimeout(function(){$E.$1h();},0);}}};PXBoundPanel.prototype.showLinkPanel=function(){if(!this.linkPanel){var $w=this.callbacks[9];if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,"",Function.createDelegate(this,this.$1i),$a);}}else{var $w=this.callbacks[10];this.linkPanel.show();this.positionLinkPanel();if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,"",Function.createDelegate(this,this.$1j),$a);}}};PXBoundPanel.prototype.$1i=function($D,$a){if($D){var $E=__px_all(this)[$a.id];var $F=new PXXmlDoc("",$D),$G=$F.rootNode;if($G.childNodes.length>0){__px_cm(this).processHtmlData($G.childNodes[0].nodeValue);setTimeout(function(){$E.$1k();},0);}}};PXBoundPanel.prototype.$1j=function($D,$a){var $E=__px_all(this)[$a.id];if($E&&$E.linkPanel){var $F=new PXXmlDoc("",$D);var $I=$F.rootNode.getAttribute("int");var $J=$F.rootNode.getAttribute("ext");$E.linkPanel.setLink($I,$J);}};PXBoundPanel.prototype.$1k=function(){this.linkPanel=__px_all(this)[this.ID+"_gtlnk"];this.linkPanel.show();this.positionLinkPanel();var $K=Function.createDelegate(this,this.$1l);__px(this).addEventHandler(this.linkPanel.btnEmail.element,"click",$K);};PXBoundPanel.prototype.positionLinkPanel=function(){if(!this.linkPanel)return;var $B=__px(this).getElemLeftPos(this.imageLink);var top=__px(this).getElemTopPos(this.imageLink)+this.imageLink.offsetHeight;var $C=__px(this).getElemLeftPos(this.element);if(this.linkPanel.element.offsetWidth+$B>$C+this.element.offsetWidth)$B=this.element.offsetWidth-this.linkPanel.element.offsetWidth;this.linkPanel.element.style.left=$B+"px";this.linkPanel.element.style.top=top+"px";};PXBoundPanel.prototype.$1l=function(){var $w=this.callbacks[11];var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,this.linkPanel.getExternalLink());};PXBoundPanel.prototype.showNotify=function(){var $w=this.callbacks[12];if(this.$1m){this.$1m.show(__px(this).elemByID(this.element.id+"_imc"),true);var $z=new Object();$z.menu=this.$1n;this.fireEvent("notifyMenuShown",null,$z);}else if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,"",Function.createDelegate(this,this.$1o),$a);}};PXBoundPanel.prototype.setPage=function($L){if(!this.dataBound)return;if(this.pageCount>0&&($L<0||$L>=this.pageCount))return;this.setPageIndex($L);this.refresh();};PXBoundPanel.prototype.setPageIndex=function($M){this.pageIndex=$M;this.viewState.update("PageIndex",$M);};PXBoundPanel.prototype.setPageCount=function($M){if($M>=-1){this.pageCount=$M;this.viewState.update("PageCount",$M);}};PXBoundPanel.prototype.setDataKey=function($M){var $N=$M?this.$1p($M):null;if($N!=null&&this.dataKey!=$N){this.dataKey=$N;delete this.noteText;}};PXBoundPanel.prototype.clearDataKey=function($M){delete this.dataKey;this.viewState.remove("DataKey");this.setPageIndex(0);};PXBoundPanel.prototype.paintDelayImages=function(){var $O=new Array();for(var i=0;i<this.$10.length;i++){var p=this.$10[i],$k=p.control,$b=$k.element;if($b.offsetParent&&$b.offsetWidth>0){if(p.type==0||$b.getAttribute("error")!=null){this.$1q($b,p.image,p.type);continue;}};$O.push(p);};this.$10=$O;};PXBoundPanel.prototype.$1p=function($P){var $Q=this.viewState.select("DataKey"),$R;var ar=$Q?$Q.split('|'):[],$S=new Object();var $T=this.dataMember?this.dataMember.toLowerCase():null;for(var i=0;i<ar.length;i++){var $U=ar[i].split(',');$S[$U[0]]=$U[1];};ar=$P.split('|');for(var i=0;i<ar.length;i++){var $U=ar[i].split(',');$S[$U[0]]=$U[1];};ar=new Array();for(var n in $S)if(n){ar.push(n+','+$S[n]);if($T==n)$R=$S[n];};this.viewState.update("DataKey",ar.join('|',ar));return $R;};PXBoundPanel.prototype.repaint=function($V,$W){var $X=$V.xmlDoc.getElementsByTagName("Controls");if(!$X)return;if($W==null)$W=true;$X=$X[$X.length-1];if($W){this.$1r=new Object();this.errorStatus=0;this.hasError=false;this.errorText=null;};this.$1s();this.errorID=null;var $Y=this.element.offsetHeight;var $Z=(this.dataKey&&!this.allowUpdate)||(!this.dataKey&&!this.allowInsert);if(this.markRequired==2)this.requiredControls=new Array();for(var i=0;i<$X.childNodes.length;i++){var $00=$X.childNodes[i];var id=$00.getAttribute("ID"),$h=$00.getAttribute("Value");var fc=__px_all(this)[id];if(fc){if(fc.setProperties)fc.setProperties(this.$1t($00));if(this.markRequired==2){fc.required=$00.getAttribute("Required")!=null;if(fc.required)this.requiredControls.push(fc);};if($00.childNodes&&$00.childNodes.length){var $01=$00.childNodes[0].nodeValue;if(fc.processRefresh)fc.processRefresh($01);else if(fc.repaint)fc.repaint($01);};if(fc.isPrimaryKey)this.$11(fc);var $02=this.$1u(fc,$00);if($02){this.$1r[id]=fc;if(this.errorStatus<$02){if(fc.element.offsetParent!=null&&$02>1&&(fc.getReadOnly==null||!fc.getReadOnly()))this.errorID=fc.ID;this.errorStatus=$02;this.errorText=__px(this).getTitle(fc.elemWrapper?fc.elemWrapper:fc.element);if(!this.errorText&&fc.elemText)this.errorText=__px(this).getTitle(fc.elemText);};this.hasError=true;};if($Z&&fc.setValue&&(!fc.isPrimaryKey||this.gridMode)){if(fc.setReadOnly)fc.setReadOnly(true);else if(fc.setEnabled)fc.setEnabled(false);};continue;};var $b=__px(this).elemByID(id);if($b){switch($b.tagName){case "INPUT":if($b.type=="checkbox"||$b.type=="radio")$b.checked=NetType.convert($h,NetType.Boolean);else $b.value=$h;break;case "TEXTAREA":case "SELECT":$b.value=$h;break;}}};if($W){this.dataChanged=false;this.keyChanged=false;this.$1v=null;this.deleteFilesMenu();};var $i=new Object();$i["hasError"]=this.hasError;$i["errorStatus"]=this.errorStatus;$i["errorText"]=this.errorText;this.fireEvent("afterRepaint",null,$i);var $03=null;if(__px_callback(this).targetCtrlID&&($03=__px_all(this)[__px_callback(this).targetCtrlID])!=null&&$03.__className=="PXBaseDataSource"&&$03.callbackFromUI){this.focusDefaultControl();};if($Y!=this.element.offsetHeight){var e=this.element.parentNode;while(e&&e.object==null)e=e.parentNode;if(e&&e.object)__px_cm(this).notifyOnResize(true,e);}};PXBoundPanel.prototype.focusDefaultControl=function(){if(__px(this).IsTablet)return;var $i=new Object(),id=this.errorID?this.errorID:this.defaultFocusCtrl;$i.target=new Object();$i.target.defaultFocusCtrl=id;this.fireEvent("focusDefaultControl",null,$i);if(id){var el=__px_all(this)[id],me=this,$04;this.delayedCallback=true;$04=setTimeout(function(){if(el&&el.focusExt)el.focusExt();else __px(me).selectElement(id,1);me.onFocusDefaultControl();delete me.delayedCallback;},10);__px_cm(this).registerTimeout($04);}};PXBoundPanel.prototype.onFocusDefaultControl=function(){};PXBoundPanel.prototype.deleteFilesMenu=function(){if(this.$1b){this.$1b.element.parentNode.removeChild(this.$1b.element);delete this.$1b;}};PXBoundPanel.prototype.deleteNotifyMenu=function(){if(this.$1m){this.$1m.element.parentNode.removeChild(this.$1m.element);delete this.$1m;}};PXBoundPanel.prototype.uploadComplete=function(){this.deleteFilesMenu();this.setFilesState(true);};PXBoundPanel.prototype.setControlError=function($k,$05,$02){var e=this.getControlElement($k),et=$k.elemText;if(e==null)return;var $06=e.getAttribute("error");if(!$05)$02=null;else if($02==null)$02=2;if($05&&$06!=null&&$06==$02){var $07=$k.elemNote?$k.elemNote:$k.boundImage;__px(this).setTitle(e,$05);if(et&&et!=e)__px(this).setTitle(et,null);if($07)__px(this).setTitle($07,$05);}else if($05){var $08=e.className,$09=($02==2)?this.errorCss:this.warningCss;if($02==0)$09=this.infoCss;if($06!=null)$08=__px(this).excludeCss(e,[this.errorCss,this.warningCss,this.infoCss]);e.setAttribute("error",$02);if(e.getAttribute("oldTitle")==null)e.setAttribute("oldTitle",__px(this).getTitle(e));__px(this).setTitle(e,$05);if(et&&et!=e)__px(this).setTitle(et,null);$k.errorCss=$09;e.className=$08+" "+$09;}else if($06!=null){__px(this).setTitle(e,e.getAttribute("oldTitle"));e.removeAttribute("error");e.removeAttribute("oldTitle");delete $k.errorCss;e.className=__px(this).excludeCss(e,[this.errorCss,this.warningCss,this.infoCss]);};this.$1w($k,$05);if($02!=null)this.onSetError($k,$05,$02);return $02;};PXBoundPanel.prototype.getControlElement=function($k){if($k.elemWrapper)return $k.elemWrapper;if($k.element.id==$k.ID)return $k.element;return $k.element.querySelector('#'+$k.ID);};PXBoundPanel.prototype.onSetError=function($k,$0a,$02){};PXBoundPanel.prototype.$1u=function($k,$0b){var $05=$0b.getAttribute("Error");var $0c=$0b.getAttribute("Warning");var $0d=$0b.getAttribute("Info");var $x=$05||$0c||$0d,$02=null;if($05)$02=2;else if($0c)$02=1;else if($0d)$02=0;return this.setControlError($k,$x,$02);};PXBoundPanel.prototype.$1s=function(){if(this.$10.length==0)return;var $O=new Array();for(var i=0;i<this.$10.length;i++){var p=this.$10[i];if(p.type==0)$O.push(p);};this.$10=$O;};PXBoundPanel.prototype.$1q=function($b,$u,$0e){while($b&&$b.style&&$b.style.position!="absolute")$b=$b.parentNode;if($b!=null&&$b.style){if($u.parentNode==null)$b.offsetParent.appendChild($u);var $0f=function(){if(__px(this).isRTL())$u.style.left=$b.offsetLeft+$b.offsetWidth+2+"px";else $u.style.left=$b.offsetLeft-$u.offsetWidth-2+"px";if($0e==0)$u.style.top=$b.offsetTop+2+"px";else $u.style.top=$b.offsetTop+($b.offsetHeight-$u.offsetHeight)/2+"px";$u.onload=null;};if($u.tagName!="IMG"||$u.complete)$0f();else $u.onload=$0f;}};PXBoundPanel.prototype.$1w=function($k,$x){var $0e=(this.markRequired&&$k.required)?0:-1;var $b=this.getControlElement($k);if(!$b||$b.style.visibility=="hidden")return;var $0g=$b.getAttribute("error"),$u;if($0g!=null){$0e=parseInt($0g)+1;if($0e>0&&$x===undefined)$x=__px(this).getTitle($b);};if($k.elemNote){$u=$k.elemNote;switch($0e){case 0:var $0h=$k.getValue();$u.className=__px(this).isRTL()?"req-r":"req-l";if($0h==null||$0h=="")$u.className+=" req-lh";break;case 1:$u.className="inf-l";break;case 2:$u.className="war-l";break;case 3:$u.className="err-l";break;default:$u.className="";break;};__px(this).setTitle($u,$x);if($0e>0)$u.setAttribute("error",$0e-1);else $u.removeAttribute("error");return;}else if($b.style.position!="absolute")return;$u=$k.boundImage;if($0e>=0){if($u!=null&&$u.tagName=="IMG"){$u.removeAttribute("width");$u.removeAttribute("height");};var $0i=null;switch($0e){case 0:$0i=this.images.required;break;case 1:$0i=this.images.info;break;case 2:$0i=this.images.warning;break;case 3:$0i=this.images.error;break;};if($u==null){$u=$k.boundImage=__px_cm(this).createSpriteOrImage(null,$0i);$u.style.zIndex=1000;$u.style.position="absolute";}else __px_cm(this).repaintImage($u,$0i);__px(this).setTitle($u,$x);if($0e>0)$u.setAttribute("error",$0e-1);else $u.removeAttribute("error");if($b.offsetParent&&$b.offsetWidth>0){var me=this;setTimeout(function(){me.$1q($b,$u,$0e);},1);}else{var p=new Object();p.control=$k;p.type=$0e;p.image=$u;this.$10.push(p);}}else if($u){if($u.parentNode)$u.parentNode.removeChild($u);};return $u;};PXBoundPanel.prototype.executeCommand=function($0j,$0k){if(!this.getCommandState(this,$0j).getEnabled())return;switch($0j){case PXPanelCommand.Refresh:this.refresh();break;case PXPanelCommand.Search:this.search();break;case PXPanelCommand.PageNext:this.setPage(this.pageIndex+1);break;case PXPanelCommand.PagePrev:this.setPage(this.pageIndex-1);break;case PXPanelCommand.PageFirst:this.setPage(0);break;case PXPanelCommand.PageLast:this.setPage((this.pageCount>0)?(this.pageCount-1):-1);break;case PXPanelCommand.Save:this.saveRow();this.dataChanged=false;break;case PXPanelCommand.AddNew:this.addNew();break;case PXPanelCommand.Delete:this.deleteRow();this.dataChanged=false;break;case PXPanelCommand.NoteShow:this.showNote();break;case PXPanelCommand.FilesMenuShow:this.showFilesMenu();break;case PXPanelCommand.ActivityShow:this.showActivity();break;case PXPanelCommand.LinkShow:this.showLinkPanel();break;case PXPanelCommand.NotifyShow:this.showNotify();break;case PXPanelCommand.CreateProviderFile:__px_callback(this).execI(this,__px_callback(this).createCommand("CreateProviderFile",true,false,true,true),"",null,null,{$0l:true,$0m:"Refresh",$03:this.ID});break;}};PXBoundPanel.prototype.getCommandState=function($y,$0j){if(!this.dataBound)return PXCommandState.empty;var pi=this.pageIndex,$0n=!!this.dataKey;switch($0j){case PXPanelCommand.PageNext:case PXPanelCommand.PageLast:return new PXCommandState(true,(this.pageCount<0)||pi!=(this.pageCount-1));case PXPanelCommand.PagePrev:case PXPanelCommand.PageFirst:return new PXCommandState(true,(this.pageCount<0)||pi>0);case PXPanelCommand.Refresh:return new PXCommandState(true,(this.pageCount<0)||this.pageIndex>=0);case PXPanelCommand.Search:return new PXCommandState(true,Boolean(this.searchField));case PXPanelCommand.Save:return new PXCommandState(true,(this.allowUpdate&&$0n)||(this.allowInsert&&!$0n));case PXPanelCommand.Delete:return new PXCommandState(true,this.allowDelete&&$0n);case PXPanelCommand.AddNew:return new PXCommandState(true,this.allowInsert);case PXPanelCommand.NoteShow:return new PXCommandState(true,true);case PXPanelCommand.FilesMenuShow:return new PXCommandState(true,true);case PXPanelCommand.ActivityShow:return new PXCommandState(true,true);case PXPanelCommand.LinkShow:return new PXCommandState(true,true);case PXPanelCommand.LinkUpdate:return new PXCommandState(true,true);case PXPanelCommand.NotifyMenuShow:case PXPanelCommand.NotifyShow:case PXPanelCommand.CreateProviderFile:return new PXCommandState(true,true);};return PXCommandState.empty;};PXBoundPanel.prototype.registerCommandControl=function($g,$0j){if(this.dataBound)__px_cm(this).registerCommandControl(this,$g,$0j);};PXBoundPanel.prototype.notifyCommandState=function(){if(this.dataBound)__px_cm(this).notifyCommandState(this,PXPanelCommand);};PXBoundPanel.prototype.$14=function($w){if(this.getCommandState(this,$w.name).getEnabled()){var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,"",Function.createDelegate(this,this.$1x),$a);}};PXBoundPanel.prototype.$1x=function($D,$a){if($D){var $E=__px_all(this)[$a.id];if($E)$E.processRefresh($D);}};PXBoundPanel.prototype.$1t=function($00){var $props=String($00.getAttribute("Props"));if($props!=null)eval("$props = "+$props.replace(/\u2028/g,""));return $props;};PXBoundPanel.prototype.handleContextMenu=function(e){var $0o=__px_all(this)[this.contextMenuID];if($0o){__px(this).cancelEvent(e);var $b=$0o.element,de=__doc(this).documentElement;if($b&&$b.parentNode!=__win(this).theForm)__win(this).theForm.appendChild($b);var $0p=de.scrollTop,$0q=de.scrollLeft;$0o.ownerID=this.ID;$0o.showAt(e.clientX+$0q,e.clientY+$0p);}};PXBoundPanel.prototype.$16=function($D,$a){if($D){var $E=__px_all(this)[$a.id];var $F=new PXXmlDoc("",$D),$G=$F.rootNode;var $0r=$E.$15,me=this;if($G.childNodes.length>0){__px_cm(this).processHtmlData($G.childNodes[0].nodeValue);setTimeout(function(){me.$1y($E);},0);}else if($0r){$0r.setText($G.getAttribute("Note"));$E.noteText=$0r.getText();$0r.show();}}};PXBoundPanel.prototype.$1y=function($E){var $0r=$E.$15=__px_all(this)[$E.ID+"_ib"];if($0r){$0r.linkedPanel=$E;$0r.events.addEventHandler("afterHide",Function.createDelegate(this,this.$1z));$E.viewState.update("InputBox",true);$E.noteText=$0r.getText();$0r.show();$0r.elemText.setSelectionRange(10000,10000);}};PXBoundPanel.prototype.$1z=function($0r){var $D=$0r.dialogResult;if($D==1){$0r.linkedPanel.saveNote($0r.getText());}};PXBoundPanel.prototype.$17=function($D,$a){var $E=__px_all(this)[$a.id],$x=$a.text;if($E){$E.noteText=$x;$E.setNoteState(!!$x);}};PXBoundPanel.prototype.$1A=function(){this.checkActivity();};PXBoundPanel.prototype.checkActivity=function(){var $w=null;for(var i=0;i<this.callbacks.length;i++){var $0s=this.callbacks[i];if(String.compare($0s.name,"CheckActivity",true)){$w=$0s;break;}};var $a=new Object();$a.id=this.ID;$a.command="CheckActivity";__px_callback(this).execI(this,$w,"",PXBoundPanel.$1x,$a);};PXBoundPanel.prototype.packCallbackCommand=function(id,$0m){return "ActivityBox$"+id+"$"+$0m;};PXBoundPanel.prototype.$1h=function(){if(!this.$1f){var $A=__px_all(this)[this.ID+"_ab"];this.$1f=__px_all(this)[this.ID+"_ab_abc"];this.$1f.setCallbackProxy(this);this.$1f.containerPanel=$A;$A.linkedPanel=this;$A.events.addEventHandler("afterHide",PXBoundPanel.$1B);this.viewState.update("ActivityBox",true);var $B=__px(this).getElemLeftPos(this.imageActivity);var top=__px(this).getElemTopPos(this.imageActivity)+this.imageActivity.offsetHeight;var $C=__px(this).getElemLeftPos(this.element);$A.show();if($A.element.offsetWidth+$B>$C+this.element.offsetWidth)$B-=$A.element.offsetWidth;$A.element.style.left=$B+"px";$A.element.style.top=top+"px";}};PXBoundPanel.$1B=function($A){$A.linkedPanel.$1A();};PXBoundPanel.prototype.$1e=function($D,$a){if($D){var $E=__px_all(this)[$a.id],me=this;var $F=new PXXmlDoc("",$D),$G=$F.rootNode;if($G.childNodes.length>0){__px_cm(this).processHtmlData($G.childNodes[0].nodeValue);setTimeout(function(){me.$1C($E,$a.showUploader);},0);}}};PXBoundPanel.prototype.$1o=function($D,$a){if($D){var $E=__px_all(this)[$a.id],me=this;var $F=new PXXmlDoc("",$D),$G=$F.rootNode;if($G.childNodes.length>0){__px_cm(this).processHtmlData($G.childNodes[0].nodeValue);setTimeout(function(){me.$1D($E);},0);}}};PXBoundPanel.prototype.$1D=function($E){var $0t=$E.$1m=__px_all(this)[$E.ID+"_nmnu"];if($0t){var $0u=new Object();var h=Function.createDelegate($E,$E.$1E);$0t.events.addEventHandler("itemClick",h);$0t.show(__px(this).elemByID($E.element.id+"_imc"),true);$0u.menu=$0t;$E.fireEvent("notifyMenuShown",null,$0u);}};PXBoundPanel.prototype.$1C=function($E,$0v){var $0w=$E.$1b=__px_all(this)[$E.ID+"_fmnu"];if($0w){var $0x=$E.$1d=__px_all(this)[$E.ID+"_upldr"];if($0x){var h=Function.createDelegate($E,$E.uploadComplete);$0x.events.addEventHandler("hideAfterUpload",h);};var $0u=new Object();$0w.events.addEventHandler("itemClick",Function.createDelegate(this,this.$1F));if($0v){$0u.uploader=$0x;$0x.show();$E.fireEvent("uploaderShown",null,$0u);}else{$0w.show(__px(this).elemByID($E.element.id+"_imf"),true);$0u.menu=$0w;$0u.uploader=$0x;$E.fireEvent("filesMenuShown",null,$0u);}}};PXBoundPanel.prototype.$1F=function($0o,e){if(e.item.value=="notfilelink")return;if(e.event.ctrlKey==true&&e.item.value&&e.item.value!=""){e.cancel=true;__px(this).cancelEvent(e);__win(this).location=e.item.value;}};PXBoundPanel.prototype.$1E=function($0o,e){var $w=this.callbacks[13];if($w&&this.$1m&&this.getCommandState(this,$w.name).getEnabled()){var $0y=__px(this).eventElem(e.event).tagName=="SPAN"?"+":"";if($0y=="+"){var ds=__px_alls(this)[this.dataSourceID];if(ds!=null){if(this.$1G==null)this.$1G=Function.createDelegate(this,this.$1H);if(this.$1a==null)this.$1a="AttachEntity;"+this.ID;this.$1I=e.item.value+"+";ds.events.addEventHandler("commandPerformed",this.$1G);ds.executeCommand(ds.saveCommandName,this.$1a);}}else{var $a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,e.item.value+(__px(this).eventElem(e.event).tagName=="SPAN"?"+":""),null,$a);};var $0z=this;setTimeout(function(){$0z.deleteNotifyMenu();},0);}};PXBoundPanel.prototype.$1H=function($y,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$1G);if($a.commandArg==this.$1a&&($a.alert===undefined||$a.alert==null||$a.alert=="")&&(ds.alert===undefined||ds.alert==null||ds.alert=="")){var $w=this.callbacks[13];if($w){$a=new Object();$a.id=this.ID;$a.command=$w.name;__px_callback(this).execI(this,$w,this.$1I,null,$a);}}};PXBoundPanel.prototype.processRefresh=function($0A){var $V=new PXXmlDoc("",$0A);this.setProperties(this.$1t($V.rootNode));this.repaint($V);this.notifyCommandState();};PXBoundPanel.prototype.executeCallback=function($0j,$0k){this.executeCommand($0j,$0k);};PXBoundPanel.prototype.hasErrorInfo=function(){return this.hasError;};PXBoundPanel.prototype.getErrorInfo=function(){return[this.errorStatus,this.errorText];};PXBoundPanel.prototype.commitChanges=function(){if(this.getChanged())this.executeCommand(PXPanelCommand.Save);};PXBoundPanel.prototype.clearChanges=function(){var ac=this.activeControl;if(ac&&ac.oldValue!=null&&ac.setValue)ac.setValue(ac.oldValue);this.dataChanged=false;this.keyChanged=false;this.$1v=null;this.errorStatus=0;this.hasError=false;this.errorText=null;};PXBoundPanel.prototype.getDataChanges=function(){return "";};PXBoundPanel.prototype.getChanged=function($0B){var ac=this.activeControl;if(ac&&ac.updateValue)ac.updateValue();return this.dataChanged||(!$0B&&this.keyChanged);};PXBoundPanel.prototype.onFieldChanged=function($g){var $N=this.$1J($g.ID);if(!$N)this.dataChanged=true;else this.keyChanged=true;if(this.$1v==null)this.$1v=new Object();this.$1v[$g.ID]=$g;if(this.markRequired&&$g.required)this.$1w($g);if(!$N||!this.$1K($g)){var ds=__px_alls(this)[this.dataSourceID];if(ds&&this.checkChanges)ds.setChanged();};if($g.isPrimaryKey)this.$11($g);};PXBoundPanel.prototype.onTextChanged=function($g){if(this.checkChanges&&(!this.$1J($g.ID)||!this.$1K($g))){var ds=__px_alls(this)[this.dataSourceID];if(ds)ds.setClientChanged();}};PXBoundPanel.prototype.onControlCreated=function($g){if(this.markRequired){var $b=$g.elemWrapper?$g.elemWrapper:$g.element;var $0C=$b.getAttribute("error")!=null;if($g.required==true||$0C){this.$1w($g);if($g.required)this.requiredControls.push($g);}}};PXBoundPanel.prototype.onControlActivated=function($g){__px_cm(this).repaintStatusBar(this);};PXBoundPanel.prototype.checkRequired=function(){for(var i=0;i<this.requiredControls.length;i++){var $k=this.requiredControls[i],$M=$k.getValue();if($M==null||$M=="")return false;};return true;};PXBoundPanel.prototype.forgetChanges=function(id){delete this.$1v[id];};PXBoundPanel.prototype.needPostElement=function(id){if(this.postVisibleOnly&&id.startsWith(this.ID)&&!__px(this).isVisible(this.element)){var $b=__px(this).elemByID(id);if(!__px(this).isVisible($b))return false;};if(this.$1J(id))return true;if(this.$1v){for(var $0D in this.$1v)if(this.$1L(id,this.$1v[$0D]))return true;};if(this.$1r){for(var $0D in this.$1r)if(this.$1L(id,this.$1r[$0D]))return true;};return false;};PXBoundPanel.prototype.notNeedPostElement=function(id){if(!this.postChangesOnly)return false;if(!id.startsWith(this.ID)||id==(this.ID+"_state"))return false;var $b=__px(this).elemByID(id),$k=$b?$b.object:null;if($k==null||$k.bindingContainer!=this.ID)return false;return !this.needPostElement(id);};PXBoundPanel.prototype.$1J=function(id){if(this.keyControls){for(var i=0;i<this.keyControls.length;i++){var $k=__px_all(this)[this.keyControls[i]];if($k&&this.$1L(id,$k))return true;}};return false;};PXBoundPanel.prototype.$1L=function(id,$g){if(id==$g.ID||id==($g.ID+"_state"))return true;if($g.elemText!=null&&$g.elemText.id==id)return true;return false;};PXBoundPanel.prototype.$1K=function($k){if($k.owner&&$k.owner.ID)$k=$k.owner;return $k.autoCallBack.command!=""||$k.onValueChange>0};PXBoundPanel.prototype.$13=function(e){switch(e.type){case "focus":if(this.getVisible()&&this.getEnabled()){this.hasFocus=true;__px_cm(this).repaintStatusBar(this);};break;case "blur":this.hasFocus=false;break;case "keydown":this.processKeyDown(e);break;}};PXBoundPanel.prototype.$0R=function(e){this.processKeyDown(e);};PXBoundPanel.prototype.$0S=function(e){var se=__px(this).eventElem(e),$0E=PX.focusTags;if(se&&se.tagName&&Array.contains($0E,se.tagName))return;if(se&&se.getAttribute&&se.getAttribute('au-target-id'))return;var $v=__px(this).eventObject(e);if(e.type=="mousedown"&&!e.altKey&&this.isObjectOwner($v)&&this.allowFocus==true){var me=this;setTimeout(function(){me.focus();},1);__px(this).cancelEvent(e,false);}};PXBoundPanel.prototype.$0U=function(e){this.showNote();};PXBoundPanel.prototype.$0W=function(e){this.showFilesMenu();};PXBoundPanel.prototype.$0X=function(e){this.showActivity();};PXBoundPanel.prototype.$0Y=function(e){this.showLinkPanel();};PXBoundPanel.prototype.$0Z=function(e){this.showNotify();};PXBoundPanel.prototype.isObjectOwner=function($v){return $v==this;};PXBoundPanel.prototype.processKeyDown=function(e){var $0u=new Object();$0u.keyCode=e.keyCode;this.fireEvent("keyDown",e,$0u);};PXBoundPanel.prototype.$0T=function(e){__px(this).cancelEvent(e,this.canAddFiles>0);if(!this.canAddFiles||window.FileReader==null||e.dataTransfer.files.length==0)return;var ds=__px_alls(this)[this.dataSourceID],$0F=e.dataTransfer.files;if(ds!=null&&ds.saveCommandName&&(ds.isClientDirty||ds.isNewRecord)){if(this.$1a==null)this.$1a="AttachEntity;"+this.ID;var me=this,$0G=function($y,$a){ds.events.removeEventHandler("commandPerformed",$0G);if($a.commandArg==me.$1a&&!$a.alert&&!ds.alert)me.$1M($0F);};ds.events.addEventHandler("commandPerformed",$0G);ds.executeCommand(ds.saveCommandName,this.$1a);}else this.$1M($0F);};PXBoundPanel.prototype.$1M=function($0F){if(this.uploadFileCall.uploadCallback==null)this.uploadFileCall.uploadCallback=Function.createDelegate(this,this.$1N);var me=this,$0H=Function.createDelegate(this,this.$1O);for(var i=0;i<$0F.length;i++){var $0I=new FileReader(),$0J=$0F[i];if($0J.size>this.maxFileSize*1000){alert(this.maxFileSizeMsg);break;};var $0K=$0J.name.toLowerCase().lastIndexOf("."),$0L=true;if($0K>0&&this.allowedFiles&&this.allowedFiles.split)$0L=Array.contains(this.allowedFiles.split(';'),$0J.name.substr($0K).toLowerCase());if(!$0L){alert(this.allowedFilesMsg);break;};__px(this).addEventHandler($0I,"load",function(e){var $0M=[e.target.fileName,e.target.fileSize];__px_callback(me).execI(me,me.uploadFileCall,e.target.fileName+'|'+e.target.result,$0H,$0M);});__px(this).addEventHandler($0I,"progress",function(e){var $0M=[e.target.fileName,e.target.fileSize];if(e.lengthComputable)me.$1N(Math.round(e.loaded/e.total*100),$0M,true);});$0I.fileName=$0J.name;$0I.fileSize=$0J.size;$0I.readAsDataURL($0J);}};PXBoundPanel.prototype.$1N=function($0N,ar,$0O){var $0P=ar[1],$0Q=ar[0],px=__px(this);if($0P&&$0P>250000){$0N=$0O?($0N/ 2):(percent/ 2+50);if(px.isActiveWC())px.stopWC();if(px.isActivePI()){px.setPIValue($0N>=99?100:$0N);if($0N>=99)px.setPIText(px.getLocalMessage('fileSaving','File saving, please wait...'));}else px.startPI(px.getLocalMessage('uploading','Uploading: ')+$0Q);}};PXBoundPanel.prototype.$1O=function($D,$a){__px(this).stopPI();if($D)this.processRefresh($D);};



function PXFormView($a,$b,$c){PXFormView.initializeBaseA(this,[$a,$b,$c]);__px_cm(this).readProperties(this,$c,PXFormView.properties);this.elemHeader=__px(this).elemByID($b.id+"_header");this.elemContent=__px(this).elemByID($b.id+"_content");if($b.tagName!="TABLE"){var ec=$b.firstChild;while(ec&&ec.tagName!="DIV")ec=ec.nextSibling;this.elemContent=ec;};var h=PXFormView.$x,h2=PXFormView.$y;if(this.elemHeader){__px(this).addEventHandler(this.elemHeader,"click",h);__px(this).addEventHandler(this.elemHeader,"dblclick",h);}else if(this.imageState){__px(this).addEventHandler(this.imageState,"click",h2);};this.setInitialExpandedState();};PXFormView.__baseType=PXBoundPanel;PXFormView.properties=[["useExpandEffect",JSType.Bool,false]];PXFormView.prototype.onLoad=function(){PXFormView.callBase(this,"onLoad",null);this.controls=new Object();this.controlsV=new Object();for(var name in __px_all(this)){var $d=__px_all(this)[name];if($d.bindingContainer==this.ID)this.controls[name]=$d;if($d.onVisibleChanged)this.controlsV[name]=$d;}};PXFormView.prototype.repaint=function($e,$f){delete this.needToExpand;PXFormView.callBase(this,"repaint",[$e,$f]);};PXFormView.prototype.onFocusDefaultControl=function(){var ec=this.elemContent.firstChild;if(!this.getState()&&ec&&ec.tagName=="DIV")ec.scrollTop=0;if(this.needToExpand){this.setState(true);delete this.needToExpand;}};PXFormView.prototype.onSetError=function($d,$g,$h){if($g&&this.allowCollapse&&!this.getState()&&$h>1)this.needToExpand=true;};PXFormView.prototype.getState=function(){return this.elemContent.style.display!="none"&&!this.collapsed;};PXFormView.prototype.setState=function($i,ev){if(this.getState()==$i)return;this.viewState.update("Expanded",$i);this.switchStateIndicator($i);if(this.useExpandEffect){if(this.$z==null)this.$z=new PXExpandEffect(this);this.$z.setState($i,ev);}else this.$A($i);};PXFormView.prototype.setHeight=function($j){var h=parseInt($j);var $k=this.element,$l=this.elemContent;h-=($k.offsetHeight-__px(this).getStyleHeight($l,$l.clientHeight));$k.style.height=$l.style.height=(h>0?h:0)+"px";};PXFormView.prototype.setWidth=function($m){var w=parseInt($m);this.element.style.width=w+"px";};PXFormView.prototype.$B=function($n){var $o=this.controlsV;for(var id in $o){var $d=$o[id];if($d.onVisibleChanged)$d.onVisibleChanged($n);}};PXFormView.prototype.$A=function($i){var e=this.element,ec=this.elemContent,$p=null,me=this;for(var i=0;i<ec.childNodes.length;i++){var t=ec.childNodes[i];if(t.tagName=="DIV"&&!t.getAttribute("data-ims")){$p=t;break;}};if($i){if(this.$C!=null)e.style.height=this.$C;if(this.minHeight>0){if(this.$D!=null)ec.style.height=this.$D;if(this.$E!=null)$p.style.height=this.$E;if(this.$F!=null)$p.style.overflowY=this.$F;$p.scrollTop=0;delete this.collapsed;}else ec.style.display="";}else{this.$C=e.style.height;this.$D=ec.style.height;this.$E=$p.style.height;this.$F=$p.style.overflowY;this.$G=ec.offsetHeight;if(this.minHeight>0){$p.style.overflowY="hidden";e.style.height=ec.style.height=$p.style.height=this.minHeight+"px";$p.scrollTop=0;this.collapsed=true;}else{var h=this.elemHeader?this.elemHeader.offsetHeight:0;e.style.height=h+"px";ec.style.display="none";}};setTimeout(function(){__px_cm(me).notifyOnResize();},1);this.$B($i);};PXFormView.$x=function(e){var $q=false,se=__px(this).eventElem(e);var $r=__px(this).eventObject(e,PXFormView),is=$r.imageState;switch(e.type){case "dblclick":$q=true;break;case "click":$q=se&&(se.tagName=="A"||se==is||se.parentNode==is);break;};__px(this).cancelEvent(e,false);if($q&&$r!=null)$r.switchState();};PXFormView.$y=function(e){var $r=__px(this).eventObject(e,PXFormView);if($r!=null)$r.switchState();};function PXExpandEffect($r){this.px_context=$r.px_context;this.$H=null;this.$I=$r;this.$J=$r.element;this._content=$r.elemContent;this.$K=$r.elemHeader;this.$L=100;this.$M=10;this.$N=$r.elemHeader.offsetHeight;this.$O=this._content.firstChild.style.overflow;};PXExpandEffect.prototype.setState=function($i,e){this.$P=e;if(this.$H)this.endSlide(!$i);var ce=this._content,p=this.$I,me=this;if(p.$D==null)p.$D=ce.style.height;if(p.$C==null)p.$C=this.$J.style.height;if(p.$G==null||(!$i&&p.$G!=ce.offsetHeight))p.$G=ce.offsetHeight;this._alpha=100/parseInt(p.$G);var $s=ce.currentStyle?ce.currentStyle.filter:ce.style.filter;if($i){if(ce.filters){if(!ce.filters["alpha"])ce.style.filter=$s+" alpha(opacity=1)";else ce.filters["alpha"].enabled=true;};ce.style.display="";ce.style.height=1+"px";this.$L=1;this.$H=setInterval(function(){me.slideDown(p.ID);},20);}else{ce.firstChild.style.overflow="hidden";if(ce.filters){if(!ce.filters["alpha"])ce.style.filter=$s+" alpha(opacity=100)";else ce.filters["alpha"].enabled=true;};ce.style.height=p.$G+"px";this.$J.style.height=this.$J.offsetHeight+"px";this.$L=100;this.$H=setInterval(function(){me.slideUp(p.ID);},20);}};PXExpandEffect.prototype.slideDown=function(id){var $t=__px_all(this)[id].$z;var $u=parseInt($t._content.style.height);if((parseInt($t.$I.$G)-$u)<($t.$M+1)){this.endSlide(true);return;};PXExpandEffect.$Q($t,$t.$M);};PXExpandEffect.prototype.slideUp=function(id){var $t=__px_all(this)[id].$z;var $u=parseInt($t._content.style.height);if($u<($t.$M+1)){this.endSlide(false);return;};PXExpandEffect.$Q($t,-$t.$M);};PXExpandEffect.$Q=function($t,$v){var $w=$t._content,$b=$t.$J;$b.style.height=parseInt($b.style.height)+$v+"px";$w.style.height=parseInt($w.style.height)+$v+"px";$t.$L=$t.$L+($v*$t._alpha);if($w.filters&&$w.filters["alpha"])$w.filters["alpha"].opacity=$t.$L;};PXExpandEffect.prototype.endSlide=function($i){var p=this.$I;if($i){clearInterval(this.$H);if(this._content.filters&&this._content.filters["alpha"]){this._content.filters["alpha"].opacity=100;this._content.filters["alpha"].enabled=false;};this.$H=null;this._content.style.height=p.$D;this.$J.style.height=p.$C;p.$D=null;p.$C=null;this._content.firstChild.style.overflow=this.$O;if(this.$P)p.fireEvent(4,this.$P);}else{clearInterval(this.$H);this._content.style.height=1+"px";if(this._content.filters&&this._content.filters["alpha"])this._content.filters["alpha"].opacity=0;this.$H=null;this._content.style.display="none";this.$J.style.height=this.$N+"px";if(this.$P)p.fireEvent(4,this.$P);};p.$B($i);__px_cm(this).notifyOnResize();};



function PXTab($b,$c,$d){PXTab.initializeBaseA(this,[$b,$c,$d]);__px_cm(this).readProperties(this,$d,PXTab.properties);var rc=this.callbacks[0];this.repaintCall=__px_callback(this).createCommand("RepaintTab",rc.blockPage,0,rc.commitChanges,rc.postData);this.contCell=__px(this).elemByID($c.id+"_cont");this.tabDiv=__px(this).elemByID($c.id+"_tabDiv");this.tabTable=__px(this).elemByID($c.id+"_tabT");this.tabRows=this.tabTable.rows.length;if(this.tabRows>1){var tt=__px(this).elemByID($c.id+"_tabT0");this.tabsBackColor=tt.style.backgroundColor;};var h=PXTab.$0m;__px(this).addEventHandler(this.tabTable,"mousedown",h);__px(this).addEventHandler(this.tabTable,"mouseover",h);__px(this).addEventHandler(this.tabTable,"mouseout",h);h=Function.createDelegate(this,this.$0n);__px(this).addEventHandler(__doc(this).documentElement,"keydown",h);this.items=new Array();for(var i=0;i<this.itemsCount;i++){this.items[i]=new PXTabItem(this,i,$d.items[i]);if(this.items[i].$0o())this.selectedIndex=i;};this.viewState.update("SelectedIndex",this.selectedIndex);if(this.tabDiv&&this.displayMode==2){var $e=this.getSelectedTab();this.$0p();if(this.allowScroll&&$e)$e.ensureVisible();};this.events.appendEvents(PXTab.events,$d.clientEvents);__px_cm(this).registerRequiresOnResize(this);if(this.imageState&&this.minHeight){var me=this;__px(this).addEventHandler(this.imageState,"click",function(e){me.switchState();});};this.setInitialExpandedState();};PXTab.__baseType=PXBoundPanel;PXTab.convertRound=function($f,$g){if($g)return $g.split(",");};PXTab.stylesInfo=[["base",JSType.String,""],["normal",JSType.String,""],["selected",JSType.String,""],["hover",JSType.String,""],["disabled",JSType.String,""],["roundLeft",JSType.String,"",PXTab.convertRound],["roundMiddle",JSType.String,"",PXTab.convertRound],["roundRight",JSType.String,"",PXTab.convertRound]];PXTab.properties=[["selectedIndex",JSType.Int,0],["tabImages",JSType.Bool,true],["displayMode",JSType.Int,3],["dynamicTabs",JSType.Bool,true],["itemsCount",JSType.Int,0],["accessKeys",JSType.Empty,null],["styles",JSType.Object,PXTab.stylesInfo]];PXTab.events={$tabChanging:9,$tabChanged:10};PXTab.prototype.onAfterResize=function(){if(!__px(this).isVisible(this.element))return;switch(this.displayMode){case 2:this.$0p();while(!this.allowScroll&&this.scrollPos){this.scroll(true);this.$0p();};break;case 3:this.arrangeOverflowItems();break;};var $h=this.getSelectedTab();if($h)$h.$0q();};PXTab.prototype.onVisibleChanged=function($i){PXTab.callBase(this,"onVisibleChanged",[$i]);var $j=this.getSelectedTab();if($j)$j.$0r($i);};PXTab.prototype.setState=function($k){var $l=this.contCell,me=this;if($k){this.element.style.height=$l.style.height=this.oldHeight;}else{this.oldHeight=$l.style.height;$l.style.height=this.minHeight+"px";};for(var i=0;i<this.items.length;i++){var $m=this.items[i],cs=$m.elemC.style;if($k){cs.overflow=$m.oldOverflow;cs.minHeight=$m.oldMinHeight;cs.height="";if($m.selected())$m.elemC.scrollTop=0;}else{$m.oldOverflow=$m.elemC.style.overflow;$m.oldMinHeight=$m.elemC.style.minHeight;cs.height=$l.style.height;cs.overflow="hidden";cs.minHeight="";}};this.switchStateIndicator($k);this.collapsed=!$k;setTimeout(function(){__px_cm(me).notifyOnResize();},1);};PXTab.prototype.getState=function(){return !this.collapsed;};PXTab.prototype.setProperties=function($d){PXTab.callBase(this,"setProperties",[$d]);if($d==null||$d.items==null)return;var $n=Math.min($d.items.length,this.items.length);var $j=this.getSelectedTab();for(var i=0;i<$n;i++){var $m=this.items[i],ip=$d.items[i];__px_cm(this).readProperties($m,ip,PXTabItem.callbackProps);$m.repaintErrorImage();};if($d.selectedIndex!=null)this.setSelectedIndex($d.selectedIndex);else if($j&&!$j.getVisible())$j.$0s();if(!$j.getVisible()){this.selectFirstVisible();}};PXTab.prototype.selectFirstVisible=function(){for(var i=0;i<this.items.length;i++){var $m=this.items[i];if($m.getVisible()&&!$m.isOverflown()){$m.select();break;}}};PXTab.prototype.onLoad=function(){PXTab.callBase(this,"onLoad",null);if(this.tabDiv&&this.displayMode==3)this.$0t();};PXTab.prototype.onUnload=function(e){if(__px_cm(this).cookie)__px_cm(this).cookie[this.ID]=this.selectedIndex;};PXTab.prototype.isObjectOwner=function($o){if($o instanceof PXTabItem)$o=$o.owner;return $o==this;};PXTab.prototype.getVisible=function(){if(this.autoSiseWindow())return this.element.style.visibility!="hidden";return PXTab.callBase(this,"getVisible");};PXTab.prototype.setVisible=function($p){if($p!=this.getVisible()){if(this.autoSiseWindow())this.element.style.visibility=($p?"":"hidden");else PXTab.callBase(this,"setVisible",[$p]);var $j=this.getSelectedTab();if($j)$j.$0r($p);}};PXTab.prototype.autoSiseWindow=function(){return(this.autoSize&&this.autoSize.enabled&&this.autoSize.container==1);};PXTab.prototype.setHeight=function($q){var h=parseInt($q);var $r=this.element,$l=this.contCell;h-=($r.offsetHeight-$l.clientHeight);$r.style.height=$l.style.height=(h>0?h:0)+"px";};PXTab.prototype.setWidth=function($s){var w=parseInt($s);this.element.style.width=w+"px";};PXTab.prototype.getSelectedIndex=function(){return this.selectedIndex;};PXTab.prototype.getSelectedTab=function(){return this.items[this.selectedIndex];};PXTab.prototype.setSelectedIndex=function($t){if($t<0||this.items.length<=$t)return;if($t==this.selectedIndex)return;this.items[$t].select();};PXTab.prototype.scroll=function($u){if(!this.allowScroll&&!this.scrollPos)return false;if(!this.scrollPos)this.scrollPos=0;var i=this.scrollPos,t=this.items[i];while(true){i+=$u?-1:1;if(i<0||i>=this.items.length)return false;if(this.items[i].getVisible())break;};this.scrollPos=i;if($u)this.items[i].$0u(true);else t.$0u(false);this.$0v();return true;};PXTab.prototype.$0v=function(){if(this.scrollBtnL)this.scrollBtnL.setEnabled(this.scrollPos>0);if(this.scrollBtnR)this.scrollBtnR.setEnabled(this.tabTable.offsetWidth>this.scrollWidth);};PXTab.prototype.$0p=function(){var b0,b1;if(this.scrollBtnL==null){b0=__px_cm(this).createControl("PXButton",this.ID+"_but0");b1=__px_cm(this).createControl("PXButton",this.ID+"_but1");if(b0){b0.events.addEventHandler("click",PXTab.$0w);this.scrollBtnL=b0;b0.left=true;b0.linkedTab=this;};if(b1){b1.events.addEventHandler("click",PXTab.$0w);this.scrollBtnR=b1;b1.left=false;b1.linkedTab=this;}}else{b0=this.scrollBtnL;b1=this.scrollBtnR;};if(b0==null||b1==null)return;this.allowScroll=false;this.scrollWidth=this.tabDiv.offsetWidth;if(this.tabTable.offsetWidth>this.scrollWidth){b0.setVisible(true);b1.setVisible(true);this.allowScroll=true;if(this.scrollPos==null)this.scrollPos=0;this.$0v();}else{b0.setVisible(false);b1.setVisible(false);}};PXTab.prototype.repaint=function($v,$w,$x){var $y=$v.xmlDoc.getElementsByTagName("Controls");if($y!=null)$y=$y[$y.length-1];var ht=($y!=null)?$y.getAttribute("HiddenTabs"):null;if(ht!=null){var $z=ht.split(",");for(var i=0;i<$z.length;i++){var ti=this.items[parseInt($z[i])],p=ti.panel;if(p==null||!p.loadOnDemand||p.loaded){ti.needsRepaint=true;ti.resetErrorImage();}}};var vt=($y!=null)?$y.getAttribute("VisibleTabs"):null;if(vt!=null){var $z=vt.split(",");for(var i=0;i<$z.length;i++)this.items[parseInt($z[i])].needsRepaint=false;};if(vt==null&&ht==null&&!$x){for(var i=0;i<this.items.length;i++)this.items[i].needsRepaint=false;};PXTab.callBase(this,"repaint",[$v,$w]);var $j=this.getSelectedTab();if(!$x&&$j.needsRepaint)this.repaintActiveTab();__px_cm(this).notifyOnResize();};PXTab.prototype.repaintActiveTab=function(){var $A=Function.createDelegate(this,this.processTabRepaint);__px_callback(this).execI(this,this.repaintCall,"",$A);};PXTab.prototype.processTabRepaint=function($B,$b){if($B){var $C=new PXXmlDoc("",$B);var bc=$C.xmlDoc.getElementsByTagName("BoundControls")[0];var $D=$C.rootNode.getAttribute("DataKey");if($D!=null)this.setDataKey($D);this.repaint($C,this.repaintCall.commitChanges,true);this.getSelectedTab().needsRepaint=false;if(bc!=null)__px_callback(this).processRepaint(bc,this);}};PXTab.prototype.excludeFromPostIDs=function(){var $E=new Array(),$e=this.getSelectedTab();for(var i=0;i<this.items.length;i++){var $m=this.items[i];if($m.needsRepaint&&$m!=$e)$E.push($m.elemC.id);};return $E;};PXTab.prototype.getErrorInfo=function(){var status=this.errorStatus,$F=this.errorText;for(var i=0;i<this.items.length;i++){var $G=this.items[i].getErrorInfo();if($G[0]>status){status=$G[0];$F=$G[1];}};return[status,$F];};PXTab.prototype.onSetError=function($H,$I,$J){var i=$H.linkedTabIndex;if(i!=null&&$I){var $m=this.items[i];if($J>$m.errorStatus){$m.errorStatus=$J;$m.errorText=$I;$m.repaintErrorImage();}}};PXTab.prototype.onChildAfterRepaint=function($H,$K){var i=$H.linkedTabIndex;if(i!=null)this.items[i].repaintErrorImage();};PXTab.prototype.arrangeOverflowItems=function(){if(this.overflowBtn==null)this.$0t();if(this.tabDiv==null||this.tabDiv.offsetWidth==0||this.overflowBtn==null)return;var $L=this.tabTable.parentNode,$M=this.items.length;var $N=($L.scrollWidth-$L.offsetWidth),i;var $O=(__px(this).IsAnyIE||__px(this).IsSafari);if($O&&$N==1)$N=0;if($N>0){this.overflowBtn.setVisible(true);for(i=$M-1;i>=0&&$N>0;i--){var $m=this.items[i];if($m.$0x||!$m.getVisible()||$m.selected())continue;this.$0y($m);$N=($L.scrollWidth-$L.offsetWidth);this.$0z=true;if($O&&$N==1)$N=0;}}else if(this.$0z){var $P=$L.offsetWidth,$s=this.tabTable.offsetWidth;var $Q=this.tabTable.rows[0].cells;$s-=$Q[$Q.length-1].offsetWidth;for(i=0;i<$M&&$P>$s;i++){var $m=this.items[i];if($m.$0x){$s+=$m.$0A;if($s<=$P)this.$0B($m);else break;}};if(i==$M){this.overflowBtn.setVisible(false);this.overflowMenu.setActive(false);this.$0z=false;}}};PXTab.prototype.$0y=function($m){if(this.overflowMenu==null||!$m.getVisible())return;$m.$0A=$m.element.offsetWidth;$m.$0x=true;$m.element.style.display="none";var $F=$m.getText()?$m.getText():$m.getTooltip();var $R=this.overflowMenu.items.insertItem(0,$F,null,null,$m.getEnabled(),true,$m.selected());$m.$0C=$R;$R.linkedItem=$m;$R.checkGroup="1";};PXTab.prototype.$0B=function($m){if(this.overflowMenu==null||!$m.$0x)return;$m.element.style.display="";delete $m.$0A;$m.$0x=false;if(this.overflowMenu){var mi=$m.$0C;if(mi)this.overflowMenu.items.removeItem(mi.index);$m.$0C=undefined;}};PXTab.prototype.$0t=function(){if(this.tabDiv==null||this.overflowBtn!=null)return;this.overflowBtn=__px_cm(this).createControl("PXButton",this.ID+"_oi");if(this.overflowBtn){var $S=this.overflowBtn.getMenu();if($S){this.overflowMenu=$S;var h1=Function.createDelegate(this,this.$0D);$S.events.addEventHandler("itemClick",h1);}}};PXTab.prototype.$0D=function($S,e){var $m=e.item.linkedItem;if($m){$S.setActive(false);if(e.item.getChecked()){$m.select(true);this.$0B($m);this.arrangeOverflowItems();var $T=new Object();$T["selectedIndex"]=$m.index;if(!this.fireEvent("tabChanging",e,$T)){this.fireEvent("tabChanged",e,$T);}}else e.item.setChecked(true);e.cancel=true;}};function PXTabItem($U,$t,$d){this.px_context=$U.px_context;this.owner=$U;this.ID="tab"+$t;this.index=$t;__px_cm(this).readProperties(this,$d);this.element=__px(this).elemByID($U.ID+"_"+this.ID);this.elemC=__px(this).elemByID($U.ID+"_t"+$t);if($U.tabImages){var $Q=this.element.rows[0].cells;this.elemL=$Q[0];this.elemText=this.elemM=$Q[1];this.elemR=$Q[2];}else this.elemText=this.element;var $V=this.element.parentNode.previousSibling;while($V&&$V.tagName!="TD")$V=$V.previousSibling;if($V&&$V.getAttribute("sep")!=null)this.separator=$V;var $W=(this.elemC.getAttribute("empty")!=null);if($W){var $d=new Object();$d.position=0;$d.loadOnDemand=true;$d.allowResize=$d.allowMove=false;$d.autoSaveChanges=false;this.panel=new PXSmartPanel(this.px_context,this.elemC,$d);__px_all(this)[this.elemC.id]=this.panel;this.panel.events.addEventHandler("afterShow",Function.createDelegate(this,this.$0E));this.panel.events.addEventHandler("afterLoad",Function.createDelegate(this,this.$0F));this.panel.linkedTabItem=this;};this.element.object=this.elemC.object=this;if(this.element.getAttribute("data-hidden")!=null)this.$0G("Hidden",true);this.staticContent=this.elemC.className=="tabPanelS";};PXTabItem.properties=[["errorStatus",JSType.Int,0],["key",JSType.String,""],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc]];PXTabItem.callbackProps=[["visible",JSType.Bool,true,"setVisible"],["errorStatus",JSType.Int,0],["errorText",JSType.String,""]];PXTabItem.prototype.getVisible=function(){return this.element.style.display!="none"||this.scrollHidden||this.$0x;};PXTabItem.prototype.isOverflown=function(){return this.$0x;};PXTabItem.prototype.setVisible=function($p){if($p!=this.getVisible()){var $X=$p?"":"none";this.element.style.display=$X;if(this.$0C&&!$p){var mi=this.$0C;this.owner.overflowMenu.items.removeItem(mi.index);delete this.$0A;this.$0x=false;};var $j=this.owner.getSelectedTab(),si=this.owner.selectedIndex;var $Y=$j?$j.getVisible():false;if(this.index==si||!$Y){if(this.elemC)this.elemC.style.display=$X;if($p){if(!$Y)this.select();else __px_cm(this).notifyOnResize(this,this.elemC);}else this.$0s();}}};PXTabItem.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXTabItem.prototype.setEnabled=function($Z){if(this.getEnabled()!=$Z){__px(this).setEnabled(this.element,$Z);if(this.elemC)__px(this).setEnabled(this.elemC,$Z);this.$0H();}};PXTabItem.prototype.setLoaded=function($00){this.$0G("Loaded",Boolean($00));};PXTabItem.prototype.isLoaded=function(){return this.panel==null||this.panel.loaded;};PXTabItem.prototype.focusInnerControl=function(){if(!this.defaultFocused){this.ensureControls();for(var id in this.controls){var $H=this.controls[id];if($H.focus&&($H.getEnabled==null||$H.getEnabled())&&($H.getReadOnly==null||!$H.getReadOnly())&&__px(this).isVisible($H.elemFocus)){if(!this.defaultFocused||($H.tabIndex&&$H.tabIndex<this.defaultFocused.tabIndex)){this.defaultFocused=$H;}}}};var $H=this.defaultFocused;if($H)setTimeout(function(){$H.focus();},1);};PXTabItem.prototype.$0I=function(){var $L=this.elemC;return !this.staticContent&&($L.parentNode.clientHeight>$L.offsetHeight);};PXTabItem.prototype.$0q=function(){if(!this.staticContent){var $L=this.elemC;if($L.scrollHeight>$L.offsetHeight)$L.className="tabPanelSD";else if(this.$0I())$L.className="tabPanel";}};PXTabItem.prototype.$0J=function(){if(!this.staticContent)this.elemC.className="tabPanel";};PXTabItem.prototype.getText=function(){return __px(this).getElemText(this.elemText);;};PXTabItem.prototype.setText=function(v){__px(this).setElemText(this.elemText,v);this.$0G("Text",v);};PXTabItem.prototype.getTooltip=function(){return __px(this).getTitle(this.element);};PXTabItem.prototype.setTooltip=function(v){__px(this).setTitle(this.element,v);this.$0G("Tooltip",v);};PXTabItem.prototype.selected=function(){return this.index==this.owner.selectedIndex;};PXTabItem.prototype.getRowIndex=function(){var ri=0;if(this.owner.tabRows>1){var e=this.$0K();ri=e?e.rowIndex:0;};return ri;};PXTabItem.prototype.isFirstRow=function(){if(this.owner.tabRows>1)return this.getRowIndex()==(this.owner.tabRows-1);return true;};PXTabItem.prototype.$0o=function(){return this.elemC.style.display!="none";};PXTabItem.prototype.setErrorImage=function($01,$J){var $02=this.owner.images;if(!$02.error||!$02.warning)return;var $03=($J==2)?$02.error:$02.warning;if($J==0)$03=$02.info;if(this.errorImage==null){var $04=__px_cm(this).createSpriteOrImage(null,$03);if($01)__px(this).setTitle($04,$01);if($04.tagName=="IMG")$04.align="absmiddle";var te=__px(this).findTextElem(this.elemText);this.elemText.insertBefore($04,te);this.errorImage=$04;}else{__px_cm(this).repaintImage(this.errorImage,$03);__px(this).setTitle(this.errorImage,$01);};this.errorImage.setAttribute("error",$J);};PXTabItem.prototype.resetErrorImage=function(){if(this.errorImage!=null){this.elemText.removeChild(this.errorImage);this.errorImage=null;}};PXTabItem.prototype.repaintErrorImage=function(){var $G=this.getErrorInfo(),status=$G[0],$F=$G[1];this.hasError=(status>0);if(status>0)this.setErrorImage($F,status);else this.resetErrorImage();};PXTabItem.prototype.getErrorInfo=function(){var status=this.errorStatus,$F=this.errorText;this.ensureControls();for(var id in this.containers){var $05=this.containers[id],$G=$05.getErrorInfo();if($G[0]>status){status=$G[0];$F=$G[1];}};return[status,$F];};PXTabItem.prototype.hasChangedChild=function(){this.ensureControls();for(var id in this.containers)if(this.containers[id].getChanged())return true;return false;};PXTabItem.prototype.getControls=function(){if(this.controls!=null)this.controls;this.controls=new Object();this.editors=new Object();this.containers=new Object();this.controlsV=new Object();var $h=this.owner,id=this.owner.ID,$06=this.elemC.id;var $07=Function.createDelegate($h,$h.onChildAfterRepaint);for(var name in __px_all(this)){var $H=__px_all(this)[name];if(!$H.ID.startsWith($06))continue;var $c=$H.element?$H.element.parentNode:null;var $08=false;while($c){if($c.object!=null&&$c.object instanceof PXTabItem){$08=($c.object==this);break;};$c=$c.parentNode;};if($08){if($H.onVisibleChanged)this.controlsV[name]=$H;if($H.bindingContainer==id)this.editors[name]=$H;if($H.constructor.__baseType==PXBoundPanel){this.containers[name]=$H;$H.events.addEventHandler("afterRepaint",$07);};if($H.__className=="PXGrid"){this.containers[name]=$H;$H.events.addEventHandler("afterRepaint",$07);$H.events.addEventHandler("afterRepaintRow",$07);};$H.linkedTabIndex=this.index;this.controls[name]=$H;}};return this.controls;};PXTabItem.prototype.containsControl=function($H){var $y=this.getControls();return($y[$H.ID]!=null);};PXTabItem.prototype.ensureControls=function(){if(this.controls==null)this.getControls();};PXTabItem.prototype.select=function($09){if(!this.getVisible())return;var $h=this.owner,$m,$0a=$h.selectedIndex,$0b;$h.selectedIndex=this.index;$h.viewState.update("SelectedIndex",this.index);if($0a>=0){$m=$h.items[$0a];$m.$0H();if($m.panel){if($m.panel.loaded)$m.$0r(false);$m.panel.hide();}else if($m.elemC){$m.$0r(false);$m.elemC.style.display="none";};if($m.$0C)$m.$0C.setChecked(false);if($m.separator)$m.separator.style.display="";$0b=$h.items[$0a+1];if($0b&&$0b.separator&&$0b.getVisible())$0b.separator.style.display="";};this.$0H();if(this.panel)this.panel.show();else if(this.elemC)this.elemC.style.display="";this.$0r(true);if(this.separator)this.separator.style.display="none";$0b=$h.items[this.index+1];if($0b&&$0b.separator)$0b.separator.style.display="none";if(this.owner.dynamicTabs&&!this.isFirstRow())this.bringToFront();if($h.allowScroll)this.ensureVisible();if(this.owner.dataBound)this.owner.paintDelayImages();for(var id in this.containers){var $05=this.containers[id];if($05.dataBound)$05.paintDelayImages();};if(this.isLoaded()){$m=$h.items[$h.selectedIndex];var me=this;setTimeout(function(){var $0c=me.$0I();if($0c)me.$0q();if(me.panel==null)__px_cm($h).notifyOnResize();if(!$0c)me.$0q();if($m.needsRepaint)$h.repaintActiveTab();if($m.autoCallBack)__px_callback($h).exec($m.owner,$m.autoCallBack);if($09)$m.focusInnerControl();},1);}};PXTabItem.prototype.ensureVisible=function(){if(!this.owner.allowScroll)return;var i0=this.index,i,$h=this.owner;var e=$h.tabImages?this.element.parentNode:this.element;if($h.scrollPos>i0){i=$h.scrollPos;while($h.scrollPos>i0&&i-->0)$h.scroll(true);}else{i=$h.items.length-$h.scrollPos;while($h.scrollPos<i0&&i-->0){if((e.offsetLeft+e.offsetWidth)>$h.scrollWidth)$h.scroll(false);else break;}}};PXTabItem.prototype.bringToFront=function(){if(!this.isFirstRow()){var $0d=this.$0K();if($0d.rowIndex==0){var $0e=this.owner.tabTable.rows[1];for(var i=0,j=0;i<$0d.cells.length;i++,j++){var $l=$0d.cells[i];if($l.rowSpan>1){$0e.insertBefore($l,(j<$0e.cells.length)?$0e.cells[j]:null);i--;}}};this.owner.tabTable.tBodies[0].appendChild($0d);for(var i=0;i<this.owner.items.length;i++)this.owner.items[i].$0H();if(this.owner.tabsBackColor){for(var i=0;i<this.owner.tabRows;i++){var tt=__px(this).elemByID(this.owner.ID+"_tabT"+i);var tr=tt?this.$0K(tt):null;if(tr){if(tr.rowIndex>0)tt.style.backgroundColor=this.owner.tabsBackColor;else tt.style.backgroundColor="";}}}}};PXTabItem.prototype.$0s=function(){var o,i=this.index;while(i-->0)if($a(this.owner,i))return true;i=this.index;while(++i<this.owner.items.length)if($a(this.owner,i))return true;function $a($U,i){var $m=$U.items[i];if($m.getVisible()){$U.setSelectedIndex(i);return true;}};return false;};PXTabItem.prototype.$0u=function($p){if(this.getVisible()){this.element.style.display=$p?"":"none";this.scrollHidden=!$p;}};PXTabItem.prototype.$0L=function(){return !this.scrollHidden;};PXTabItem.prototype.$0H=function($0f){var $0g=new Array(),$0h=this.owner.styles;if($0h.base&&this.isFirstRow())$0g.push($0h.base);if($0h.normal)$0g.push($0h.normal);if(!this.getEnabled()){if($0h.disabled)$0g.push($0h.disabled);if(this.selected())if($0h.selected)$0g.push($0h.selected);}else if(this.selected()){if($0h.selected)$0g.push($0h.selected);}else{if($0f&&$0h.hover)$0g.push($0h.hover);};this.element.className=$0g.join(" ");if(this.owner.tabImages){var i=this.selected()?2:($0f?1:0);if(this.elemL&&$0h.roundLeft)this.elemL.className=$0h.roundLeft[i];if(this.elemM&&$0h.roundMiddle)this.elemM.className=$0h.roundMiddle[i];if(this.elemR&&$0h.roundRight)this.elemR.className=$0h.roundRight[i];}};PXTabItem.prototype.$0K=function($c){var e=$c?$c:this.element.parentNode;while(e){if(e.tagName=="TR"&&e.parentNode.parentNode==this.owner.tabTable)break;e=e.parentNode;};return(e!=null&&e.tagName=="TR")?e:null;};PXTabItem.prototype.$0G=function($0i,$00){this.owner.viewState.updateListItem("Items",this.index,$0i,$00);};PXTabItem.prototype.$0r=function($i){if($i&&this.$0M==null){__px_tm(this).register(this.elemC);this.$0M=true;};this.ensureControls();var $y=this.controlsV;for(var id in $y){var $H=$y[id];if($H.onVisibleChanged)$H.onVisibleChanged($i);}};PXTabItem.prototype.$0E=function($0j,e){__px_cm(this).notifyOnResize(true);};PXTabItem.prototype.$0F=function($0j,e){var $m=$0j.linkedTabItem;$m.setLoaded(true);$m.controls=null;$m.ensureControls();$m.focusInnerControl();};PXTab.$0w=function($0k,ev){if($0k.linkedTab)$0k.linkedTab.scroll($0k.left);};PXTab.$0m=function(e){var $h=__px(this).eventObject(e,PXTab);var $m=__px(this).eventObject(e,PXTabItem);if($m&&$h)switch(e.type){case "mousedown":if(__px(this).isActiveWC())return;if(!__win(this).pageLoaded)return;var $T=new Object();$T["selectedIndex"]=$h.selectedIndex;if(!$h.fireEvent("tabChanging",e,$T)){$m.select(true);$h.fireEvent("tabChanged",e,$T);};break;case "mouseover":var hi=$h.hoverItem;if($m.getEnabled()&&hi!=$m){if(hi)hi.$0H(false);$m.$0H(true);$h.hoverItem=$m;};break;case "mouseout":if($h.hoverItem){$h.hoverItem.$0H(false);$h.hoverItem=null;};break;}};PXTab.prototype.$0n=function(e){var k=e.keyCode,$c=__px(this).eventElem(e),$08=false;if($c&&$c.getAttribute("controlID")){var $H=__px_all(this)[$c.getAttribute("controlID")];if($H)$c=$H.element;}while($c){if($c.object!=null&&$c.object instanceof PXTab){$08=($c.object==this);break;};$c=$c.parentNode;};if(!$08)return;switch(k){case 190:case 188:if(e.ctrlKey){var $n=this.items.length;var i=this.selectedIndex,ii=$n;while(ii-->0){(k==188)?i--:i++;if(i>=$n)i=0;if(i<0)i=$n-1;var $m=this.items[i];if($m.getVisible())break;};if(i!=this.selectedIndex){this.setSelectedIndex(i);if(!this.hasFocus)this.focus();};__px(this).cancelEvent(e);};break;default:if(this.accessKeys&&e.altKey){for(var i=0;i<this.accessKeys.length;i++){var $0l=this.accessKeys[i];if(k==$0l[1]){this.setSelectedIndex($0l[0]);__px(this).cancelEvent(e);if(!this.hasFocus)this.focus();break;}}};break;}};



function PXFileUpload($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);this.uploadElem=__px(this).elemByID(this.ID+"_upl");this.imageLoading=__px(this).elemByID(this.ID+"_imgl");if(this.uploadElem!=null){__px(this).addEventHandler(this.uploadElem,"blur",PXFileUpload.onUploadBlur);__px(this).addEventHandler(this.uploadElem,"change",PXFileUpload.onUploadChange);};if(this.submitButtonID!=""){this.submitButton=__px(this).elemByID(this.submitButtonID);__px(this).addEventHandler(this.submitButton,"click",Function.createDelegate(this,this.checkForLink));};this.events=new PXEventList(this,PXFileUpload.events,$c.clientEvents);};PXFileUpload.properties=[["allowedFileTypes",JSType.String,""],["callbackTargetID",JSType.String,""],["submitButtonID",JSType.String,""],["ajaxBehavior",JSType.Bool,true],["maxFileSize",JSType.Int,25000],["maxFileSizeMsg",JSType.String,""],["uploadForbiddenMessage",JSType.String,""],["allowedTypesMessage",JSType.String,""],["isAzure",JSType.Bool,false],["sizeCheckerHandlerUrl",JSType.String,""],["uniqueId",JSType.String,""]];PXFileUpload.events={$initialize:0,$fileUploaded:1};PXFileUpload.prototype.fireEvent=function(id,ev,$d){return this.events.fireEvent(id,ev,$d);};PXFileUpload.prototype.checkFileType=function($e){if(this.allowedFileTypes==null||this.allowedFileTypes=="")return false;var $f=this.allowedFileTypes.split(";");$e=$e.toLowerCase();var $g=$e.lastIndexOf(".");if($g==-1)return false;var $h=$e.substr($g);for(i=0;i<$f.length;i++)if($h==$f[i])return true;return false;};PXFileUpload.prototype.reset=function(){var $i=__doc(this).createElement('input');$i.type="file";$i.style.width=this.uploadElem.style.width;$i.size=this.uploadElem.size;$i.id=this.uploadElem.id;$i.name=this.uploadElem.name;if(this.allowedFileTypes){$i.setAttribute("accept",this.allowedFileTypes.split(';').join(','));};__px(this).removeEventHandler(this.uploadElem,"blur",PXFileUpload.onUploadBlur);__px(this).removeEventHandler(this.uploadElem,"change",PXFileUpload.onUploadBlur);__px(this).addEventHandler($i,"blur",PXFileUpload.onUploadBlur);__px(this).addEventHandler($i,"change",PXFileUpload.onUploadChange);var parent=__px(this).IsIE?this.uploadElem.parentElement:this.uploadElem.parentNode;parent.insertBefore($i,this.uploadElem);parent.removeChild(this.uploadElem);delete this.uploadElem;this.uploadElem=$i;this.imageLoading.style.display="none";};PXFileUpload.prototype.onSubmit=function(e){if(this.allowPostEmpty||this.element.offsetParent!=null&&this.element.offsetWidth>0&&this.uploadElem.value!=""){this.uniqueId=new Date().getTime();this.hiddenInput=__doc(this).createElement("input");this.hiddenInput.setAttribute("type","hidden");this.hiddenInput.setAttribute("name","FileUniqueKey");this.hiddenInput.setAttribute("id","FileUniqueKey");this.element.appendChild(this.hiddenInput);this.hiddenInput.setAttribute("value",this.uniqueId);var $j=this.postToHiddenFrame();var $k=this.callbackTargetID==""||this.callbackTargetID==null?__px_all(this)[this.ID]:__px_all(this)[this.callbackTargetID];return $j;}};PXFileUpload.prototype.postToHiddenFrame=function(){if(!this.ajaxBehavior)return false;var id="fileUpload_"+this.ID,$l="fileUpload_div_"+this.ID;var $m="<iframe style='display:none' src='about:blank' suppressCallbacks='true' id='"+id+"' name='"+id+"' ></iframe>";if(__px(this).IsSafari)this.safariLoad=true;var $n=__doc(this).getElementById($l);if($n)$n.innerHTML=$m;else{var $o=__doc(this).createElement('DIV');$o.id=$l;$o.innerHTML=$m;__doc(this).body.appendChild($o);};var $p=__doc(this).forms[0];$p.setAttribute('target',id);if($p.action&&$p.action.indexOf("fileupload")<0){var ip=$p.action.indexOf("?");this.srcAction=$p.action;$p.action+=(ip>0?"&":"?")+"fileupload=1"};var $q=__px(this).elemByID(id),$r=$q.contentWindow;__px(this).addEventHandler($q,"load",Function.createDelegate(this,this.hiddenFrameLoaded));$r.suppressChanges=true;$r.suppressCallbacks=true;this.imageLoading.style.display="";return true;};PXFileUpload.prototype.checkForLink=function(){var $s=__px(this).elemByID(this.ID+"_txt");if(!__px(this).IsIE){$s.value=this.uploadElem.value;return;};$s.value=this.uploadElem.value;if($s.value.indexOf('/')!=-1)this.reset();};PXFileUpload.prototype.sendCallback=function($t,$u){if(!$t.sizeCheckerHandlerUrl||$t.sizeCheckerHandlerUrl=="")return;var $v=__px(this).IsIE?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();$v.open("GET",$t.sizeCheckerHandlerUrl+"?FileUploadId="+$t.uniqueId,true);$v.onreadystatechange=function(){if($v.readyState==4){if($v.responseText=="0"){if(__win(this).stop)__win(this).stop();else __win(this).document.execCommand('Stop');alert($t.maxFileSizeMsg);};if($t.hiddenInput){$t.element.removeChild($t.hiddenInput);delete $t.hiddenInput;}}};$v.send(null);};PXFileUpload.onUploadBlur=function(e){var $w=__px(this).eventObject(e,PXFileUpload);if($w.submitButton==null)$w.checkForLink();};PXFileUpload.onUploadChange=function(e){var $x=__px(this).eventObject(e,PXFileUpload);if($x.checkFileType($x.uploadElem.value)==false){if($x.allowedFileTypes==null||$x.allowedFileTypes=="")alert($x.uploadForbiddenMessage);else alert($x.allowedTypesMessage);$x.reset();};var $y=this.files[0];if($y.size>$x.maxFileSize*1000){alert($x.maxFileSizeMsg);$x.reset();return;};if(__px(this).IsIE)return;var $s=__px(this).elemByID($x.ID+"_txt");$s.value=this.value;};PXFileUpload.prototype.hiddenFrameLoaded=function(){var $z="fileUpload_"+this.ID;var $q=__doc(this).getElementById($z);var $p=__doc(this).forms[0];$p.removeAttribute('target');$p.__EVENTTARGET.value=$p.__EVENTARGUMENT.value="";if(this.srcAction){$p.action=this.srcAction;delete this.srcAction;};$q.contentWindow.suppressChanges=true;$q.contentWindow.suppressCallbacks=true;var $A=($q.contentWindow.uploadErr!=null);if($A)alert($q.contentWindow.uploadErr);setTimeout(function(){$q.contentWindow.__doPostBack=function(){};$q.parentNode.removeChild($q);delete $q;},0);var ar=this.uploadElem.value.split('\\');var $d=new Object();$d.fileName=ar[ar.length-1];$d.hasError=$A;this.reset();this.fireEvent("fileUploaded",null,$d);};



function PXUploadDialog($a,$b,$c,$d){PXUploadDialog.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXUploadDialog.properties);if(this.elemContent){var $e=this.elemContent.rows;this.radioFile=__px(this).elemByID($b.id+"_rdFile");this.radioLink=__px(this).elemByID($b.id+"_rdLink");if(this.renderLink)this.uploaderId=$e[1].cells[1].childNodes[0].id;else this.uploaderId=$e[0].cells[1].childNodes[0].id;if(this.renderLink)this.edtLink=$e[2].cells[1].childNodes[0];if(this.renderComment)this.edtCommentId=$b.id+"_edtComment";var $f=null;if(this.renderLink&&this.renderComment)$f=4;else if(!this.renderLink&&this.renderComment)$f=2;else if(this.renderLink&&!this.renderComment)$f=3;else $f=1;var $g=Array.prototype.slice.call(this.elemContent.querySelectorAll('button'),-2);if($g.length>1){this.btnUpload=$g[0];this.btnClose=$g[1];};var $h=Function.createDelegate(this,this.$x);var $i=Function.createDelegate(this,this.$y);var $j=Function.createDelegate(this,this.$z);var $k=Function.createDelegate(this,this.$A);if(this.btnClose)__px(this).addEventHandler(this.btnClose,"click",$h);if(this.btnUpload)__px(this).addEventHandler(this.btnUpload,"click",$i);if(this.radioFile)__px(this).addEventHandler(this.radioFile,"click",$j);if(this.radioLink)__px(this).addEventHandler(this.radioLink,"click",$k);if(this.btnClose&&this.radioFile)this.radioFile.checked=true;if(this.radioLink)this.radioLink.checked=false;this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onLoad));};var $l=function($m,$n){if($m&&$n){for(var i in $n){$m[i]=$n[i];}};return $m;};var $o=$l($l({},$c.clientEvents),$c.uploadEvents);this.events.appendEvents(PXUploadDialog.events,$o);};PXUploadDialog.__baseType=PXSmartPanel;PXUploadDialog.properties=[["postbackTargetID",JSType.String,""],["renderLink",JSType.Bool,true],["renderComment",JSType.Bool,true],["renderLinkTextBox",JSType.Bool,false],["uploadCallBack",JSType.Object,PXCallbackManager.settingsDesc]];PXUploadDialog.events={$hideAfterUpload:9};PXUploadDialog.prototype.onLoad=function(){if(this.btnUpload){this.initUploader();var h=Function.createDelegate(this,this.$B);this.events.addEventHandler("afterResize",h);PXUploadDialog.callBase(this,"onLoad");}};PXUploadDialog.prototype.initUploader=function(){this.uploader=__px_all(this)[this.uploaderId];if(this.uploader==null){this.uploader=__px_cm(this).createControl("PXFileUpload",this.uploaderId);__px_all(this)[this.uploaderId]=this.uploader;};if(this.uploader!=null){var h=Function.createDelegate(this,this.$C);this.uploader.events.addEventHandler("fileUploaded",h);}};PXUploadDialog.prototype.show=function($p){PXUploadDialog.callBase(this,"show",[$p]);};PXUploadDialog.prototype.$x=function(){this.uploader=__px_all(this)[this.uploaderId];__px_all(this)[this.edtCommentId].setValue("");this.uploader.reset();};PXUploadDialog.prototype.$C=function($q,ev){var cs=this.uploadCallBack;if(cs&&cs.enabled)__px_callback(this).exec(this,cs);var $r=this.callbackContext;if($r){$r.info.dialogResult=PXDialogResult.OK;__px_callback(this).execI(__px_all(this)[$r.controlID],$r.info,$r.data,$r.handler,$r.context,$r.popupCommand);delete this.callbackContext;};__win(this).suppressChanges=this.changesFlag;this.hide();var $s=new Object();$s.hasError=ev.hasError;$s.fileName=ev.fileName;if(this.radioLink&&this.radioLink.checked){var ar=this.edtLink.value.split('\\');$s.fileName=ar[ar.length-1];};this.fireEvent("hideAfterUpload",null,$s);if(this.edtCommentId)__px_all(this)[this.edtCommentId].setValue("");if(this.edtLink)this.edtLink.value="";};PXUploadDialog.prototype.$y=function($q,e){var $t=__px_all(this)[this.uploaderId];this.changesFlag=__win(this).suppressChanges;__win(this).suppressChanges=true;if(this.edtLink!=null&&this.edtLink.value!="")$t.allowPostEmpty=true;if(((this.radioFile&&this.radioFile.checked)||(this.edtLink&&this.edtLink.parentNode.parentNode.style.display=="none"))&&(!$t.uploadElem.value||$t.uploadElem.value==""))return;if(this.postbackTargetID!=""&&this.postbackTargetID!=null)__px(this).doPostNoDisabledReset(__px_all(this)[this.postbackTargetID].element.getAttribute("name"),"uploadFinished$"+this.ID);else __px(this).doPostNoDisabledReset(this.btnUpload.getAttribute("name"),"click");};PXUploadDialog.prototype.$z=function($q,e){this.radioFile.checked=true;this.radioLink.checked=false;this.uploader.element.parentNode.parentNode.style.display="";this.edtLink.parentNode.parentNode.style.display="none";};PXUploadDialog.prototype.$A=function($q,e){this.radioFile.checked=false;this.radioLink.checked=true;this.uploader.element.parentNode.parentNode.style.display="none";this.edtLink.parentNode.parentNode.style.display="";};PXUploadDialog.prototype.$B=function(){};function PXUploadFilePanel($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c,PXUploadFilePanel.properties);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.uploadPanelID=this.ID+"_"+this.panelID;this.uploaderID=this.uploadPanelID+"_fldImportSource";this.uploadButtonID=this.uploadPanelID+"_btnUpload";};PXUploadFilePanel.properties=[["panelID",JSType.String,""],["importAction",JSType.String,""],["dataSourceID",JSType.String,""]];PXUploadFilePanel.prototype.onLoad=function(){var $u=__px_all(this),me=this,$v=$u[this.uploaderID];if($v){$v.events.addEventHandler("fileUploaded",function($m,$s){__px(me).restoreDisabledState();$u[me.uploadPanelID].hide();if(!$s.hasError)$u[me.dataSourceID].executeCallback(me.importAction);});};var $w=$u[this.uploadButtonID];if($w){$w.events.addEventHandler("mouseUp",function(){if($u[me.uploaderID].uploadElem.value)__px(me).doPost($w.element.getAttribute("name"),"click");});}};



function PXWikiShow($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c,PXWikiShow.properties);__px_cm(this).registerAutoSize(this,$c);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.callbacks=new Array();this.callbacks[0]=__px_callback(this).copyCommand("Refresh",this.callBackMode);this.callbacks[1]=__px_callback(this).copyCommand("ShowEditor",this.callBackMode);this.callbacks[2]=__px_callback(this).copyCommand("SaveSection",this.callBackMode);this.callbacks[3]=__px_callback(this).copyCommand("CheckServer",this.callBackMode);this.viewState=new PXStateBag(this,"PXWikiShow");this.elemDivContent=__px(this).elemByID(this.ID+"_divContent");this.elemInformer=__px(this).elemByID(this.ID+"_PopupInformer");this.elemInformer.scrollHandler=Function.createDelegate(this,this.handleScrollForInformer);this.addClickHandlers();this.elemInformer.parentNode.removeChild(this.elemInformer);var $d=__win(this).theForm?__win(this).theForm:__doc(this).body;$d.appendChild(this.elemInformer);h=Function.createDelegate(this,this.$0A);__px(this).addEventHandler($b,"mousedown",h);};PXWikiShow.properties=[["bindingContainer",JSType.String,""],["labelID",JSType.String,""],["callBackMode",JSType.Object,PXCallbackManager.commandDesc],["spinnerUrl",JSType.String,""],["collapseUrl",JSType.String,""],["expandUrl",JSType.String,""],["closeUrl",JSType.String,""],["closeImgAlt",JSType.String,""],["cancelEditMsg",JSType.String,""]];PXWikiShow.callbackProps=[["parsedContent",JSType.String,"","setValue"]];PXWikiShow.prototype.onLoad=function(){this.initFileList();};PXWikiShow.prototype.initFileList=function(){var $e=this.ID+"_flst";var $f=__px(this).elemsByName("FileList",true);var $b=__px(this).elemByID($e);if($b&&$f.length>0){$f[0].appendChild($b);$b.style.display="";};__win(this)["_"+$e]=new Object();this.flist=__px_cm(this).createControl("PXFileList",$e,$e);};PXWikiShow.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXWikiShow.callbackProps);};PXWikiShow.prototype.setValue=function(v){if(this.flist){this.flist.element.style.display="none";__doc(this).forms[0].appendChild(this.flist.element);};this.elemDivContent.innerHTML=v;if(this.flist){var $f=__px(this).elemsByName("FileList",true);if($f.length>0){$f[0].appendChild(this.flist.element);this.flist.element.style.display="";}};this.addClickHandlers();};PXWikiShow.prototype.setHeight=function($g){var h=parseInt($g);this.element.style.height=__px(this).getStyleHeight(this.element,h)+"px";};PXWikiShow.prototype.setWidth=function($h){var w=parseInt($h);this.element.style.width=w+"px";};PXWikiShow.prototype.addClickHandlers=function(){var $i=__px(this).elemsByName("expandableSection"+this.ID,true);var $j=__px(this).elemsByName("clickableImage"+this.ID,true);var $k=__px(this).elemsByName("clickableLink"+this.ID,true);var $l=__px(this).elemsByName("clickableImageMagnify"+this.ID,true);var $m=__px(this).elemsByName("sectionEditLink"+this.ID,true);var $n=__px(this).elemsByName("hiddenText"+this.ID,true);var $o=__px(this).elemsByName("tocHideShow"+this.ID,true);var $p=__px(this).elemsByName("wikiImage"+this.ID,true);if($i!=null){for(var i=0;i<$i.length;i++)__px(this).addEventHandler($i[i],"click",PXWikiShow.handleSectionClick);};if($j!=null){for(var i=0;i<$j.length;i++)__px(this).addEventHandler($j[i],"click",Function.createDelegate(this,this.handlePopupImageClick));};if($k!=null){for(var i=0;i<$k.length;i++)__px(this).addEventHandler($k[i],"click",Function.createDelegate(this,this.handlePopupLinkClick));};if($l!=null){for(var i=0;i<$l.length;i++)__px(this).addEventHandler($l[i],"click",Function.createDelegate(this,this.handleMagnifyImageClick));};if($m!=null){for(var i=0;i<$m.length;i++)__px(this).addEventHandler($m[i],"click",Function.createDelegate(this,PXWikiShow.handleStartEdit));};if($n!=null){for(var i=0;i<$n.length;i++){$n[i].childNodes[0].src=this.expandUrl;__px(this).addEventHandler($n[i],"click",Function.createDelegate(this,this.handleHiddenTextClick));}};if($o!=null){for(var i=0;i<$o.length;i++)__px(this).addEventHandler($o[i],"click",PXWikiShow.handleTocHideShow);};if($p!=null){for(var i=0;i<$p.length;i++){__px(this).addEventHandler($p[i],"mouseover",Function.createDelegate(this,this.handleImageOver));__px(this).addEventHandler($p[i],"mouseout",Function.createDelegate(this,this.handleImageOut));}};__px(this).addEventHandler(this.elemInformer,"mouseover",Function.createDelegate(this,this.handleInformerOver));__px(this).addEventHandler(this.elemInformer,"mouseout",Function.createDelegate(this,this.handleInformerOut));this.imageLinks=$j;};PXWikiShow.handleSectionClick=function(e){var $b=__px(this).eventElem(e).nextSibling;if($b==null)return;if($b.tagName.toLowerCase()!="div")$b=$b.nextSibling;if($b==null||$b.style==null||$b.tagName.toLowerCase()!="div")return;if(this.editorOpen==true&&$b==this.currentSectionEditing)return;if($b.style['display']=='none')$b.style['display']='';else $b.style['display']='none';};PXWikiShow.handleTocHideShow=function(e){var $q=__px(this).eventElem(e);var tr=$q.parentNode.parentNode.parentNode.parentNode;var $r=tr.nextSibling.childNodes[0].childNodes[0];if($r.style['display']=='none')$r.style['display']='';else $r.style['display']='none';};PXWikiShow.prototype.$0A=function(e){var se=__px(this).eventElem(e);var $s=__px(this).eventObject(e);if(se&&se.tagName=='A'&&e.type=="mousedown"&&!e.altKey&&$s==this){__px(this).cancelEvent(e,false);}};PXWikiShow.prototype.handleHiddenTextClick=function(e){var $t=__px(this).eventElem(e);while($t!=null&&$t.tagName.toLowerCase()!="span")$t=$t.parentNode;if($t==null)return;var $b=$t.nextSibling;var $u=$t.childNodes[0];while($b!=null&&($b.tagName==null||$b.tagName.toLowerCase()!="div"))$b=$b.nextSibling;if($b==null)return;if($b.style['display']=='none'){$b.style['display']='';__px_cm(this).repaintImage($u,this.collapseUrl);}else{$b.style['display']='none';__px_cm(this).repaintImage($u,this.expandUrl);}};PXWikiShow.prototype.handleImageOver=function(e){var $u=__px(this).eventElem(e);var $v=$u.getAttribute("editurl");this.elemInformer.isOver=true;this.showDynamicEdit($u,$v);};PXWikiShow.prototype.handleImageOut=function(e){var me=this;this.elemInformer.isOver=false;setTimeout(function(){me.hideDynamicEdit();},2000);};PXWikiShow.prototype.handleInformerOver=function(e){this.elemInformer.isOver=true;};PXWikiShow.prototype.handleInformerOut=function(e){var me=this;this.elemInformer.isOver=false;setTimeout(function(){me.hideDynamicEdit();},2000);};PXWikiShow.prototype.showDynamicEdit=function($u,$v){var is=this.elemInformer.style,$w=this.elemInformer.childNodes[0];is.display="none";$w.href=$v;this.elemInformer.currentElem=$u;is.left=is.top="-99px";is.display="";this.positionDynamicEdit();__px(this).addEventHandler(this.element,"scroll",this.elemInformer.scrollHandler);};PXWikiShow.prototype.hideDynamicEdit=function($x){if(!this.elemInformer.isOver||$x){this.elemInformer.style.display="none";__px(this).removeEventHandler(this.element,"scroll",this.elemInformer.scrollHandler);}};PXWikiShow.prototype.handleScrollForInformer=function(e){this.positionDynamicEdit();};PXWikiShow.prototype.positionDynamicEdit=function(){var $u=this.elemInformer.currentElem;var $y=this.getY($u)-this.element.scrollTop;var $z=this.getY(this.element);var $A=this.getX($u)+$u.width-this.element.scrollLeft;$y=$y<$z?$z:$y;$A=$A+this.elemInformer.clientWidth>=this.element.clientWidth?this.element.clientWidth-this.elemInformer.clientWidth-5:$A;this.elemInformer.style.left=$A+"px";this.elemInformer.style.top=$y+"px";if($y>=$z+this.element.clientHeight)this.hideDynamicEdit(true);};PXWikiShow.prototype.getY=function(e){return this.getAbsolutePos(e,false);};PXWikiShow.prototype.getX=function(e){return this.getAbsolutePos(e,true);};PXWikiShow.prototype.getAbsolutePos=function(e,$B){var $C=0;while(e!=null&&e.tagName!="BODY"&&e.tagName!="HTML"){$C+=$B?e.offsetLeft:e.offsetTop;e=e.offsetParent;};return $C;};PXWikiShow.prototype.handlePopupImageClick=function(e){var $b=__px(this).eventElem(e),po=this.getPopupObject();var $D=$b,$E,$F,$G=false;if($b.childNodes!=null&&$b.childNodes[0]!=null&&$b.childNodes[0].id=="Video"){$D=$b.parentNode.parentNode.parentNode;$E=$b.getAttribute('frWidth');$F=$b.getAttribute('frHeight');$G=true;}else if($b.id=="Video"){$D=$b.parentNode.parentNode.parentNode.parentNode;$E=$b.parentNode.getAttribute('frWidth');$F=$b.parentNode.getAttribute('frHeight');$G=true;};this.hideDynamicEdit(true);po.setParameters($D,$G,$E,$F);po.showImage($D.parentNode.href);__px(this).cancelEvent(e);};PXWikiShow.prototype.handlePopupLinkClick=function(e){var $b=__px(this).eventElem(e),po=this.getPopupObject();var $D=$b,$E,$F,$G=true;while($D.tagName.toLowerCase()!='a')$D=$D.parentNode;$E=$D.parentNode.getAttribute('frWidth');$F=$D.parentNode.getAttribute('frHeight');this.hideDynamicEdit(true);po.setParameters($D,$G,$E,$F);po.showImage($D.href);__px(this).cancelEvent(e);};PXWikiShow.prototype.handleMagnifyImageClick=function(e){var $b=__px(this).eventElem(e).parentNode.parentNode.parentNode.previousSibling.childNodes[0];var po=this.getPopupObject(),$G=($b.id=="VideoTable")?true:false;po.setParameters($b,$G);po.showImage($b.parentNode.href);__px(this).cancelEvent(e);};PXWikiShow.prototype.getPopupObject=function(){if(this.popupObject==null)this.popupObject=new PXPopupImage(this,this.spinnerUrl,this.closeUrl);return this.popupObject;};PXWikiShow.handleStartEdit=function(e){var $H=__px(this).eventElem(e);if(!$H.getAttribute)return;this.showEditor($H.getAttribute("sectionForEdit"),$H);};PXWikiShow.getSectionDiv=function($I){return __px($I).IsIE?$I.nextSibling.nextSibling:$I.nextSibling.nextSibling.nextSibling;};function PXPopupImage($J,$K,$L){this.px_context=$J.px_context;this.owner=$J;this.spinnerUrl=$K;this.closeUrl=$L;this.allowNavigation=true;this.initImagesProcessing();};PXPopupImage.prototype.initImagesProcessing=function(){this.shadowDiv=null;this.image=null;this.path=null;this.picDiv=null;this.frWidth=640;this.frHeight=480;this.resizeImageHandler=Function.createDelegate(this,this.onWindowResize);this.keyPressImageHandler=Function.createDelegate(this,this.onKeyPress);this.clickImageHandler=Function.createDelegate(this,this.hideImage);this.loadImageHandler=Function.createDelegate(this,this.onImageLoad);this.nextClickHandler=Function.createDelegate(this,this.onNextClicked);this.prevClickHandler=Function.createDelegate(this,this.onPrevClicked);this.loadImageFromNavHandler=Function.createDelegate(this,this.onImageFromNavigationLoaded);};PXPopupImage.prototype.setParameters=function($D,$G,$E,$F){this.currentThumbnail=$D;this.currentThumbnail.X=__px(this).getElemLeftPos($D);this.currentThumbnail.Y=__px(this).getElemTopPos($D);this.title=$D.getAttribute("tooltip");if(this.title==null)this.title=$D.getAttribute("alt");this.isVideo=$G;if($E!=null)this.frWidth=$E;if($F!=null)this.frHeight=$F;};PXPopupImage.prototype.createSpinner=function(){if(this.spinner)return;this.spinner=__doc(this).createElement('div');var $u=__doc(this).createElement('img');$u.id=$u.name="spinner";$u.src=this.spinnerUrl;this.spinner.style.position="absolute";this.spinner.style.zIndex=11000;this.spinner.style.width=this.spinner.style.height="32px";this.spinner.style.display="none";this.spinner.style.backgroundColor="#FFFFFF";this.spinner.appendChild($u);var $d=__win(this).theForm?__win(this).theForm:__doc(this).body;$d.appendChild(this.spinner);};PXPopupImage.prototype.showImage=function($M){this.createSpinner();this.path=$M;this.shadowDiv=this.getShadowDiv();this.layoutImage();__px(this).addEventHandler(__win(this),"resize",this.resizeImageHandler);__px(this).addEventHandler(__doc(this).documentElement,"keydown",this.keyPressImageHandler);__px(this).addEventHandler(this.shadowDiv,"click",this.clickImageHandler);__px(this).addEventHandler(this.image,"load",this.loadImageHandler);__px(this).addEventHandler(this.image,"onload",this.loadImageHandler);__px(this).addEventHandler(this.image,"click",this.clickImageHandler);if(this.owner&&this.owner.executeCommand&&typeof this.owner.executeCommand=="function")this.owner.executeCommand("CheckServer");};PXPopupImage.prototype.layoutImage=function(){this.layoutShadowElement();this.layoutImageElement();};PXPopupImage.prototype.onWindowResize=function(){this.getPicture();var $N=__doc(this).documentElement.clientWidth;var $O=__doc(this).documentElement.clientHeight;var $P=__px(this).IsSafari?__win(this).pageXOffset:__doc(this).documentElement.scrollLeft;var $Q=__px(this).IsSafari?__win(this).pageYOffset:__doc(this).documentElement.scrollTop;this.layoutShadowElement();this.picDiv.curW=this.picDiv.curW==null?0:this.picDiv.curW;this.picDiv.curH=this.picDiv.curH==null?0:this.picDiv.curH;this.picDiv.style.left=($N/ 2- this.picDiv.curW/ 2+$P)+"px";this.picDiv.style.top=($O/ 2- this.picDiv.curH/ 2+$Q)+"px";};PXPopupImage.prototype.hideImage=function(){var $R=this.getShadowDiv();var $S=this.getPicture();var $N=__doc(this).documentElement.clientWidth;var $O=__doc(this).documentElement.clientHeight;var $P=__px(this).IsSafari?__win(this).pageXOffset:__doc(this).documentElement.scrollLeft;var $Q=__px(this).IsSafari?__win(this).pageYOffset:__doc(this).documentElement.scrollTop;$R.style.display="none";this.spinner.style.display="none";$S.style.display="none";$S.style.top=$O/2-16+$Q;$S.style.left=$N/2-16+$P;this.isVideo=false;__doc(this).documentElement.style.overflow=this.documentOverflow;__px(this).removeEventHandler(__doc(this).documentElement,"keydown",this.keyPressImageHandler);__px(this).removeEventHandler(__win(this),"resize",this.resizeImageHandler);};PXPopupImage.prototype.layoutShadowElement=function(){var $R=this.getShadowDiv();var $T=__doc(this).documentElement;var $U=$T.scrollWidth-$T.clientWidth;var $V=$T.scrollHeight-$T.clientHeight;if(__px(this).IsOpera){$U-=100;$V-=100;};$R.style.width=$R.style.height="0px";$R.style.display="";$R.style.width="100%";if($V>0)$R.style.height=($T.clientHeight+$V)+"px";else $R.style.height=$T.clientHeight+"px";};PXPopupImage.prototype.layoutImageElement=function(){var $N=__doc(this).documentElement.clientWidth;var $O=__doc(this).documentElement.clientHeight;var $P=__px(this).IsSafari?__win(this).pageXOffset:__doc(this).documentElement.scrollLeft;var $Q=__px(this).IsSafari?__win(this).pageYOffset:__doc(this).documentElement.scrollTop;this.spinner.style.left=$N/2-16+$P+"px";this.spinner.style.top=$O/2-16+$Q+"px";this.getPicture();if(__px(this).IsOpera){this.picDiv.style.top="0px";this.picDiv.style.left="0px";this.picDiv.style.display="";};if(__px(this).IsIE&&this.image.complete)this.spinner.style.display="none";this.picDiv.width=this.spinner.width;this.picDiv.height=this.spinner.height;this.picDiv.style.display="none";if(this.spinner.style.display=="none"){this.picDiv.width=parseInt(this.image.width);this.picDiv.height=parseInt(this.image.height);this.animateImagePopup(this.image,$N,$O,$P,$Q);}};PXPopupImage.prototype.fitSize=function(w,h,$W,$X){var $Y=1;var nw=w;var nh=h;var $Z=$W-this.picDiv.innerOffset*2;var $00=$X-this.picDiv.innerOffset*2;var wc=$Z/nw;var wh=$00/nh;if((wh>1)&&(wc>1)){this.picDiv.targetWidth=nw;this.picDiv.targetHeight=nh;}else{if(wh>wc){this.picDiv.targetWidth=$Z;this.picDiv.targetHeight=Math.round(nh*wc);}else{this.picDiv.targetWidth=Math.round(nw*wh);this.picDiv.targetHeight=$00;}}};PXPopupImage.prototype.animateImagePopup=function($01,$N,$O,$P,$Q){var me=this;var $02=15;var $03=100/$02;var $04=0;this.picDiv.opacity=0;this.picDiv.style.opacity=this.picDiv.opacity;this.picDiv.style.filter="alpha(opacity="+(this.picDiv.opacity*100)+")";this.documentOverflow=__doc(this).documentElement.style.overflow;this.picDiv.style.visibility="hidden";this.picDiv.style.left=this.picDiv.style.top="-1000px";this.picDiv.style.display="";$01.style.display="";$01.realWidth=$01.realWidth?$01.realWidth:$01.width;$01.realHeight=$01.realHeight?$01.realHeight:$01.height;this.fitSize(parseInt($01.realWidth),parseInt($01.realHeight),$N,$O);this.picDiv.targetX=$N/ 2- this.picDiv.targetWidth/ 2+$P-this.picDiv.innerOffset;this.picDiv.targetY=$O/ 2- this.picDiv.targetHeight/ 2+$Q-this.picDiv.innerOffset;$01.style.display="none";this.picDiv.style.display="none";this.picDiv.style.visibility="";this.picDiv.startW=this.picDiv.curW=parseInt(this.currentThumbnail.offsetWidth);this.picDiv.startH=this.picDiv.curH=parseInt(this.currentThumbnail.offsetHeight);this.picDiv.startX=this.picDiv.curX=this.currentThumbnail.X;this.picDiv.startY=this.picDiv.curY=this.currentThumbnail.Y;$01.style.width=this.picDiv.curW+"px";$01.style.height=this.picDiv.curH+"px";this.picDiv.style.left=this.picDiv.curX+"px";this.picDiv.style.top=this.picDiv.curY+"px";this.picDiv.style.display=$01.style.display="";setTimeout(function(){me.expandImage($01,$03,$04);},5);};PXPopupImage.prototype.expandImage=function($01,$03,$04){var me=this;this.picDiv.curW=this.cubicInOut($04,this.picDiv.startW,this.picDiv.targetWidth-this.picDiv.startW,15);this.picDiv.curH=this.cubicInOut($04,this.picDiv.startH,this.picDiv.targetHeight-this.picDiv.startH,15);this.picDiv.curX=this.cubicInOut($04,this.picDiv.startX,this.picDiv.targetX-this.picDiv.startX,15);this.picDiv.curY=this.cubicInOut($04,this.picDiv.startY,this.picDiv.targetY-this.picDiv.startY,15);this.picDiv.opacity=this.picDiv.opacity+$03;$01.style.width=this.picDiv.curW+"px";$01.style.height=this.picDiv.curH+"px";this.picDiv.style.left=this.picDiv.curX+"px";this.picDiv.style.top=this.picDiv.curY+"px";this.picDiv.style.opacity=this.picDiv.opacity/100;this.picDiv.style.filter="alpha(opacity="+(this.picDiv.opacity)+")";$04++;if((this.picDiv.curW>=this.picDiv.targetWidth||this.picDiv.curH>=this.picDiv.targetHeight)&&(this.picDiv.startX<this.picDiv.targetX&&this.picDiv.curX>=this.picDiv.targetX||this.picDiv.startX>=this.picDiv.targetX&&this.picDiv.curX<=this.picDiv.targetX||this.picDiv.startY<this.picDiv.targetY&&this.picDiv.curY>=this.picDiv.targetY||this.picDiv.startY>=this.picDiv.targetY&&this.picDiv.curY<=this.picDiv.targetY)){this.picDiv.style.opacity=1;this.picDiv.style.filter="alpha(opacity=100)";this.captionSpan.innerHTML=this.title;this.captionSpan.style.visibility=this.title?"":"hidden";}else setTimeout(function(){me.expandImage($01,$03,$04);},5);};PXPopupImage.prototype.cubicInOut=function(t,b,c,d){if((t/= d/ 2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;};PXPopupImage.prototype.getShadowDiv=function(){if(this.shadowDiv==null){var $05=70;this.shadowDiv=__doc(this).createElement("DIV"),ds=this.shadowDiv.style;ds.zIndex=9000;ds.position="absolute";ds.top=ds.left="0px";ds.width=ds.height="0px";ds.display="none";ds.backgroundColor='#000000';ds.opacity=$05/100;ds.filter="alpha(opacity="+$05+")";var $d=__win(this).theForm?__win(this).theForm:__doc(this).body;$d.appendChild(this.shadowDiv);};return this.shadowDiv;};PXPopupImage.prototype.getPicture=function(){if(this.picDiv==null){var $r=__doc(this).createElement('div');var $06=__doc(this).createElement('div');$r.name=$r.id='picDiv'+this.owner.ID;$r.style.zIndex=10000;$r.style.position="absolute";$r.style.display="none";$r.style.textAlign="center";$r.style.verticalAlign="middle";$r.style.backgroundColor="#ffffff";$06.style.zIndex=9500;$06.style.position="absolute";$06.style.top=$06.style.left="0px";$06.style.width=$06.style.height="0px";var $d=__win(this).theForm?__win(this).theForm:__doc(this).body;$d.appendChild($06);$06.appendChild($r);this.createInnerDivContent($r);this.picDiv=$r;};if(this.image.path!=this.path)this.image=this.createImage(this.picDiv.childNodes[1],this.path);if(this.image.tagName.toLowerCase()=='iframe'){this.image.width=this.frWidth;this.image.height=this.frHeight;};return this.picDiv;};PXPopupImage.prototype.createInnerDivContent=function($07){$07.innerOffset=20;this.createCaption($07);$r=__doc(this).createElement('div');$r.style.paddingRight=$r.style.paddingLeft=$r.style.paddingBottom=$07.innerOffset+"px";$07.appendChild($r);this.image=this.createImage($r,this.path);if(this.allowNavigation)this.createNavigationButtons($07);};PXPopupImage.prototype.createCaption=function($07){var $08=__doc(this).createElement('table');var tr=__doc(this).createElement('tr');var $09=__doc(this).createElement('td');var $0a=__doc(this).createElement('td');this.captionSpan=__doc(this).createElement('span');$08.cellSpacing=$08.cellPadding="0";$08.style.backgroundColor="white";$08.style.height=$07.innerOffset+"px";$09.setAttribute("class","PopupImgCaption");$0a.setAttribute("class","PopupImgClose");this.captionSpan.setAttribute("class","PopupImgCaption");this.captionSpan.innerHTML=this.title;this.captionSpan.style.visibility=this.title?"":"hidden";$09.appendChild(this.captionSpan);var $u=__px_cm(this).createSpriteOrImage($0a,this.closeUrl);$u.style.cursor="pointer";$u.alt=$u.title=this.owner.closeImgAlt;__px(this).addEventHandler($u,"click",this.clickImageHandler);tr.appendChild($09);tr.appendChild($0a);$08.appendChild(tr);$07.appendChild($08);};PXPopupImage.prototype.createNavigationButtons=function($07){var $08=__doc(this).createElement('table');var tr=__doc(this).createElement('tr');var $09=__doc(this).createElement('td');var $0a=__doc(this).createElement('td');$08.cellSpacing="0";$08.cellPadding="0";$08.style.height=($07.innerOffset-5)+"px";$08.style.paddingRight="2px";$08.style.paddingBottom="5px";$08.style.width="100%";$09.style.width="50%";$09.style.textAlign="right";$09.style.paddingRight="4px";$0a.style.width="50%";$0a.style.paddingLeft="3px";$0a.style.textAlign="left";var $t=__doc(this).createElement('span');$t.innerHTML="&larr; Ctrl";$t.setAttribute("class","PrevNextPopupImg");__px(this).addEventHandler($t,"click",this.prevClickHandler);$09.appendChild($t);$t=__doc(this).createElement('span');$t.innerHTML="Ctrl &rarr;";$t.setAttribute("class","PrevNextPopupImg");__px(this).addEventHandler($t,"click",this.nextClickHandler);$0a.appendChild($t);tr.appendChild($09);tr.appendChild($0a);$08.appendChild(tr);$07.appendChild($08);};PXPopupImage.prototype.createImage=function($r,$M){var $01=this.isVideo?this.createImageVideo($r,$M):this.createImagePicture($M);$01.style.display="none";this.spinner.style.display="";$r.appendChild($01);return $01;};PXPopupImage.prototype.createImagePicture=function($M,$0b){var $01=__doc(this).getElementById('picImage'+this.owner.ID);if($01!=null&&!$0b)$01.parentNode.removeChild($01);$01=__doc(this).createElement('img');$01.name=$01.id='picImage'+this.owner.ID;$01.src=$01.path=$M;return $01;};PXPopupImage.prototype.createImageVideo=function($r,$M){var $0c=__doc(this).getElementById('frVideo'+this.owner.ID);if($0c!=null)$0c.parentNode.removeChild($0c);$0c=__doc(this).createElement("iframe");$0c.name=$0c.id='frVideo'+this.owner.ID;$0c.src=$0c.path=$M;$0c.width=this.frWidth;$0c.height=this.frHeight;$0c.frameBorder="0";$0c.style.borderStyle="none";$0c.style.overflowX=$0c.style.overflowY="hidden";return $0c;};PXPopupImage.prototype.next=function(){var $0d=this.getCurrentImage()+1;if($0d==0)return;if($0d>=this.owner.imageLinks.length)$0d=0;this.showNextPrev($0d);};PXPopupImage.prototype.prev=function(){var $0d=this.getCurrentImage()-1;if($0d==-2)return;if($0d==-1)$0d=this.owner.imageLinks.length-1;this.showNextPrev($0d);};PXPopupImage.prototype.getCurrentImage=function(){var $0d=-1;for(var i=0;i<this.owner.imageLinks.length;i++){if(this.owner.imageLinks[i].href==this.path){$0d=i;break;}};return $0d;};PXPopupImage.prototype.showNextPrev=function($0e){this.path=this.owner.imageLinks[$0e].href;this.spinner.style.display="";this.nextImage=this.createImagePicture(this.path,true);this.title=this.owner.imageLinks[$0e].childNodes[0].getAttribute("tooltip");if(this.owner&&this.owner.executeCommand&&typeof this.owner.executeCommand=="function")this.owner.executeCommand("CheckServer");if(__px(this).IsIE&&this.nextImage.complete)this.onImageFromNavigationLoaded();else{__px(this).addEventHandler(this.nextImage,"load",this.loadImageFromNavHandler);__px(this).addEventHandler(this.nextImage,"onload",this.loadImageFromNavHandler);}};PXPopupImage.prototype.onImageLoad=function(e){this.spinner.style.display="none";__px(this).removeEventHandler(this.image,"load",this.loadImageHandler);__px(this).removeEventHandler(this.image,"onload",this.loadImageHandler);if(this.image.complete==null)this.image.setAttribute("complete",true);this.layoutImage();};PXPopupImage.prototype.onImageFromNavigationLoaded=function(){var parent=this.image.parentNode;parent.removeChild(this.image);parent.appendChild(this.nextImage);this.image=this.nextImage;this.spinner.style.display="none";this.fitSize(parseInt(this.image.width),parseInt(this.image.height),__doc(this).documentElement.clientWidth,__doc(this).documentElement.clientHeight);this.image.style.width=this.picDiv.targetWidth+"px";this.image.style.height=this.picDiv.targetHeight+"px";this.picDiv.curW=this.picDiv.targetWidth+this.picDiv.innerOffset*2;this.picDiv.curH=this.picDiv.targetHeight+this.picDiv.innerOffset*2;this.onWindowResize();this.captionSpan.innerHTML=this.title;this.captionSpan.style.visibility=this.title?"":"hidden";__px(this).addEventHandler(this.image,"click",this.clickImageHandler);__px(this).removeEventHandler(this.image,"load",this.loadImageFromNavHandler);__px(this).removeEventHandler(this.image,"onload",this.loadImageFromNavHandler);if(this.image.complete==null)this.image.setAttribute("complete",true);};PXPopupImage.prototype.onKeyPress=function(e){if(e.keyCode==27){this.hideImage();__px(this).cancelEvent(e);}else if(this.allowNavigation&&e.ctrlKey&&e.keyCode==37)this.onPrevClicked();else if(this.allowNavigation&&e.ctrlKey&&e.keyCode==39)this.onNextClicked();};PXPopupImage.prototype.onNextClicked=function(e){if(this.spinner.style.display=="none")this.next();};PXPopupImage.prototype.onPrevClicked=function(e){if(this.spinner.style.display=="none")this.prev();};PXWikiShow.prototype.executeCallback=function($0f,$0g){this.executeCommand($0f,$0g);};PXWikiShow.prototype.executeCommand=function($0f,$0g){switch($0f){case "Refresh":var $0h=this;var $0i=function($0j,$a){setTimeout(function(){$0h.handleRefresh($0j);},0);};__px_callback(this).execI(this,this.callbacks[0],$0g,$0i,null,null);break;case "CheckServer":__px_callback(this).execI(this,this.callbacks[3]);break;}};PXWikiShow.prototype.showEditor=function($0k,$0l){this.editLinkTop=__px(this).getElemTopPos($0l,this.element);if(this.editorOpen){var $0m=("Sec"+$0k)==this.currentSectionEditing.id;if(!this.confirmCancelEdit())return;this.$0B(false);if($0m)return;};var $0i=Function.createDelegate(this,this.$0C);this.currentSectionEditing=__px(this).elemByID("Sec"+$0k);this.currentSectionEditing.editLinkElem=$0l;this.currentSectionEditing.sectionNum=$0k;this.currentSectionEditing.originSectionHeight=this.currentSectionEditing.offsetHeight;delete this.editor;__px_callback(this).execI(this,this.callbacks[1],$0k,$0i);};PXWikiShow.prototype.showEditorControl=function($0j,$a){if(!this.editor)this.$0D();this.editor.container=this;this.$0B(true);this.$0E();};PXWikiShow.prototype.$0C=function($0j,$a){var $0n=__px_all(this)[$a];if($0j&&$0n){var $r=__px_cm(this).processHtmlData($0j,$0n.$0F());setTimeout(function(){$0n.showEditorControl();},0);}};PXWikiShow.prototype.$0F=function(){var $r=this.$0G=__doc(this).createElement("div");$r.id=this.ID+"_ed_div";$r.style.display="none";$r.style.overflow="auto";var $0o=this.currentSectionEditing;$0o.parentNode.insertBefore($r,$0o);return $r;};PXWikiShow.prototype.$0D=function(){var $0p=this.ID+"_ed";var $e=this.sourceID?(this.sourceID+"_ed"):null;if(!__px_all(this)[$0p]){this.editor=__px_cm(this).createControl("PXWikiEdit",$0p,$e);__px_all(this)[$0p]=this.editor;}else this.editor=__px_all(this)[$0p];};PXWikiShow.prototype.$0B=function($0q){var $r=this.$0G,$0o=this.currentSectionEditing;if($0q){$r.setAttribute("controlID",this.ID);$0o.hSize=$0o.scrollHeight;$0o.style.display="none";$r.style.display="";this.editorOpen=true;this.currentSectionEditing.editorHeight=this.$0G.offsetHeight;if($0o.editLinkElem&&$0o.editLinkElem.getAttribute)__px(this).setElemText($0o.editLinkElem,$0o.id=='Sec0'?"":$0o.editLinkElem.getAttribute("closeText"));if(this.editor){__px(this).setActive(this.editor.elemTextEdit);this.scrollToSection(this.editLinkTop);}}else{try{$0o.parentNode.removeChild($r);}catch(ex){};$r.style.display="none";$0o.style.display="";if($0o.editLinkElem&&$0o.editLinkElem.getAttribute)__px(this).setElemText($0o.editLinkElem,$0o.editLinkElem.getAttribute("editText"));this.editorOpen=false;}};PXWikiShow.prototype.$0E=function(){var $0o=this.currentSectionEditing,$g=0;var $r=this.$0G,$d=$r.offsetParent;var ts=this.editor.element.style;ts.width="100%";{$g=($0o.hSize<200)?200:$0o.hSize;this.editor.adjustHeight();this.editor.autoAdjustHeight=true;this.currentSectionEditing.editorHeight=this.$0G.offsetHeight;this.scrollToSection(this.editLinkTop);}};PXWikiShow.prototype.$0H=function($0j,$a){var $0r=__px_all(this)[$a];if($0r)setTimeout(function(){$0r.handleSave($0j);},0);};PXWikiShow.prototype.handleRefresh=function($0s){var $0t=this.tryDetermineFileList($0s);this.setValue($0t);var $d=__px_all(this)[this.bindingContainer];if($d!=null)$d.checkChanges=false;if($0t!=$0s)this.initFileList();};PXWikiShow.prototype.handleSave=function($0s){this.$0B(false);this.handleRefresh($0s);};PXWikiShow.prototype.saveSection=function(){var $0i=Function.createDelegate(this,this.$0H);var $0u=this.currentSectionEditing.id.substr(3)+"|"+this.escape(this.editor.getValue());__px_callback(this).execI(this,this.callbacks[2],$0u,$0i);};PXWikiShow.prototype.escape=function($0j){$0j=$0j.replace(/\&/g,'&amp;');$0j=$0j.replace(/\</g,'&lt;');$0j=$0j.replace(/\>/g,'&gt;');return $0j;};PXWikiShow.prototype.cancelSection=function(){if(this.confirmCancelEdit())this.$0B(false);};PXWikiShow.prototype.confirmCancelEdit=function($0l){this.scrollToSection();return confirm(this.cancelEditMsg);};PXWikiShow.prototype.tryDetermineFileList=function($0u){var $0v="filelist|";if($0u.substr(0,$0v.length)!=$0v)return $0u;var $0w=$0u.indexOf('|',$0v.length)+1;var $0x=parseInt($0u.substr($0v.length,$0w-$0v.length-1));var $0y=$0u.substr($0w,$0x);if(__px(this).elemByID(this.ID+"_flst_grd")==null)__px_cm(this).processHtmlData($0y);else{this.element.parentNode.appendChild(this.flist.element);};return $0u.substr($0x+$0w);};PXWikiShow.prototype.scrollToSection=function($0z){this.element.scrollTop=this.currentSectionEditing.editLinkElem.offsetTop;};



function PXWikiEdit($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c,PXWikiEdit.properties);this.parseHtmlDoc=true;__px_cm(this).registerAutoSize(this,$c);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.callbacks=new Array();this.callbacks[0]=__px_callback(this).copyCommand("Preview",this.callBackMode);this.callbacks[1]=__px_callback(this).copyCommand("AttachFile",this.callBackMode);this.callbacks[2]=__px_callback(this).copyCommand("ImageEditor",this.callBackMode);this.callbacks[3]=__px_callback(this).copyCommand("FileParams",this.callBackMode);this.callbacks[4]=__px_callback(this).copyCommand("LinkEditor",this.callBackMode);this.convertor=new PXHtml2Wiki($a,this);if(this.renderAsShow)return;this.elemContent=$b.rows[1].cells[0];this.elemText=__px(this).elemByID(this.ID+"_txt");this.elemText.object=this;this.elemFrame=__px(this).elemByID(this.ID+"_if");this.enabled=true;var h=Function.createDelegate(this,this.handleKeyDown);var h2=Function.createDelegate(this,this.handleKeyUp);__px(this).addEventHandler(this.elemText,"keydown",h);__px(this).addEventHandler(this.elemText,"keyup",h2);if(!this.allowContextMenu){h=Function.createDelegate(this,this.$0I);__px(this).addEventHandler(this.elemText,"contextmenu",h);};this.attachEventHandlers();this.events=new PXEventList(this,PXWikiEdit.events,$c.clientEvents);};PXWikiEdit.properties=[["autoPostBack",JSType.Bool,false],["bindingContainer",JSType.String,""],["labelID",JSType.String,""],["allowContextMenu",JSType.Bool,true],["autoAdjustHeight",JSType.Bool,false],["wysiWygMode",JSType.Bool,false],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc],["callBackMode",JSType.Object,PXCallbackManager.commandDesc],["uploadCallBack",JSType.Object,PXCallbackManager.settingsDesc],["renderAsShow",JSType.Bool,false],["useContainerAttach",JSType.Bool,false],["filesMenuContainer",JSType.String,""],["dataSourceID",JSType.String,""],["visible",JSType.Bool,true,"setVisible"]];PXWikiEdit.callbackProps=[["value",JSType.Empty,null,"setValue"],["enabled",JSType.Bool,true,"setEnabled"],["visible",JSType.Bool,true,"setVisible"]];PXWikiEdit.events={$initialize:0,$keyDown:1,$keyPress:2,$keyUp:3,$mouseDown:4,$mouseUp:5,$mouseMove:6,$mouseOver:7,$mouseOut:8,$click:9,$focus:10,$blur:11,$valueChanging:12,$valueChanged:13};PXWikiEdit.commandTags=["Save","Cancel","Preview"];PXWikiEdit.tagsCss={h1:["wikiH1 separator"],h2:["wikiH2 separator"],h3:["wikiH3 separator"],h4:["wikiH4 separator"],$d:["wikibulletlist","wikibullet"],$e:["wikinumlist","wikibullet"],hr:["horline"]};PXWikiEdit.htmlTags=["hr","ordered","unordered","indent","outdent","fontname","fontsize","color"];PXWikiEdit.textTags=["toc","box","code","codebox","info","warn","pagebreak","br"];PXWikiEdit.prototype.dispose=function(){__px_cm(this).unregisterControl(this.$0J);__px_cm(this).unregisterControl(this.$0K);};PXWikiEdit.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXWikiEdit.callbackProps);};PXWikiEdit.prototype.getVisible=function(){return this.element.style.display!="none";};PXWikiEdit.prototype.setVisible=function($f){if($f!=this.getVisible()){var $g=$f?"":"none";this.element.style.display=$g;if(this.labelID){var $h=__px(this).elemByID(this.labelID);if($h)$h.style.display=$g;}}};PXWikiEdit.prototype.onLoad=function(){this.$0L();if(!this.renderAsShow){if(__px(this).IsIE)this.elemFrame.contentWindow.document.designMode="on";if(this.wysiWygMode)this.showPreview(this.elemText.value);};var hd=Function.createDelegate(this,this.$0M);var dd=__px_all(this)[this.ID+"_tlb_ddColor"];var h1=Function.createDelegate(this,this.$0N);dd.events.addEventHandler("valueChanged",h1);dd.events.addEventHandler("showDropDown",hd);if(__px(this).IsIE)dd.allowFocus=false;dd=__px_all(this)[this.ID+"_tlb_ddFont"];h1=Function.createDelegate(this,this.handleFontNameChanged);dd.events.addEventHandler("valueChanged",h1);dd.events.addEventHandler("showDropDown",hd);if(__px(this).IsIE)dd.allowFocus=false;dd=__px_all(this)[this.ID+"_tlb_ddSize"];h1=Function.createDelegate(this,this.handleFontSizeChanged);dd.events.addEventHandler("valueChanged",h1);dd.events.addEventHandler("showDropDown",hd);if(__px(this).IsIE)dd.allowFocus=false;};PXWikiEdit.prototype.onCallback=function(){if(this.htmlMode&&this.getEditWin()){var $i=this.convertor.convert();if($i!=this.getValue()){this.elemText.value=$i;__px_cm(this).notifyOwnerChanged(this);}}};PXWikiEdit.prototype.onVisibleChanged=function($j){if(__px(this).IsFirefox20)this.getEditDoc().designMode=$j?"on":"off";};PXWikiEdit.prototype.$0L=function(){var $k=this.ID+"_tlb";this.toolBar=__px_cm(this).createControl("PXToolBar",$k,$k);if(this.toolBar){__px_all(this)[$k]=this.toolBar;this.toolBar.events.addEventHandler("buttonClick",Function.createDelegate(this,this.handleButtonClick));}};PXWikiEdit.prototype.attachEventHandlers=function(){if(!this.renderAsShow){__px_cm(this).addBaseHandlers(this.elemText,PXWikiEdit.handleEvents);__px(this).addEventHandler(this.elemText,"paste",PXWikiEdit.handleEvents,false);}};PXWikiEdit.prototype.detachEventHandlers=function(){if(!this.renderAsShow){__px_cm(this).removeBaseHandlers(this.elemText,PXWikiEdit.handleEvents);__px(this).removeEventHandler(this.elemText,"paste",PXWikiEdit.handleEvents,false);}};PXWikiEdit.prototype.setHeight=function($l){var h=parseInt($l),$i=this.elemText;var $m=this.element,$n=this.elemContent,$o=this.elemFrame;if(!this.renderAsShow){h-=($m.offsetHeight-$n.clientHeight);h=h>2?h:2;$m.style.height=$n.style.height=h+"px";$i.style.height=(h-2)+"px";$o.style.height=h+"px";}else{var $f=__px(this).elemByID(this.ID+"_shw");var $p=parseInt($f.style.marginTop.substr(0,$f.style.marginTop.length-2));var $q=parseInt($f.style.marginBottom.substr(0,$f.style.marginBottom.length-2));$m.style.height=($l-$p-$q)+"px";}};PXWikiEdit.prototype.adjustHeight=function(){var $b=this.elemText;if(this.htmlMode){var $r=this.getEditDoc();if($r)$b=__px(this).IsIE?$r.body:$r.documentElement;};if($b.scrollHeight>$b.clientHeight){var $s=(this.element.offsetHeight-this.elemContent.clientHeight);var h=$b.scrollHeight+$s+20;this.setHeight(h<200?200:h);}};PXWikiEdit.prototype.setValue=function(v){if(v!=this.getValue()){this.elemText.value=this.oldValue=v;if(this.htmlMode)this.handlePreview(true);}};PXWikiEdit.prototype.getValue=function(){return this.elemText.value;};PXWikiEdit.prototype.setEnabled=function($t){__px(this).setEnabled(this.elemText,$t,true);this.enabled=$t;if((this.element.offsetParent!=null&&this.elemFrame.offsetParent!=null&&this.elemFrame.offsetHeight>0)||!__px(this).IsFirefox20){this.getEditDoc().designMode=$t?"on":"off";};this.toolBar.setEnabled($t);for(var i=0;i<this.toolBar.items.length;i++){var $u=this.toolBar.items[i];if($u instanceof PXToolBarButton)$u.setEnabled($t);}};PXWikiEdit.prototype.updateValue=function($v){var $w=($v==undefined)?this.getValue():$v;if(!__px(this).equals($w,this.oldValue)){if($v!=undefined)this.setValue($w);var $x=this.fireEvent(12,null);if($x){this.setValue(this.oldValue);return false;};this.oldValue=$w;this.fireEvent(13,null);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this);return true;}};PXWikiEdit.prototype.fireEvent=function(id,ev,$y){var $z=($y!=null)?$y:new Object();switch(id){case 1:case 2:case 3:if(ev.keyCode)$z["keyCode"]=ev.keyCode;break;case 12:$z["oldValue"]=this.oldValue;$z["value"]=this.getValue();break;case 13:$z["value"]=this.getValue();break;};return this.events.fireEvent(id,ev,$z);};PXWikiEdit.prototype.getVisible=function(){return this.element.style.display!="none";};PXWikiEdit.prototype.showUploader=function(){if(this.useContainerAttach){var $A=__px_all(this)[this.filesMenuContainer];$A.showUploadPanel();return;};var ds=__px_alls(this)[this.dataSourceID];if(ds!=null){if(this.$0O==null)this.$0O=Function.createDelegate(this,this.$0P);var $B=null;for(var i=0;i<ds.callbacks.length;i++){if(ds.callbacks[i].name=="save")$B=ds.callbacks[i].name;};if($B!=null){var $C=ds.getCommandState(this,$B);if($C.getEnabled()){ds.events.addEventHandler("commandPerformed",this.$0O);ds.executeCommand($B,new Object());}else{if(this.$0Q)this.$0Q.show();else{__px_callback(this).execI(this,this.callbacks[1],"",Function.createDelegate(this,this.$0R));}}}else{if(this.$0Q)this.$0Q.show();else{__px_callback(this).execI(this,this.callbacks[1],"",Function.createDelegate(this,this.$0R));}}}};PXWikiEdit.prototype.$0P=function($D,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$0O);if(!$a.alert&&!ds.alert)if(this.$0Q)this.$0Q.show();else{__px_callback(this).execI(this,this.callbacks[1],"",Function.createDelegate(this,this.$0R));}};PXWikiEdit.prototype.$0R=function($E,$a){if($E){__px_cm(this).processHtmlData($E);var $F=__px_all(this)[$a];setTimeout(function(){$F.$0S();},0);}};PXWikiEdit.prototype.$0S=function(){this.$0Q=__px_all(this)[this.ID+"_upldr"];this.$0Q.show();var h=Function.createDelegate(this,this.$0T);this.$0Q.events.addEventHandler("hideAfterUpload",h);};PXWikiEdit.prototype.$0T=function(){var uc=this.uploadCallBack;if(uc&&uc.enabled)__px_callback(this).exec(this,uc);this.showImageEdit();__px_cm(this).notifyOwnerChanged(this);};PXWikiEdit.prototype.showImageEdit=function(){if(this.$0K)__px_callback(this).execI(this,this.callbacks[3],"",Function.createDelegate(this,this.$0U));else __px_callback(this).execI(this,this.callbacks[2],"",Function.createDelegate(this,this.$0V));};PXWikiEdit.prototype.$0V=function($E,$a){if($E){__px_cm(this).processHtmlData($E);var $F=__px_all(this)[$a];setTimeout(function(){$F.$0W();},0);}};PXWikiEdit.prototype.$0W=function(){this.$0K=__px_all(this)[this.ID+"_ie"];this.$0K.show();};PXWikiEdit.prototype.$0U=function($E,$a){if($E){var ar=$E.split('|');var $F=__px_all(this)[$a],$G=$F.$0K;$G.setFileMode(ar[0]=="up");$G.setFileName(ar[1]);$G.externalLink=ar[2];$G.show();}};PXWikiEdit.prototype.showLinkEdit=function(){if(this.$0J)this.$0J.show();else __px_callback(this).execI(this,this.callbacks[4],"",Function.createDelegate(this,this.$0X));};PXWikiEdit.prototype.$0X=function($E,$a){if($E){__px_cm(this).processHtmlData($E);var $F=__px_all(this)[$a];setTimeout(function(){$F.$0Y();},0);}};PXWikiEdit.prototype.$0Y=function(id){this.$0J=__px_all(this)[this.ID+"_le"];var h=Function.createDelegate(this,this.$0Z);this.$0J.events.addEventHandler("afterHide",h);h=Function.createDelegate(this,this.$10);this.$0J.events.addEventHandler("beforeShow",h);this.$0J.show();};PXWikiEdit.handleEvents=function(e){var $b=__px(this).eventElem(e);if($b!=null){var o=$b.object;if(o!=null&&o.$11!=null)o.$11(e)}};PXWikiEdit.prototype.$11=function(e){var $H=PXEvent.baseEventID(e.type);if(this.fireEvent($H,e)&&$H<10){__px(this).cancelEvent(e);return;};switch(e.type){case "blur":this.hasFocus=false;this.updateValue();break;case "focus":this.hasFocus=true;__px_cm(this).notifyOwnerActivate(this);break;case "keypress":if((e.which||e.keyCode==46)&&!e.ctrlKey&&!e.altKey)__px_cm(this).notifyOwnerTyping(this);break;case "keydown":if(e.keyCode==8||e.keyCode==46)if(__px(this).IsIE||__px(this).IsSafari)__px_cm(this).notifyOwnerTyping(this);break;case "paste":__px_cm(this).notifyOwnerTyping(this);break;}};PXWikiEdit.prototype.$0Z=function($D,e){if(!this.htmlMode||$D.dialogResult!=PXDialogResult.OK)return;var $r=this.getEditDoc(),$I=$D.getUrl();if(!$r||!$I)return;if($D.isArticle())$I="http://localhost/Show.aspx?art="+$I.replace(/\ {1};/g,'+');else if(!$I.match(/^(http|https|ftp|irc|file):\/\/\S+/))$I="http://"+$I;var $J=this.activeLink;if($J){var $K=$J.getAttribute("wikitext");$J.href=$I;$J.innerHTML=$D.getCaption();if($K){var ar=unescape($K).split('|');ar[1]=$D.getCaption();$J.setAttribute("wikitext",escape(ar.join('|')));}}else{this.getEditWin().focus();this.$12("<a href='"+$I+"'>"+$D.getCaption()+"</a>");}};PXWikiEdit.prototype.$10=function($D,e){if(!this.htmlMode)return;this.activeLink=this.getActiveElement('a');if(this.activeLink){var $L=this.activeLink.getAttribute("href");var $M=this.$13($L);var $h=unescape(this.activeLink.innerHTML);$D.setType($M?"Article":"URL");$D.setUrl($M?$M:$L,$M);$D.setCaption($h);}};PXWikiEdit.prototype.$13=function($L){var $J=$L.replace(/\+{1};/g,' ');var $N=($J.indexOf("Show.aspx")>=0);if($N){var i=$J.indexOf("art=");if(i>0)$J=$J.substr(i+4);else $J=null;}else $J=null;return $J;};PXWikiEdit.prototype.handleButtonClick=function($D,e){var $O=e.button;this.executeCommand($O.key);if(e.button.key==PXWikiEditCommand.Preview){var $P=$O.getTooltip(),$Q=$O.element.getAttribute("title2");$O.setTooltip($Q);$O.element.setAttribute("title2",$P)}};PXWikiEdit.prototype.handleSave=function(){var $R=this.ID.lastIndexOf("_ed");var $S=this.ID.substr(0,$R);this.dispose();this.elemText.blur();__px_all(this)[$S].saveSection();};PXWikiEdit.prototype.handleCancel=function(){var $R=this.ID.lastIndexOf("_ed");var $S=this.ID.substr(0,$R);this.dispose();__px_all(this)[$S].cancelSection();};PXWikiEdit.prototype.handlePreview=function($T){if($T){var $U=Function.createDelegate(this,this.$14);var $V=this.elemText.value;if($V&&(!this.$15($V)||this.parseHtmlDoc))__px_callback(this).execI(this,this.callbacks[0],$V,$U);else this.showPreview($V);}else this.hidePreview();};PXWikiEdit.prototype.handleShowTemplate=function(){var $F=__px_all(this)[this.ID+"_phID"];if($F!=null){if(!$F.init){var $W=Function.createDelegate(this,this.templateLoad);$F.events.addEventHandler("afterLoad",$W);$F.init=true;};$F.loaded=false;$F.showAfterLoad=true;$F.show();}};PXWikiEdit.prototype.templateLoad=function(){var $X=__px_all(this)[this.ID+"_phID"];var ok=__px_all(this)[this.ID+"_phID_phOk"];var $Y=__px_all(this)[this.ID+"_phID_phTreeID"];if(!ok.init){var $Z=Function.createDelegate(this,this.insertTemplate);ok.events.addEventHandler("click",$Z);var $00=Function.createDelegate(this,this.handleTreeNodeClick);$Y.events.addEventHandler("nodeClick",$00);ok.init=true;}};PXWikiEdit.prototype.handleTreeNodeClick=function($01,ev){if(ev.event.clickCount==2&&(ev.area==PXTreeArea.Text||ev.area==PXTreeArea.NodeImage)){this.insertTemplate();}};PXWikiEdit.prototype.insertTemplate=function(){var $X=__px_all(this)[this.ID+"_phID"];var $Y=__px_all(this)[this.ID+"_phID_phTreeID"];$X.hide();if($Y.selectedNode!=null&&$Y.selectedNode.value!=null){this.insertWikiTag($Y.selectedNode.value,"");}};PXWikiEdit.prototype.$16=function($02,ev){this.executeCommand(ev.item.value);};PXWikiEdit.prototype.$0I=function(e){var $02=this.getLocalMenu();if($02){__px(this).cancelEvent(e);var de=__doc(this).documentElement;var $03=de.scrollTop,$04=de.scrollLeft;$02.showAt(e.clientX+$04,e.clientY+$03);}};PXWikiEdit.prototype.handleKeyDown=function(e){switch(e.keyCode){case 46:if(e.ctrlKey){if(e.stopPropagation!=null)e.stopPropagation();e.cancelBubble=true;return;};break;};if(this.autoAdjustHeight){var me=this;setTimeout(function(){me.adjustHeight();},1);};if(__px(this).IsIE)this.handleKeyUp(e,true);};PXWikiEdit.prototype.handleKeyUp=function(e,$05){if(__px(this).IsIE&&!$05)return;if(e.ctrlKey==true){var $s;if(e.keyCode==40&&this.elemText.scrollHeight>this.elemText.scrollTop){$s=this.elemText.scrollHeight-this.elemText.scrollTop<16?this.elemText.scrollHeight-this.elemText.scrollTop:16;this.elemText.scrollTop+=$s;__px(this).cancelEvent(e);}else if(e.keyCode==38&&this.elemText.scrollTop>0){$s=this.elemText.scrollTop<16?this.elemText.scrollTop:16;this.elemText.scrollTop-=$s;__px(this).cancelEvent(e);}}};PXWikiEdit.prototype.showPreview=function($06){var $r=this.getEditDoc(),$i="";this.enabled=false;this.isHtmlDoc=this.$15($06);this.htmlMeta="";if(!this.isHtmlDoc){$i='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"';$i+='"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';$i+='<html xmlns="http://www.w3.org/1999/xhtml">';$i+='<head></head><body style="margin:0px;padding:0px;height:100%"><form class="wiki">';$i+=$06+'</form></body></html>';}else{var $07=$06.toLowerCase().indexOf("<html");if($07>0)this.htmlMeta=$06.substring(0,$07);$i=$06;};$r.open();$r.write($i);$r.close();this.$17();$r.body.style.backgroundColor="white";var h=Function.createDelegate(this,this.handleKeyDown);var h2=Function.createDelegate(this,this.handleKeyUp);__px(this).addEventHandler($r,"keydown",h);__px(this).addEventHandler($r,"keyup",h2);if(__px(this).IsFirefox){h=Function.createDelegate(this,this.handleDocKeyPress);__px(this).addEventHandler($r,"keypress",h);};if(!this.htmlMode)this.showFrame();if(this.autoAdjustHeight){var me=this;setTimeout(function(){me.adjustHeight();},1);};this.toolBar.items[PXWikiEditCommand.Preview].setPushed(true);if((this.element.offsetParent!=null||!__px(this).IsFirefox20)&&this.enabled)setTimeout(function(){try{$r.designMode="on";}catch(ex){}},1);this.enabled=true;};PXWikiEdit.prototype.showFrame=function(){this.elemText.style.display="none";this.elemFrame.style.backgroundColor="white";this.elemFrame.style.display="";this.htmlMode=true;this.setToolbarState();};PXWikiEdit.prototype.hidePreview=function(){var h=this.elemContent.clientHeight-2;if(this.isHtmlDoc&&!this.parseHtmlDoc){var de=this.getEditDoc().documentElement;this.elemText.value=this.htmlMeta+"<html>"+de.innerHTML+"</html>";}else{try{__px(this).startWC();this.elemText.value=this.convertor.convert();}finally{__px(this).stopWC();}};if(__px(this).IsFirefox)this.getEditDoc().designMode="off";this.elemFrame.style.display="none";this.elemText.style.display="";this.elemText.style.height=h+"px";__px(this).setActive(this.elemText);this.htmlMode=false;this.setToolbarState();if(this.autoAdjustHeight)this.adjustHeight();this.toolBar.items[PXWikiEditCommand.Preview].setPushed(false);};PXWikiEdit.prototype.$17=function(){var $08=__doc(this).styleSheets,$r=this.getEditDoc();var $09=$r.getElementsByTagName("head")[0],$0a=null;for(var i=0;i<$08.length;i++){var $0b=$08[i];if($0b.href==__win(this).location.href)continue;if($0b.href!=null){var $0c=new Object();$0c.href=$0b.href;$0c.type=$0b.type;$0c.media="screen";$0c.rel="stylesheet";var $J=__px(this).createElement("link",$09,$0c,$r);}else{if(__px(this).IsIE78){if($0a==null)$0a=$r.createStyleSheet();for(var j=0;j<$0b.rules.length;j++){var $0d=$0b.rules[j];$0a.addRule($0d.selectorText,$0d.style.cssText);}}else{$0a=$r.styleSheets[0];for(var j=0;j<$0b.cssRules.length;j++){var $0d=$0b.cssRules[j];try{$0a.insertRule($0d.cssText,$0a.cssRules.length-1);}catch(ex){}}}}}};PXWikiEdit.prototype.setToolbarState=function(){var toolbar=__px_all(this)[this.ID+"_tlb"];for(var i=0;i<toolbar.items.length;i++){var $u=toolbar.items[i],$0e=$u.key;if(!$0e||Array.contains(PXWikiEdit.commandTags,$0e))continue;var $0f=this.htmlMode?PXWikiEdit.textTags:PXWikiEdit.htmlTags;$u.setVisible(!Array.contains($0f,$0e));}};PXWikiEdit.prototype.getHtml=function(){try{return this.getEditDoc().body.innerHTML;}catch(ex){return "";}};PXWikiEdit.prototype.getEditDoc=function(){var $r=null;if(this.elemFrame.contentWindow){$r=this.elemFrame.contentWindow.document;if(!__px(this).IsIE78)$r.window=this.elemFrame.contentWindow;};return $r;};PXWikiEdit.prototype.getEditWin=function(){return this.elemFrame.contentWindow;};PXWikiEdit.prototype.$15=function($i){var $0g=$i?$i.toLowerCase():"";return($0g.indexOf("<html")>=0)&&$0g.endsWith("</html>");};PXWikiEdit.prototype.$14=function($E,$a){var $0h=__px_all(this)[$a];if($0h)$0h.showPreview($E);};var PXWikiEditCommand={Save:"Save",Cancel:"Cancel",Preview:"Preview",Template:"Template",AttachFile:"AttachFile",LinkEditor:"LinkEditor"};PXWikiEdit.prototype.executeCommand=function($0i,$0j){if(!this.getCommandState(this,$0i).getEnabled())return;switch($0i){case PXWikiEditCommand.Save:if(this.htmlMode)this.elemText.value=this.convertor.convert();this.handleSave();break;case PXWikiEditCommand.Cancel:this.handleCancel();break;case PXWikiEditCommand.Template:this.handleShowTemplate();break;case PXWikiEditCommand.Preview:this.handlePreview(!this.htmlMode);break;case PXWikiEditCommand.AttachFile:this.showUploader();break;case PXWikiEditCommand.LinkEditor:this.showLinkEdit();break;default:if(this.htmlMode)this.processFormatCommand($0i);else this.insertTag($0i);break;}};PXWikiEdit.prototype.getCommandState=function($D,$0i){return new PXCommandState(true,true);};PXWikiEdit.prototype.registerCommandControl=function($0k,$0i){__px_cm(this).registerCommandControl(this,$0k,$0i);};PXWikiEdit.prototype.notifyCommandState=function(){__px_cm(this).notifyCommandState(this,PXWikiEditCommand);};PXWikiEdit.prototype.insertTag=function($0l){var $0m=PXHtml2Wiki.tags["__"+$0l];if($0m){var $0n=$0m[0],end=($0m[1]==null)?$0m[0]:$0m[1];this.insertWikiTag($0n,end);}};PXWikiEdit.prototype.insertWikiTag=function($0o,$0p){this.elemText.focus();if($0o=="{TOC};"){this.elemText.value=$0o+"\r\n"+this.elemText.value;return;};if(__px(this).IsIE)this.insertWikiTagIE($0o,$0p);else this.insertWikiTagOther($0o,$0p);};PXWikiEdit.prototype.insertWikiTagIE=function($0o,$0p){var $0q=__doc(this).selection.createRange();var $0r=$0q.text;if($0r.substring(0,$0o.length)==$0o&&$0r.substring($0r.length-$0p.length,$0r.length)==$0p){$0q.text=$0r.substring($0o.length,$0r.length-$0p.length);}else $0q.text=$0o+$0r+$0p;if($0r.length==0)$0q.move("character",-$0p.length);$0q.select();};PXWikiEdit.prototype.insertWikiTagOther=function($0o,$0p){var $0s=this.elemText;var $0t=$0s.selectionStart;var $0u=$0s.value.substring(0,$0s.selectionStart);var $0r=$0s.value.substring($0s.selectionStart,$0s.selectionEnd);var $0v=$0s.value.substring($0s.selectionEnd);if($0r.substring(0,$0o.length)==$0o&&$0r.substring($0r.length-$0p.length,$0r.length)==$0p){$0r=$0r.substring($0o.length,$0r.length-$0p.length);$0s.value=$0u+$0r+$0v;$0s.selectionStart=$0t;$0s.selectionEnd=$0t+$0r.length;}else{$0s.value=$0u+$0o+$0r+$0p+$0v;$0s.selectionStart=$0t;$0s.selectionEnd=$0t+$0o.length+$0r.length+$0p.length;};if($0r.length==0){$0s.selectionStart+=$0o.length;$0s.selectionEnd-=$0p.length;}};PXWikiEdit.prototype.getLocalMenu=function(){if(this.localMenu==null){this.localMenu=PXMenu.createMenuControl(this.ID+"_mnu",this.px_context);if(this.localMenu){var h=Function.createDelegate(this,this.$16);this.localMenu.events.addEventHandler("itemClick",h);}};return this.localMenu;};PXWikiEdit.prototype.processFormatCommand=function($0w){if(this["do_"+$0w])this["do_"+$0w]($0w);else this.execFormatCommand($0w);this.getEditWin().focus();};PXWikiEdit.prototype.execFormatCommand=function($0w,$0x){this.getEditWin().focus();this.getEditDoc().execCommand($0w,false,$0x);};PXWikiEdit.prototype.$18=function($0w){this.execFormatCommand("FormatBlock",'<'+$0w+'>');var $0y=__px(this).IsIE?this.getEditDoc().selection:this.getEditWin().getSelection();var $0z=PXWikiEdit.tagsCss[$0w];if($0z){var $b=this.getActiveElement($0w);if($b)$b.className=$0z[0];}};PXWikiEdit.prototype.do_h1=PXWikiEdit.prototype.$18;PXWikiEdit.prototype.do_h2=PXWikiEdit.prototype.$18;PXWikiEdit.prototype.do_h3=PXWikiEdit.prototype.$18;PXWikiEdit.prototype.do_h4=PXWikiEdit.prototype.$18;PXWikiEdit.prototype.do_strike=function(){this.execFormatCommand("StrikeThrough");};PXWikiEdit.prototype.do_sub=function(){this.execFormatCommand("Subscript");};PXWikiEdit.prototype.do_sup=function(){this.execFormatCommand("Superscript");};PXWikiEdit.prototype.do_ordered=function(){this.execFormatCommand("InsertOrderedList");this.$19("ol","ordered");};PXWikiEdit.prototype.do_unordered=function(){this.execFormatCommand("InsertUnorderedList");this.$19("ul","unordered");};PXWikiEdit.prototype.do_hr=function($0m){this.execFormatCommand("InsertHorizontalRule");};PXWikiEdit.prototype.do_link=function(){var $i=this.$1a(),$I;if(!$i)return;var $0A=$i.match(/(.*?)\b((?:http|https|ftp|irc|file):\/\/\S+)(.*)/);if($0A){if($0A[1]||$0A[3])return null;$I=$0A[2];}else $I="http://"+escape($i);this.getEditDoc().execCommand("CreateLink",__px(this).IsIE,$I);};PXWikiEdit.prototype.$0N=function(dd,e){this.restoreSelection();this.execFormatCommand("ForeColor",dd.getValue());};PXWikiEdit.prototype.handleFontNameChanged=function(dd,e){this.restoreSelection();this.execFormatCommand("FontName",dd.getValue());};PXWikiEdit.prototype.handleFontSizeChanged=function(dd,e){this.restoreSelection();var $i=this.$1a(true);if(!$i||!$i.trim())return;var $0B=this.getActiveElement("span",true);if($0B&&$0B.innerHTML==$i){$0B.style.fontSize=dd.getValue()+"pt";return;};var $0C=Function.createDelegate(this,this.$1b);setTimeout(function(){$0C(dd,e);},0);};PXWikiEdit.prototype.$1b=function(dd,e){this.storeSelection();this.execFormatCommand("CreateLink","http://localhost");var $b=this.getActiveElement("a",true);if($b){$0B=this.getEditDoc().createElement("span");$0B.innerHTML=$b.innerHTML;$0B.style.fontSize=dd.getValue()+"pt";$b.parentNode.replaceChild($0B,$b);this.selectElementContent($0B);};this.restoreSelection();};PXWikiEdit.prototype.$0M=function(dd,e){this.storeSelection();};PXWikiEdit.prototype.restoreSelection=function(){if(this.lastRange){this.lastRange.select();this.lastRange=null;}};PXWikiEdit.prototype.storeSelection=function(){if(__px(this).IsIE){$0y=this.getEditDoc().selection;if($0y)this.lastRange=$0y.createRange();}};PXWikiEdit.prototype.selectElementContent=function($b){var $0y,$0D;if(__px(this).IsIE){$0y=this.getEditDoc().selection;if($0y){$0D=$0y.createRange();$0D.moveToElementText($b);}}else{$0y=this.getEditWin().getSelection();if($0y){$0D=this.getEditDoc().createRange();$0D.selectNodeContents($b.childNodes[0]);$0y.addRange($0D);}}};PXWikiEdit.prototype.handleDocKeyPress=function(e){var $0e=e.keyCode?e.keyCode:e.which,$0w=null;$0e=String.fromCharCode($0e);if(e.ctrlKey)switch($0e){case 'b':$0w='bold';break;case 'i':$0w='italic';break;case 'u':$0w='underline';break;case 'd':$0w='strike';break;case 'l':$0w='link';break;};if($0w){__px(this).cancelEvent(e);this.processFormatCommand($0w);}};PXWikiEdit.prototype.$19=function($0l,$0E){var $b=this.getActiveElement($0l);if($b){var $0z=PXWikiEdit.tagsCss[$0E];$b.className=$0z[0];for(var i=0;i<$b.childNodes.length;i++){if($b.tagName.toLowerCase()!=$0l)continue;$b.childNodes[i].className=$0z[1];}}else{var $b=this.getActiveElement();if($b&&$b.className)$b.removeAttribute("class");}};PXWikiEdit.prototype.$12=function($06){var $r=this.getEditDoc();if(__px(this).IsIE){var $0D=$r.selection.createRange();if($0D.boundingTop==2&&$0D.boundingLeft==2)return;$0D.pasteHTML($06);$0D.collapse(false);$0D.select();}else $r.execCommand("InsertHtml",false,$06);};PXWikiEdit.prototype.getActiveElement=function($0l,$0F){var $0y,$b=null;if(__px(this).IsIE){$0y=this.getEditDoc().selection;if($0y){var $0D=$0y.createRange();$b=$0D.parentElement();}}else{$0y=this.getEditWin().getSelection();if($0y){var $0G=$0F?$0y.focusNode:$0y.anchorNode;if($0G)$b=$0G.parentNode;}};if($0l!=null){if($b&&$b.tagName.toLowerCase()!=$0l)$b=$b.parentNode;if($b&&$b.tagName.toLowerCase()!=$0l)$b=null;};return $b;};PXWikiEdit.prototype.$1a=function($0H){var $0y,$i="";if(__px(this).IsIE){$0y=this.getEditDoc().selection;if($0y){var $0D=$0y.createRange();$i=$0H?$0D.text:$0D.htmlText;}}else{$0y=this.getEditWin().getSelection();if($0y)$i=$0y.toString();};return $i;};



function PXHtml2Wiki($a,$b){this.wikiEdit=$b;this.px_context=$a;};PXHtml2Wiki.tags={__bold:["'''","'''","BoundPhrase"],__italic:["''","''","BoundPhrase"],__underline:["__","__","BoundPhrase"],__strike:["--","--","BoundPhrase"],__h1:["==","==","BoundPhraseH"],__h2:["===","===","BoundPhraseH"],__h3:["====","====","BoundPhraseH"],__h4:["=====","=====","BoundPhraseH"],__sub:["<sub>","</sub>","BoundPhrase"],__sup:["<sup>","</sup>","BoundPhrase"],__hiddentext:["=^","^=","BoundPhraseH2"],__link:["[","]","BoundPhrase"],__ordered:["#","","StartLines"],__unordered:["*","","StartLines"],__indent:[":","","StartLines",],__hr:["----","","LineAlone"],__br:["{br\x7d",""],__pagebreak:["{PageBreak\x7d",""],__toc:["{TOC\x7d",""],__box:["(((",")))","Parse"],__info:["((({S:Hint\x7d",")))","Parse"],__warn:["((({S:Warn\x7d",")))","Parse"],__danger:["((({S:Danger\x7d",")))","Parse"],__goodpractice:["((({S:GoodPractice\x7d",")))","Parse"],__code:["{{","\x7d\x7d","BoundPhraseC"],__codebox:["{{{{","\x7d\x7d\x7d\x7d"],__image:["[","]"],__nowiki:["<nowiki>","</nowiki>"],__csharp:['<source lang="csharp">',"</source>","TextContent"]};PXHtml2Wiki.$09=["line-through","bold","italic","underline"];PXHtml2Wiki.prototype.convert=function($c){if(this.dom==null)this.dom=__doc(this).createElement("div");if($c==null){if(!this.wikiEdit)return "";this.dom.innerHTML=this.wikiEdit.getHtml();}else if(typeof $c=="string"){this.dom.innerHTML=$c;}else return "";this.output=[];this.indentLevel=0;this.listType=[];this.listTypes=[];this.normalizeDomWhitespace();this.normalizeDomStructure();this.walk(this.dom);return this.$0a();};PXHtml2Wiki.prototype.$0b=function($d){if($d)this.output.push($d);};PXHtml2Wiki.prototype.$0a=function(){var $e=[];for(var i=0;i<this.output.length;i++){if(typeof(this.output[i])!='string')continue;$e.push(this.output[i]);};return $e.join('');};PXHtml2Wiki.prototype.walk=function(element){if(!element)return;var $f=null;for(var $g=element.firstChild;$g;$g=$g.nextSibling){if($g.nodeType==1){var $h=$g.getAttribute("wikitag");var $i=$g.getAttribute("wikitext");if($h!=null||$i!=null){var $j=$h?PXHtml2Wiki.tags["__"+$h.toLowerCase()]:null;if($i){if($j)this.$0b($j[0]);this.$0b(unescape($i));if($j)this.$0b($j[1]);}else if($j){this.format_wikitag($g,$j);}else if($h=="html"){this.format_undefined($g);}}else{var $k="format_"+$g.nodeName.toLowerCase();if(!this[$k])$k="format_undefined";this[$k]($g,$f);};$f=$g;}else if($g.nodeType==3){var $d=$g.nodeValue;if($d.match(/[^\n]/)&&!$d.match(/^\n[\ \t]*$/)&&!($d.match(/^\ +$/)&&this.$0c())){var $d=this.$0d($g.nodeValue);if(!this.$0e)$d=this.$0f($d);this.$0b($d);$f=$g;}}}};PXHtml2Wiki.prototype.skip=function(){};PXHtml2Wiki.prototype.format_wikitag=function($g,$j){var $l=$j[2];if(this["handle_"+$l]!=null){this["handle_"+$l]($g,$j);return;};this.$0b($j[0]);if($j[1]){if($l=="Parse"){var e=($g.tagName=="TABLE")?$g.rows[0].cells[1]:$g;this.$0g();var $m=null;for(var i=0;i<e.childNodes.length;i++){if(e.childNodes[i].tagName=="TABLE"){$m=e.childNodes[i];break;}};if($m!=null)e=$m.rows[0].cells[1];this.walk(e);this.$0h();}else if($l=="TextContent"){var $n="\r\n"+this.$0i($g.innerHTML);this.$0b(this.$0j($n.replace(/<[^>]*?>/g,'')));}else if($g.innerHTML){this.$0b(this.$0j(this.$0i($g.innerHTML)));};this.$0b($j[1]);}};PXHtml2Wiki.prototype.format_undefined=function($g){var $o=$g.tagName.toLowerCase(),$p;if($g.innerHTML){if($o=="style"){$p=$g.innerHTML.replace(/<span newline="br"><\/span>/g,'');$p=this.$0i($p);}else if($o=="pre"){this.$0e=true;};var $d="<"+$o+this.$0k($g)+">";this.$0b($d);$p?this.$0b($p):this.walk($g);this.$0e=false;$d="</"+$o+">";this.$0b($d);}else{this.$0b("<"+$o+this.$0k($g)+" />");}};PXHtml2Wiki.prototype.$0k=function($g){var $d="",$q=$g.attributes;var $r=["wikitag","wikicl","style","singleline"];if($q)for(var i=0;i<$q.length;i++){var $s=$q[i],name=$s.nodeName.toLowerCase();if(!$s.specified||Array.contains($r,name))continue;var $t=$s.nodeValue;if(name=="class"&&$t){var $u=$g.getAttribute("wikicl");$t=$t.trimStart();if($u){$t=$t.substring($u.length).trimStart();if(!$t)continue;}};$d+=' '+name;if($t)$d+='="'+$t+'"';};if($g.style&&$g.style.cssText!="")$d+=' style="'+$g.style.cssText.toLowerCase()+'"';return $d;};PXHtml2Wiki.prototype.normalizeDomWhitespace=function(){var $v=['span','strong','em','strike','del','tt'];for(var i=0;i<$v.length;i++){var $w=this.dom.getElementsByTagName($v[i]);for(var j=0;j<$w.length;j++)this.$0l($w[j]);};this.$0m(['br','blockquote'],'nextSibling');this.$0m(['p','div','blockquote'],'firstChild');};PXHtml2Wiki.prototype.$0m=function($v,$x){for(var i=0;i<$v.length;i++){var $y=this.dom.getElementsByTagName($v[i]);for(var j=0;j<$y.length;j++){var $z=$y[j][$x];if($z&&$z.nodeType==3)$z.nodeValue=$z.nodeValue.replace(/^\n/,'');}}};PXHtml2Wiki.prototype.$0l=function(element){if(this.$0n(element))return;var $A=this.$0o(element);var $B=this.$0p(element);var $C=this.$0q(element);var $D=this.$0r(element);if($A&&$A.nodeValue.match(/^\ /)){$A.nodeValue=$A.nodeValue.replace(/^\ +/,'');if($B&&!$B.nodeValue.match(/\ $/))$B.nodeValue=$B.nodeValue+' ';};if($C&&$C.nodeValue.match(/\ $/)){$C.nodeValue=$C.nodeValue.replace(/\ $/,'');if($D&&!$D.nodeValue.match(/^\ /))$D.nodeValue=' '+$D.nodeValue;}};PXHtml2Wiki.prototype.$0n=function(element){var $E=element.lastChild;return $E&&($E.nodeType==8);};PXHtml2Wiki.prototype.$0s=function(element){if(this.$0t(element)||this.$0u(element)){var $F=__doc(this).createElement('font');$F.innerHTML=element.innerHTML;element.parentNode.replaceChild($F,element);return true;};return false;};PXHtml2Wiki.prototype.$0t=function(element){var $A=this.$0o(element);var $B=this.$0p(element);if(!$A)return true;if($A.nodeValue.match(/^\ /))return false;if(!$B||$B.nodeValue=='\n')return false;return !$B.nodeValue.match(/[\ "]$/);};PXHtml2Wiki.prototype.$0u=function(element){var $C=this.$0q(element);var $D=this.$0r(element);for(var n=element;n&&n.nodeType!=3;n=n.lastChild)if(n.nodeType==8)return false;if(!$C)return true;if($C.nodeValue.match(/\ $/))return false;if(!$D||$D.nodeValue=='\n')return false;return !$D.nodeValue.match(/^[\ ."\n]/);};PXHtml2Wiki.prototype.$0o=function(element){var $E=element;while($E&&$E.nodeType!=3)$E=$E.firstChild;return $E;};PXHtml2Wiki.prototype.$0q=function(element){var $E=element;while($E&&$E.nodeType!=3)$E=$E.lastChild;return $E;};PXHtml2Wiki.prototype.$0p=function(element){var $E=element.previousSibling;if($E&&$E.nodeType!=3)$E=null;return $E;};PXHtml2Wiki.prototype.$0r=function(element){var $E=element.nextSibling;if($E&&$E.nodeType!=3)$E=null;return $E;};PXHtml2Wiki.prototype.normalizeDomStructure=function(){this.$0v("ol");this.$0v("ul");this.$0w();};PXHtml2Wiki.prototype.$0w=function(){var $w=this.$0x(this.dom,"span");for(var i=0;i<$w.length;i++){var $E=$w[i].firstChild;while($E){if($E.nodeType==3){$E.nodeValue=$E.nodeValue.replace(/^\n+/,"");break;};$E=$E.nextSibling;};$E=$w[i].lastChild;while($E){if($E.nodeType==3){$E.nodeValue=$E.nodeValue.replace(/\n+$/,"");break;};$E=$E.previousSibling;}}};PXHtml2Wiki.prototype.$0y=function($G){var $w=this.$0x(this.dom,$G);for(var i=0;i<$w.length;i++){var $g=$w[i],style=$g.getAttribute("style");if(!style)continue;$g.removeAttribute("style");$g.innerHTML='<span style="'+style+'">'+$g.innerHTML+'</span>';}};PXHtml2Wiki.prototype.$0v=function($G){var $w=this.$0x(this.dom,$G);for(var i=0;i<$w.length;i++){var $g=$w[i],style=$g.getAttribute("style");if(!style)continue;$g.removeAttribute("style");var $H=$g.getElementsByTagName("li");for(var j=0;j<$H.length;j++)$H[j].innerHTML='<span style="'+style+'">'+$H[j].innerHTML+'</span>';}};PXHtml2Wiki.prototype.$0x=function($I,$G,$J){var $K=$I.getElementsByTagName($G);var $w=[];for(var i=0;i<$K.length;i++){if($J&&!$J($K[i]))continue;$w.push($K[i]);};return $w;};PXHtml2Wiki.prototype.format_abbr=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_acronym=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_address=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_applet=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_area=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_basefont=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_base=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_bgsound=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_big=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_blink=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_body=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_button=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_caption=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_center=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_cite=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_col=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_colgroup=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_dfn=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_dt=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_embed=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_field=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_fieldset=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_form=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_frame=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_frameset=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_head=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_html=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_iframe=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_input=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_ins=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_isindex=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_label=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_legend=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_link=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_map=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_marquee=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_meta=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_multicol=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_nobr=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_noembed=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_noframes=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_nolayer=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_noscript=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_nowrap=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_object=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_optgroup=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_option=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_param=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_select=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_small=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_spacer=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_style=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_sub=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_submit=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_sup=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_tbody=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_textarea=PXHtml2Wiki.prototype.skip;PXHtml2Wiki.prototype.format_tfoot=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_thead=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_wiki=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_blockquote=function($g){var $L=parseInt($g.style.marginLeft),$M=0;if($L)$M+=parseInt($L/40);if($g.tagName.toLowerCase()=="blockquote")$M+=1;this.indentLevel+=$M;this.$0z();this.walk($g);this.indentLevel-=$M;this.$0z();};PXHtml2Wiki.prototype.format_div=function($g){if(!this.$0A($g)){var style=$g.getAttribute("style");if(style)this.$0B(style);this.walk($g);if(style)this.$0C(style);}};PXHtml2Wiki.prototype.format_p=function($g,$B){if(!this.$0A($g)){if($B&&$B.tagName&&$B.tagName.toLowerCase()=='p'){if(!this.$0c())this.$0D();this.$0D();}else if(!this.$0c())this.$0D();this.walk($g);}};PXHtml2Wiki.prototype.$0A=function($g){if(this.$0E($g)){this.format_blockquote($g);return true;};if($g.childNodes.length==1){var $c=$g.innerHTML.toLowerCase();if($c=="&nbsp;"||$c=="<span>&nbsp;</span>"){if(!this.$0c())this.$0D();this.$0D();return true;}};return false;};PXHtml2Wiki.prototype.format_span=function($g){var br=$g.getAttribute("newline");if(br){if(!this.$0e)this.$0D();return;};var style=$g.getAttribute("style");if(!style){this.walk($g);return;};if(!this.$0F($g)&&!this.$0G($g))return;var $N=false,$O=$g.style.cssText;if($O!=""){$O=$O.toLowerCase();$O=$O.replace(/(font-weight|font-style|text-decoration)\:\D+?;/g,'');if($O){this.$0b('<span style="'+$O+'">');$N=true;}};this.$0B(style);this.walk($g);this.$0C(style);if($N)this.$0b('</span>');};PXHtml2Wiki.prototype.format_br=function($g){this.$0b('{br\x7d');};PXHtml2Wiki.prototype.$0B=function(style){var $q=PXHtml2Wiki.$09;for(var i=0;i<$q.length;i++)this.$0H(style,$q[i],0);};PXHtml2Wiki.prototype.$0C=function(style){var $q=PXHtml2Wiki.$09;for(var i=$q.length-1;i>=0;i--)this.$0H(style,$q[i],1);};PXHtml2Wiki.prototype.format_a=function($g){var $P=unescape($g.innerHTML);$P=$P.replace(/<[^>]*?>/g,' ');$P=$P.replace(/\s+/g,' ');$P=$P.trim();var $Q=$g.getAttribute("href");var $R=PXHtml2Wiki.tags.__link[0];var $S=PXHtml2Wiki.tags.__link[1];if(!$Q){this.$0b($P);}else if($Q.startsWith("javascript:")){this.walk($g);}else{$Q=$Q.replace(new RegExp("\\+{1\x7d","g"),' ');var $T=($Q.indexOf("Show.aspx")>=0);if($T){var i=$Q.indexOf("art=");if(i>0)$Q=$Q.substr(i+4);};var $U=$Q.startsWith("mailto:");if($U)$Q=$Q.substr(7);var $V=$g.getAttribute("target");if($V=="_blank")$R+='^';if($Q==$P)this.$0b($R+$Q+$S);else this.$0b($R+$Q+'|'+$P+$S);}};PXHtml2Wiki.prototype.format_ol=function($g){this.$0I($g,"ordered");};PXHtml2Wiki.prototype.format_ul=function($g){this.$0I($g,"unordered");};PXHtml2Wiki.prototype.format_dl=function($g){this.$0I($g,"indent");};PXHtml2Wiki.prototype.format_li=function($g){var $W=["ol","ul","dl"],e=$g.firstChild;var $G=(e&&e.tagName)?e.tagName.toLowerCase():"";if(!Array.contains($W,$G)){for(var $X=0;$X<this.listType.length;$X++){var $Y=this.listType[$X],$j=PXHtml2Wiki.tags["__"+$Y];this.$0b($j[0]);}};this.walk($g);this.$0z();};PXHtml2Wiki.prototype.format_dd=PXHtml2Wiki.prototype.format_li;PXHtml2Wiki.prototype.$0I=function($g,$Z){if(!this.$0c())this.$0D();this.listType.push($Z);this.walk($g);this.listType.pop();};PXHtml2Wiki.prototype.format_table=function($g){var $q=this.$0k($g);if(!this.$0c()&&!this.$0J())this.$0D();this.$0b("{|");if($g.caption){this.$0D();this.$0b("|+ "+$g.caption);this.$0D();};if($q)this.$0b($q);this.walk($g);this.$0D();this.$0b("|\x7d");};PXHtml2Wiki.prototype.format_tbody=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_tfoot=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_thead=PXHtml2Wiki.prototype.walk;PXHtml2Wiki.prototype.format_tr=function($g){var $q=this.$0k($g);if($g.rowIndex>0||$q){this.$0D();this.$0b("|-");if($q)this.$0b($q);};this.walk($g);};PXHtml2Wiki.prototype.format_th=function($g){this.$0K($g,'!');};PXHtml2Wiki.prototype.format_td=function($g){this.$0K($g,'|');};PXHtml2Wiki.prototype.$0K=function($g,$00){var sl=($g.parentNode.getAttribute("singleline")!=null),i;if(sl){if($g.cellIndex==0){this.$0z();this.$0b($00+" ");}else{this.$0L();this.$0b($00.times(2)+" ");};i=this.output.length;this.walk($g);this.$0M(i);}else{var $q=this.$0k($g);this.$0z();if($q)this.$0b($00+$q+" ");this.$0b($00+" ");i=this.output.length;this.walk($g);this.$0M(i);}};PXHtml2Wiki.prototype.handle_BoundPhrase=function($g,$j){if(!this.$0F($g))return;if($g.innerHTML.match(/^\s*<br\s*\/?\s*>/)){this.$0b("\r\n");$g.innerHTML=$g.innerHTML.replace(/^\s*<br\s*\/?\s*>/,"");};this.$0b($j[0]);this.walk($g);this.$0b($j[1]);};PXHtml2Wiki.prototype.handle_BoundPhraseH=function($g,$j){if(!this.$0F($g))return;if(!this.$0c())this.$0D();this.$0N($g);this.$0b($j[0]);this.walk($g);this.$0b($j[1]);this.$0z();};PXHtml2Wiki.prototype.handle_BoundPhraseH2=function($g,$j){if(!this.$0F($g))return;if(!this.$0c())this.$0D();this.$0N($g);this.$0b($j[0]);this.walk($g);if(!this.$0c())this.$0D();this.$0b($j[1]);this.$0z();};PXHtml2Wiki.prototype.handle_BoundPhraseC=function($g,$j){if(!this.$0F($g))return;this.$0b($j[0]);this.$0b(this.$0j($g.innerHTML));this.$0b($j[1]);};PXHtml2Wiki.prototype.handle_StartLines=function($g,$j){var $n=$g.firstChild.nodeValue;if(!$n)return;this.$0z();$n=$n.replace(/^/mg,$j[0]);this.$0b($n);this.$0z();};PXHtml2Wiki.prototype.handle_LineAlone=function(element,$j){this.$0z();this.$0b($j[0]);};PXHtml2Wiki.prototype.$0O=function($g,$G){var $j=PXHtml2Wiki.tags["__"+$G];var $l=$j[2];this["handle_"+$l]($g,$j);};PXHtml2Wiki.$0P=function($G){return function($g){this.$0O($g,$G);}};PXHtml2Wiki.$0Q=function($G){return function($g){if(this.$0F($g))this.$0O($g,$G);}};PXHtml2Wiki.prototype.format_b=PXHtml2Wiki.$0Q('bold');PXHtml2Wiki.prototype.format_strong=PXHtml2Wiki.prototype.format_b;PXHtml2Wiki.prototype.format_i=PXHtml2Wiki.$0Q('italic');PXHtml2Wiki.prototype.format_em=PXHtml2Wiki.prototype.format_i;PXHtml2Wiki.prototype.format_u=PXHtml2Wiki.$0Q('underline');PXHtml2Wiki.prototype.format_strike=PXHtml2Wiki.$0Q('strike');PXHtml2Wiki.prototype.format_del=PXHtml2Wiki.prototype.format_strike;PXHtml2Wiki.prototype.format_s=PXHtml2Wiki.prototype.format_strike;PXHtml2Wiki.prototype.format_hr=PXHtml2Wiki.$0P('hr');PXHtml2Wiki.prototype.format_h1=PXHtml2Wiki.$0Q('h1');PXHtml2Wiki.prototype.format_h2=PXHtml2Wiki.$0Q('h2');PXHtml2Wiki.prototype.format_h3=PXHtml2Wiki.$0Q('h3');PXHtml2Wiki.prototype.format_h4=PXHtml2Wiki.$0Q('h4');PXHtml2Wiki.prototype.format_sub=PXHtml2Wiki.$0Q('sub');PXHtml2Wiki.prototype.format_sup=PXHtml2Wiki.$0Q('sup');PXHtml2Wiki.prototype.format_code=PXHtml2Wiki.$0Q('code');PXHtml2Wiki.prototype.$0R=function(){var $d;while(this.output.length){$d=this.output.pop();if(typeof($d)!="string"){this.$0b($01);return;};if(!this.$0S($d)&&$d.match(/\S/))break;};if($d){$d=$d.replace(/[\r\n\s]+$/,"");this.$0b($d);}};PXHtml2Wiki.prototype.$0T=function(){for(var i=this.output.length-1;i>=0;i--){var $d=this.output[i];if(typeof($d)=="string"){if(this.$0S($d)){this.output[i]=$d.replace(/\:+$/,"");if(!this.output[i])this.output.splice(i,1);};break;}}};PXHtml2Wiki.prototype.$0N=function($g){$g.innerHTML=$g.innerHTML.replace(/\s*<br\s*\/?\s*>/g,"");};PXHtml2Wiki.prototype.$0D=function(){var $02='',$03=':',$04="\r\n";if(this.indentLevel>0){this.$0T();$02=$03.times(this.indentLevel);};if(this.output.length)this.$0b($04+$02);else if($02.length)this.$0b($02);};PXHtml2Wiki.prototype.$0z=function(){this.$0R();this.$0D();};PXHtml2Wiki.prototype.$0L=function(){if(!this.output.length)return;if(!this.$0U().match(/(\s+|[\(])$/))this.$0b(' ');};PXHtml2Wiki.prototype.$0E=function($g){var $L=parseInt($g.style.marginLeft);return $L>0;};PXHtml2Wiki.prototype.$0S=function($d){return $d&&$d.match(/^(\r\n)+\:+$/);};PXHtml2Wiki.prototype.$0f=function($d){$d=$d.replace(/^\n+/,"").replace(/\n+$/,"");return $d.replace(/[\ \u00a0\r\n]+/g,' ');};PXHtml2Wiki.prototype.$0M=function($05){if($05<this.output.length)this.output[$05]=this.output[$05].trimStart();};PXHtml2Wiki.prototype.$0d=function($d){$d=$d.replace(/\u00a0/g,"&nbsp;");if(this.$0c()){for(var i=0;i<$d.length;i++){var ch=$d.charAt(i),$06=null;switch(ch){case '#':$06="&#35;";break;case '*':$06="&#42;";break;};if($06){$d=$d.substring(0,i)+$06+$d.substring(i+1);i+=4;}else break;}};return $d.replace(/</g,"&lt;").replace(/>/g,"&gt;");};PXHtml2Wiki.prototype.$0j=function($d){$d=$d.replace(/&nbsp;/g,"\u00a0");$d=$d.replace(/&#35;/g,"#").replace(/&#42;/g,"*");$d=$d.replace(/&lt;/g,"<").replace(/&gt;/g,">");return $d.replace(/&amp;/g,"&");};PXHtml2Wiki.prototype.$0i=function($d){return $d.replace(/<br\s*\/?\s*>/g,"\r\n");};PXHtml2Wiki.prototype.$0U=function(){var length=this.output.length;return length?this.output[length-1]:'';};PXHtml2Wiki.prototype.$0c=function(){for(var i=this.output.length-1;i>=0;i--){var $01=this.output[i];return $01.match(/\n$/);};return true;};PXHtml2Wiki.prototype.$0J=function(){if(!this.output.length)return false;var $d=this.output[this.output.length-1];return $d.match(/^[\:\*#]$/);};PXHtml2Wiki.prototype.$0F=function($g){return $g.innerHTML.replace(/<.*?>/g,"").replace(/&nbsp;/g,"").match(/\S/);};PXHtml2Wiki.prototype.$0G=function($g){var fc=$g.firstChild;return $g.childNodes.length==1&&fc.nodeType==1&&fc.tagName.toLowerCase()=='img';};PXHtml2Wiki.prototype.$0V=function(style,$s){return style.match("\\b"+$s+"\\b");};PXHtml2Wiki.prototype.$0H=function(style,$s,$07){if(typeof style!="string")style=style.cssText.toLowerCase();var $j=($s=="line-through")?"strike":$s;if(this.$0V(style,$s))this.$0b(PXHtml2Wiki.tags["__"+$j][$07]);};PXHtml2Wiki.prototype.$0g=function(){this.listTypes.push([this.listType,this.indentLevel]);this.listType=[];this.indentLevel=0;};PXHtml2Wiki.prototype.$0h=function(){if(this.listTypes.length>0){var $08=this.listTypes.pop();this.listType=$08[0];this.indentLevel=$08[1];}};



function PXWikiImageEdit($a,$b,$c,$d){PXWikiImageEdit.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXWikiImageEdit.properties);this.elemWikiText=__px_cm(this).createControl("PXTextEdit",$b.id+"_text");this.edUrl=__px_cm(this).createControl("PXTextEdit",$b.id+"_edurl");this.edType=__px_cm(this).createControl("PXDropDown",$b.id+"_edtype");this.edCaption=__px_cm(this).createControl("PXTextEdit",$b.id+"_edcap");this.edAlign=__px_cm(this).createControl("PXDropDown",$b.id+"_edalign");this.edSize=__px_cm(this).createControl("PXTextEdit",$b.id+"_edsize");this.btnOk=__px_cm(this).createControl("PXButton",$b.id+"_btnOk");this.btnCancel=__px_cm(this).createControl("PXButton",$b.id+"_btnCancel");var h=Function.createDelegate(this,this.handleValueChanged);var $e=[this.edUrl,this.edType,this.edCaption,this.edAlign,this.edSize];for(var i=0;i<$e.length;i++)$e[i].events.addEventHandler("valueChanged",h);this.makeWikiText();};PXWikiImageEdit.__baseType=PXSmartPanel;PXWikiImageEdit.properties=[["fileMode",JSType.Bool,false],["externalLink",JSType.String,""]];PXWikiImageEdit.prototype.handleValueChanged=function($f,e){this.makeWikiText();};PXWikiImageEdit.prototype.makeWikiText=function(){if(!this.edUrl.getValue())return "";var $g;if(this.fileMode){var $h=this.edCaption.getValue();$g=decodeURI("[%7Bup%7D");$g+=this.edUrl.getValue();if($h)$g+="|"+$h;}else{var $i=this.edType.getValue().toLowerCase();var $j=this.edAlign.getValue().toLowerCase();var $h=this.edCaption.getValue(),$k=this.edSize.getValue();$g="[image:"+this.edUrl.getValue();if($i&&$i!="notset")$g+="|"+$i;if($j&&$j!="notset")$g+="|"+$j;if($h)$g+="|"+$h;if($k)$g+="|"+$k;};this.elemWikiText.setValue($g+"]");};PXWikiImageEdit.prototype.getWikiText=function(){return this.elemWikiText.getValue();};PXWikiImageEdit.prototype.setFileMode=function(on){var $l=on?"none":"";var $m=this.elemContent.rows;this.fileMode=on;$m[1].style.display=$l;$m[4].style.display=$l;this.makeWikiText();};PXWikiImageEdit.prototype.setFileName=function(name){this.edUrl.setValue(name);this.makeWikiText();};



function PXWikiLinkEdit($a,$b,$c,$d){this.ID=$b.id;this.element=$b;PXWikiLinkEdit.initializeBaseA(this,[$a,$b,$c,$d]);this.elemWikiText=__px_cm(this).createControl("PXTextEdit",$b.id+"_text");this.elemType=__px_cm(this).createControl("PXDropDown",$b.id+"_type");this.elemUrl=__px_cm(this).createControl("PXTextEdit",$b.id+"_url");this.elemArticle=__px_cm(this).createControl("PXTreeSelector",$b.id+"_art");this.elemCaption=__px_cm(this).createControl("PXTextEdit",$b.id+"_capt");this.btnOk=__px_cm(this).createControl("PXButton",$b.id+"_btnOk");var h=Function.createDelegate(this,this.handleValueChanged);var $e=[this.elemType,this.elemUrl,this.elemArticle,this.elemCaption];for(var i=0;i<$e.length;i++)$e[i].events.addEventHandler("valueChanged",h);this.makeWikiText();};PXWikiLinkEdit.__baseType=PXSmartPanel;PXWikiLinkEdit.prototype.handleValueChanged=function($f,e){if($f==this.elemType){var $g=this.isArticle();this.elemUrl.setVisible(!$g);this.elemArticle.setVisible($g);};this.makeWikiText();};PXWikiLinkEdit.prototype.makeWikiText=function(){var $g=this.isArticle();var $h="",$i=true;if($g&&!this.elemArticle.getValue())$i=false;if(!$g&&!this.elemUrl.getValue())$i=false;if($i){var $j=this.getCaption();$h="[";if($g){var parent=this.elemArticle.tree.selectedNode.parentNode;if(parent!=null){var $k=parent;while($k!=null){parent=$k;$k=parent.parentNode;};$h+=parent.value;$h+="\\";};$h+=this.elemArticle.getValue();}else $h+=this.elemUrl.getValue();if($j)$h+="|"+$j;$h+="]";};this.elemWikiText.setValue($h);};PXWikiLinkEdit.prototype.getWikiText=function(){return this.elemWikiText.getValue();};PXWikiLinkEdit.prototype.isArticle=function(){return(this.elemType.selectedIndex==0);};PXWikiLinkEdit.prototype.setType=function($l){this.elemType.setValue($l);this.elemArticle.setVisible(this.isArticle());this.elemUrl.setVisible(!this.isArticle());this.makeWikiText();};PXWikiLinkEdit.prototype.getUrl=function(){return this.isArticle()?this.elemArticle.getValue():this.elemUrl.getValue();};PXWikiLinkEdit.prototype.setUrl=function($m,$h){if(this.isArticle()){this.elemArticle.setValue($m);if($h!=null)this.elemArticle.setText($h);}else this.elemUrl.setValue($m);this.makeWikiText();};PXWikiLinkEdit.prototype.getCaption=function(){return this.elemCaption.getValue();};PXWikiLinkEdit.prototype.setCaption=function($n){this.elemCaption.setValue($n);this.makeWikiText();};


function PXFileList($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c,PXFileList.properties);this.grid=__px_all(this)[this.ID+"_grd"];var me=this;if(this.grid!=null){this.grid.fileList=this;this.grid.events.addEventHandler("toolsButtonClick",PXFileList.$l);this.grid.events.addEventHandler("afterRefresh",PXFileList.$m);this.grid.events.addEventHandler("afterRowDelete",PXFileList.$n);var h=Function.createDelegate(this,this.$o);__px(this).addEventHandler(__win(this),"resize",h);setTimeout(function(){me.grid.adjustSize();},0);};this.callbacks=new Array();this.callbacks[0]=__px_callback(this).copyCommand("AttachFile",this.callBackMode);this.callbacks[1]=__px_callback(this).copyCommand("Download",this.callBackMode);this.callbacks[2]=__px_callback(this).copyCommand("PropertiesView",this.callBackMode);this.callbacks[3]=__px_callback(this).copyCommand("CheckOutFile",this.callBackMode);this.callbacks[4]=__px_callback(this).copyCommand("UndoCheckOutFile",this.callBackMode);this.callbacks[5]=__px_callback(this).copyCommand("GetFilesLink",this.callBackMode);if(this.isIELessThan8())this.intervalID=__win(this).setInterval(function(){me.attachOnScrollForIELessThan8()},500);};PXFileList.properties=[["callBackMode",JSType.Object,PXCallbackManager.commandDesc]];PXFileList.prototype.showUploader=function(){if(this.$p)this.$p.show();else __px_callback(this).execI(this,this.callbacks[0],"",Function.createDelegate(this,this.$q));};PXFileList.prototype.downloadFile=function(){__px_callback(this).execI(this,this.callbacks[1],"");};PXFileList.prototype.viewProperties=function(){__px_callback(this).execI(this,this.callbacks[2],"");};PXFileList.prototype.checkOutFile=function(){__px_callback(this).execI(this,this.callbacks[3],"",Function.createDelegate(this,this.$r));};PXFileList.prototype.undoCheckOutFile=function(){__px_callback(this).execI(this,this.callbacks[4],"",Function.createDelegate(this,this.$r));};PXFileList.prototype.getFilesLink=function(){__px_callback(this).execI(this,this.callbacks[5],"",Function.createDelegate(this,this.$s));};PXFileList.prototype.$t=function(){this.grid.refresh();};PXFileList.prototype.$o=function(){this.grid.adjustSize();this.grid.element.style.width="100%";this.grid.adjustColumns();if(this.isIELessThan8())this.element.style.height=this.grid.element.clientHeight+"px";};PXFileList.prototype.isIELessThan8=function(){if(!__px(this).IsIE)return false;var ua=navigator.userAgent;var MSIEOffset=ua.indexOf("MSIE ");if(MSIEOffset==-1)return false;if(parseFloat(ua.substring(MSIEOffset+5,ua.indexOf(";",MSIEOffset)))==8)return false;return true;};PXFileList.prototype.attachOnScrollForIELessThan8=function(){this.grid.element.style.position="absolute";this.element.style.height=this.grid.element.clientHeight+"px";this.calculateGridPosition(this.element);var $b=this.grid.element.parentNode;var me=this;var $d=false;while($b.parentNode!=__doc(this)){if($b.clientHeight<$b.scrollHeight){$b.onscroll=function(){me.calculateGridPosition(this)};$d=true;};$b=$b.parentNode;};if($d)__win(this).clearInterval(this.intervalID);};PXFileList.prototype.calculateGridPosition=function($e){var $f=$e.scrollTop;this.grid.element.style.left=this.element.offsetLeft+"px";this.grid.element.style.top=(this.element.offsetTop-$f)+"px";};PXFileList.$l=function($g,ev){if(ev.button.key=="AddNew")$g.fileList.showUploader();else if(ev.button.key=="Download")$g.fileList.downloadFile();else if(ev.button.key=="Properties")$g.fileList.viewProperties();else if(ev.button.key=="CheckOut")$g.fileList.checkOutFile();else if(ev.button.key=="UndoCheckOut")$g.fileList.undoCheckOutFile();else if(ev.button.key=="GetFilesLink")$g.fileList.getFilesLink();};PXFileList.$m=function($g,ev){$g.adjustSize();if($g.fileList.isIELessThan8())$g.fileList.element.style.height=$g.element.clientHeight+"px";};PXFileList.$n=function($g,ev){$g.adjustSize();};PXFileList.prototype.$q=function($h,$a){if($h){__px_cm(this).processHtmlData($h);var $i=__px_all(this)[$a];setTimeout(function(){$i.$u($i.ID);},0);}};PXFileList.prototype.$r=function($h,$a){var $i=__px_all(this)[$a];var $j=new PXXmlDoc("",$h);var $k=new Object();$k.id=$j.rootNode.nodeName;PXBaseDataSource.$v($h,$k);$i.grid.refresh();};PXFileList.prototype.$s=function($h,$a){};PXFileList.prototype.$u=function(id){var $i=__px_all(this)[id];if($i){$i.$p=__px_all(this)[$i.ID+"_upldr"];$i.$p.show();var h=Function.createDelegate($i,$i.$t);$i.$p.events.addEventHandler("hideAfterUpload",h);}}


function PXTreeSelector($a,$b,$c,$d){PXTreeSelector.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXTreeSelector.properties);this.events.appendEvents(PXTreeSelector.events,$c.clientEvents);if($c.inputMask&&this.allowEditValue&&this.valueType==NetType.String){var $e=new Object();$e.inputMask=this.inputMask;$e.allowNull=this.allowNull;$e.nullText=this.nullText;$e.promptChar=this.promptChar;this.maskEdit=new PXMaskEdit($a,this.elemText,$e);};this.callbacks=new Array();this.callbacks[0]=__px_callback(this).copyCommand("DropDown",this.callBackMode);this.sizeLimit=new Object();__px_cm(this).readProperties(this.sizeLimit,$c,PXTreeSelector.sizeLimitDesc);this.sourceID=$d;this.viewState=new PXStateBag(this,"PXTreeSelector");};PXTreeSelector.__baseType=PXButtonEdit;PXTreeSelector.events={$beforeDropDown:15,$afterDropDown:16};PXTreeSelector.sizeLimitDesc=[["minDropWidth",JSType.Int,200,null,"minWidth"],["minDropHeight",JSType.Int,200,null,"minHeight"]];PXTreeSelector.properties=[["value",JSType.Empty,null],["valueType",JSType.Int,18],["allowEditValue",JSType.Bool,false],["appendSelectedValue",JSType.Bool,false],["autoRefresh",JSType.Bool,false],["initialExpandLevel",JSType.Int,1],["callBackMode",JSType.Object,PXCallbackManager.commandDesc],["inputMask",JSType.String,''],["promptChar",JSType.String,'_'],["tooltip",JSType.String,""]];PXTreeSelector.callbackProps=[["value",JSType.Empty,null,"setValue"],["hidden",JSType.Bool,false,PXControl.setHidden],["enabled",JSType.Bool,true,"setEnabled"],["readOnly",JSType.Bool,false,"setReadOnly"],["text",JSType.String,"","setText"],["tooltip",JSType.String,"","setTooltip"]];PXTreeSelector.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXTreeSelector.callbackProps);};PXTreeSelector.prototype.initInlineEditor=function($f){var cs=this.autoCallBack;if(cs.enabled){cs.enabled=false;cs.command=cs.target="";}};PXTreeSelector.prototype.detachEventHandlers=function(){PXTreeSelector.callBase(this,"detachEventHandlers");if(this.maskEdit!=null)this.maskEdit.detachEventHandlers();};PXTreeSelector.prototype.getValue=function(){var v=this.value;if(this.allowEditValue){if(this.maskEdit==null){var $g=this.elemText.value;v=(this.allowNull&&this.isNullValue($g))?null:$g;}else v=this.maskEdit.getValue(true);};return NetType.convert(v,this.valueType);};PXTreeSelector.prototype.setValue=function(v,$g){v=NetType.convert(v,this.valueType);if(this.allowEditValue){if(this.hasFocus){this.elemText.value=this.getEditText(v);if(this.selectOnFocus&&this.getVisible())this.elemText.select();}else this.elemText.value=this.getDisplayText(v);}else{this.value=v;this.viewState.update("Value",(v!=null)?v:"");if($g!=null)this.elemText.value=$g;else if(v==null)this.elemText.value=this.nullText;};this.oldValue=this.getValue();};PXTreeSelector.prototype.getEditText=function(v){if(this.allowEditValue){if(v===undefined)v=this.getValue();if(this.maskEdit!=null)return this.maskEdit.getEditText(v);return PXTreeSelector.callBase(this,"getEditText",[v]);};return this.elemText.value;};PXTreeSelector.prototype.getDisplayText=function(v){if(this.allowEditValue){if(v===undefined)v=this.getValue();if(this.maskEdit!=null)return this.maskEdit.getDisplayText(v);return PXTreeSelector.callBase(this,"getDisplayText",[v]);};return this.elemText.value;};PXTreeSelector.prototype.setText=function(v){if(!this.allowEditValue)this.elemText.value=(v==null)?"":v;};PXTreeSelector.prototype.commandStateCallback=function($h,$i){var $j=$h.getTooltip();if($j!=null)this.setTooltip($j);};PXTreeSelector.prototype.getTooltip=function(){return __px(this).getTitle(this.elemText);};PXTreeSelector.prototype.setTooltip=function(v){if(this.tooltip!=v){__px(this).setTitle(this.elemText,v);this.tooltip=v;}};PXTreeSelector.prototype.showDropDown=function(){if(this.dropOpen||!this.getEnabled())return;var $k=__doc(this).dropDownElem;if($k){var $l=__px_all(this)[$k.getAttribute("controlID")];if($l)$l.hideDropDown();};if(this.sourceID){var $m=__px_all(this)[this.sourceID];if($m.$J)this.$J=$m.$J;};if(!this.onShowDropDown())return;if(this.$J==null||(this.autoRefresh&&!this.isRefreshing)){this.$K=true;var $n=Function.createDelegate(this,this.$L);var $o=this.getSearchValue();this.isRefreshing=true;delete this.tree;__px_callback(this).execI(this,this.callbacks[0],$o,$n);}else{var $p=this.$J;if(!__px(this).elemByID($p.id))__win(this).theForm.appendChild($p);if(!this.tree)this.$M();this.tree.selector=this;this.$N(true);this.$O();this.isRefreshing=false;this.tree.adjustAutoGrowSize();this.initiallyExpand();}};PXTreeSelector.prototype.hideDropDown=function($q){var $p=this.$J;if(!$p||!this.dropOpen)return false;try{$p.style.display="none";if($q)this.$P();}finally{this.$N(false);this.onHideDropDown($q);};return true;};PXTreeSelector.prototype.onShowDropDown=function(){this.getSelectedText();if(this.oldValue===undefined)this.oldValue=this.getValue(true);return !this.fireEvent(15,null);};PXTreeSelector.prototype.onHideDropDown=function($q){var $r=new Object();$r.select=$q;$r.complete=$q;return !this.events.fireEvent(16,null,$r)};PXTreeSelector.prototype.getSearchValue=function(){return this.getValue(true);};PXTreeSelector.prototype.$L=function($s,$a){var $t=__px_all(this)[$a];if($s&&$t){var $u=$t.$Q()+"_div";var $p=__px_cm(this).processHtmlData($s,$u);if($t.sourceID){var $m=__px_all(this)[$t.sourceID];$m.$J=$p;};$t.$J=$p;setTimeout(function(){$t.$R();},0);}};PXTreeSelector.prototype.$R=function(id){__px_cm(this).handleLoad();this.showDropDown();};PXTreeSelector.prototype.$Q=function(){return this.sourceID?this.sourceID:this.ID;};PXTreeSelector.prototype.$M=function(){var $v=this.$Q()+"_tr",me=this;var $w=this.sourceID?(this.sourceID+"_tr"):null;if(!__px_all(this)[$v]){this.tree=__px_cm(this).createControl("PXTreeView",$v,$w);__px_all(this)[$v]=this.tree;}else this.tree=__px_all(this)[$v];if(!this.tree.hasSelectorEvents){var h=Function.createDelegate(this,this.$S);var h2=Function.createDelegate(this,this.$T);this.tree.events.addEventHandler("nodeClick",h);this.tree.events.addEventHandler("keyDown",h2);this.tree.events.addEventHandler("afterExpand",function(){me.$O();});this.tree.hasSelectorEvents=true;};__px_cm(this).registerResizableControl(this.tree,5);if(this.tree.toolBar){var h=Function.createDelegate(this,this.$U);this.tree.toolBar.events.addEventHandler("buttonClick",h);};this.tree.bindingContainer=this.bindingContainer;this.tree.ownerID=this.sourceID?this.sourceID:this.ID;this.tree.storeCookie=this.tree.postValues=false;};PXTreeSelector.prototype.$U=function($x,ev){switch(ev.button.key){case "Select":this.hideDropDown(true);this.focus();break;case "Refresh":this.tree.refresh();break;}};PXTreeSelector.prototype.$S=function($x,ev){if(ev.event.clickCount==2&&(ev.area==PXTreeArea.Text||ev.area==PXTreeArea.NodeImage)){ev.node.select();ev.cancel=true;this.hideDropDown(true);var id=this.elemText.id,me=this;setTimeout(function(){__px(me).selectElement(id,1);},1);}};PXTreeSelector.prototype.$T=function($x,ev){var $t=null,$q=false;switch(ev.key){case 13:case 27:this.hideDropDown(ev.key==13);ev.cancel=true;var id=this.elemText.id,me=this;setTimeout(function(){__px(me).selectElement(id,1);},1);break;}};PXTreeSelector.prototype.$P=function(){var $y,$z,$A=this.tree.selectedNode;if(this.allowEditValue){if(this.appendSelectedValue)$z=this.getEditText()+String($A.value);else $z=$A.value;}else{$z=$A.value;$y=$A.description?$A.description:$A.getText();};if($y!=null)this.setText($y);this.updateValue($z);};PXTreeSelector.prototype.$N=function($B){var $p=this.$J,ds=$p.style;if($B){__doc(this).dropDownElem=$p;$p.setAttribute("controlID",this.ID);if(!__px(this).elemByID($p.id))__win(this).theForm.appendChild($p);ds.display="";ds.zIndex=10500;ds.position="absolute";if(!__px(this).IsSafari)ds.left=ds.top="-1000px";this.dropOpen=true;var h=PXTreeSelector.$V;__px(this).addEventHandler(__doc(this),"mousedown",h,true);if(this.tree)this.tree.focus();}else{__win(this).theForm.removeChild($p);$p.style.display="none";__doc(this).dropDownElem=null;this.dropOpen=false;var h=PXTreeSelector.$V;__px(this).removeEventHandler(__doc(this),"mousedown",h,true);}};PXTreeSelector.prototype.$O=function(){var $b=this.element;var $p=this.$J,$C=__doc(this).documentElement;var $D=this.sizeLimit.minWidth+1,$E=this.sizeLimit.minHeight+1;if($D<$b.offsetWidth)$D=__px(this).getStyleWidth($b,$b.offsetWidth);var ts=this.tree.element.style;ts.width=$D+"px";ts.heigth=$E+"px";var $F=__px(this).getDropDownPos(this.element,$p,2);$p.style.left=$F.left+"px";$p.style.top=$F.top+"px";};PXTreeSelector.prototype.initiallyExpand=function(){if(this.initialExpandLevel>0){this.treeNodeExpandHandler=Function.createDelegate(this,this.onTreeNodeExpanded);this.tree.events.addEventHandler("afterExpand",this.treeNodeExpandHandler);this.initiallyExpandNodes(this.tree.nodes);};var $G=this.getValue();if($G){var $A=this.tree.find($G,true);if($A){$A.select();$A.ensureVisible();}}};PXTreeSelector.prototype.onTreeNodeExpanded=function($H,e){if(e.node.level+1<this.initialExpandLevel)this.initiallyExpandNodes(e.node.childNodes);};PXTreeSelector.prototype.initiallyExpandNodes=function($I){if($I!=null)for(var i=0;i<$I.length;i++)$I.getNode(i).expand();};PXTreeSelector.$V=function(e){var se=__px(this).eventElem(e),$p=__doc(this).dropDownElem;if($p&&!__px(this).contains($p,se)){var $t=__px_all(this)[$p.getAttribute("controlID")];if($t!=null&&!__px(this).contains($t.element,se)&&!__px(this).containsObject($t,e)&&(!$t.tree||!__px(this).containsObject($t.tree,e))){$t.hideDropDown();}}};PXTreeSelector.prototype.onKeyPress=function(e){return this.allowEditValue;};PXTreeSelector.prototype.onKeyDown=function(e){switch(e.keyCode){case 8:case 46:if(!this.allowEditValue){this.updateValue(null);return false;};break;case 114:this.showDropDown();__px(this).cancelEvent(e);break;};return true;};PXTreeSelector.prototype.onButtonClick=function(e){if(this.dropOpen){this.hideDropDown();this.focus();}else this.showDropDown();};



function PXSearchBox($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);if(!this.defaultSearch)this.defaultSearch=this.text;this.defaultSearchNavigateUrl=this.searchNavigateUrl;this.maxVisibleItems=15;this.edtSearch=__px(this).elemByID(this.ID+"_txtSearch");this.btnSearch=__px(this).elemByID(this.ID+"_btnSearch");this.btnAddNew=__px(this).elemByID(this.ID+"_btnAddNew");this.elemText=this.edtSearch;if(this.edtSearch!=null){__px(this).addEventHandler(this.elemText,"keydown",Function.createDelegate(this,this.textBoxKey));__px(this).addEventHandler(this.elemText,"keyup",Function.createDelegate(this,this.textBoxKeyUp));__px(this).addEventHandler(this.elemText,"keypress",Function.createDelegate(this,this.textBoxKeyPress));__px(this).addEventHandler(this.elemText,"focus",Function.createDelegate(this,this.onFocusGained));__px(this).addEventHandler(this.elemText,"blur",Function.createDelegate(this,this.onFocusLost));var h=Function.createDelegate(this,this.onClipboard);__px(this).addEventHandler(this.elemText,"paste",h,false);__px(this).addEventHandler(this.elemText,"cut",h,false);};if(this.btnSearch!=null)__px(this).addEventHandler(this.btnSearch,"click",Function.createDelegate(this,this.searchClicked));if(this.btnAddNew!=null)__px(this).addEventHandler(this.btnAddNew,"click",Function.createDelegate(this,this.addNewClicked));this.events=new PXEventList(this,PXSearchBox.events,$c.clientEvents);this.suggestCall=__px_callback(this).createCommand("Suggest",true);this.dropDownStyles=new Object();this.dropDownStyles.dropDown="ddSearch";this.dropDownStyles.item="ddSearchItem";this.dropDownStyles.selection="ddSearchSelItem";};PXSearchBox.properties=[["text",JSType.String,""],["searchNavigateUrl",JSType.String,""],["startSearchNode",JSType.String,""],["addNewNavigateUrl",JSType.String,""],["addNewEnabled",JSType.Bool,true],["target",JSType.String,""],["defaultSearch",JSType.String,""],["editorNonFocusedClass",JSType.String,""],["editorFocusedClass",JSType.String,""],["searchOnEmpty",JSType.Bool,false],["autoComplete",JSType.Bool,false],["searchSuggestionsText",JSType.String,""]];PXSearchBox.events={$initialize:0,$search:1};PXSearchBox.prototype.getVisible=function(){return this.element.style.display!="none";};PXSearchBox.prototype.setVisible=function(v){if(v!=this.getVisible())this.element.style.display=v?"":"none";};PXSearchBox.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXSearchBox.prototype.setEnabled=function($d){if($d!=this.getEnabled())__px_cm(this).setEnabled(this,$d);};PXSearchBox.prototype.getReadOnly=function(){return __px(this).getReadOnly(this.elemText);};PXSearchBox.prototype.getDisabled=function(){return !this.getEnabled()||this.getReadOnly();};PXSearchBox.prototype.getValue=function(){return this.edtSearch.value;};PXSearchBox.prototype.clearValue=function(){this.edtSearch.value="";};PXSearchBox.prototype.focus=function(){try{this.elemText.focus();}catch(e){}};PXSearchBox.prototype.searchClicked=function(e){var $e=this.edtSearch.value;if(this.getEnabled()&&$e!=this.defaultSearch){var $f=new Object();$f.value=$e;if(!this.events.fireEvent("search",e,$f)){if(this.dropDownOpen&&!this.$s){this.hideDropDown(true);}else if(this.searchNavigateUrl){__px(this).openUrl(this.searchNavigateUrl+$e,this.target);this.elemText.value="";}}};return false;};PXSearchBox.prototype.addNewClicked=function(e){if(this.addNewEnabled)__px(this).openUrl(this.addNewNavigateUrl,this.target);};PXSearchBox.prototype.textBoxKey=function(e){switch(e.keyCode){case 13:__px(this).cancelEvent(e);this.searchClicked(e);break;case 38:case 40:if(this.dropDownOpen){this.$t(e.keyCode==38);__px(this).cancelEvent(e);};break;case 8:case 46:if((__px(this).IsIE||__px(this).IsSafari)&&!this.getDisabled())this.textBoxKeyPress(e);break;}};PXSearchBox.prototype.textBoxKeyUp=function(e){if(this.searchOnEmpty){var $e=this.edtSearch.value;if(this.oldValue!==undefined&&this.oldValue!=$e&&$e===""){var $f={'value':$e};this.events.fireEvent("search",e,$f);};this.oldValue=this.edtSearch.value;}};PXSearchBox.prototype.onFocusGained=function(e){var $g=__px(this).eventElem(e);if($g.value==this.defaultSearch){$g.value="";$g.parentNode.className=this.editorFocusedClass;};if(this.defaultSearch==undefined){$g.parentNode.className=this.editorFocusedClass;}};PXSearchBox.prototype.onFocusLost=function(e){var $g=__px(this).eventElem(e);if($g.value.trim()==""){$g.value=this.text;$g.parentNode.className=this.editorNonFocusedClass;}};PXSearchBox.prototype.suggest=function(){var $h=Function.createDelegate(this,this.$u);__px_callback(this).execI(this,this.suggestCall,this.getValue(),$h);};PXSearchBox.prototype.$u=function($i,$a){delete this.$s;if(!$i){if(this.dropDownOpen)this.hideDropDown();}else this.$v($i);};PXSearchBox.prototype.hideDropDown=function($j){if(!this.dropDown)return;if($j){var $k,i=(this.currentRow!=null)?this.currentRow.rowIndex:-1;if(i>=0)$k=this.autoCompleteItems[i].value;if($k){__px(this).openUrl($k,this.target);this.elemText.value="";}};__px_cm(this).setDropDownVisible(this,false);};PXSearchBox.prototype.processDDEvents=function(e,$l){switch(e.type){case "mouseover":if($l&&($l!=this.currentRow))PXDropDown.hilightRow(this,this.dropDownStyles,$l);break;case "mousedown":this.focus();return __px(this).cancelEvent(e,true);case "mouseup":if($l){this.hideDropDown(true);this.focus();};break;}};PXSearchBox.prototype.textBoxKeyPress=function(e){if(this.autoComplete&&e.keyCode!=9)this.$w();};PXSearchBox.prototype.onClipboard=function(e){if(this.autoComplete)this.$w();};PXSearchBox.prototype.$w=function(){if(this.$s)this.$x();var me=this;setTimeout(function(){var $m=me.getValue();if(!$m||$m.length==1){if(me.dropDownOpen)me.hideDropDown();}else me.$s=setTimeout(function(){me.$y();},500);},0);};PXSearchBox.prototype.$x=function(){if(this.$s){clearTimeout(this.$s);delete this.$s;}};PXSearchBox.prototype.$y=function(){var $m=this.getValue(),me=this;if(!$m){if(this.dropDownOpen)this.hideDropDown();delete this.$s;}else if($m){if(this.elemText.getAttribute("unblock")==null){this.elemText.setAttribute("unblock","1");this.$z=true;};this.suggest($m);}};PXSearchBox.prototype.$v=function($n){if(typeof($n)=="string")this.autoCompleteItems=$n=this.$A($n);if($n.length==0){if(this.dropDownOpen)this.hideDropDown();return;};if(this.dropDown==null)PXDropDown.createDropDown(this,$n,this.dropDownStyles,false,this.searchSuggestionsText);else PXDropDown.fillDropDown(this,$n,this.dropDownStyles);if(!this.autoCompleteOpen){__px_cm(this).setDropDownVisible(this,true);PXDropDown.setDropDownSize(this);__px(this).setDropDownPos(this.element,this.dropDown,2);}else PXDropDown.setDropDownSize(this);PXDropDown.hilightRow(this,this.dropDownStyles,0);};PXSearchBox.prototype.$A=function($n){var ar=new Array(),$o=$n.split('|');for(var i=0;i<$o.length;i++){var $p=new Object(),$q=$o[i].split(';');$p.enabled=true;$p.value=$q[0];$p.text=$q[1];$p.imageUrl=$q[2];$p.note=$q[3];$p.startGroup=Boolean(parseInt($q[4]));ar.push($p);};return ar;};PXSearchBox.prototype.$t=function(back){var $r=this.activeRowIndex,$n=this.autoCompleteItems;if($r!=null){$r+=back?-1:1;if($r>=$n.length)$r=$n.length-1;else if($r<0)$r=0;}else $r=0;PXDropDown.hilightRow(this,this.dropDownStyles,$r);return $r;};



function PXWikiTree($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);__px_cm(this).registerRequiresOnLoad(this,$b.id);};PXWikiTree.properties=[["searchUrl",JSType.String,""],["newArticleUrl",JSType.String,""]];PXWikiTree.prototype.onLoad=function(){this.tree=__px_all(this)[this.ID+"_treeHlp"];if(this.tree){var style=__px(this).getComputedStyle(this.element);if(style.height){this.tree.autoSize.enabled=false;this.tree.element.style.height="100%";}}};



var PXReportCommand={PageNext:"PageNext",PagePrev:"PagePrev",PageFirst:"PageFirst",PageLast:"PageLast",Params:"Params",Groups:"Groups",Refresh:"Refresh",Print:"Print",Zoom:"Zoom",Export:"Export",PdfMode:"PdfMode",HtmlMode:"HtmlMode",Search:"Search",MailSend:"MailSend",Run:"Run",Edit:"Edit",LoadParams:"LoadParams",TemplateSave:"TemplateSave",TemplateRemove:"TemplateRemove",TemplateSchedule:"TemplateSchedule",TemplateSelect:"TemplateSelect"};function PXReportViewer($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);if(this.schema==null)this.schema=new Array();this.paramsPref=this.ID+"_par_";this.paramsFormID=this.paramsPref+"tab_t0_pForm";this.IsIE=__px(this).IsIE||__px(this).IsIE11;__px_cm(this).registerAutoSize(this,$c);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.pageIndex=this.pageCount=0;this.baseReportUri=this.handlerUri+"?InstanceID="+this.instanceID;this.reportRowIndex=this.toolBarID?0:1;var $d=$b.rows[this.reportRowIndex].cells[0];this.reportTable=$d.firstChild;var $e=this.reportTable.rows[0].cells[2];this.reportFrame=$e.getElementsByTagName("iframe")[0];this.waitControl=$e.childNodes[1];if(this.reportFrame){this.reportLoadH=Function.createDelegate(this,this.$0Z);__px(this).addEventHandler(this.reportFrame,"load",this.reportLoadH);if(this.reportFrame.contentWindow)this.reportFrame.contentWindow.location.href="about:blank";};this.events=new PXEventList(this,PXReportViewer.events,$c.clientEvents);this.viewState=new PXStateBag(this,"ReportViewer");this.callbacks=new Object();for(var i=0;i<PXReportViewer.callbacks.length;i++){var name=PXReportViewer.callbacks[i];var $f=name.substr(0,1).toLowerCase()+name.substr(1);this.callbacks[$f]=__px_callback(this).copyCommand(name,this.callBackMode);if(name=='TemplateSave')this.callbacks[$f].optimizePostData=false;};this.templateQueryCall=__px_callback(this).createCommand("TemplateQuery",true);this.scheduleQueryCall=__px_callback(this).createCommand("ScheduleQuery",true);};PXReportViewer.callbacks=["RefreshParams","Reload","LoadParams","TemplateSave","TemplateRemove","TemplateSelect","Navigate","MailSend","TemplateSchedule"];PXReportViewer.properties=[["handlerUri",JSType.String,""],["instanceID",JSType.String,""],["toolBarID",JSType.String,""],["nextReportUrl",JSType.String,""],["hideParameters",JSType.Bool,false],["autoExportPDF",JSType.Bool,false],["requestParams",JSType.Bool,true],["schema",JSType.Array,null],["requiredParams",JSType.Array,null],["callBackMode",JSType.Object,PXCallbackManager.commandDesc],["pdfViewMode",JSType.Bool,false],["navigationTree",JSType.Bool,true],["armMode",JSType.Bool,false],["armEditPage",JSType.String,""],["ofPage",JSType.String,""],["errorMsg",JSType.String,""],["errorEmptyMsg",JSType.String,""]];PXReportViewer.callbackProps=[["mailSendInProcess",JSType.Bool,false],["mailSendIsComplete",JSType.Bool,false]];PXReportViewer.prototype.setProperties=function($c){__px(this).stopLC();__px_cm(this).readProperties(this,$c,PXReportViewer.callbackProps);};PXReportViewer.events={$initialize:0,$commandState:1};PXReportViewer.prototype.onLoad=function(){this.$10();this.$11();this.$12();this.$13();this.$14();var $d=this.element.rows[this.reportRowIndex].cells[0];if($d.childNodes.length>1){this.paramsForm=$d.childNodes[1];this.paramsFrame=__px_all(this)[this.ID+"_par"];if(this.paramsFrame){var h=Function.createDelegate(this,this.$15);this.paramsFrame.events.addEventHandler("afterLoad",h);};var $g=__px_all(this)[this.ID+"_ok"];if($g){var h=Function.createDelegate(this,this.$16);$g.events.addEventHandler("click",h);};var $h=this.btnEdit=__px_all(this)[this.ID+"_edit"];if($h){var h=Function.createDelegate(this,this.$17);$h.events.addEventHandler("click",h);}};if(this.hasReportUri()){if(this.requestParams)this.showParams();else{if(__loc(this).href.indexOf("timeStamp=")>0){var ch=Function.createDelegate(this,this.$18);__px_callback(this).addHandler(ch);this.$19=true;}else this.pdfViewMode?this.refreshPage():this.navigate(0);}};if(this.nextReportUrl!=null&&this.nextReportUrl!=""){__px(this).openUrl(this.nextReportUrl,"_blank");}};PXReportViewer.prototype.$18=function($a,$i){if(this.$19){if(!$i)this.pdfViewMode?this.refreshPage():this.navigate(0);delete this.$19;}};PXReportViewer.prototype.onUnload=function(){var $j=this.baseReportUri+"&OpType=Clear";var $k=__px(this).createXMLHttpRequest();$k.open('GET',$j,true);$k.send(null);};PXReportViewer.prototype.getVisible=function(){return this.element.style.display!="none";};PXReportViewer.prototype.setVisible=function($l){if($l!=this.getVisible()){this.element.style.display=($l?"":"none");this.viewState.update("Visible",Boolean($l));}};PXReportViewer.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXReportViewer.prototype.setEnabled=function($m){if($m!=this.getEnabled()){__px(this).setEnabled(this.element,$m);this.viewState.update("Enabled",Boolean($m));}};PXReportViewer.prototype.setHeight=function($n){var h=parseInt($n),$o=this.reportFrame;var $p=this.element,$q=$p.rows[this.reportRowIndex].cells[0];h-=($p.offsetHeight-$q.clientHeight);h=(h>0?h:0)+"px";$p.style.height=$q.style.height=h;$o.style.height=$o.parentNode.style.height=h;this.groupsTree.element.style.height=h;};PXReportViewer.prototype.setPdfViewMode=function($r){this.pdfViewMode=$r;if(this.btnExport)this.btnExport.menuAbove=($r&&this.IsIE);};PXReportViewer.prototype.navigate=function($s,$t){if(this.hasReportUri()){var $u=this.printAllPages();if(this.paramsVisible())this.hideParams();this.pageIndex=$u?-1:$s;this.$1a();var $v=this.$1b()+($t?("&Group="+$t):"")+($u?"&JoinPages=True":"");this.reportLoaded=false;if(this.$1c){delete this.$1c;this.$1d();};this.reportFrame.contentWindow.location.replace($v);}};PXReportViewer.prototype.search=function($w){if(this.hasReportUri()){if(this.paramsVisible())this.hideParams();this.$1a();var $v=this.$1b()+"&Search="+$w;this.reportFrame.contentWindow.location.replace($v);}};PXReportViewer.prototype.hasReportUri=function(){return this.handlerUri&&this.instanceID;};PXReportViewer.prototype.printAllPages=function(){return this.chkPrintAll&&this.chkPrintAll.getChecked();};PXReportViewer.prototype.$1d=function(){__px(this).removeEventHandler(this.reportFrame,"load",this.reportLoadH);var $x=this.reportFrame;var $o=this.reportFrame=__px(this).createElement("iframe",$x.parentNode);$o.frameBorder=0;$o.style.backgroundColor=$x.style.backgroundColor;$o.style.width=$x.style.width;$o.style.height=$x.style.height;$x.src="";$x.parentNode.removeChild($x);__px(this).addEventHandler(this.reportFrame,"load",this.reportLoadH);};PXReportViewer.prototype.refreshPage=function(){if(this.hasReportUri()){if(this.paramsVisible())this.hideParams();if(this.pdfViewMode&&this.groupsVisible())this.hideGroups();this.$1a();var $v=null;if(!this.pdfViewMode){var $u=this.printAllPages(),pi=$u?-1:null;$v=this.$1b(pi)+"&Refresh=True"+($u?"&JoinPages=True":"");}else $v=this.$1e()+"&Refresh=True";if(this.printFrame)this.printFrame.$1f=false;if(!this.pdfViewMode&&!this.armMode)this.$1g=false;this.reportLoaded=false;if(this.IsIE||__px(this).IsEdge)this.$1d();this.reportFrame.contentWindow.location.replace($v);if(this.pdfViewMode){this.pageCount=this.pageIndex=1;if(this.IsIE||__px(this).IsEdge)this.$0Z();}}};PXReportViewer.prototype.exportData=function($y){if(this.hasReportUri()){this.$1h();this.exportFrame.src=this.$1i($y);}};PXReportViewer.prototype.showParams=function(){this.paramsForm.style.display="";this.reportTable.style.display="none";this.$1j();if(this.paramsFrame.loaded)this.$14();this.paramsFrame.load();if(this.paramsFrame)__px_cm(this).performAutoSize(this.paramsFrame);this.notifyCommandState();};PXReportViewer.prototype.hideParams=function(){this.paramsForm.style.display="none";this.reportTable.style.display="";this.$14();this.notifyCommandState();};PXReportViewer.prototype.paramsVisible=function(){return this.paramsForm!=null&&(this.paramsForm.style.display=="");};PXReportViewer.prototype.loadEditSchema=function($z){if(this.hasReportUri()){this.$1h();this.exportFrame.src=this.$1k($z);}};PXReportViewer.prototype.run=function(){if(this.requiredParams){var $A=__px_all(this)[this.paramsFormID];var $B=null;if($A){for(var i=0;i<this.requiredParams.length;i++){var name=this.requiredParams[i];var $C=this.getParamsControl("ed"+name);if($C==null)continue;var $r=$C.getValue(true);if($r==null||$r.toString()==""){var $D=$C.getLabelText?$C.getLabelText():name;if(!$D)$D=name;$B=this.errorMsg+": '"+$D+"' "+this.errorEmptyMsg;$A.setControlError($C,$B);}else $A.setControlError($C,null);};if($B){alert($B);return;}}};var $E=this.getParamsControl("edcmViewPdf");if($E!=null)this.setPdfViewMode($E.getValue());if(this.sortGrid)this.sortGrid.endEdit(false);if(this.filterGrid)this.filterGrid.endEdit(false);this.refreshParams();};PXReportViewer.prototype.edit=function(){if(this.armMode){if(this.armEditPage){var $F=__loc(this).href.toLowerCase(),i=$F.indexOf("id=");var $G=null;if($F.substr(i+3).indexOf(".")==-1){$G=$F.substr(i+3).split("&")[0];}else{$G=$F.substr(i+3).split(".")[0];};__px(this).openUrl(this.armEditPage+"?ReportCode="+$G,"_blank");}}else this.loadEditSchema();};PXReportViewer.prototype.showGroups=function(){var $H=this.reportTable.rows[0];if(__px(this).IsIE)$H.cells[2].style.width="80%";$H.cells[0].style.display="";$H.cells[1].style.display="";this.splitter.onAfterResize();this.$14();if(!this.$1g){this.groupsTree.refresh();this.$1g=true;}};PXReportViewer.prototype.hideGroups=function(){var $H=this.reportTable.rows[0];if(__px(this).IsIE)$H.cells[2].style.width="";$H.cells[0].style.display="none";$H.cells[1].style.display="none";this.$14();};PXReportViewer.prototype.groupsVisible=function(){return(this.reportTable.rows[0].cells[0].style.display=="");};PXReportViewer.prototype.print=function(){if(this.hasReportUri()){if(this.printFrame==null){this.printFrame=__doc(this).createElement("iframe");var style=this.printFrame.style;this.printFrame.frameBorder=0;style.height=style.width="0px";__doc(this).body.appendChild(this.printFrame);var h=Function.createDelegate(this,this.$1l);__px(this).addEventHandler(this.printFrame,"load",h);};if(!this.printFrame.$1f){__px(this).startWC();this.printFrame.contentWindow.location.replace(this.$1b(-1));return;};try{var $I=this.printFrame.contentWindow;if(__px(this).IsAnyIE)$I.document.execCommand("print",true,null);else if($I.print)$I.print();}catch(ex){alert("Error report printing:\n\n"+ex);}}};PXReportViewer.prototype.setZoom=function($w){var $o=this.reportFrame;var $J=100,$K="percent";this.$1m=$w;if($w){$J=parseInt($w);$K=String($w).toLowerCase();};if(isNaN($J)){var $L=$o.contentWindow.document.getElementById('ReportTable');if($L){$o.style.zoom=1;$J=1;if($K.indexOf("pagewidth")>-1){$J=$o.offsetWidth/$L.offsetWidth;if($o.offsetHeight<($L.offsetHeight*$J))$J=$o.offsetWidth/($L.offsetWidth+18);}else if($K.indexOf("fullpage")>-1){var $M=$o.offsetWidth/$L.offsetWidth;var $N=$o.offsetHeight/$L.offsetHeight;$J=($M<$N)?$M:$N;};$o.style.zoom=$J;}}else $o.style.zoom=$J+"%";};PXReportViewer.prototype.reload=function($O,$z){var $P=Function.createDelegate(this,this.$1n);var $Q=$O?$O:"",$R=new Object();$R.controlID=this.ID;if($z){$Q+="|"+$z;$R.version=$z;};__px_callback(this).execI(this,this.callbacks.reload,$Q,$P,$R);};PXReportViewer.prototype.$1n=function($S,$a){var $T=__px_all(this)[$a.controlID];if($S&&$T){if($T.paramsFrame){if(this.$1o)this.$1o.setPushed(false);$T.paramsFrame.setLoaded(false);$T.activeVersion=$a.version;};var $U=$S.split("|"),$schema;$T.requestParams=Boolean.parse($U[0]);$T.navigationTree=Boolean.parse($U[1]);$T.setPdfViewMode(Boolean.parse($U[2]));if($U.length>3){$U.splice(0,3);eval("$schema = "+$U.join('|'));$T.schema=$schema;};$T.pageCount=0;if(!$T.navigationTree)$T.hideGroups();$T.$1g=false;if(!$T.requestParams){__px(this).stopLC();$T.pdfViewMode?$T.refreshPage():$T.navigate(0);}else $T.showParams();}};PXReportViewer.prototype.loadParams=function(){var $P=Function.createDelegate(this,this.$1p);__px_callback(this).execI(this,this.callbacks.loadParams,"",$P);};PXReportViewer.sharedClick=function($V){var $W=$V,$X=$V.ID.lastIndexOf('_');var $Y=$V.ID.substr(0,$X)+'_tDefault';var $Z=__px_all($V)[$Y];if($Z!=null){if($W.getChecked()){$Z.setChecked(false);$Z.setEnabled(false);}else $Z.setEnabled(true);}};PXReportViewer.prototype.templateSave=function(){if(this.sortGrid)this.sortGrid.endEdit(false);if(this.filterGrid)this.filterGrid.endEdit(false);var $00=this.getParamsControl("tName");if($00!=null){var name=$00.getValue();this.showTemplateQuery(name);}};PXReportViewer.prototype.templateSchedule=function(){if(this.sortGrid)this.sortGrid.endEdit(false);if(this.filterGrid)this.filterGrid.endEdit(false);this.showScheduleQuery();};PXReportViewer.prototype.getParamsControl=function(name){return __px_alls(this)[name];};PXReportViewer.prototype.showTemplateQuery=function(name){if(this.$1q==null){var $P=Function.createDelegate(this,this.$1r);__px_callback(this).execI(this,this.templateQueryCall,"",$P);}else{this.$1q.setText(name);this.$1q.show();}};PXReportViewer.prototype.showScheduleQuery=function(){if(this.$1s==null){var $P=Function.createDelegate(this,this.$1t);__px_callback(this).execI(this,this.scheduleQueryCall,this.getParamsControl("tName").getValue(),$P);}else{this.$1s.show();}};PXReportViewer.prototype.$1r=function($S,$a){var $00=__px_all(this)[$a];if($S&&$00){var $01=$00.ID+"_div";var $02=new PXXmlDoc("",$S),$03=$02.rootNode;var $04=__px_cm(this).processHtmlData($03.childNodes[0].nodeValue,$01);var $05=$00.getParamsControl("tName");$00.$1q=__px_all(this)[$00.ID+"_ibTemplate"];$00.$1q.setText($05.getValue());$00.$1q.show();var $P=Function.createDelegate($00,$00.$1u);$00.$1q.events.addEventHandler("afterHide",$P);}};PXReportViewer.prototype.$1t=function($S,$a){var $00=__px_all(this)[$a];if($S&&$00){var $01=$00.ID+"_div",me=this;var $02=new PXXmlDoc("",$S),$03=$02.rootNode;var $04=__px_cm(this).processHtmlData($03.childNodes[0].nodeValue,$01);var $05=$00.getParamsControl("tName");$00.$1s=__px_all(this)[$00.ID+"_ibSchedule"];$00.$1s.show();var $P=Function.createDelegate($00,$00.$1v);$00.$1s.events.addEventHandler("afterHide",$P);setTimeout(function(){$00.$1w=__px_all(me)[$00.ID+"_ibSchedule_chk"];$00.$1x=__px_all(me)[$00.ID+"_ibSchedule_ne"];},0);}};PXReportViewer.prototype.$1u=function(){if(this.$1q.dialogResult==PXDialogResult.OK){var name=this.$1q.getText();if(name!=""){var $06=this.$1y();$06.setProperty($06.rootNode,"TemplateName",name);var $Q=$06.toString();var $P=Function.createDelegate(this,this.$1z);__px_callback(this).execI(this,this.callbacks.templateSave,$Q,$P);this.notifyCommandState();}}};PXReportViewer.prototype.$1v=function(){if(this.$1s.dialogResult==PXDialogResult.OK){var $00=this.getParamsControl("tName");if($00!=null){var name=$00.getValue();var id=this.$1s.getValue();var $07=this.$1w.getChecked();var ne=this.$1x.getValue();if(name!=""&&id!=""){__px_callback(this).execI(this,this.callbacks.templateSchedule,name+"|"+id+"|"+$07+"|"+ne,null);}}}};PXReportViewer.prototype.startMailSend=function(){__px_callback(this).execI(this,this.callbacks.mailSend,null,null);};PXReportViewer.prototype.templateRemove=function(){var $00=this.getParamsControl("tName");if($00!=null){var $Q=$00.getValue();__px_callback(this).execI(this,this.callbacks.templateRemove,$Q,null);$00.removeItem($Q);this.$1j();this.$14();}};PXReportViewer.prototype.templateSelect=function(){var $00=this.getParamsControl("tName");if($00!=null){var $Q=$00.getValue();var $P=Function.createDelegate(this,this.$1p);__px_callback(this).execI(this,this.callbacks.templateSelect,$Q,$P);}};PXReportViewer.prototype.$1j=function($08){var $00=this.getParamsControl("tName");if($00!=null){var $08=$00.getValue()!=null&&$00.getValue()!="";var $09=__px_all(this)[this.ID+"_remove"];if($09==null)$09=__px_all(this)[this.ID+"_form_remove"];$09.setEnabled($08);var $0a=__px_all(this)[this.ID+"_schedule"];if($0a==null)$0a=__px_all(this)[this.ID+"_form_schedule"];$0a.setEnabled($08);}};PXReportViewer.prototype.$1p=function($S,$a){var $T=__px_all(this)[$a];if($S&&$T){var $02=new PXXmlDoc("",$S),$03=$02.rootNode;for(var i=0;i<$03.childNodes.length;i++){var n=$03.childNodes[i];switch(n.tagName){case "Filter":if($T.filterGrid)$T.filterGrid.processRefresh($02.toString(n.childNodes[0]));break;case "Sorting":if($T.sortGrid)$T.sortGrid.processRefresh($02.toString(n.childNodes[0]));break;case "Params":$T.$1A(n,"ed",true);break;case "Mail":$T.$1A(n,"edml");break;case "Common":$T.$1A(n,"edcm");break;case "Template":$T.$1A(n,"t");PXReportViewer.sharedClick(this.getParamsControl("tShared"));break;case "Schedule":$T.$1B(n,$a);break;}};$T.showParams();}};PXReportViewer.prototype.$1A=function(n,$0b,$0c){if(this.requiredParams){var $A=__px_all(this)[this.paramsFormID];for(var i=0;i<this.requiredParams.length;i++){var $C=this.getParamsControl($0b+this.requiredParams[i]);if($C!=null)$A.setControlError($C,null);}};for(var j=0;j<n.childNodes.length;j++){var n2=n.childNodes[j];var $00=this.getParamsControl($0b+n2.tagName);if($00)$00.setValue(n2.getAttribute("Value"),n2.getAttribute("Text"));}};PXReportViewer.prototype.$1B=function(n,$a){var $00=__px_all(this)[$a];var $0d=__px_all(this)[$00.ID+"_ibSchedule_chk"];var $0e=__px_all(this)[$00.ID+"_ibSchedule_ne"];if($0d!=null&&$0e!=null){for(var j=0;j<n.childNodes.length;j++){var n2=n.childNodes[j];var c=__px_all(this)[$00.ID+"_ibSchedule_"+n2.tagName];if(c!=null)c.setValue(n2.getAttribute("Value"));};$0e.setEnabled($0d.getChecked());}};PXReportViewer.prototype.refreshParams=function(){var $P=Function.createDelegate(this,this.$1C);var $Q=this.$1y().toString();var ae=__doc(this).activeElement,me=this;if(ae&&ae.id&&ae.blur)ae.blur();setTimeout(function(){__px_callback(me).execI(me,me.callbacks.refreshParams,$Q,$P);},0);};PXReportViewer.prototype.$1C=function($S,$a){var $T=__px_all(this)[$a];if($S&&$T){$T.pageIndex=0;$T.refreshPage();}};PXReportViewer.prototype.executeCallback=function($0f,$0g){switch($0f){case "Reload":this.reload($0g);break;case "RefreshParams":this.refreshParams();break;default:this.executeCommand($0f);break;}};PXReportViewer.prototype.registerCommandControl=function($V,$0f){__px_cm(this).registerCommandControl(this,$V,$0f);};PXReportViewer.prototype.notifyCommandState=function(){__px_cm(this).notifyCommandState(this,PXReportCommand);};PXReportViewer.prototype.getCommandState=function($0h,$0f){var $08=PXCommandState.empty,$0i=new Object();$0i.sender=$0h;$0i.command=$0f;switch($0f){case PXReportCommand.Run:$08=new PXCommandState(!this.hideParameters&&this.paramsVisible(),true);break;case PXReportCommand.Edit:$08=new PXCommandState(this.paramsVisible()&&this.btnEdit!=null,true);break;case PXReportCommand.TemplateRemove:case PXReportCommand.TemplateSchedule:var $05=this.getParamsControl("tName");$08=new PXCommandState(this.paramsVisible(),this.paramsVisible()&&$05&&$05.getValue()!=null);break;case PXReportCommand.TemplateSave:$08=new PXCommandState(this.paramsVisible(),true);break;case PXReportCommand.TemplateSelect:case PXReportCommand.LoadParams:$08=new PXCommandState(this.paramsVisible(),this.paramsVisible());break;};if($08!=PXCommandState.empty){$0i.state=$08;this.events.fireEvent("commandState",null,$0i);return $08;};var $0j=this.requestParams&&this.paramsForm==null;if((this.paramsVisible()||$0j)&&$0f!=PXReportCommand.Params)return new PXCommandState(false,false);switch($0f){case PXReportCommand.PageFirst:$08=new PXCommandState(!this.pdfViewMode,this.$1D(0));break;case PXReportCommand.PageLast:$08=new PXCommandState(!this.pdfViewMode,this.$1D(this.pageCount-1));break;case PXReportCommand.PageNext:$08=new PXCommandState(!this.pdfViewMode,this.$1D(this.pageIndex+1));break;case PXReportCommand.PagePrev:$08=new PXCommandState(!this.pdfViewMode,this.$1D(this.pageIndex-1));break;case PXReportCommand.Search:$08=new PXCommandState(!this.pdfViewMode,Boolean(this.searchEditor&&this.searchEditor.getValue()));break;case PXReportCommand.Zoom:$08=new PXCommandState(false,this.hasReportUri()&&(this.pageCount>0));break;case PXReportCommand.Refresh:case PXReportCommand.Export:$08=new PXCommandState(true,this.hasReportUri()&&(this.pageCount>0));break;case PXReportCommand.Params:$08=new PXCommandState(!this.hideParameters,this.hasReportUri()&&(this.pageCount>0));break;case PXReportCommand.PdfMode:$08=new PXCommandState(!this.pdfViewMode,true);break;case PXReportCommand.MailSend:$08=new PXCommandState(true,true);break;case PXReportCommand.HtmlMode:$08=new PXCommandState(this.pdfViewMode,true);break;case PXReportCommand.Groups:$08=new PXCommandState(!this.pdfViewMode&&this.navigationTree,this.navigationTree&&(this.pageCount>0));break;case PXReportCommand.Print:var $0k=!this.pdfViewMode;if(this.pdfViewMode)$08=new PXCommandState($0k,false);var $I=this.reportFrame.contentWindow,$0l=false;try{if(__px(this).IsIE)$08=new PXCommandState($0k,$I.document.queryCommandSupported("print"));}catch(ex){return new PXCommandState($0k,false);};try{$0l=$I&&$I.print!=null;}catch(ex){};$08=new PXCommandState($0k,$0l);break;};$0i.state=$08;this.events.fireEvent("commandState",null,$0i);return $08;};PXReportViewer.prototype.executeCommand=function($0f,$0g){if(!this.getCommandState(this,$0f).getEnabled())return;switch($0f){case PXReportCommand.PageFirst:this.navigate(0);break;case PXReportCommand.PageLast:this.navigate(this.pageCount-1);break;case PXReportCommand.PageNext:this.navigate(this.pageIndex+1);break;case PXReportCommand.PagePrev:this.navigate(this.pageIndex-1);break;case PXReportCommand.Refresh:this.refreshPage();break;case PXReportCommand.HtmlMode:this.setPdfViewMode(false);this.$1c=this.IsIE;this.navigate(0);break;case PXReportCommand.PdfMode:this.setPdfViewMode(true);this.refreshPage();break;case PXReportCommand.Params:this.paramsVisible()?this.hideParams():this.showParams();break;case PXReportCommand.Groups:this.groupsVisible()?this.hideGroups():this.showGroups();break;case PXReportCommand.Zoom:this.setZoom($0g?$0g:"PageWidth");break;case PXReportCommand.Print:this.print();break;case PXReportCommand.Export:this.exportData($0g?$0g:"Excel");break;case PXReportCommand.Search:this.search($0g?$0g:this.searchEditor.getValue());break;case PXReportCommand.MailSend:if(this.pdfViewMode){this.setPdfViewMode(false);this.$1c=this.IsIE;this.navigate(0);this.$1E=true;}else this.startMailSend();break;case PXReportCommand.TemplateSave:this.templateSave();break;case PXReportCommand.TemplateRemove:this.templateRemove();break;case PXReportCommand.TemplateSelect:this.templateSelect();break;case PXReportCommand.TemplateSchedule:this.templateSchedule();break;case PXReportCommand.Run:this.run();break;case PXReportCommand.Edit:this.edit();break;case PXReportCommand.LoadParams:this.loadParams();break;}};PXReportViewer.prototype.$10=function(){if(this.toolBar==null){if(this.toolBarID)this.toolBar=__px_alls(this)[this.toolBarID];if(this.toolBar==null){var id=this.ID+"_tlb";this.toolBar=__px_cm(this).createControl("PXToolBar",id);if(this.toolBar){__px_all(this)[id]=this.toolBar;this.toolBar.onLoad();}};if(this.toolBar)this.toolBar.trackSeparators=true;else return null;var h=Function.createDelegate(this,this.$1F);this.toolBar.events.addEventHandler("buttonClick",h);var tm=__px_tm(this),$0m=this.toolBar.element;if(tm!=null&&this.IsIE)tm.registerHandler(function(){tm.unregister($0m);});for(var i=0;i<this.toolBar.items.length;i++){var $0n=this.toolBar.items[i];var $0o=$0n.commandName?$0n.commandName:$0n.key;switch($0o){case PXReportCommand.Zoom:var $0p=$0n.getMenu();if($0p){h=Function.createDelegate(this,this.$1G);$0p.events.addEventHandler("itemClick",h);this.$1H=$0p.items.getItem(1);};break;case PXReportCommand.Export:var $0p=$0n.getMenu();if($0p){h=Function.createDelegate(this,this.$1I);$0p.events.addEventHandler("itemClick",h);};this.btnExport=$0n;break;case PXReportCommand.Params:this.$1o=$0n;break;case PXReportCommand.Groups:this.$1J=$0n;break;case PXReportCommand.Search:this.$1K=$0n;break;}}};return this.toolBar;};PXReportViewer.prototype.$11=function(){if(this.pageEditor==null){var id=this.toolBarID?(this.toolBarID+"_pn"):(this.ID+"_tlb_pn");var $b=__px(this).elemByID(id);if($b){this.pageEditor=new PXNumberEdit(this.px_context,$b,new Object());this.pageEditor.setMinValue(1);var h=Function.createDelegate(this,this.$1L);this.pageEditor.events.addEventHandler("valueChanged",h);}};return this.pageEditor;};PXReportViewer.prototype.$13=function(){if(this.searchEditor==null){var id=this.toolBarID?(this.toolBarID+"_ft"):(this.ID+"_tlb_ft");this.searchEditor=__px_all(this)[id];if(this.searchEditor){var h=Function.createDelegate(this,this.$1M);this.searchEditor.events.addEventHandler("search",h);}};return this.searchEditor;};PXReportViewer.prototype.$12=function(){if(this.groupsTree==null){var id=this.ID+"_gt";this.groupsTree=__px_cm(this).createControl("PXTreeView",id);if(this.groupsTree){__px_all(this)[id]=this.groupsTree;var h=Function.createDelegate(this,this.$1N);this.groupsTree.events.addEventHandler("nodeClick",h);}};if(this.splitter==null){var id=this.ID+"_sp";this.splitter=__px_cm(this).createControl("PXSplitter",id);if(this.splitter)__px_all(this)[id]=this.splitter;}};PXReportViewer.prototype.$1a=function(){this.$1O(true);};PXReportViewer.prototype.$1P=function(){this.$1O(false);};PXReportViewer.prototype.$1O=function($0q){var rf=this.reportFrame.parentNode,$0r=rf.clientWidth;rf.style.position=$0q?"absolute":"";rf.style.top=$0q?"-2000px":"";rf.style.width=$0q?($0r+"px"):"";this.waitControl.style.display=$0q?"":"none";};PXReportViewer.prototype.$1b=function(pi){if(pi==null)pi=this.pageIndex;var $v=this.baseReportUri+"&OpType=Report"+"&PageIndex="+pi;var $0s=this.getParamsControl("tLocale");if($0s&&$0s.getValue()){$v+="&Locale="+$0s.getValue();};return $v;};PXReportViewer.prototype.$1i=function($y){var $v=this.baseReportUri+"&OpType=Export"+"&ExportFormat="+$y;var $0s=this.getParamsControl("tLocale");if($0s&&$0s.getValue()){$v+="&Locale="+$0s.getValue();};return $v;};PXReportViewer.prototype.$1e=function(){var $v=this.baseReportUri+"&OpType=PdfReport";var $0s=this.getParamsControl("tLocale");if($0s&&$0s.getValue()){$v+="&Locale="+$0s.getValue();};return $v;};PXReportViewer.prototype.$1k=function($z){var $v=this.baseReportUri+"&OpType=Schema";if($z!=null)$v+="&Version="+$z;return $v;};PXReportViewer.prototype.$14=function(){var $0t=this.paramsVisible();for(var i=0;i<this.toolBar.items.length;i++){var $0n=this.toolBar.items[i];if(($0n.commandName||$0n.key)&&$0n.setEnabled){var $08=this.getCommandState(this.toolBar,$0n.commandName?$0n.commandName:$0n.key);$0n.setEnabled($08.getEnabled());$0n.setVisible($08.getVisible());}};if(this.$1o)this.$1o.setPushed($0t);if(this.$1J)this.$1J.setPushed(this.groupsVisible());var $0u=!$0t&&!this.pdfViewMode,$0v=(this.pageCount>0)&&$0u;if(this.pageEditor!=null)this.pageEditor.setVisible($0v);if(this.searchEditor!=null)this.searchEditor.setVisible($0v);var $0w=this.toolBar.items["pc"];if($0w!=null){if(this.pdfViewMode||!(this.pageCount>0))$0w.setText("");else $0w.setText(this.ofPage+this.pageCount);$0w.setVisible($0v);};if(this.btnCancel!=null)this.btnCancel.setEnabled(this.pageCount>0);};PXReportViewer.prototype.$1D=function($s){return $s>=0&&$s<this.pageCount&&$s!=this.pageIndex;};PXReportViewer.prototype.$1y=function(){var $02=new PXXmlDoc("Params");if(this.filterGrid&&this.filterGrid.rows.length>0)this.$1Q(this.filterGrid,$02,"Filter");if(this.sortGrid&&this.sortGrid.rows.length>0)this.$1Q(this.sortGrid,$02,"Sorting");return $02;};PXReportViewer.prototype.$1Q=function($0x,$06,$0y){var $0z=$06.addNode($0y,$06.rootNode);for(var i=0;i<$0x.rows.length;i++){var $0A=$06.addNode("Row",$0z);var $H=$0x.rows.getRow(i);for(var j=0;j<$H.cells.length;j++){var $0B=$06.addNode("Cell",$0A);var $q=$H.getCell(j);$06.setProperty($0B,"Value",$q.getInvariantText());}}};PXReportViewer.prototype.$1h=function(){if(this.exportFrame==null){this.exportFrame=__doc(this).createElement("iframe");this.exportFrame.style.display="none";__doc(this).body.appendChild(this.exportFrame);}};PXReportViewer.prototype.$1R=function($0C){var $0D=null,$0E=null,$0F=null,$0G=null;for(var j=0;j<this.schema.length;j++){var $0n=this.schema[j];if($0n[0]==$0C){$0D=$0n[1];if($0n.length>2)$0E=$0n[2];if($0n.length>3)$0F=($0n[3]<=0)?null:$0n[3];if($0n.length>4)$0G=$0n[4];break;}};return[$0D,$0E,$0F,$0G];};PXReportViewer.prototype.$1S=function(){var $H=this.filterGrid.activeRow,$0H=false,$0I=false;if($H){var $0C=$H.getCell("DataField").getValue();var $0D=this.$1R($0C)[0];if($0D!=null){$0H=($0D==NetType.DateTime);$0I=NetType.isNumeric($0D);}};var vi=this.filterGrid.levels[0].getColumn("Condition").valueItems;for(var i=13;i<vi.length;i++)vi[i].enabled=$0H;for(var i=6;i<=9;i++)vi[i].enabled=!$0H&&!$0I;};PXReportViewer.prototype.$1F=function($0J,ev){var $0K=ev.button;this.executeCommand($0K.commandName,$0K.commandArgument);if($0K.commandName==PXReportCommand.Zoom&&this.$1H)this.$1H.setChecked(true);};PXReportViewer.prototype.$1T=function(e){var se=__px(this).eventElem(e);if(se&&se.tagName=="SPAN"&&se.parentNode.tagName=="A")se=se.parentNode;if(se&&se.tagName=="A"){var $0L="javascript:";if(se.href.startsWith($0L)){var $0M=se.href.substring($0L.length);__px(this).cancelEvent(e);var $P=Function.createDelegate(this,this.$1U);var $a=new Object();$a.target=se.target?se.target:"_blank";$a.openFrameset=e.shiftKey||e.ctrlKey;__px_callback(this).execI(this,this.callbacks.navigate,$0M,$P,$a);}else{__px(this).cancelEvent(e);__px(this).openUrl(se.href,se.target?se.target:"_self");}}};PXReportViewer.prototype.$1U=function($S,$a){if($S)__px(this).openUrl($S,$a.target,$a.openFrameset);};PXReportViewer.prototype.$16=function($0K,ev){this.run();};PXReportViewer.prototype.$1G=function($0p,ev){var $0n=ev.item;this.executeCommand(PXReportCommand.Zoom,$0n.getText());};PXReportViewer.prototype.$17=function($0K,ev){this.edit();};PXReportViewer.prototype.$1V=function($0x,ev){var ar=$0x.activeRow;switch(ev.button.key){case "Edit":if(ar)this.loadEditSchema(ar.getCell("Version").getValue());break;case "Select":if(ar){var $q=ar.getCell("IsActive");if($q)$q.switchCheckState();};break;}};PXReportViewer.prototype.$1W=function($0x,ev){if(ev.cell.column.dataField=="IsActive"){this.$1X=true;__px(this).startLC();}};PXReportViewer.prototype.$1Y=function($0x,ev){if(this.$1X){delete this.$1X;this.reload();}};PXReportViewer.prototype.$1I=function($0p,ev){var $0n=ev.item;this.executeCommand(PXReportCommand.Export,$0n.commandArgument);};PXReportViewer.prototype.$1L=function($0N,ev){this.navigate($0N.getValue()-1);};PXReportViewer.prototype.$1M=function($C,ev){var $r=this.searchEditor.getValue();ev.cancel=true;{this.search($r);this.searchEditor.oldValue="";}};PXReportViewer.prototype.$1N=function($0O,ev){if(ev.area!=PXTreeArea.StateImage){if(this.armMode){var $P=Function.createDelegate(this,this.$1Z);__px_callback(this).execI(this,this.callbacks.navigate,"u|"+ev.node.value,$P);}else{var $r=ev.node.value;if(!$r&&ev.node.hasChild)$r=ev.node.childNodes.getNode(0).value;if($r){var ar=$r.split("|");this.navigate(parseInt(ar[0])-1,ar[1]);}}}};PXReportViewer.prototype.$1Z=function($S,$a){var $T=__px_all(this)[$a];if($T)$T.refreshPage();};PXReportViewer.prototype.$0Z=function(){var $0P=this.reportFrame.contentWindow,$0Q,$0R,$02;try{$0Q=$0P.reportInfo;$0R=$0P.processInfo;}catch(ex){};if(this.$1E){delete this.$1E;this.startMailSend();};if($0R){$0P.location.replace($0P.location.href.replace("&Refresh=True",""));return;};if($0Q){if($0Q[0]<0){this.pageIndex=0;this.pageCount=1;}else{this.pageIndex=$0Q[0];this.pageCount=$0Q[1];};if(this.pageIndex>=this.pageCount)this.pageIndex=this.pageCount-1;if(this.pageEditor!=null){this.pageEditor.setValue(this.pageIndex+1);this.pageEditor.setMaxValue(this.pageCount);};var $0w=this.toolBar.items["pc"];if($0w!=null){$0w.setText("of "+this.pageCount);};this.$1P();this.setZoom(this.$1m);}else this.$1P();try{$02=$0P.document;}catch(ex){};if($02!=null){var h=Function.createDelegate(this,this.$1T);__px(this).addEventHandler($02,"click",h);};if(!this.$1g&&this.groupsVisible()){this.groupsTree.refresh();this.$1g=true;};this.$14();this.notifyCommandState();__px_cm(this).notifyOnResize();if($0Q||(this.pdfViewMode&&!this.paramsVisible())){this.reportLoaded=true;if(this.autoExportPDF)this.executeCommand("Export","PDF");}};PXReportViewer.prototype.$1l=function(){__px(this).stopWC();this.printFrame.$1f=true;this.print();};PXReportViewer.prototype.$15=function(){var $0S=this.getParamsControl("gridF");var $0T=this.getParamsControl("gridS");var $0U=this.getParamsControl("gridV");var h1=Function.createDelegate(this,this.$20);var h2=Function.createDelegate(this,this.$21);var gl=[$0S,$0T];for(var i=0;i<gl.length;i++){if(gl[i]!=null){gl[i].events.addEventHandler("afterRowUpdate",h1);gl[i].events.addEventHandler("afterRowInsert",h1);gl[i].events.addEventHandler("beforeRowDelete",h2);}};if($0U){var h=Function.createDelegate(this,this.$1V);$0U.events.addEventHandler("toolsButtonClick",h);h=Function.createDelegate(this,this.$1Y);$0U.events.addEventHandler("afterRowUpdate",h);$0U.events.addEventHandler("afterRepaint",h);h=Function.createDelegate(this,this.$1W);$0U.events.addEventHandler("afterCellUpdate",h);};if($0S!=null){var h3=Function.createDelegate(this,this.$22);var h4=Function.createDelegate(this,this.$23);$0S.events.addEventHandler("afterCellUpdate",h3);$0S.events.addEventHandler("beforeCellEdit",h4);};this.chkPrintAll=this.getParamsControl("edcmPrintAllPages");this.filterGrid=$0S;this.sortGrid=$0T;this.versionsGrid=$0U;this.$1j();this.$14();if(this.activeVersion){this.versionsGrid.find(this.activeVersion,"Version");delete this.activeVersion;};__px(this).stopLC();this.notifyCommandState();};PXReportViewer.prototype.$20=function($0x,ev){ev.row.clearStatus(false);};PXReportViewer.prototype.$21=function($0x,ev){ev.row.setStatus(PXRowStatus.AddNew);};PXReportViewer.prototype.$23=function($0x,ev){var $q=ev.cell,$0V=$q.column.dataField;if(String.compare($0V,"Value",true)||String.compare($0V,"Value2",true)){var $0C=$q.row.getCell("DataField").getValue();var $0n=null,$0W=this.$1R($0C),$0D=$0W[0];var $0E=$0W[1],$0F=$0W[2],$0G=$0W[3];if($0D==null){$q.setDataType(NetType.String);$q.setViewName("");$q.setValueItems(null);return;};$q.setDataType($0D);$q.setViewName($0E);$q.setDecimals($0F);if($0G){$0G=$0G.split(';');var $0X=new Array();for(var i=0;i<$0G.length;i++){var $0n=new Object(),$0Y=$0G[i].split('|');$0n.value=NetType.convert($0Y[0],$0D);$0n.displayValue=$0Y[1];$0X.push($0n);};$q.setValueItems($0X);$q.valueItems.exclusive=true;}else $q.setValueItems(null);}};PXReportViewer.prototype.$22=function($0x,ev){var $q=ev.cell,$0V=$q.column.dataField;if($0V=="DataField"){var c1=$q.row.getCell("Value"),c2=$q.row.getCell("Value2");c1.updateValue(null);c2.updateValue(null);this.$1S();}};PXReportViewer.prototype.$1z=function($S,$a){var $0d=this.$1w;var $0e=this.$1x;if($0d!=null&&$0e!=null){$0e.setEnabled(false);$0e.setValue(0);$0d.setChecked(false);};var $00=this.getParamsControl("tName");var name=this.$1q.getText();if(!$00.setValue(name)){var $X=$00.addItemByValues(name,name);$00.selectedIndex=$X;$00.setValue(name);};this.$14();}

function PXImageUploader($a,$b,$c){var $d=function($e,name){return $e&&$e.className&&$e.className.indexOf&&($e.className.indexOf(name)>-1);};this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c,PXImageUploader.properties);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.initialIndex=this.imageIndex;this.correctIndex();this.elemText=$b.querySelector(".textDiv");this.leftArrow=$b.querySelector(".imgleft");this.rightArrow=$b.querySelector(".imgright");this.elemImgDiv=$b.querySelector(".imgDiv");this.elemMainDiv=$b.querySelector(".mainDiv");this.ctrlWidth=this.pxInt(this.imgWidth);this.ctrlHeight=this.pxInt(this.imgHeight);this.imageWidth=this.ctrlWidth-50;this.imageHeight=this.ctrlHeight-58;this.elemMainDiv.style.width=this.ctrlWidth+"px";this.elemMainDiv.style.height=this.ctrlHeight+"px";this.positionFrame();var $f=function($g){var $h=$g.trim().toLowerCase();return($h.indexOf("http://")===0)||($h.indexOf("https://")===0);};if(this.noImageUrl){this.noImage=this.element.ownerDocument.createElement('IMG');this.disableDraging(this.noImage);this.noImage.src=this.noImageUrl;this.elemImgDiv.appendChild(this.noImage);if(this.magnifyDefault){var h=Function.createDelegate(this,this.$01);__px(this).addEventHandler(this.noImage,"click",h);};var $i=this;var $j=function(){var style=this.noImage.style;var nw=this.noImage.naturalWidth?this.noImage.naturalWidth:this.noImage.width;var nh=this.noImage.naturalHeight?this.noImage.naturalHeight:this.noImage.height;style.width=nw+'px';style.height=nh+'px';var $k=nw;style.left=Math.floor((this.imageWidth-$k)/2)+"px";var $l=nh;style.top=Math.floor((this.imageHeight-$l)/2)+"px";style.display="";};if(this.noImage.complete){$j.call($i);}else this.noImage.onload=function(){$j.call($i);$i.noImage.onload=undefined;};};var h1=Function.createDelegate(this,this.$02);__px(this).addEventHandler(this.element,"click",h1);$b.object=this;this.viewState=new PXStateBag(this,"PXImageUploader");this.$03();this.setImage(this.imageIndex);this.uploadedCmd=__px_callback(this).createCommand("Uploaded",true);var $m=__px(this).elemByID(this.ID+"_upld");if($m){DragNDropMixIn(this,this.sizeMsg,this.allowedTypes,this.unsupportedMsg);}else{DisableDrop(this);};__px(this).addEventHandler($b,"keydown",Function.createDelegate(this,this.$04));this.subscribe();};PXImageUploader.prototype.disableDraging=function($n){$n.setAttribute('draggable','false');$n.ondragstart=function(){return false;};$n.onmousedown=function(){return false;};};PXImageUploader.prototype.subscribe=function(){this.keyDownHandler=Function.createDelegate(this,this.$04);__px(this).addEventHandler(this.element.ownerDocument.documentElement,"keydown",this.keyDownHandler);};PXImageUploader.prototype.unsubscribe=function(){if(this.keyDownHandler){__px(this).removeEventHandler($b,"keydown",this.keyDownHandler);}};PXImageUploader.prototype.correctIndex=function(){if(!this.allowNoImage){if(this.imageIndex==-1&&this.imageLinks&&this.imageLinks.length){this.imageIndex=0;}}};PXImageUploader.prototype.positionFrame=function(){var style=this.elemImgDiv.style;style.width=this.imageWidth+"px";style.height=this.imageHeight+"px";};PXImageUploader.prototype.placeOutside=function($e){if($e){$e.style.left=(this.imageWidth+10)+"px";$e.style.display="";}};PXImageUploader.prototype.hasClass=function($e,name){return $e&&$e.className&&$e.className.indexOf&&($e.className.indexOf(name)>-1);};PXImageUploader.prototype.onLoad=function(){this.uploader=__px_all(this)[this.ID+"_upld"];if(this.uploader){this.uploader.events.addEventHandler("fileUploaded",Function.createDelegate(this,this.$05));}};PXImageUploader.setTypes=function($o,$p){if($p){$o.allowedFiles=$p.split(',');}};PXImageUploader.convertImagesList=function($o,$p){var ar=$p?$p.split('|'):null;delete $o.imageName;delete $o.imageLinks;delete $o.imageDescr;if(ar){$o.imageNames=new Array();$o.imageLinks=new Array();$o.imageDescr=new Array();for(var i=0;i<ar.length;i++){var $q=ar[i].split(',');$o.imageNames.push(decodeURIComponent($q[0]));$o.imageLinks.push($q[1]);$o.imageDescr.push(decodeURIComponent($q[2]));}};return ar;};PXImageUploader.properties=[["value",JSType.Empty,""],["bindingContainer",JSType.String,""],["imgWidth",JSType.String,""],["imgHeight",JSType.String,""],["urlPref",JSType.String,""],["spinnerUrl",JSType.String,""],["imageIndex",JSType.Int,-1],["closeUrl",JSType.String,""],["closeImgAlt",JSType.String,""],["noImageUrl",JSType.String,""],["allowNoImage",JSType.Bool,false],["viewOnly",JSType.Bool,false],["magnifyDefault",JSType.Bool,false],["dragMsg",JSType.String,""],["allowedTypes",JSType.Empty,undefined,PXImageUploader.setTypes],["unsupportedMsg",JSType.Empty,"Unsupported file type. Supported types are: "],["maxFileSizeMsg",JSType.Empty,"size exceeded"],["images",JSType.String,"",PXImageUploader.convertImagesList],["enabled",JSType.Bool,true,"setEnabled"]];PXImageUploader.callbackProps=[["noImageUrl",JSType.String,""],["dataKey",JSType.String,"","setKey"],["imageIndex",JSType.Int,-1],["hidden",JSType.Bool,false,PXControl.setHidden],["value",JSType.Empty,"","setValue"],["images",JSType.String,"",PXImageUploader.convertImagesList],["enabled",JSType.Bool,true,"setEnabled"],["errorMessage",JSType.String,""]];PXImageUploader.prototype.setKey=function($p){this.dataKey=$p;};PXImageUploader.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXImageUploader.callbackProps);if(this.noImageUrl&&this.noImage){this.noImage.src=this.noImageUrl;};this.correctIndex();if(this.oldKey!=this.dataKey&&this.oldImage&&this.oldImage!=this.noImage){if(this.noImage)this.noImage.style.display="none";this.oldImage.style.display="none";};this.setImage(this.initialIndex=this.imageIndex);};PXImageUploader.prototype.setEnabled=function($p){this.enabled=$p;if(this.uploader)this.uploader.setEnabled($p);if($p){this.element.className=__px(this).excludeCss(this.element,["disabled"]);}else{this.element.className=__px(this).appendCss(this.element,["disabled"]);}};PXImageUploader.prototype.canUpload=function(){return this.enabled;};PXImageUploader.prototype.pxInt=function($p){return parseInt($p.replace('px',''),10);};PXImageUploader.prototype.transition0=function(){if(this.oldImage&&(this.oldImage!=this.noImage)&&(this.elemImage!=this.oldImage)){this.oldImage.parentNode.removeChild(this.oldImage);}else{if(this.noImage)this.noImage.style.display="none";};if(this.elemImage){var style=this.elemImage.style;var $k=this.pxInt(style.width);style.left=Math.floor((this.imageWidth-$k)/2)+"px";var $l=this.pxInt(style.height);style.top=Math.floor((this.imageHeight-$l)/2)+"px";style.display="";};this.oldImage=this.elemImage;};PXImageUploader.prototype.animationStep=function($r){if(this.delta){if($r>=200){if(this.oldImage&&(this.oldImage!=this.noImage)&&(this.elemImage!=this.oldImage)){this.oldImage.parentNode.removeChild(this.oldImage);}else if(this.oldImage){this.oldImage.style.display="none";};this.elemImage.style.left=this.newLeft+this.delta+"px";this.oldImage=this.elemImage;this.delta=this.newLeft=this.oldLeft=undefined;}else{this.oldImage.style.left=this.ease($r,this.oldLeft,this.delta,200)+"px";this.elemImage.style.left=this.ease($r,this.newLeft,this.delta,200)+"px";var $i=this;setTimeout(function(){$i.animationStep.call($i,$r+10);},20);}}};PXImageUploader.prototype.transition=function(){if(this.delta)return;if(this.elemImage&&this.oldImage&&this.elemImage!=this.oldImage){var style=this.elemImage.style;var $k=this.pxInt(style.width);var $s=this.oldImage.style;var $t=this.pxInt($s.width);this.step=5;this.counter=0;this.oldLeft=Math.floor((this.imageWidth-$t)/2);if(this.lastClick=='right'){this.newLeft=Math.floor((this.imageWidth-$k)/2)+this.imageWidth;this.delta=-this.imageWidth;style.display="";this.animationStep(0);return;}else if(this.lastClick='left'){this.newLeft=Math.floor((this.imageWidth-$k)/2)-this.imageWidth;this.delta=this.imageWidth;style.display="";this.animationStep(0);return;}};this.transition0();};PXImageUploader.prototype.ease=function($u,$v,$w,$x){var $y=$x/2;var $z=$u/$y;if($z<1)return $w/2*$z*$z*$z+$v;$z-=2;return $w/2*($z*$z*$z+2)+$v;};PXImageUploader.prototype.setImage=function($A,$B){this.positionFrame();var $C=this.imageLinks&&this.imageLinks.length;var $D=$A!=-1&&$A!=undefined;if(this.errorDiv)this.errorDiv.innerText="";if(!$C){if(this.errorMessage){if(!this.errorDiv){this.errorDiv=__doc(this).createElement('div');this.errorDiv.style.textAlign="center";this.errorDiv.className="GridError";this.elemImgDiv.appendChild(this.errorDiv);};this.errorDiv.innerText=this.errorMessage;};this.oldKey=this.dataKey;this.elemImage=this.noImage;this.elemText.textContent=this.dragMsg;if(this.oldImage!=this.noImage){this.placeOutside(this.elemImage);this.transition();}}else{if(!$D&&(!this.allowNoImage||this.viewOnly)){$A=$B?this.imageLinks.length-1:0;$D=true;};if($D){if(this.oldKey!=this.dataKey){this.oldKey=this.dataKey;}else{if(this.oldIndex==$A)return;};this.elemImage=__doc(this).createElement('img');this.disableDraging(this.elemImage);this.elemImage.style.cursor="pointer";this.placeOutside(this.elemImage);this.elemText.textContent=this.imageDescr[$A];this.elemImage.src=__px(this).resolveSessionUrl(this.urlPref)+this.imageLinks[$A];this.elemImgDiv.appendChild(this.elemImage);var $i=this;if(this.elemImage.complete)this.resize2(this.elemImage);else this.elemImage.onload=function(){$i.resize2.call($i,$i.elemImage);$i.elemImage.onload=undefined;};var h=Function.createDelegate(this,this.$01);__px(this).addEventHandler(this.elemImage,"click",h);}else{this.oldKey=this.dataKey;this.elemImage=this.noImage;this.elemText.textContent=this.dragMsg;if(this.oldImage!=this.noImage){this.placeOutside(this.elemImage);this.transition();}};this.oldIndex=$A;this.imageIndex=$A;this.$06();};this.$06();};PXImageUploader.prototype.resize2=function($E){this.resize($E);this.transition();};PXImageUploader.prototype.resize=function($E){if($E){var nw=$E.naturalWidth?$E.naturalWidth:$E.width;var nh=$E.naturalHeight?$E.naturalHeight:$E.height;var wc=this.imageWidth/ nw, wh= this.imageHeight/ nh;var style=$E.style;if((wh>1)&&(wc>1)){style.width=nw+'px';style.height=nh+'px';}else{if(wh>wc){style.width=this.imageWidth+'px';var $F=Math.round(nh*wc);style.height=$F+'px';}else{var $G=Math.round(nw*wh);style.width=$G+'px';style.height=this.imageHeight+'px';}}}};PXImageUploader.prototype.getValue=function(){return this.value;};PXImageUploader.prototype.setValue=function(v){this.value=v;this.$03();};PXImageUploader.prototype.getVisible=function(){return this.element.style.display!="none";};PXImageUploader.prototype.setVisible=function($H){if($H!=this.getVisible()){var $I=$H?"":"none";this.element.style.display=$I;}};PXImageUploader.prototype.onVisibleChanged=function($J){if(this.popupObject)this.popupObject.hideImage();};PXImageUploader.prototype.$03=function(){var $K=this.getValue();this.viewState.update("Value",($K!=null)?$K:"");};PXImageUploader.prototype.$07=function(){if(this.popupObject==null){this.popupObject=new PXPopupImage(this,this.spinnerUrl,this.closeUrl);this.popupObject.allowNavigation=false;};return this.popupObject;};PXImageUploader.prototype.$02=function(e){if(this.delta)return __px(this).cancelEvent(e);if(!this.enabled)return __px(this).cancelEvent(e);this.lastUploaded=undefined;var $b=__px(this).eventElem(e),$L=0;if($b&&this.elemMainDiv&&this.elemMainDiv.contains(e.target)){var $M=($b.tagName=="A"&&$b==this.linkPrev)||this.hasClass($b,"imgleft");var $N=($b.tagName=="A"&&$b==this.linkNext)||this.hasClass($b,"imgright");if($M){this.lastClick='left';$L=-1;}else if($N){this.lastClick='right';$L=1;};this.$08($L);__px(this).cancelEvent(e);}};PXImageUploader.prototype.$08=function($L){if($L!=0&&this.imageLinks){var $A=this.imageIndex+$L;if($A<-1)$A=this.imageLinks.length-1;if($A>=this.imageLinks.length)$A=-1;if(this.viewOnly||this.noSelectImage){if($A==-1&&this.imageLinks.length){$A=($L==-1)?(this.imageLinks.length-1):0;}};if($A!=this.imageIndex)this.setImage($A,$L==-1);if(!this.viewOnly){this.setValue(($A>=0)?this.imageNames[$A]:null);__px_cm(this).notifyOwnerChanged(this);}}};PXImageUploader.prototype.$04=function(e){if(this.delta)return __px(this).cancelEvent(e);var $L=0;if(__px(this).isVisible(this.element)&&e.ctrlKey&&!e.altKey&&!e.shiftKey){if(e.which==37&&this.leftArrow.style.display==""){$L=-1;this.lastClick='left';};if(e.which==39&&this.rightArrow.style.display==""){$L=1;this.lastClick='right';}};this.$08($L);if($L!=0)__px(this).cancelEvent(e);};PXImageUploader.prototype.$09=function($O,ev){var $P=ev.uploader;if($P&&!this.$0a){var h=Function.createDelegate(this,this.$05);$P.events.addEventHandler("hideAfterUpload",h);this.$0a=true;}};PXImageUploader.prototype.$05=function($Q,ev){var $R=__px_all(this)[this.bindingContainer];if($R&&!ev.hasError){if(this.viewOnly){__px_callback(this).execI(this,this.uploadedCmd,ev.fileName,undefined);}else{this.setValue(ev.fileName);__px_cm(this).notifyOwnerChanged(this);$R.dataChanged=true;$R.saveRow();__px_cm(this).notifyOwnerChanged(this);}}};PXImageUploader.prototype.fileUploaded=function($S,$T){var $R=__px_all(this)[this.bindingContainer];if($R&&$R.viewHash==$T){if(this.viewOnly){__px_callback(this).execI(this,this.uploadedCmd,$S,undefined);}else{this.setValue($S);__px_cm(this).notifyOwnerChanged(this);$R.dataChanged=true;$R.saveRow();__px_cm(this).notifyOwnerChanged(this);}}};PXImageUploader.prototype.$01=function(e){var $b=this.elemImage,po=this.$07();po.setParameters($b,false);po.showImage($b.src);__px(this).cancelEvent(e);};PXImageUploader.prototype.$06=function(){var $C=this.imageLinks&&this.imageLinks.length;var $U=this.allowNoImage?-1:0;this.$0b(this.leftArrow,$C&&this.imageIndex>$U);this.$0b(this.rightArrow,$C&&this.imageIndex<this.imageLinks.length-1);};PXImageUploader.prototype.$0b=function($V,$W){if($V&&$V.style){$V.style.display=$W?"":"none";}};PXImageUploader.prototype.processCallback=function($X,$a){__px(this).stopPI();var $Y=$X.rootNode.textContent?$X.rootNode.textContent:$X.rootNode.text;var $Z=$Y.split('|');var $A=parseInt($Z.shift(),10);this.oldIndex=undefined;var $00=parseInt($Z.shift(),10);PXImageUploader.convertImagesList(this,$Z.join('|'));this.setImage($A);if($00==2){this.setValue(($A>=0)?this.imageNames[$A]:null);__px_cm(this).notifyOwnerChanged(this);var $R=__px_all(this)[this.bindingContainer];if($R){$R.dataChanged=true;$R.saveRow();__px_cm(this).notifyOwnerChanged(this);}}};


function PXImageView($a,$b,$c){this.px_context=$a;this.ID=$b.id;this.element=$b;__px_cm(this).readProperties(this,$c,PXImageView.properties);};PXImageView.properties=[["value",JSType.Empty,""],["spinnerUrl",JSType.String,""],["closeUrl",JSType.String,""],["embeddedResource",JSType.Bool,true]];PXImageView.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXImageView.properties);this.setValue(this.value);if(!this.embeddedResource){this.element.style.cursor="pointer";var h=Function.createDelegate(this,this.$f);__px(this).addEventHandler(this.element,"click",h);}};PXImageView.prototype.getValue=function(){return this.value;};PXImageView.prototype.setValue=function(v){this.value=v;this.element.src=v;this.setVisible(this.embeddedResource||(v!=null&&v!=""));};PXImageView.prototype.getVisible=function(){return this.element.style.display!="none";};PXImageView.prototype.setVisible=function($d){if($d!=this.getVisible()){var $e=$d?"":"none";this.element.style.display=$e;}};PXImageView.prototype.$f=function(e){var $b=this.element,po=this.$g();po.setParameters($b,false);po.showImage($b.src);__px(this).cancelEvent(e);};PXImageView.prototype.$g=function(){if(this.popupObject==null){this.popupObject=new PXPopupImage(this,this.spinnerUrl,this.closeUrl);this.popupObject.allowNavigation=false;};return this.popupObject;}


function PXActivityBox($a,$b,$c){this.$N="Refresh";this.$O="OpenItem";this.$P="Complete";this.$Q="Cancel";this.$R="NewTask";this.$S="NewEvent";this.$T="NewActivity";this.$U="Dismiss";this.$V="Snooze";this.$W="ShowAll";this.px_context=$a;this.element=$b;this.ID=$b.id;this.header=__px(this).elemByID(this.ID+"_header");this.contentDiv=__px(this).elemByID(this.ID+"_contDiv");this.initializeElems();this.callbackCmd=new Object();this.callbackCmd.postData=1;this.callbackCmd.blockPage=true;this.handler=Function.createDelegate(this,this.$X);this.toolbarClickHandler=Function.createDelegate(this,this.$Y);this.toolbarMenuClickHandler=Function.createDelegate(this,this.$Z);__px_cm(this).readProperties(this,$c,PXActivityBox.properties);this.mouseeventsHandler=Function.createDelegate(this,this.$00);__px(this).addEventHandler(this.element,"mousemove",this.mouseeventsHandler);PXSmartPanel.addEventHandler("activePanelChanged",Function.createDelegate(this,this.$01),$a);this.addHadlers();this.$02=Function.createDelegate(this,this.$03);this.$04=Function.createDelegate(this,this.$03);this.events=new PXEventList(this,PXActivityBox.events,$c.clientEvents);__px_cm(this).registerRequiresOnLoad(this,this.ID);$c.autoSize=new Object();$c.autoSize.enabled=true;__px_cm(this).registerAutoSize(this,$c);};PXActivityBox.properties=[["highlightColor",JSType.String,"#FABC4E"],["selectedColor",JSType.String,"#F9CD81"],["confirmMessage",JSType.String,"You need to save changes."]];PXActivityBox.events={$afterHide:0};PXActivityBox.prototype.initializeElems=function(){this.content=__px(this).elemByID(this.ID+"_content");this.activeItem=null;};PXActivityBox.prototype.addHadlers=function(){__px(this).addEventHandler(this.content,"mousedown",this.mouseeventsHandler);__px(this).addEventHandler(this.content,"click",this.mouseeventsHandler);__px(this).addEventHandler(this.content,"dblclick",this.mouseeventsHandler);__px(this).addEventHandler(this.content,"selectstart",this.mouseeventsHandler);};PXActivityBox.prototype.removeHadlers=function(){__px(this).removeEventHandler(this.content,"mousedown",this.mouseeventsHandler);__px(this).removeEventHandler(this.content,"click",this.mouseeventsHandler);__px(this).removeEventHandler(this.content,"dblclick",this.mouseeventsHandler);__px(this).removeEventHandler(this.content,"selectstart",this.mouseeventsHandler);};PXActivityBox.prototype.onLoad=function(e){var $d=__px_all(this)[this.header.id];for(var i=0;i<$d.items.length;i++){var $e=$d.items[i];if(!$e.commandName)continue;switch($e.commandName){case this.$N:this.refreshButton=$e;break;case this.$O:this.detailsButton=$e;break;case this.$P:this.completeButton=$e;break;case this.$Q:this.cancelButton=$e;break;case this.$R:this.taskButton=$e;break;case this.$S:this.eventButton=$e;break;case this.$T:this.activityButton=$e;break;case this.$U:this.dismissButton=$e;break;case this.$V:this.deferButton=$e;break;case this.$W:this.showAllButton=$e;break;};var $f=$e.getMenu();if($f)$f.events.addEventHandler("itemClick",this.toolbarMenuClickHandler);};$d.events.addEventHandler("buttonClick",this.toolbarClickHandler);this.correctButtons();};PXActivityBox.prototype.show=function($g,top,$h,$i){if(this.getVisible())return;this.$05();var $j=__win(this).theForm?__win(this).theForm:__doc(this).body;if(this.element.parentNode!=$j){$j.appendChild(this.element);};var es=this.element.style;es.position="absolute";es.left=$g;es.top=top;es.zIndex=__px_cm(this).getNextZIndex(this.zIndex?this.zIndex:5000);es.display="";var $d=__px_all(this)[this.header.id];$d.setVisible(true);this.$03();};PXActivityBox.prototype.$03=function(){var $k=__doc(this).documentElement,$l=__doc(this).body;var es=this.element.style;var $m=Math.max($k.scrollWidth,$l.scrollWidth);var $n=Math.max($k.scrollHeight,$l.scrollHeight);var $o=$k.clientWidth,$p=$k.clientHeight;var $q=$k.scrollLeft?$k.scrollLeft:$l.scrollLeft;var $r=$k.scrollTop?$k.scrollTop:$l.scrollTop;if(__px(this).IsIE){es.position="absolute";es.left=this.left+$q+"px";es.top=this.top+$r+"px";}else{es.position="fixed";es.left=this.left+"px";es.top=this.top+"px";}};PXActivityBox.prototype.$05=function(){__px(this).addEventHandler(__win(this),'resize',this.$04);__px(this).addEventHandler(__win(this),'scroll',this.$02);this.$06=true;};PXActivityBox.prototype.$07=function(){if(this.$06){__px(this).removeEventHandler(__win(this),'resize',this.$04);__px(this).removeEventHandler(__win(this),'scroll',this.$02);}};PXActivityBox.prototype.setCallbackProxy=function($s){this.$08=$s;};PXActivityBox.prototype.getVisible=function(){return this.element.style.display!="none";};PXActivityBox.prototype.executeCallback=function($t,$u,$v){this.callbackCmd.name=$t;var $w=this;if(this.$08){$w=this.$08;this.callbackCmd.name=this.$08.packCallbackCommand(this.ID,this.callbackCmd.name);};var $a=new Object();$a.id=this.ID;$a.popupCommand=$v;$a.command=$t;$a.commandArg=$u;__px_callback(this).execI($w,this.callbackCmd,$u,this.handler,$a,$v);};PXActivityBox.prototype.$X=function($x,$a){if(!$x)return;if($x=="SAVE_NOTE_REQUIRED"){if(confirm(this.confirmMessage)){var $y="SAVE";if($a.commandArg)$y+="|"+$a.commandArg;this.executeCallback($a.command,$y,$a.popupCommand);};return;};if($x.startsWith("Redirect"))__px_callback(this).processRedirect($x,$a);var $z=(new PXXmlDoc("",$x)).rootNode;if($z.childNodes.length>0){for(var $A=0;$A<$z.childNodes.length;$A++){var $B=$z.childNodes[$A];if(String.compare($B.tagName,"content",true)){this.removeHadlers();__px_cm(this).processHtmlData($B.childNodes[0].nodeValue,this.contentDiv);this.initializeElems();this.addHadlers();this.correctButtons();}}}};PXActivityBox.prototype.$01=function(e,$C){if(this.element.offsetWidth)this.executeCallback(this.$N,null,null);};PXActivityBox.prototype.$Z=function($D,ev){ev.button=new Object();ev.button.commandName=ev.item.commandName;ev.button.commandArgument=ev.item.commandArgument;this.$Y(null,ev);};PXActivityBox.prototype.$Y=function($d,ev){var $E=ev.button.commandName;var $C=null,$F=null;switch($E){case this.$O:$C=this.activeItem.recID;$F=new Object();break;case this.$P:case this.$Q:case this.$U:$C=this.activeItem.recID;break;case this.$V:$C=this.activeItem.recID+'|'+ev.button.commandArgument;break;case this.$T:$C=ev.button.commandArgument;$F=new Object();break;case this.$R:case this.$S:$F=new Object();break;case this.$N:case this.$W:break;};if($F!=null)this.$09($F);if($E)this.executeCallback($E,$C,$F);};PXActivityBox.prototype.$09=function($F){$F.target=this.ID;$F.enabled=$F.checkSave=true;$F.command=this.$N;return $F;};PXActivityBox.prototype.$00=function(e){switch(e.type){case "mousemove":this.tryHighlight(e);break;case "click":case "mousedown":var $w=__px(this).eventElem(e);this.$0a(e,$w&&$w.tagName=='A'&&e.type=="click");break;case "dblclick":if(this.$0a(e))this.navigateToActiveItem();break;case "selectstart":__px(this).cancelEvent(e);break;}};PXActivityBox.prototype.$0a=function(e,$G){var $H=this.getHoverElement(e);if($H.recID){if(this.activeItem!=$H){if(this.activeItem)this.clearRow(this.activeItem.elems);this.activeItem=$H;this.activeItem.elems=this.colorRow(this.activeItem,this.activeItem.coll,this.selectedColor);this.correctButtons();};if($G)this.navigateToActiveItem();return true;};return false;};PXActivityBox.prototype.setHeight=function(h){var $b=this.element,$I=this.contentDiv.parentNode;var $h=h-($b.offsetHeight-$I.offsetHeight);if($h<0)$h=0;$b.style.height=$I.style.height=$h+"px";};PXActivityBox.prototype.navigateToActiveItem=function(){if(this.activeItem)this.executeCallback(this.$O,this.activeItem.recID,this.$09(new Object()));};PXActivityBox.prototype.tryHighlight=function(e){var $H=this.getHoverElement(e);if($H.recID){this.clearHighlight($H.recID);this.setHighlight($H.recID,$H.coll);}else this.clearHighlight();};PXActivityBox.prototype.isActiveItem=function($J){return this.activeItem&&this.activeItem.recID==$J;};PXActivityBox.prototype.clearHighlight=function($J){var $H=this.$0b;if(!$H||$J&&$H.recID==$J)return;if(!this.isActiveItem($H.recID))this.clearRow($H);this.$0b=null;};PXActivityBox.prototype.setHighlight=function($J,$H){if(this.$0b&&this.$0b.recID==$J)return;this.$0b=this.colorRow($J,$H,this.isActiveItem($J)?null:this.highlightColor);};PXActivityBox.prototype.clearRow=function($H){for(var j=0;j<$H.coll.length;j++){var ae=$H.coll[j];ae.style.backgroundColor=ae.ownColor;if(ae.tagName=="TR"){for(var i=0;i<ae.cells.length;i++){var $I=ae.cells[i];$I.style.backgroundColor=$I.ownColor;}}else if(ae.style)ae.style.backgroundColor=ae.ownColor;}};PXActivityBox.prototype.colorRow=function($J,$H,$K){var v=new Object();v.recID=$J;v.coll=new Array();for(var j=0;j<$H.length;j++){var ae=$H[j];if(typeof(ae.ownColor)==="undefined")ae.ownColor=ae.style.backgroundColor;if($K)ae.style.backgroundColor=$K;v.coll.push(ae);if(ae.tagName=="TR"){for(var i=0;i<ae.cells.length;i++){var $I=ae.cells[i];if(typeof($I.ownColor)=="undefined")$I.ownColor=$I.style.backgroundColor;if($K)$I.style.backgroundColor=$K;}}};return v;};PXActivityBox.prototype.getHoverElement=function(e){var se=__px(this).eventElem(e);var $H=new Object();$H.recID=null;$H.coll=new Array();while(se&&se!=this.content){if(se.getAttribute&&($H.recID=se.getAttribute("recID"))!=null)break;se=se.parentNode;};for(var i=0;i<this.content.rows.length;i++){var $L=this.content.rows[i];if($L.getAttribute&&$L.getAttribute("recID")==$H.recID)$H.coll.push($L);};return $H;};PXActivityBox.prototype.correctButtons=function(){var $M=this.activeItem!=null;if(this.detailsButton)this.detailsButton.setEnabled($M);if(this.completeButton)this.completeButton.setEnabled($M);if(this.cancelButton)this.cancelButton.setEnabled($M);if(this.dismissButton)this.dismissButton.setEnabled($M);if(this.deferButton)this.deferButton.setEnabled($M);};


var PXWizCommand={WizCancel:"WizCancel",WizSave:"WizSave",WizNext:"WizNext",WizPrev:"WizPrev"};function PXWizard($a,$b,$c){PXWizard.initializeBaseA(this,[$a,$b,$c]);__px_cm(this).readProperties(this,$c,PXWizard.properties);this.viewState.update("SelectedIndex",this.selectedIndex);if($b.rows.length==3){this.elemCaption=$b.rows[0].cells[0];this.elemContent=$b.rows[1].cells[0];this.elemFooter=$b.rows[2].cells[0];}else if($b.rows.length==2){this.elemContent=$b.rows[0].cells[0];this.elemFooter=$b.rows[1].cells[0];};var h=Function.createDelegate(this,this.$U);__px(this).addEventHandler(this.elemFooter,"mousedown",h);h=Function.createDelegate(this,this.$V);__px(this).addEventHandler(this.elemFooter,"mouseup",h);h=Function.createDelegate(this,this.$W);__px_callback(this).addHandler(h);this.pages=new Array();for(var i=0;i<this.pagesCount;i++)this.pages[i]=new PXWizardPage(this,i,$c.pages[i]);this.events.appendEvents(PXWizard.events,$c.clientEvents);};PXWizard.__baseType=PXBoundPanel;PXWizard.properties=[["selectedIndex",JSType.Int,0],["pagesCount",JSType.Int,0],["cancelCommand",JSType.Object,PXCallbackManager.settingsDesc],["saveCommand",JSType.Object,PXCallbackManager.settingsDesc],["nextCommand",JSType.Object,PXCallbackManager.settingsDesc],["prevCommand",JSType.Object,PXCallbackManager.settingsDesc]];PXWizard.events={$pageChanging:7,$pageChanged:8,$pageLoaded:9,$buttonClick:10};PXWizard.prototype.excludeFromPostIDs=function(){var $d=new Array(),$e=this.getSelectedPage();for(var i=0;i<this.pages.length;i++)if(i!=this.$X&&this.pages[i]!=$e)$d.push(this.pages[i].element.id);return $d;};PXWizard.prototype.setProperties=function($c){PXWizard.callBase(this,"setProperties",[$c]);if($c!=null){this.$Y=Boolean($c.isLastPage);if($c.nextIndex!=null)this.$X=$c.nextIndex;}};PXWizard.prototype.onLoad=function(){PXWizard.callBase(this,"onLoad",null);this.btnCancel=__px_all(this)[this.ID+"_cancel"];this.btnSave=__px_all(this)[this.ID+"_save"];this.btnNext=__px_all(this)[this.ID+"_next"];this.btnPrev=__px_all(this)[this.ID+"_prev"];for(var i=0;i<this.pagesCount;i++)this.pages[i].ensureControls();};PXWizard.prototype.onChildAfterRepaint=function($f,$g){var i=$f.linkedPageIndex;if(i!=null&&($g.hasError&&($g.errorStatus==null||$g.errorStatus>1)))this.pages[i].hasError=true;};PXWizard.prototype.onSetError=function($f,$h,$i){var i=$f.linkedPageIndex;if(i!=null&&($h&&$i==2))this.pages[i].hasError=true;};PXWizard.prototype.repaint=function($j,$k){for(var i=0;i<this.pagesCount;i++)delete this.pages[i].hasError;PXWizard.callBase(this,"repaint",[$j,$k]);};PXWizard.prototype.hidePrevNext=function($l){if($l)this.prevNextHidden=true;else delete this.prevNextHidden;};PXWizard.prototype.setHeight=function($m){var h=parseInt($m);var $n=this.element,$o=this.elemContent;h-=($n.offsetHeight-$o.clientHeight);$n.style.height=$o.style.height=(h>0?h:0)+"px";};PXWizard.prototype.setWidth=function($p){var w=parseInt($p);this.element.style.width=w+"px";};PXWizard.prototype.getSelectedIndex=function(){return this.selectedIndex;};PXWizard.prototype.getSelectedPage=function(){return this.pages[this.selectedIndex];};PXWizard.prototype.setSelectedIndex=function($q){if($q<0||this.pages.length<=$q)return;if($q!=this.selectedIndex){this.pages[$q].select();this.setButtonsState();}};PXWizard.prototype.setCaption=function(v){if(this.elemCaption)__px(this).setElemText(this.elemCaption,v);};PXWizard.prototype.getCaptionImage=function($r,$s){if(!this.elemCaption)return null;var $t=this.elemCaption,$u=__px_cm(this).findSpriteOrImage($t);if($u==null&&$r){$u=__px_cm(this).createSpriteOrImage(null,$s);if($u.tagName=="IMG")$u.align="left";$u.style.marginRight="2px";$t.insertBefore($u,$t.firstChild);};return $u;};PXWizard.prototype.executeCommand=function($v,$w){if($v&&!$v.startsWith("Wiz")){PXWizard.callBase(this,"executeCommand",[$v,$w]);return;};var $x=($w===true);var cs=null,$q=this.selectedIndex,$y=this.getSelectedPage();delete this.$Z;switch($v){case PXWizCommand.WizCancel:$q=0;cs=this.cancelCommand;if($x)this.$Z=2;break;case PXWizCommand.WizSave:cs=this.saveCommand;if(!cs.enabled)cs=this.nextCommand;if($x)this.$Z=1;break;case PXWizCommand.WizNext:$q++;cs=this.nextCommand;break;case PXWizCommand.WizPrev:$q=($y.$00!=null)?$y.$00:($q-1);cs=this.prevCommand;break;};if($q<0)$q=0;if($q>=this.pagesCount)$q=this.pagesCount-1;var $z=new Object();$z.command=$v;$z.closePanel=this.$Z;if(this.fireEvent("buttonClick",null,$z))return;if($q!=this.selectedIndex||this.$Z||$w){delete this.$Y;delete this.$X;if($v==PXWizCommand.WizPrev||$v==PXWizCommand.WizCancel){delete $y.$00;delete $y.$Y;};if(cs&&cs.enabled&&cs.command){this.$X=$q;if($v==PXWizCommand.WizNext)this.viewState.update("OwnAction",true);this.dataChanged=($v!=PXWizCommand.WizCancel);if(cs.target){var $A=__px_all(this)[cs.target];if($A&&$A.__className.indexOf("DataSource")>0){$A.callbackFromUI=true;$A.viewState.update("CallbackFromUI",$A.callbackFromUI);}};this.$01=cs.command;__px_callback(this).exec(this,cs);}else{this.setSelectedIndex($q);if(this.$Z)this.$02();}}};PXWizard.prototype.getCommandState=function($B,$v){var $y=this.getSelectedPage(),si=this.selectedIndex;var $C=si==(this.pagesCount-1)||Boolean($y.$Y);switch($v){case PXWizCommand.WizCancel:return new PXCommandState(true,true);case PXWizCommand.WizSave:return new PXCommandState($C,true);case PXWizCommand.WizNext:return new PXCommandState(!this.prevNextHidden&&!$C,!$C);case PXWizCommand.WizPrev:return new PXCommandState(!this.prevNextHidden,si>0);};return PXWizard.callBase(this,"getCommandState",[$B,$v]);};PXWizard.prototype.notifyCommandState=function($D){if(!$D)PXWizard.callBase(this,"notifyCommandState");__px_cm(this).notifyCommandState(this,PXWizCommand);};PXWizard.prototype.$U=function(e){__px(this).registerWaitTask(this,this.$V,e);};PXWizard.prototype.$V=function(e){var $E=__px(this).eventObject(e);__px(this).unregisterWaitTask(this);if($E==this.btnCancel)this.executeCommand(PXWizCommand.WizCancel,true);else if($E==this.btnSave)this.executeCommand(PXWizCommand.WizSave,true);else if($E==this.btnNext)this.executeCommand(PXWizCommand.WizNext);else if($E==this.btnPrev)this.executeCommand(PXWizCommand.WizPrev);};PXWizard.prototype.setButtonsState=function(){this.notifyCommandState(true);this.btnNext.setVisible(this.getCommandState(this,PXWizCommand.WizNext).getVisible());this.btnSave.setVisible(this.getCommandState(this,PXWizCommand.WizSave).getVisible());this.btnPrev.setVisible(this.getCommandState(this,PXWizCommand.WizPrev).getVisible());this.btnPrev.setEnabled(this.getCommandState(this,PXWizCommand.WizPrev).getEnabled());};PXWizard.prototype.$W=function($a,$F){var $A=__px_callback(this).target;var $G=__px_callback(this).command.name;if(this.$X!=null&&String.compare($G,this.$01,true)){var $y=this.getSelectedPage(),me=this;var ni=this.$X,si=this.selectedIndex;if($y&&$y.hasError)$F=true;if(!$F){if(ni!=si&&ni!=(si+1))this.pages[ni].$00=si;this.pages[ni].$Y=this.$Y;setTimeout(function(){me.setSelectedIndex(ni);if(me.$Z)me.$02();},0);};this.viewState.remove("OwnAction");delete this.$X;delete this.$Y;delete this.$01;}else if($A&&$A.__className&&$A.__className.indexOf("DataSource")>0&&String.compare($G,"Cancel",true)){this.setSelectedIndex(0);}};PXWizard.prototype.$02=function(){var $b=this.element.parentNode;while($b!=null){var $f=$b.object,$H=$f?$f.constructor.__baseType:null;if($f&&($f.__className=="PXSmartPanel"||$H.__className=="PXSmartPanel")){$f.dialogResult=this.$Z;if($f.dialogResult==1)$f.execCloseAction();$f.hide();break;};$b=$b.parentNode;};this.setSelectedIndex(0);delete this.$Z;};function PXWizardPage($I,$q,$c){this.px_context=$I.px_context;this.owner=$I;this.ID="p"+$q;this.index=$q;__px_cm(this).readProperties(this,$c);this.element=__px(this).elemByID($I.ID+"_"+this.ID);var $J=(this.element.getAttribute("empty")!=null);if($J){var $c=new Object();$c.position=0;$c.loadOnDemand=true;$c.allowResize=$c.allowMove=false;$c.autoSaveChanges=false;this.panel=new PXSmartPanel(this.px_context,this.element,$c);__px_all(this)[this.element.id]=this.panel;this.panel.events.addEventHandler("afterShow",Function.createDelegate(this,this.$03));this.panel.events.addEventHandler("afterLoad",Function.createDelegate(this,this.$04));this.panel.linkedPage=this;};this.element.object=this;};PXWizardPage.properties=[["caption",JSType.String,""],["imageUrl",JSType.String,""]];PXWizardPage.prototype.containsControl=function($f){var $K=this.getControls();return($K[$f.ID]!=null);};PXWizardPage.prototype.ensureControls=function(){if(this.controls==null)this.getControls();};PXWizardPage.prototype.hasChangedChild=function(){for(var id in this.containers)if(this.containers[id].getChanged())return true;return false;};PXWizardPage.prototype.selected=function(){return this.index==this.owner.selectedIndex;};PXWizardPage.prototype.isLoaded=function(){return this.panel==null||this.panel.loaded;};PXWizardPage.prototype.focusInnerControl=function(){this.ensureControls();for(var id in this.controls){var $f=this.controls[id];if($f.focus){setTimeout(function(){$f.focus();},1);break;}}};PXWizardPage.prototype.getControls=function(){if(this.controls!=null)return this.controls;this.controls=new Object();this.editors=new Object();this.containers=new Object();this.controlsV=new Object();var $L=this.owner,id=this.owner.ID,$M=this.element.id;var $N=Function.createDelegate($L,$L.onChildAfterRepaint);for(var name in __px_all(this)){var $f=__px_all(this)[name];if(!$f.ID.startsWith($M))continue;var $b=$f.element?$f.element.parentNode:null;var $O=false;while($b){if($b.object!=null&&$b.object instanceof PXWizardPage){$O=($b.object==this);break;};$b=$b.parentNode;};if($O){if($f.onVisibleChanged)this.controlsV[name]=$f;if($f.bindingContainer==id)this.editors[name]=$f;if($f.constructor.__baseType==PXBoundPanel){this.containers[name]=$f;$f.events.addEventHandler("afterRepaint",$N);};if($f.__className=="PXGrid"){this.containers[name]=$f;$f.events.addEventHandler("afterRepaint",$N);$f.events.addEventHandler("afterRepaintRow",$N);};$f.linkedPageIndex=this.index;this.controls[name]=$f;}};return this.controls;};PXWizardPage.prototype.select=function(){var $L=this.owner,$y,$P=$L.selectedIndex,$u;var $Q=new Object();$Q.newIndex=this.index;$Q.oldIndex=$P;if($L.fireEvent("pageChanging",null,$Q))return;$L.selectedIndex=this.index;$L.viewState.update("SelectedIndex",this.index);if($P>=0){$y=$L.pages[$P];if($y.panel==null||$y.panel.loaded)$y.$05(false);if($y.panel)$y.panel.hide();else $y.element.style.display="none";};$L.setCaption(this.caption);if(this.imageUrl){$u=$L.getCaptionImage(true,this.imageUrl);if($u){__px_cm(this).repaintImage($u,this.imageUrl);$u.style.display="";}}else{$u=$L.getCaptionImage(false);if($u)$u.style.display="none";};if(this.panel)this.panel.show();else this.element.style.display="";this.$05(true);if(this.owner.dataBound)this.owner.paintDelayImages();for(var id in this.containers){var $R=this.containers[id];if($R.dataBound)$R.paintDelayImages();};if(this.isLoaded()){var $b=this.owner.element.parentNode,me=this;$y=$L.pages[$L.selectedIndex];setTimeout(function(){if(me.panel==null)__px_cm($y).notifyOnResize(true,$b);$y.focusInnerControl();},1);};$L.fireEvent("pageChanged",null,$Q);};PXWizardPage.prototype.$05=function($S){this.ensureControls();var $K=this.controlsV;for(var id in $K){var $f=$K[id];if($f.onVisibleChanged)$f.onVisibleChanged($S);}};PXWizardPage.prototype.$03=function($T,e){__px_cm(this).notifyOnResize(true,$T.elem);};PXWizardPage.prototype.$04=function($T,e){var $y=$T.linkedPage;$y.controls=null;$y.ensureControls();$y.focusInnerControl();var $Q=new Object();$Q.index=$y.index;this.owner.fireEvent("pageLoaded",null,$Q);};



function PXGetLinkDialog($a,$b,$c,$d){this.ID=$b.id;this.element=$b;PXGetLinkDialog.initializeBaseA(this,[$a,$b,$c,$d]);this.txtIntLink=__px_cm(this).createControl("PXTextEdit",$b.id+"_text_int");this.txtLink=__px_cm(this).createControl("PXTextEdit",$b.id+"_text");this.btnClose=__px_cm(this).createControl("PXButton",$b.id+"_btnClose");this.btnEmail=__px_cm(this).createControl("PXButton",$b.id+"_btnEmail");};PXGetLinkDialog.__baseType=PXSmartPanel;PXGetLinkDialog.prototype.setLink=function($e,$f){this.txtIntLink.setValue($e);this.txtLink.setValue($f);};PXGetLinkDialog.prototype.getInternalLink=function(){return this.txtIntLink.getValue();};PXGetLinkDialog.prototype.getExternalLink=function(){return this.txtLink.getValue();};


function lastEvent($a){var $b=-1;for(var i in $a){$b=Math.max($b,$a[i]);};return $b;};function PXRichTextDialog($c,$d,$e,$f){this.ID=$d.id;PXRichTextDialog.initializeBaseA(this,[$c,$d,$e,$f]);this.gridDblClickHandler=Function.createDelegate(this,function($g,e){if(e.event.clickCount==2){this.dialogResult=PXDialogResult.OK;this.hide();}});};PXRichTextDialog.__baseType=PXSmartPanel;PXRichTextDialog.prototype.onLoad=function(){PXRichTextDialog.callBase(this,"onLoad",[]);this.menu=__px_all(this)[this.outerBaseID+"_dialogMenu"];var $h=Function.createDelegate(this,function(e,e1,e2){if(e1.item.checked){e1.cancel=true;}});if(this.menu){this.menu.events.addEventHandler("itemCheck",$h);};this.events.addEventHandler("afterShow",Function.createDelegate(this,function(){this.result=undefined;}));if(this.resizeManager){this.resizeManager.minWidth=800;this.resizeManager.minHeight=500;};var $i=__px_all(this)[this.ID+"_splitter_capt"];if($i){$i.allowRepaintText=false;}};PXRichTextDialog.prototype.setTabDisplay=function($j,$k){if(this.tabs){for(var i=0;i<this.tabs.length;i++){var $l=this.tabs[i];if($l){if(i==$j){$l.style.setProperty('display',"");__px_cm(this).notifyOnResize(true,$l);var $m=this.tabControlNames[i];if($m){var $n=__px_all(this)[this.baseID+"_"+$m];if($k&&$n&&$n.selectItem){$n.selectItem($k);}else if($n&&$n.onVisibleChanged2){$n.onVisibleChanged2(true);}}}else{$l.style.setProperty('display',"none");}}};this.selectedTab=$j;}};PXRichTextDialog.prototype.setTabByName=function(name,$k){var $j=this.tabCommands.indexOf(name);if($j>-1){this.setTabDisplay($j,$k);}};PXRichTextDialog.prototype.positionControl=function($k){var $m=this.tabControlNames[this.selectedTab];if($m){var $n=__px_all(this)[this.baseID+"_"+$m];if($n&&$n.selectItem){$n.selectItem($k);return true;}}};PXRichTextDialog.prototype.setFirstTab=function(){if(this.tabs){for(var i=0;i<this.tabs.length;i++){var $l=this.tabs[i];if($l){this.setTabDisplay(i);break;}}}};PXRichTextDialog.prototype.getCaption=function(){var $i=__px(this).elemByID(this.outerBaseID+"_capt");if($i){if(($i.value==undefined)||($i.value=="")){return this.selectedCaption;};return $i.value;}};PXRichTextDialog.prototype.setCaption=function($o){var $i=__px(this).elemByID(this.outerBaseID+"_capt");if($i){$i.value=$o;}};PXRichTextDialog.prototype.initGrid=function($p,$q,$r,$s){var name=$q.getAttribute('href').substr($r.length);$p.search(name,$s);};PXRichTextDialog.prototype.initGrid2=function($p,$q,$r,$s){var name=$q.getAttribute('href').substr($r.length);this.searchValue=name;this.searchColumn=$s;$p.setSearchValue(name);$p.viewState.update("PageIndex",this.pageIndex=0);};PXRichTextDialog.prototype.regPanel=function($t,$u,$v){var $w=function($x){if(this[$x]==undefined){this[$x]=[];}};$w.call(this,'tabs');$w.call(this,'tabCommands');$w.call(this,'tabShowHandlers');$w.call(this,'tabControlNames');var $y=__px(this).elemByID(this.baseID+"_"+$u);if($y){this[$t]=$y;this.tabs.push($y);this.tabCommands.push($u);this.tabControlNames.push($v);}};PXRichTextDialog.prototype.baseSelection=function(){var $z=this.tabCommands[this.selectedTab];var $A=__px(this).elemByID(this.outerBaseID+"_capt");var $i=$A?$A.value:undefined;var $m=this.tabControlNames[this.selectedTab];if($m){var $n=__px_all(this)[this.baseID+"_"+$m];if($n){return{'type':$z,'key':$n.getSelectedKey(),'value':$n.getSelectedValue(),'caption':$i};}}};PXRichTextDialog.prototype.setHandler=function($B){var $n=__px_all(this)[this.baseID+"_"+$B];if($n){$n.events.addEventHandler("selected",Function.createDelegate(this,function($g,e){this.dialogResult=PXDialogResult.OK;this.hide();}));}};function PXRichTextUpload($c,$d,$e,$f){PXRichTextUpload.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXRichTextUpload.events,$e.clientEvents);};PXRichTextUpload.__baseType=PXRichTextDialog;PXRichTextUpload.events={$afterUpload:lastEvent(PXSmartPanel.events)+1};PXRichTextUpload.prototype.registerUploadControl=function($d){__px(this).addEventHandler($d,"drop",Function.createDelegate(this,this.handleDropFile));this.uploadFileCall=__px_callback(this).createCommand("UploadFile",true,false,false);};PXRichTextUpload.prototype.handleDropFile=function(e){__px(this).cancelEvent(e);if(window.FileReader==null)return;if(this.uploadFileCall.uploadCallback==null)this.uploadFileCall.uploadCallback=Function.createDelegate(this,this.uploadCallback2);var $C=e.dataTransfer.files,me=this;var $D=Function.createDelegate(this,this.processFileLoaded2);for(var i=0;i<$C.length;i++){var $E=new FileReader(),$F=$C[i];if($F.size>this.maxFileSize*1000){alert(this.maxFileSizeMsg);break;};if(this.allowedFiles){var $G=$F.name.toLowerCase().lastIndexOf("."),$H=true;if($G>0)$H=Array.contains(this.allowedFiles,$F.name.substr($G).toLowerCase());if(!$H){alert(this.allowedFilesMsg);break;}};__px(this).addEventHandler($E,"load",function(e){var $I=[e.target.fileName,e.target.fileSize];__px_callback(me).execI(me,me.uploadFileCall,e.target.fileName+'|'+e.target.result,$D,$I);});__px(this).addEventHandler($E,"progress",function(e){var $I=[e.target.fileName,e.target.fileSize];if(e.lengthComputable)me.uploadCallback2(Math.round(e.loaded/e.total*100),$I,true);});$E.fileName=$F.name;$E.fileSize=$F.size;$E.readAsDataURL($F);}};PXRichTextUpload.prototype.uploadCallback2=function($J,ar,$K){var $L=ar[1],$M=ar[0],px=__px(this);if($L&&$L>250000){$J=$K?($J/ 2):(percent/ 2+50);if(px.isActiveWC())px.stopWC();if(px.isActivePI()){px.setPIValue($J>=99?100:$J);if($J>=99)px.setPIText(px.getLocalMessage('fileSaving','File saving, please wait...'));}else px.startPI(px.getLocalMessage('uploading','Uploading: ')+$M);}};PXRichTextUpload.prototype.processFileLoaded2=function($N,$c){__px(this).stopPI();this.fireEvent("afterUpload",null,{'filename':$c[0]});};function PXInsertImageDialog($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.outerBaseID=$d.id+"_splitter";this.baseID=this.outerBaseID+"_rpnl";PXInsertImageDialog.initializeBaseA(this,[$c,$d,$e,$f]);this.searchPanelID=this.baseID;this.attachedPanelID=this.baseID;this.attachedImagesPanel=__px(this).elemByID(this.baseID+"_ImgAtt");this.fromTheWebPanel=__px(this).elemByID(this.baseID+"_ImgWeb");this.searchPanel=__px(this).elemByID(this.baseID+"_ImgSrch");this.tabs=[this.attachedImagesPanel,this.fromTheWebPanel,this.searchPanel];this.searchImagesTextBox=__px(this).elemByID(this.searchPanelID+"_SearchImageEdit");this.find2Call=__px_callback(this).createCommand("FindImages2",true);this.events.appendEvents(PXInsertImageDialog.events,$e.clientEvents);__px_cm(this).readProperties(this,$e,PXInsertImageDialog.properties);};PXInsertImageDialog.properties=[["noimage",JSType.String,"","noimage"]];PXInsertImageDialog.__baseType=PXRichTextUpload;PXInsertImageDialog.events={$saveItem:lastEvent(PXSmartPanel.events)+1};PXInsertImageDialog.listIsBeingUpdated=false;PXInsertImageDialog.prototype.updateListImpl=function($O){$O.listIsBeingUpdated=false;$O.searchPreviewPanel.loaded=false;$O.searchPreviewPanel.load();};PXInsertImageDialog.prototype.searchImages2=function($O,e){this.findImage2();};PXInsertImageDialog.prototype.onLoad=function(){PXInsertImageDialog.callBase(this,"onLoad",[]);this.uploader=__px_all(this)[this.ID+"_upld"];this.imgList1=__px_all(this)[this.attachedPanelID+"_gallery1"];this.searchPreviewPanel=__px_all(this)[this.searchPanelID+"_gallery2"];var $P=Function.createDelegate(this,this.handleDblClick2);__px(this).addEventHandler(this.element,"dblclick",$P);var $Q=Function.createDelegate(this,this.handleClick2);__px(this).addEventHandler(this.element,"click",$Q);this.searchImagesTextBoxControl=__px_all(this)[this.searchPanelID+"_SearchImageEdit"];if(this.searchImagesTextBoxControl){this.searchImagesTextBoxControl.defaultSearch=undefined;var $R=Function.createDelegate(this,this.searchImages2);this.searchImagesTextBoxControl.events.addEventHandler("search",$R);};if(this.attachedImagesPanel){var $S=Function.createDelegate(this,function($g,e){this.imgList1.loaded=false;this.imgList1.load();this.lastUpload=e.filename?e.filename:e.fileName;});if(this.uploader){this.uploader.events.addEventHandler("hideAfterUpload",$S);};this.events.addEventHandler("afterUpload",$S);var $T=Function.createDelegate(this,function($g,e){if(this.lastUpload){var $U=this.imgList1.element.querySelectorAll('[data-convert][src$="'+this.lastUpload+'"]');for(var i=0;i<$U.length;i++){var $V=$U[i];var $g=$V.getAttribute('src');if($g[$g.length-this.lastUpload.length-1]=='\\'){this.unselectImages($V);$V.className=__px(this).appendCss($V,["selected-image"]);this.selectedFile=$V.getAttribute('src');this.selectedCaption=$V.getAttribute('tooltip');break;}};this.lastUpload=undefined;}});if(this.imgList1){this.imgList1.events.addEventHandler("afterLoad",$T);this.registerUploadControl(this.imgList1.element);}};var $W=__px(this).elemByID(this.baseID+"_prvw");if($W){$W.style.setProperty('display','none');};this.previewImg=__px(this).elemByID(this.baseID+"_prvw");if(this.previewImg){__px(this).addEventHandler(this.previewImg,"error",Function.createDelegate(this,this.previewError));};this.okButton=__px_all(this)[this.outerBaseID+"_OKButton"];};PXInsertImageDialog.prototype.previewError=function(e){if(this.previewImg.src!=this.noimage){this.previewImg.className=__px(this).excludeCss(this.previewImg,["auto-size"]);this.previewImg.src=this.noimage;}};PXInsertImageDialog.prototype.handleDblClick2=function(e){if((e.target.tagName=="IMG")&&(e.target.getAttribute("data-convert")=="view")){var $X=e.target.getAttribute('src');this.selectedFile=$X;this.selectedCaption=e.target.getAttribute('tooltip');this.dialogResult=1;this.hide();}};PXInsertImageDialog.prototype.unselectImages=function($V){var $Y=function($Z){var $00=$Z.parentNode.parentNode;var $N=[];for(var $01 in $00.childNodes){var $02=$00.childNodes[$01];for(var $03 in $02.childNodes){var $04=$02.childNodes[$03];if($04.nodeName=="IMG")$N.push($04);}};return $N;};var $U=$Y($V);for(var i in $U){var $W=$U[i];$W.className=__px(this).excludeCss($W,["selected-image"]);}};PXInsertImageDialog.prototype.handleClick2=function(e){if((e.target.tagName=="IMG")&&(e.target.getAttribute("data-convert")=="view")){var $X=e.target.getAttribute('src');this.unselectImages(e.target);e.target.className=__px(this).appendCss(e.target,["selected-image"]);this.selectedFile=$X;this.selectedCaption=e.target.getAttribute('tooltip');}};PXInsertImageDialog.prototype.showDlg=function(){if(this.attachedImagesPanel&&this.imgList1){this.imgList1.loaded=false;this.imgList1.load();};this.show();if(undefined==this.selectedTab){this.setFirstTab();}};PXInsertImageDialog.prototype.setImageTabDisplay=function($j){this.setTabDisplay($j);};PXInsertImageDialog.prototype.executeCommand=function($05,$06){var $07=[];switch($05){case "AttachedImagesTab":this.setImageTabDisplay(0);break;case "FromTheWebTab":this.setImageTabDisplay(1);break;case "SearchImagesTab":this.setImageTabDisplay(2);break;case "PreviewImage":this.showPreview();break;case "FindImage2":this.findImage2();break;case "BrowseForImage":this.showUploader();break;}};PXInsertImageDialog.prototype.showUploader=function(){this.fireEvent("saveItem",null,null);};PXInsertImageDialog.prototype.showUploader2=function(){if(this.uploader){this.uploader.show();}};PXInsertImageDialog.prototype.showfoundImages2=function($08){if(this.searchPreviewPanel){this.searchPreviewPanel.element.innerHTML=$08;}};PXInsertImageDialog.prototype.findImage2=function(){if(this.searchImagesTextBoxControl){var $09=Function.createDelegate(this,this.showfoundImages2);var $0a=this.searchImagesTextBoxControl.getValue();__px_callback(this).execI(this,this.find2Call,$0a,$09);}};PXInsertImageDialog.prototype.showPreview=function(){if(this.previewImg){this.previewImg.className=__px(this).appendCss(this.previewImg,["auto-size"]);this.previewImg.style.setProperty('display','block');this.previewImg.src=this.getSelectedFile();}};PXInsertImageDialog.prototype.getSelectedFile=function(){var $0b=__px(this).elemByID(this.baseID+"_FtWUrl");switch(this.selectedTab){case 1:return $0b?$0b.value:undefined;default:return this.selectedFile;}};PXInsertImageDialog.prototype.isExternalFile=function(){return this.selectedTab==1;};function PXImageProperties($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXImageProperties.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXImageProperties.events,$e.clientEvents);this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onShow));};PXImageProperties.__baseType=PXSmartPanel;PXImageProperties.events={$removeImage:lastEvent(PXSmartPanel.events)+1};PXImageProperties.prototype.isLoaded=function(){return this.borderCheck&&this.linkCheck;};PXImageProperties.prototype.onLoad=function(){if(this.isLoaded())return;this.borderCheck=__px_all(this)[this.ID+"_border"];this.linkCheck=__px_all(this)[this.ID+"_click"];if(!this.isLoaded())return;PXImageProperties.callBase(this,"onLoad",[]);this.captionBox=__px_all(this)[this.ID+"_ImagePropsCaption"];this.widthBox=__px_all(this)[this.ID+"_ImagePropsWidth"];this.borderCheck.events.addEventHandler("valueChanged",Function.createDelegate(this,this.changeBorder2));this.linkCheck.events.addEventHandler("valueChanged",Function.createDelegate(this,this.changeLink2));};PXImageProperties.prototype.changeBorder2=function(){if(this.targetImage&&this.borderCheck){this.targetImage.className=__px(this).toggleCss(this.borderCheck.getValue(),this.targetImage,['imgbrdr']);}};PXImageProperties.prototype.changeLink2=function(){var $0c=function($d,$0d,$o){if($d.getAttribute($0d)){$d.removeAttribute($0d);return false;}else{$d.setAttribute($0d,$o);return true;}};if($0c(this.targetImage,"data-clickable","yes")){}};PXImageProperties.prototype.unlinkImage=function(){var $W=this.targetImage;if($W){var $0e=$W.parentNode;$0e.parentNode.replaceChild($W,$0e);};this.hide();};PXImageProperties.prototype.setSize=function($0f){var $0g;if(this.targetImage){this.targetImage.style.width="";this.targetImage.style.height="";if($0f==0){this.targetImage.removeAttribute("width");this.targetImage.removeAttribute("height");}else{var $0h=this.targetImage.width;var $0i=this.targetImage.height;$0g=$0i*$0f/$0h;this.targetImage.setAttribute("width",$0f);this.targetImage.setAttribute("height",$0g);};this.updateWidth();}};PXImageProperties.prototype.updateCaption=function(){if(this.captionBox&&this.widthBox){this.targetImage.setAttribute("title",this.captionBox.getValue()||"");var $0j=this.widthBox.getValue();this.setSize(parseInt($0j,10));};this.hide();};PXImageProperties.prototype.executeCommand=function($05,$06){switch($05){case "OkImage":this.updateCaption();break;case "CancelImage":this.hide();break;case "LinkImage":this.linkImage();break;case "UnlinkImage":this.unlinkImage();break;case "SmallImage":this.setSize(50);break;case "MedImage":this.setSize(200);break;case "LargeImage":this.setSize(600);break;case "OriginalImage":this.setSize(0);break;case "RemoveImage":var $W=this.targetImage;this.hide();this.fireEvent("removeImage",null,{'image':$W});break;}};PXImageProperties.prototype.updateWidth=function(){if(this.widthBox&&this.targetImage){this.widthBox.setValue(this.targetImage.width);}};PXImageProperties.prototype.onShow=function(){this.onLoad();this.editedImage=undefined;this.captionBox.setValue(this.targetImage.getAttribute('title'));this.borderCheck.setValue(__px(this).hasCss(this.targetImage,['imgbrdr']));this.linkCheck.setValue(this.targetImage.getAttribute("data-clickable")!="yes");this.updateWidth();var $0k=__px_all(this)[this.ID+"_unlinkBtn"];var $0l=this.targetImage.parentNode.nodeName=="A";$0k.setEnabled($0l);this.linkCheck.setEnabled(!$0l);};PXImageProperties.prototype.showPopup=function($V){this.targetImage=$V;this.show();};PXImageProperties.prototype.linkImage=function(){var $0m=this.ID.split('_').slice(0,-1).join('_')+"_insl";this.openForLink=true;this.hide();this.editedImage=this.targetImage;var $0n=__px_all(this)[$0m];$0n.editedImage=this.targetImage;$0n.showDlg(this.outerLink,this.outerLinkType);};function PXInsertLinkDialog($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXInsertLinkDialog.initializeBaseA(this,[$c,$d,$e,$f]);__px_cm(this).readProperties(this,$e,PXInsertLinkDialog.properties);this.outerBaseID=$d.id+"_splitter";this.baseID=this.outerBaseID+"_rpnl";this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onShow));};PXInsertLinkDialog.__baseType=PXRichTextDialog;PXInsertLinkDialog.properties=[["noimage",JSType.String,"","noimage"]];PXInsertLinkDialog.events={$saveItem:lastEvent(PXSmartPanel.events)+1};PXInsertLinkDialog.prototype.getSelection=function(){var $0o=this.baseSelection();if($0o){return $0o;};if(this.tabs[this.selectedTab]==this.externalFilesPanel){var $q=__px(this).elemByID(this.baseID+"_FileWebUrl");if($q){var $A=__px(this).elemByID(this.outerBaseID+"_capt");var $i=$A?$A.value:undefined;return{'type':'WebFilesTab','key':$q.value,'value':$q.value,'caption':$i};}}};PXInsertLinkDialog.prototype.onLoad2=function(){if(this.linkWebUrl)return;PXInsertLinkDialog.callBase(this,"onLoad",[]);this.linkWebUrl=__px_all(this)[this.baseID+"_FileWebUrl"];if(!this.linkWebUrl)return;this.regPanel('attachedFilesPanel','AttachedFilesTab',"attFiles");this.regPanel('searchFilesPanel','SearchFilesTab',"allFiles");this.regPanel('externalFilesPanel','WebFilesTab');this.regPanel('linkArticlesPanel','LinkedArticlesTab',"articles");this.regPanel('linkScreensPanel','LinkedScreensTab',"screens");this.setHandler("screens");this.setHandler("articles");this.setHandler("attFiles");this.setHandler("allFiles");var $W=__px(this).elemByID(this.baseID+"_prvw");if($W){$W.style.setProperty('display','none');};this.previewImg=__px(this).elemByID(this.baseID+"_prvw");if(this.previewImg){__px(this).addEventHandler(this.previewImg,"error",Function.createDelegate(this,this.previewError));};this.addGridDblclick("attFiles");this.addGridDblclick("allFiles");this.addGridDblclick("articles");this.addGridDblclick("screens");var $0p=__px_all(this);this.updateGridRefreshCallback($0p[this.ID+"_splitter_rpnl_allFiles_filesSearchGrid"]);this.updateGridRefreshCallback($0p[this.ID+"_splitter_rpnl_articles_articlesGrid"]);this.updateGridRefreshCallback($0p[this.ID+"_insl_splitter_rpnl_screens_screensGrid"]);};PXInsertLinkDialog.prototype.updateGridRefreshCallback=function($p){if($p&&$p.callbacks&&$p.callbacks[0]){for(var i=0;i<$p.callbacks.length;i++)if($p.callbacks[i].name==PXGridCommand.Refresh){$p.callbacks[i].postData=3;break;}}};PXInsertLinkDialog.prototype.addGridDblclick=function($m){var $n=__px_all(this)[this.baseID+"_"+$m];if($n&&$n.grid){$n.grid.events.addEventHandler($n.events,"cellClick",Function.createDelegate(this,function($g,e){if(e.event.clickCount==2){this.dialogResult=PXDialogResult.OK;this.hide();}}));}};PXInsertLinkDialog.prototype.showPreview=function(){if(this.previewImg){this.previewImg.className=__px(this).appendCss(this.previewImg,["auto-size"]);this.previewImg.style.setProperty('display','block');var $0b=__px(this).elemByID(this.baseID+"_FtWUrl");var $g=$0b?$0b.value:undefined;if($g){this.previewImg.src=$g;}}};PXInsertLinkDialog.prototype.previewError=function(e){if(this.previewImg.src!=this.noimage&&this.noimage){this.previewImg.className=__px(this).excludeCss(this.previewImg,["auto-size"]);this.previewImg.src=this.noimage;}};PXInsertLinkDialog.prototype.setLinksTabDisplay=function($j,$0q){this.setTabDisplay($j);if(!$0q){}};PXInsertLinkDialog.prototype.executeCommand=function($05,$06){var $j=this.tabCommands.indexOf($05);if($j>-1){this.setLinksTabDisplay($j);}};PXInsertLinkDialog.prototype.getSelectedFile=function(){switch(this.selectedTab){case 3:return __px(this).elemByID(this.baseID+"_LinkWebUrl").value;case 2:return this.getSelectedScreen();case 1:return this.getSelectedFile1();case 0:return this.getSelectedArticle();}};PXInsertLinkDialog.prototype.getSelectedCell=function($p,$0r){var $0s=$p.activeRow.xmlNode.childNodes[0];return $0s.childNodes[$0r].getAttribute("Value");};PXInsertLinkDialog.prototype.getSelectedArticle=function(){return this.getSelectedCell(this.articlesGrid,3);};PXInsertLinkDialog.prototype.getSelectedFile1=function(){return this.getSelectedCell(this.filesGrid,0);};PXInsertLinkDialog.prototype.getSelectedArticleTitle=function(){return this.getSelectedCell(this.articlesGrid,0);};PXInsertLinkDialog.prototype.getSelectedScreen=function(){return this.getSelectedCell(this.screensGrid,1);};PXInsertLinkDialog.prototype.getSelectedScreenTitle=function(){return this.getSelectedCell(this.screensGrid,0);};PXInsertLinkDialog.prototype.getSelectedCaption=function(){switch(this.selectedTab){case 3:this.selectedCaption=this.getSelectedFile();return this.getCaption();case 2:this.selectedCaption=this.getSelectedScreenTitle();return this.getCaption();case 1:this.selectedCaption=this.getSelectedFile1();return this.getCaption();case 0:this.selectedCaption=this.getSelectedArticleTitle();return this.getCaption();}};PXInsertLinkDialog.prototype.onShow=function(){this.onLoad2();var $k=this.onShowKey;var $z=this.onShowType;var $0t=function($O,$j){$O.setLinksTabDisplay($j,true);var $0u=$O.menu.items.getItem($j);$0u.setChecked(true);};var $O=this;if($k){this.setCaption($k.textContent);}else{this.setCaption("");};if(this.attachImagesCtrl){this.attachImagesCtrl.load();};switch($z){case "article":this.setTabByName('LinkedArticlesTab',$k);break;case "screen":this.setTabByName('LinkedScreensTab',$k);break;case "file":this.setTabByName('SearchFilesTab',$k);break;case "attFile":this.setTabByName('AttachedFilesTab',$k);break;case "extFile":this.setTabByName('WebFilesTab',$k);if($k){this.linkWebUrl.setValue($k.getAttribute('href'));};break;};if(this.selectedTab){var $0u=$O.menu.items.getItem(this.selectedTab);$0u.setChecked(true);};if(undefined==this.selectedTab){this.setFirstTab();}};PXInsertLinkDialog.prototype.showDlg=function($k,$z){this.onShowKey=$k;this.onShowType=$z;this.show();};PXInsertLinkDialog.prototype.getType=function(){return this.selectedTab;};function PXInsertFileDialog($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.outerBaseID=$d.id+"_splitter";this.baseID=this.outerBaseID+"_rpnl";this.attachedPanelID=this.baseID;this.searchPanelID=this.baseID;PXInsertFileDialog.initializeBaseA(this,[$c,$d,$e,$f]);this.attachedFilesPanel=__px(this).elemByID(this.baseID+"_FlsFls");this.filesFromTheWebPanel=__px(this).elemByID(this.baseID+"_FlsWeb");this.filesSearchPanel=__px(this).elemByID(this.baseID+"_FlsSrch");this.tabs=[this.attachedFilesPanel,this.filesFromTheWebPanel,this.filesSearchPanel];this.events.appendEvents(PXInsertFileDialog.events,$e.clientEvents);};PXInsertFileDialog.__baseType=PXRichTextUpload;PXInsertFileDialog.events={$saveItem:lastEvent(PXSmartPanel.events)+1};PXInsertFileDialog.prototype.onLoad=function(){PXInsertFileDialog.callBase(this,"onLoad",[]);this.uploader=__px_all(this)[this.ID+"_upld2"];var $O=this;if(this.attachedFilesPanel){var $S=Function.createDelegate(this,function(e){$O.refreshGrid.call($O,this.baseID+"_"+"filesGrid");});this.uploader.events.addEventHandler("afterHide",$S);this.filesGrid=__px_all(this)[this.attachedPanelID+"_filesGrid"];if(this.filesGrid){this.registerUploadControl(this.filesGrid.element);this.filesGrid.events.addEventHandler("cellClick",this.gridDblClickHandler);};this.events.addEventHandler("afterUpload",$S);};this.filesSearchGrid=__px_all(this)[this.searchPanelID+"_filesSearchGrid"];this.filesSearch=__px_all(this)[this.searchPanelID+"_FileSearch"];if(this.filesSearch){this.filesSearch.defaultSearch=undefined;this.filesSearch.events.addEventHandler("search",Function.createDelegate(this,function($g,e){e.cancel=true;$O.filesSearchGrid.applyFilter($g.getValue());}));};if(this.filesSearchGrid){this.filesSearchGrid.events.addEventHandler("cellClick",this.gridDblClickHandler);}};PXInsertFileDialog.prototype.refreshGrid=function($0v){__px_all(this)[$0v].refresh();};PXInsertFileDialog.prototype.setFilesTabDisplay=function($j){this.selectedTab=$j;this.setTabDisplay($j);switch($j){case 0:this.filesGrid.adjustPage();break;case 2:this.filesSearchGrid.adjustPage();break;}};PXInsertFileDialog.prototype.showDlg=function($0w,$0x,$r){this.datasource=$0w;this.editorID=$0x;var $0t=function($O,$j){if(!$O.filesGrid){$j--;};$O.setFilesTabDisplay($j);var $0u=$O.menu.items.getItem($j);$0u.setChecked(true);};this.show();if(this.oldFile){var $0y=this.oldFile.getAttribute('objtype');if(this.attachedFilesPanel){if($0y==undefined){$0t(this,1);var $0z=this.oldFile.getAttribute('href');__px(this).elemByID(this.baseID+"_FileWebUrl").value=$0z;}else if($0y=='attached'){$0t(this,0);this.initGrid(this.filesGrid,this.oldFile,$r,0);}else if($0y=='file'){$0t(this,2);this.initGrid(this.filesSearchGrid,this.oldFile,$r,0);};var $M=this.oldFile.getAttribute('href').substr($r.length);}else{if($0y==undefined){$0t(this,0);var $0z=this.oldFile.getAttribute('href');__px(this).elemByID(this.baseID+"_FileWebUrl").value=$0z;}else if($0y=='file'){$0t(this,1);this.initGrid(this.filesSearchGrid,this.oldFile,$r,0);}}};var $O=this;var $0A=(undefined==this.selectedTab);if($0A){this.setFirstTab();}else{if(this.attachedFilesPanel){switch(this.selectedTab){case 0:this.filesGrid.refresh();break;case 2:if($0A){this.filesSearchGrid.refresh();};break;}}else{if(this.selectedTab==1&&$0A){this.filesSearchGrid.refresh();}}}};PXInsertFileDialog.prototype.executeCommand=function($05,$06){switch($05){case "AttachedFilesTab":this.setFilesTabDisplay(0);break;case "WebFilesTab":this.setFilesTabDisplay(1);break;case "SearchFilesTab":this.setFilesTabDisplay(2);break;case "BrowseForFile":this.showUploader();break;}};PXInsertFileDialog.prototype.showUploader=function(){this.fireEvent("saveItem",null,null);};PXInsertFileDialog.prototype.showUploader2=function(){this.uploader.show();};PXInsertFileDialog.prototype.getSelectedFile=function(){var $0B=this.selectedTab;if($0B==1)return __px(this).elemByID(this.baseID+"_FileWebUrl").value;else if($0B==0){return this.getSelectedName(this,"filesGrid");}else if($0B==2){return this.getSelectedName(this,"filesSearchGrid");}};PXInsertFileDialog.prototype.getSelectedName=function($O,$0C){var $0D=__px_all($O)[$O.baseID+"_"+$0C];var $0E=$0D.activeRow.xmlNode.childNodes[0].childNodes[0];return $0E.getAttribute('Value');};PXInsertFileDialog.prototype.getSelectedNameOrCaption=function($O,$0C,$0F){if(($0F!=undefined)&&($0F!=""))return $0F;return this.getSelectedName($O,$0C);};PXInsertFileDialog.prototype.getCaption=function(){var $i=__px(this).elemByID(this.outerBaseID+"_capt").value;var $0B=this.selectedTab;if($0B==1){return $i;};if($0B==0){return this.getSelectedNameOrCaption(this,"filesGrid",$i);}else if($0B==2){return this.getSelectedNameOrCaption(this,"filesSearchGrid",$i);}};PXInsertFileDialog.prototype.getType=function(){return this.selectedTab;};function PXLinkProperties($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXLinkProperties.initializeBaseA(this,[$c,$d,$e,$f]);};PXLinkProperties.__baseType=PXSmartPanel;PXLinkProperties.prototype.openLink=function(){this.hide();window.open(this.targetLink.href,'_blank');};PXLinkProperties.prototype.executeCommand=function($05,$06){switch($05){case "UnlinkLink":this.removeLink();break;case "GoToLink":this.openLink();break;case "CloseLink":this.hide();break;}};function PXImageGallery($c,$d,$e,$f){PXImageGallery.initializeBaseA(this,[$c,$d,$e,$f]);};PXImageGallery.__baseType=PXSmartPanel;function PXLoadTemplatePanel1($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXLoadTemplatePanel1.initializeBaseA(this,[$c,$d,$e,$f]);__px_cm(this).readProperties(this,$e,PXLoadTemplatePanel1.properties);this.events.appendEvents(PXLoadTemplatePanel1.events,$e.clientEvents);this.handler=Function.createDelegate(this,this.handleCallback2);this.elemArticle=__px_cm(this).createControl("PXSelector",$d.id+"_notification");this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onLoad));};PXLoadTemplatePanel1.PostDataMode_Page=3;PXLoadTemplatePanel1.RepaintMode_None=0;PXLoadTemplatePanel1.__baseType=PXSmartPanel;PXLoadTemplatePanel1.properties=[["command",JSType.String,null],["repaintControlsIDs",JSType.String,null]];PXLoadTemplatePanel1.events={$templateSelected:lastEvent(PXSmartPanel.events)+1};PXLoadTemplatePanel1.prototype.onLoad=function(){var $0G=!this.grid;this.grid=__px_all(this)[this.ID+"_tplGrd"];if(this.grid&&$0G){PXLoadTemplatePanel1.callBase(this,"onLoad",[]);var $0H=Function.createDelegate(this,this.select);this.grid.events.addEventHandler("cellClick",$0H);this.grid.events.addEventHandler("keyUp",$0H);}};PXLoadTemplatePanel1.prototype.select=function($0I,ev){if(ev.event.clickCount==2){var $0s=this.grid.activeRow.xmlNode.childNodes[0];var $0J=$0s.childNodes[1].getAttribute("Value");if($0J){var $0K=__px_callback(this).createCommand("Load",true,PXLoadTemplatePanel1.RepaintMode_None,true,PXLoadTemplatePanel1.PostDataMode_Page);$0K.sendSettings=true;if(this.repaintControlsIDs)$0K.repaintControlsIDs=this.repaintControlsIDs;__px_callback(this).execI(this,$0K,$0J,this.handler);}}};PXLoadTemplatePanel1.prototype.onOk=function(){var $0J=this.elemArticle.getValue();if($0J){var $0K=__px_callback(this).createCommand(this.command,true,PXLoadTemplatePanel1.RepaintMode_None,true,PXLoadTemplatePanel1.PostDataMode_Page);$0K.sendSettings=true;if(this.repaintControlsIDs)$0K.repaintControlsIDs=this.repaintControlsIDs;__px_callback(this).execI(this,$0K,$0J,this.handler);}};PXLoadTemplatePanel1.prototype.handleCallback2=function($N,$c){var $0L;if($N&&($0L=(new PXXmlDoc("",$N)).rootNode)&&$0L.childNodes.length>0){var $0M=new Object();for(var $j=0;$j<$0L.childNodes.length;$j++){var $0N=$0L.childNodes[$j];if($0N.childNodes.length>0){var $o=$0N.childNodes[0].nodeValue;switch($0N.tagName){case "subject":$0M.subject=$o;break;case "style":$0M.style=$o;break;case "content":$0M.content=$o;break;}}};this.fireEvent("templateSelected",null,$0M);};this.hide();};function PXDatafieldPanel($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXDatafieldPanel.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXDatafieldPanel.events,$e.clientEvents);__px_cm(this).registerRequiresOnLoad(this,this.ID);};PXDatafieldPanel.Text=1;PXDatafieldPanel.NodeImage=2;PXDatafieldPanel.__baseType=PXSmartPanel;PXDatafieldPanel.events={$datafieldSelected:lastEvent(PXSmartPanel.events)+1};PXDatafieldPanel.prototype.onLoad=function(e){var $0O=Function.createDelegate(this,this.handleNodeClick2);var $0P=Function.createDelegate(this,this.handleKeyPress);this.tree=__px_all(this)[this.ID+"_Smrt_phTreeID"];this.tree.events.addEventHandler("nodeClick",$0O);this.tree.events.addEventHandler("keyDown",$0P);this.btn=__px_all(this)[this.ID+"_sel"];if(this.btn){this.btn.setEnabled(false);this.btn.events.addEventHandler("mouseDown",Function.createDelegate(this,function($0I,ev){if(this.btn.getEnabled()){this.insertParameter();}}));}};PXDatafieldPanel.prototype.handleKeyPress=function($0I,ev){if($0I.selectedNode&&$0I.selectedNode.value){if(!(ev.event.ctrlKey||ev.event.altKey||ev.event.shiftKey||ev.event.metaKey)){if(ev.key==13){this.insertParameter();}}}};PXDatafieldPanel.prototype.handleNodeClick2=function($0I,ev){if(ev.area==PXDatafieldPanel.Text||ev.area==PXDatafieldPanel.NodeImage){if(ev.event.type=="dblclick"){if($0I.selectedNode&&$0I.selectedNode.value){this.insertParameter();}}else{this.btn.setEnabled(true);}}else{this.btn.setEnabled(false);}};PXDatafieldPanel.prototype.insertParameter=function(){if(this.tree.selectedNode!=null&&this.tree.selectedNode.value){var $0M=new Object();$0M.value=this.tree.selectedNode.value;this.hide();this.fireEvent("datafieldSelected",null,$0M);}};function PXIframeProperties($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXIframeProperties.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXIframeProperties.events,$e.clientEvents);this.events.addEventHandler("afterLoad",Function.createDelegate(this,this.onLoad));this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onShow));};PXIframeProperties.__baseType=PXSmartPanel;PXIframeProperties.events={$iframeSelected:lastEvent(PXSmartPanel.events)+1,$iframeRemoved:lastEvent(PXSmartPanel.events)+2};PXIframeProperties.prototype.onLoad=function(e){if(this.loadDone)return;this.srcEdit=__px_all(this)[this.ID+"_IframeSource"];this.widthEdit=__px_all(this)[this.ID+"_IframeWidth"];this.heightEdit=__px_all(this)[this.ID+"_IframeHeight"];this.borderEdit=__px_all(this)[this.ID+"_IframeBorder"];this.removeBtn=__px_all(this)[this.ID+"_RemoveButton"];this.loadDone=this.srcEdit&&this.widthEdit&&this.heightEdit&&this.borderEdit&&this.removeBtn;};PXIframeProperties.prototype.executeCommand=function($05,$06){if($05=="CancelFrame")this.hide();else if($05=="OkFrame"){this.hide();this.fireEvent("iframeSelected",null,{'src':this.srcEdit.getValue(),'width':this.widthEdit.getValue(),'height':this.heightEdit.getValue(),'border':this.borderEdit.getValue()});}else if($05=="RemoveFrame"){this.hide();if(this.oldFrame){this.fireEvent("iframeRemoved",null,{'frame':this.oldFrame});}}};PXIframeProperties.prototype.showDlg=function(){this.show();};PXIframeProperties.prototype.onShow=function(){if(this.oldFrame){this.removeBtn.setEnabled(true);this.srcEdit.setValue(this.oldFrame.getAttribute("data-src"));this.widthEdit.setValue(this.oldFrame.getAttribute("width"));this.heightEdit.setValue(this.oldFrame.getAttribute("height"));this.borderEdit.setValue(this.oldFrame.getAttribute("class").indexOf("iframeBorder")>-1);}else{this.srcEdit.setValue("http://");this.widthEdit.setValue("100");this.heightEdit.setValue("100");this.borderEdit.setValue("");this.removeBtn.setEnabled(false);}};function PXInsertCodeDialog($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXInsertCodeDialog.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXInsertCodeDialog.events,$e.clientEvents);this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onShow));};PXInsertCodeDialog.__baseType=PXSmartPanel;PXInsertCodeDialog.events={$codeSelected:lastEvent(PXSmartPanel.events)+1};PXInsertCodeDialog.prototype.executeCommand=function($05,$06){if($05=="CancelCode")this.hide();else if($05=="OkCode"){this.hide();var $0Q=__px(this).elemByID(this.ID+"_codeEdit").value;var $0R=__px(this).elemByID(this.ID+"_showLines").checked;var $0S=__px(this).elemByID(this.ID+"_firstLine").value;this.fireEvent("codeSelected",null,{'code':$0Q,'lines':$0R,'firstLine':$0S});}};PXInsertCodeDialog.prototype.onShow=function(){var $0Q=this.code;var $0T=__px(this).elemByID(this.ID+"_firstLine");if($0T){if($0Q){__px(this).elemByID(this.ID+"_codeEdit").value=$0Q.textContent;__px(this).elemByID(this.ID+"_showLines").checked=$0Q.getAttribute('data-lines')=="true"?true:undefined;$0T.value=$0Q.getAttribute('data-firstline');};if(!$0T.value){$0T.value="1";}}};PXInsertCodeDialog.prototype.showDlg=function($0Q){this.code=$0Q;this.show();};function PXMacroProperties($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXMacroProperties.initializeBaseA(this,[$c,$d,$e,$f]);};PXMacroProperties.__baseType=PXSmartPanel;PXMacroProperties.prototype.removeMacro=function(){this.hide();var $0U=__doc(this);var $0V=$0U.createElement('span');var $0W=this.targetMacro;$0V.innerHTML=$0W.innerText!=undefined?$0W.innerText:$0W.text;this.targetMacro.parentNode.replaceChild($0V,this.targetMacro);};PXMacroProperties.prototype.openMacro=function(){this.hide();window.open(this.targetMacro.href,'_blank');};PXMacroProperties.prototype.executeCommand=function($05,$06){switch($05){case "RemoveMacro":this.removeMacro();break;case "Edit":this.openMacro();break;case "CloseMacro":this.hide();break;}};PXMacroProperties.prototype.showDlg=function($0X){this.macro=$0X;this.show();};function PXEditableMacroProperties($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXEditableMacroProperties.initializeBaseA(this,[$c,$d,$e,$f]);};PXEditableMacroProperties.__baseType=PXMacroProperties;PXEditableMacroProperties.prototype.executeCommand=function($05,$06){switch($05){case "CloseMacro":this.hide();break;}};function PXCreateTable($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXCreateTable.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXCreateTable.events,$e.clientEvents);this.moveHandler=Function.createDelegate(this,this.mouseMove2);this.clickHandler=Function.createDelegate(this,this.mouseClick2);this.events.addEventHandler("afterLoad",Function.createDelegate(this,this.onLoad));this.events.addEventHandler("afterShow",Function.createDelegate(this,this.subscribe2));this.events.addEventHandler("afterHide",Function.createDelegate(this,this.unsubscribe2));};PXCreateTable.__baseType=PXSmartPanel;PXCreateTable.events={$tableSizeSelected:lastEvent(PXSmartPanel.events)+1};PXCreateTable.prototype.onLoad=function(){var $0Y=this.columns&&this.rows&&this.table;if($0Y)return;PXCreateTable.callBase(this,"onLoad",[]);this.columns=__px_all(this)[this.ID+"_Columns"];this.rows=__px_all(this)[this.ID+"_Rows"];this.table=__px(this).elemByID(this.ID+"_inittable");};PXCreateTable.prototype.subscribe2=function(){this.onLoad();if(this.table){this.cells=this.table.querySelectorAll('td');this.cellRects=[];for(var i=0;i<this.cells.length;i++){this.cellRects.push(this.cells[i].getBoundingClientRect());};this.table.addEventListener("mousemove",this.moveHandler,false);this.table.addEventListener("mouseup",this.clickHandler,false);}};PXCreateTable.prototype.unsubscribe2=function(){this.cells=undefined;this.cellRects=undefined;if(this.table){this.table.removeEventListener("mousemove",this.moveHandler);this.table.removeEventListener("mouseup",this.clickHandler);}};PXCreateTable.prototype.mouseMove2=function(e){var $0Z=this.cells;var x=0,y=0;for(var i=0;i<$0Z.length;i++){var $04=$0Z[i];var $10=this.cellRects[i];var $11=$10.top<e.clientY&&$10.left<e.clientX;$04.setAttribute('class',$11?"selected":"");if($11){var $12=Math.floor(i/10);var $13=i-10*$12;x=Math.max(x,$13);y=Math.max(y,$12);}};this.columns.setValue(x+1);this.rows.setValue(y+1);};PXCreateTable.prototype.getCols=function(){try{return parseInt(this.columns.getValue(),10);}catch(ex){return 0;}};PXCreateTable.prototype.getRows=function(){try{return parseInt(this.rows.getValue(),10);}catch(ex){return 0;}};PXCreateTable.prototype.mouseClick2=function(e){if(this.table.contains(e.target)){var $14=this.table;var $15=$14.querySelector('tbody');if($15)$14=$15;if($14){var x,y=0;for(var i=0;i<$14.childNodes.length;i++){var $16=$14.childNodes[i];if($16.nodeName=='TR'){var $11=$16.querySelectorAll('td[class=selected]').length;if($11>0){x=$11;y++;}}};this.hide();this.fireEvent("tableSizeSelected",null,{'width':x,'height':y});}}};function PXTableSize($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.autoHide=true;PXTableSize.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXTableSize.events,$e.clientEvents);__px_cm(this).registerRequiresOnLoad(this,this.ID);};PXTableSize.__baseType=PXSmartPanel;PXTableSize.events={$tableSizeSelected:lastEvent(PXSmartPanel.events)+1};PXTableSize.prototype.onLoad=function(){PXTableSize.callBase(this,"onLoad",[]);this.events.addEventHandler("afterHide",Function.createDelegate(this,this.afterHide2));this.tableColumns=__px(this).elemByID(this.ID+"_Columns");this.tableRows=__px(this).elemByID(this.ID+"_Rows");};PXTableSize.prototype.afterHide2=function(e){if(this.dialogResult==PXDialogResult.OK){this.fireEvent("tableSizeSelected",null,{'width':this.tableColumns.value,'height':this.tableRows.value});}};function PXFileListDialog($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXFileListDialog.initializeBaseA(this,[$c,$d,$e,$f]);this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onLoad2));this.events.appendEvents(PXFileListDialog.events,$e.clientEvents);};PXFileListDialog.__baseType=PXSmartPanel;PXFileListDialog.events={$macroUpdated:lastEvent(PXSmartPanel.events)+1};PXFileListDialog.prototype.onLoad=function(){PXFileListDialog.callBase(this,"onLoad",[]);this.onLoad2();};PXFileListDialog.prototype.onLoad2=function(){if(this.grid){return;};this.grid=__px_all(this)[this.ID+"_files"];if(!this.grid){return;};this.events.addEventHandler("afterHide",Function.createDelegate(this,this.afterHide));if(this.grid){this.grid.events.addEventHandler("afterRefresh",Function.createDelegate(this,this.gridRefresh));this.grid.refresh();}};PXFileListDialog.prototype.showDlg=function($0X){this.macro=$0X;this.show();};PXFileListDialog.prototype.gridRefresh=function($g,e){var $17=this.grid.rows;for(var i=0;i<$17.length;i++){$17.getRow(i).getCell(0).setValue(true);};if(this.macro){var $18=this.macro.getAttribute('data-excluded');if($18){var $19=$18.split('|');for(var i=0;i<$17.length;i++){var $1a=$17.getRow(i).getCell(1).getValue();if($19.indexOf($1a)>-1){$17.getRow(i).getCell(0).setValue(false);}}}}};PXFileListDialog.prototype.afterHide=function(e){if(this.dialogResult==PXDialogResult.OK){var $18=[];var $17=this.grid.rows;for(var i=0;i<$17.length;i++){if(!$17.getRow(i).getCell(0).getValue()){$18.push($17.getRow(i).getCell(1).getValue());}};if($18.length){this.macro.setAttribute('data-excluded',$18.join('|'));}else{this.macro.removeAttribute('data-excluded');};this.fireEvent("macroUpdated",null,{});}};function PXImagesBase($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXImagesBase.initializeBaseA(this,[$c,$d,$e,$f]);this.events.appendEvents(PXImagesBase.events,$e.clientEvents);};PXImagesBase.__baseType=PXSmartPanel;PXImagesBase.events={$selected:lastEvent(PXSmartPanel.events)+1};PXImagesBase.prototype.onLoad=function(){PXImagesBase.callBase(this,"onLoad",[]);this.imgList1=__px_all(this)[this.ID+this.imglistName];this.events.addEventHandler("beforeShow",Function.createDelegate(this,this.load));var $P=Function.createDelegate(this,this.handleDblClick2);__px(this).addEventHandler(this.element,"dblclick",$P);var $Q=Function.createDelegate(this,this.handleClick2);__px(this).addEventHandler(this.element,"click",$Q);};PXImagesBase.prototype.unselectImages=function($V){var $Y=function($Z){var $00=$Z.parentNode.parentNode;var $N=[];for(var $01 in $00.childNodes){var $02=$00.childNodes[$01];for(var $03 in $02.childNodes){var $04=$02.childNodes[$03];if($04.nodeName=="IMG")$N.push($04);}};return $N;};var $U=$Y($V);for(var i in $U){var $W=$U[i];$W.className=__px(this).excludeCss($W,["selected-image"]);}};PXImagesBase.prototype.handleDblClick2=function(e){if((e.target.tagName=="IMG")&&(e.target.getAttribute("data-convert")=="view")){var $X=e.target.getAttribute('src');this.fireEvent("selected",null,{'filename':$X,'type':'attachedImage'});}};PXImagesBase.prototype.handleClick2=function(e){if((e.target.tagName=="IMG")&&(e.target.getAttribute("data-convert")=="view")){var $X=e.target.getAttribute('src');this.unselectImages(e.target);e.target.className=__px(this).appendCss(e.target,["selected-image"]);this.selectedFile=$X;this.selectedCaption=e.target.getAttribute('tooltip');}};PXImagesBase.prototype.selectImage=function($1b){var $U=this.imgList1.element.querySelectorAll('[data-convert][src$="'+$1b+'"]');for(var i=0;i<$U.length;i++){var $V=$U[i];var $g=$V.getAttribute('src');if($g[$g.length-$1b.length-1]=='\\'){this.unselectImages($V);$V.className=__px(this).appendCss($V,["selected-image"]);this.selectedFile=$V.getAttribute('src');break;}}};PXImagesBase.prototype.onVisibleChanged2=function($1c){if($1c){this.load();}};PXImagesBase.prototype.load=function(){if(this.imgList1){this.imgList1.setLoaded(false);this.imgList1.load();}};PXImagesBase.prototype.getSelectedKey=function(){return this.selectedFile;};PXImagesBase.prototype.getSelectedValue=function(){return this.getSelectedKey();};function PXAttachedImages($c,$d,$e,$f){this.ID=$d.id;this.element=$d;this.imglistName="_gallery1";PXAttachedImages.initializeBaseA(this,[$c,$d,$e,$f]);};PXAttachedImages.__baseType=PXImagesBase;PXAttachedImages.prototype.onLoad=function(){PXAttachedImages.callBase(this,"onLoad",[]);this.uploader=__px_all(this)[this.ID+"_attImUp"];var $1d=__px(this).getLocalMessage('sizeExceeded',"size limit is exceeded");var $1e=__px(this).getLocalMessage('unsupportedFile',"unsupported file type");DragNDropMixIn(this,$1d,['.jpg','.png','.gif','.bmp','.ico'],$1e);var $S=Function.createDelegate(this,this.fileUploaded);if(this.uploader){this.uploader.events.addEventHandler("fileUploaded",$S);};this.events.addEventHandler("afterUpload",$S);var $T=Function.createDelegate(this,function($g,e){if(this.lastUpload){this.selectImage(this.lastUpload);this.lastUpload=undefined;}});if(this.imgList1){this.imgList1.events.addEventHandler("afterLoad",$T);}};PXAttachedImages.prototype.fileUploaded=function($g,$0M){this.load();this.lastUpload=$0M.filename?$0M.filename:$0M.fileName;};function PXExternalFile($c,$d,$e,$f){PXExternalFile.initializeBaseA(this,[$c,$d,$e,$f]);};PXExternalFile.__baseType=PXSmartPanel;function PXExternalImage($c,$d,$e,$f){this.imglistName="_gallery2";PXExternalFile.initializeBaseA(this,[$c,$d,$e,$f]);};PXExternalImage.__baseType=PXExternalFile;function PXAllImages($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXAllImages.initializeBaseA(this,[$c,$d,$e,$f]);this.find2Call=__px_callback(this).createCommand("FindImages2",true);};PXAllImages.__baseType=PXImagesBase;PXAllImages.prototype.onLoad=function(){PXAllImages.callBase(this,"onLoad",[]);this.searchImagesTextBoxControl=__px_all(this)[this.ID+"_SearchImageEdit"];if(this.searchImagesTextBoxControl){var $R=Function.createDelegate(this,this.searchImages2);this.searchImagesTextBoxControl.events.addEventHandler("search",$R);};this.searchPreviewPanel=__px_all(this)[this.ID+"_gallery2"];};PXAllImages.prototype.searchImages2=function($O,e){if(this.searchImagesTextBoxControl){var $09=Function.createDelegate(this,this.showfoundImages2);var $0a=this.searchImagesTextBoxControl.getValue();__px_callback(this).execI(this,this.find2Call,$0a,$09);}};PXAllImages.prototype.showfoundImages2=function($08){if(this.searchPreviewPanel){this.searchPreviewPanel.element.innerHTML=$08;}};function PXGridSelectable($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXExternalFile.initializeBaseA(this,[$c,$d,$e,$f]);this.selected=Function.createDelegate(this,this.itemSelected);this.events.appendEvents(PXGridSelectable.events,$e.clientEvents);};PXGridSelectable.__baseType=PXSmartPanel;PXGridSelectable.events={$selected:lastEvent(PXSmartPanel.events)+1};PXGridSelectable.prototype.itemSelected=function($g,e){if(e.event.clickCount==2){this.fireEvent("selected",null,{'source':this});}};PXGridSelectable.prototype.getSelectedCell=function($1f){var $0s=this.grid.activeRow.xmlNode.childNodes[0];return $0s.childNodes[$1f].getAttribute("Value");};PXGridSelectable.prototype.selectCell=function($s,$k){var $1g=this.grid.levels[0].columns[$s];this.grid.search($k,$1g);};function PXAttachedFiles($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXAttachedFiles.initializeBaseA(this,[$c,$d,$e,$f]);};PXAttachedFiles.__baseType=PXGridSelectable;PXAttachedFiles.prototype.onLoad=function(){this.uploader=__px_all(this)[this.ID+"_attFileUp"];this.grid=__px_all(this)[this.ID+"_filesGrid"];if(this.grid){if(this.uploader){this.uploader.events.addEventHandler("fileUploaded",Function.createDelegate(this,function(){this.grid.adjustPage(true)}));};this.grid.events.addEventHandler("cellClick",this.selected);};var $1d=__px(this).getLocalMessage('sizeExceeded',"size limit is exceeded");var $1e=__px(this).getLocalMessage('unsupportedFile',"unsupported file type");DragNDropMixIn(this,$1d,['.jpg','.png','.gif','.bmp','.ico'],$1e);this.events.addEventHandler("afterUpload",Function.createDelegate(this,function(){this.grid.adjustPage(true)}));};PXAttachedFiles.prototype.onVisibleChanged2=function($1c){if(this.uploader){this.uploader.onVisibleChanged($1c);};if($1c&&this.grid){this.grid.adjustPage(true);}};PXAttachedFiles.prototype.getSelectedKey=function(){return this.getSelectedCell(0);};PXAttachedFiles.prototype.getSelectedValue=function(){return this.getSelectedKey();};PXAttachedFiles.prototype.selectItem=function($1h){this.selectCell(0,$1h);};function PXAllFiles($c,$d,$e,$f){PXAllFiles.initializeBaseA(this,[$c,$d,$e,$f]);};PXAllFiles.__baseType=PXGridSelectable;PXAllFiles.prototype.onLoad=function(){this.grid=__px_all(this)[this.ID+"_filesSearchGrid"];if(this.grid){this.grid.events.addEventHandler("cellClick",this.selected);};this.filesSearch=__px_all(this)[this.ID+"_FileSearch"];if(this.filesSearch&&this.grid){this.filesSearch.defaultSearch=undefined;this.filesSearch.events.addEventHandler("search",Function.createDelegate(this,function($g,e){e.cancel=true;this.grid.applyFilter($g.getValue());}));}};PXAllFiles.prototype.getSelectedKey=function(){return this.getSelectedCell(0);};PXAllFiles.prototype.getSelectedValue=function(){return this.getSelectedKey();};PXAllFiles.prototype.selectItem=function($1h){this.filesSearch.clearValue();this.grid.setFastFilter("");this.selectCell(0,$1h);};function PXArticles($c,$d,$e,$f){PXArticles.initializeBaseA(this,[$c,$d,$e,$f]);};PXArticles.__baseType=PXGridSelectable;PXArticles.prototype.onLoad=function(){this.grid=__px_all(this)[this.ID+"_articlesGrid"];if(this.grid){this.grid.events.addEventHandler("cellClick",this.selected);};this.articleSearch=__px_all(this)[this.ID+"_ArticleLinkUrl"];if(this.articleSearch&&this.grid){this.articleSearch.defaultSearch=undefined;this.articleSearch.events.addEventHandler("search",Function.createDelegate(this,function($g,e){e.cancel=true;this.grid.applyFilter($g.getValue());}));}};PXArticles.prototype.getSelectedKey=function(){return this.getSelectedCell(3);};PXArticles.prototype.getSelectedValue=function(){return this.getSelectedCell(0);};PXArticles.prototype.selectItem=function($1h){this.articleSearch.clearValue();this.grid.setFastFilter("");this.selectCell(3,$1h);};function PXScreens($c,$d,$e,$f){PXScreens.initializeBaseA(this,[$c,$d,$e,$f]);};PXScreens.__baseType=PXGridSelectable;PXScreens.prototype.onLoad=function(){this.grid=__px_all(this)[this.ID+"_screensGrid"];if(this.grid){this.grid.events.addEventHandler("cellClick",this.selected);};this.screenSearch=__px_all(this)[this.ID+"_ScreenLinkUrl"];if(this.screenSearch&&this.grid){this.screenSearch.defaultSearch=undefined;this.screenSearch.events.addEventHandler("search",Function.createDelegate(this,function($g,e){e.cancel=true;this.grid.applyFilter($g.getValue());}));};this.screenGridSearch=Function.createDelegate(this,function($g,e){this.linkPrefix=undefined;if(this.searchValue){this.screensGrid.find(this.searchValue,this.searchColumn,0,false);this.searchValue=undefined;this.searchColumn=undefined;}});this.grid.events.addEventHandler("afterRefresh",this.screenGridSearch);};PXScreens.prototype.getSelectedKey=function(){var id=this.getSelectedCell(1);var $0z=px.removeUrlParam(this.getSelectedCell(3),'scrid');if($0z.indexOf('~/pages/')==0){id=$0z.substr(11,8);};var $1i=$0z.split('?');if($1i.length>1){return id+'&'+$1i[1];};return id;};PXScreens.prototype.getSelectedValue=function(){return this.getSelectedCell(0);};PXScreens.prototype.selectItem=function($1h){this.screenSearch.clearValue();this.grid.setFastFilter("");this.selectCell(1,$1h);};function PXInsertImageDialog2($c,$d,$e,$f){this.ID=$d.id;this.element=$d;PXInsertImageDialog2.initializeBaseA(this,[$c,$d,$e,$f]);__px_cm(this).readProperties(this,$e,PXInsertImageDialog2.properties);this.outerBaseID=$d.id+"_splitter";this.baseID=this.outerBaseID+"_rpnl";this.events.addEventHandler("afterShow",Function.createDelegate(this,this.onShow));};PXInsertImageDialog2.properties=[["noimage",JSType.String,"","noimage"]];PXInsertImageDialog2.__baseType=PXRichTextUpload;PXInsertImageDialog2.events={$saveItem:lastEvent(PXRichTextUpload.events)+1};PXInsertImageDialog2.prototype.onShow=function(){if(this.imgUrl)return;this.imgUrl=__px_all(this)[this.baseID+"_FtWUrl"];if(!this.imgUrl)return;var $W=__px(this).elemByID(this.baseID+"_prvw");if($W){$W.style.setProperty('display','none');};this.regPanel('attachedImagesPanel','AttachedImagesTab',"attImg");this.regPanel('searchImagesPanel','SearchImagesTab',"allImg");this.regPanel('externalImagesPanel','WebImagesTab');this.setHandler("attImg");this.setHandler("allImg");if(undefined==this.selectedTab){this.setFirstTab();};this.previewImg=__px(this).elemByID(this.baseID+"_prvw");if(this.previewImg){__px(this).addEventHandler(this.previewImg,"error",Function.createDelegate(this,this.previewError));}};PXInsertImageDialog2.prototype.previewError=function(e){if(this.previewImg.src!=this.noimage){this.previewImg.className=__px(this).excludeCss(this.previewImg,["auto-size"]);this.previewImg.src=this.noimage;}};PXInsertImageDialog2.prototype.showDlg=function(){this.show();};PXInsertImageDialog2.prototype.executeCommand=function($05,$06){var $j=this.tabCommands.indexOf($05);if($j>-1){this.selectedTab=$j;this.setTabDisplay($j);}else if($05=="PreviewImage"){this.showPreview();}};PXInsertImageDialog2.prototype.showPreview=function(){if(this.previewImg){var $1j=this.getSelection();if($1j){this.previewImg.className=__px(this).appendCss(this.previewImg,["auto-size"]);this.previewImg.style.setProperty('display','block');this.previewImg.src=$1j.key;}}};PXInsertImageDialog2.prototype.getSelection=function(){var $0o=this.baseSelection();if($0o){return $0o;};if(this.tabs[this.selectedTab]==this.externalImagesPanel){var $W=__px(this).elemByID(this.baseID+"_FtWUrl");if($W){var $z=this.tabCommands[this.selectedTab];var $A=__px(this).elemByID(this.outerBaseID+"_capt");var $i=$A?$A.value:undefined;return{'type':$z,'key':$W.value,'value':$W.value,'caption':$i};}}};



function PXRichTextEdit1($a,$b,$c,$d){this.px_context=$a;this.element=$b;this.ID=$b.id;this.elemToolbar=__px(this).elemByID($b.id+"_tlb");this.elemIFrame=__px(this).elemByID($b.id+"_if");var $e=this;this.elemIFrame.parentNode.onclick=function(e){var $f=$e.getEditDoc();if($f.body){$f.body.focus();var $g=$e.elemIFrame.getBoundingClientRect();if(e.pageY<$g.top){$e.gotoStart();}else if(e.pageY>$g.height){$e.gotoEnd();}}};this.mainToolbar=__px(this).elemByID($b.id+"_mtlb");this.insertImageDialog=__px(this).elemByID($b.id+"_insi");this.insertFileDialog=__px(this).elemByID($b.id+"_insf");this.insertLinkDialog=__px(this).elemByID($b.id+"_insl");this.insertImageDialog2=__px(this).elemByID($b.id+"_insi2");__px_cm(this).readProperties(this,$c,PXRichTextEdit1.properties);this.updateLangIndicator();__px_cm(this).registerAutoSize(this,$c);__px_cm(this).registerRequiresOnLoad(this,$b.id);this.initializeButtons();this.viewState=new PXStateBag(this,"PXRichTextEdit",$d);this.initUndo();this.viewFrame=__px(this).elemByID($b.id+"_ifview");this.viewId=this.viewFrame.id;this.viewStyle=this.viewFrame.style;this.viewParent=this.viewFrame.parentNode;this.viewOwner=this.viewFrame.ownerDocument;this.viewParent.style.display="none";this.sourceFrame=__px(this).elemByID($b.id+"_ifsrc");if(this.sourceFrame){this.sourceFrame.style.display="none";};this.viewState=new PXStateBag(this,"PXRichTextEdit");};PXRichTextEdit1.$3r=0;PXRichTextEdit1.$3s=1;PXRichTextEdit1.properties=[["dataKey",JSType.String,"","setKey"],["simpleFormatWarning",JSType.String,null],["loadTemplateConfirm",JSType.String,"Your data will be lost. Would you like to continue?"],["deleteLocalization",JSType.String,""],["ccpError",JSType.String,"Copy/Cut/Paste of current fragment is not available in your browser."],["loseFormatting",JSType.String,"You're about to lose all the formatting."],["spellcheck",JSType.Bool,false],["showPlainText",JSType.Bool,false],["labelID",JSType.String,""],["content",JSType.String,"","setContent"],["readonly",JSType.Bool,false],["bindingContainer",JSType.String,""],["filesMenuContainer",JSType.String,""],["fileShowUrl",JSType.String,false],["screenShowUrl",JSType.String,false],["wikiShowUrl",JSType.String,false],["convertAttr",JSType.String,false],["viewConvertAttr",JSType.String,false],["screenConvertAttr",JSType.String,false],["wikiConvertAttr",JSType.String,false],["iconConvertAttr",JSType.String,false],["wikiIconFolder",JSType.String,false],["spinnerUrl",JSType.String,""],["closeUrl",JSType.String,""],["visible",JSType.Bool,true,"setVisible"],["fileAttr",JSType.String,""],["icons",JSType.String,""],["language",JSType.String,""],["deleteTooltip",JSType.String,""]];PXRichTextEdit1.callbackProps=[["language",JSType.String,""],["dataKey",JSType.String,"","setKey"],["enabled",JSType.Bool,true,"setEnabled"],["spellcheck",JSType.Bool,false],["visible",JSType.Bool,true,"setVisible"]];PXRichTextEdit1.prototype.setKey=function($h){this.dataKey=$h;};PXRichTextEdit1.prototype.gotoStart=function(){var $f=this.getEditDoc();if($f&&$f.body){var r=$f.createRange();r.setStart($f.body,0);r.setEnd($f.body,0);var s=$f.getSelection();s.removeAllRanges();s.addRange(r);}};PXRichTextEdit1.prototype.gotoEnd=function(){var $f=this.getEditDoc();if($f&&$f.body){var r=$f.createRange();var $i=$f.body.lastChild;var s=$f.getSelection();if($i){if($i.nodeName=="P"&&$i.lastChild&&$i.lastChild.nodeName=="BR"){r.setStart($i,$i.childNodes.length-1);r.setEnd($i,$i.childNodes.length-1);s.removeAllRanges();s.addRange(r);return;}};var $j=$f.body.childNodes.length;r.setStart($f.body,$j);r.setEnd($f.body,$j);s.removeAllRanges();s.addRange(r);}};PXRichTextEdit1.prototype.sf=function($k){return;if(!this.sourceFrame){throw($k+" No source frame yet");}else if(!this.sourceFrame.contentDocument){throw($k+" No content Document");}else if(!this.sourceFrame.contentDocument.body){throw($k+" No body");}else{var t=this.sourceFrame.contentDocument.body.innerHTML;throw($k+" "+this.sourceFrame.contentDocument.body.innerHTML);}};PXRichTextEdit1.prototype.updateLangIndicator=function($l){if(!this.toolbarTail){this.toolbarTail=this.element.querySelector('.richTabTail');if(this.toolbarTail){this.toolbarTail.addEventListener('click',Function.createDelegate(this,this.langIndicatorClicked));}};if(this.toolbarTail){var $m=$l||(this.language&&this.language.split('|')[1]);var $n=this.toolbarTail.querySelector('.langIndi');if($n){$n.innerHTML=$m||"";}else{this.toolbarTail.innerHTML="<nobr class='langIndi'>"+($m||"")+"</nobr>"+this.toolbarTail.innerHTML;};var $o=this.toolbarTail.querySelector('[icon=Remove]');if($o){$o.style.display=$m?"":"none";if(this.deleteTooltip)$o.setAttribute("title",this.deleteTooltip);__px_tm(this).register($o);}}};PXRichTextEdit1.prototype.langIndicatorClicked=function(e){if(this.contains(this.toolbarTail.querySelector('.langIndi'),e.target)&&this.langMenu){__px_callback(this).execI(this,this.showLanguagesCmd,null,Function.createDelegate(this,this.showLangMenu));}else if(this.contains(this.toolbarTail.querySelector('[icon=Remove]'),e.target)){if(confirm(this.deleteLocalization)){this.contentChanged();var $l=this.alternativeLanguage||(this.language&&this.language.split('|')[0]);if($l){this.viewState.update("AlternativeLanguage",$l);};__px_callback(this).execI(this,this.localizedDeleteCmd,null,this.localizedValueHandler);__px_all(this)[this.bindingContainer].forgetChanges(this.ID);}}};PXRichTextEdit1.prototype.showLangMenu=function($p){this.langMenu.items.clear();this.langNamesCache=this.langNamesCache||{};var $q=($p||"").split('|');for(var i=0;i<$q.length;i+=3){var $r=this.langMenu.items.insertItem(-1,$q[i+2],null,true,true,true,parseInt($q[i+1]),false);$r.value=$q[i];this.langNamesCache[$q[i]]=$q[i+2];};this.langMenu.show(this.toolbarTail.lastElementChild,false);};PXRichTextEdit1.prototype.setProperties=function($c){this.forbidRefreshing=true;__px_cm(this).readProperties(this,$c,PXRichTextEdit1.callbackProps);var $s=__px_callback(this);this.setValue($s.getLargeProp(this,"value"));this.setContent($s.getLargeProp(this,"content"));this.alternativeLanguage=undefined;this.viewState.remove("AlternativeLanguage");this.updateLangIndicator();};PXRichTextEdit1.buttonGroups={'EditTab':["bold","italic","underline","sepColor","colorText","colorBackground","sepJustify","JustifyLeft","JustifyCenter","JustifyRight","JustifyFull","sepToc","insertorderedlist","insertunorderedlist","indent","outdent"],'InsertTab':["ImageButton","ImageButton2","FileButton","LinkButton","TemplateButton","PlaceholderButton","DatafieldButton","DatafieldPrevButton","macros"],'LayoutTab':["CreateSection","RemoveSection","SectionUp","SectionDown","LayoutW","LayoutWW","LayoutNW","LayoutWN","LayoutWWW","LayoutNWN"],'TablesTab':["CreateTable","TableRowBefore","TableRowAfter","TableColBefore","TableColAfter","TableDelRow","TableDelCol","TableDel","sepTable","sepDel"]};PXRichTextEdit1.prototype.getGroupForButton=function($t){for(var $u in PXRichTextEdit1.buttonGroups){if(PXRichTextEdit1.buttonGroups[$u].indexOf($t)!=-1)return $u;};return undefined;};PXRichTextEdit1.prototype.showTab=function($v,$r){this.toolBarControl.element.style.visibility="hidden";this.toolBarControl.element.style.left="";this.elemToolbar.className=__px(this).excludeCss(this.elemToolbar,["tlbr0","tlbr1","tlbr2","tlbr3","tlbr4"]);this.toolBarControl.setVisible(true);for(var $u in this.toolBarControl.items){var $w=this.toolBarControl.items[$u];if($w.setVisible){var $x=$v==this.getGroupForButton($w.key);$w.setVisible($x);}};var $y=__px(this).getDropDownPos($r.element,this.toolBarControl.element);var $z=$y.left;var $A=this.toolBarControl.element.offsetWidth;var $B=50;var $C=$z-$A/2;var $D=($A-$B)/2+15;var $E=this.toolBarControl.element;$E.style.left=$C+"px";$E.style.top=$y.top+10+"px";var $F=$E.offsetParent.offsetWidth<$E.offsetLeft+$E.offsetWidth;if($F){$E.style.left="";$E.style.right="10px";$A=$E.offsetWidth;$C=$E.offsetLeft-2;$E.style.left=$C+"px";$E.style.right="";$D=$z-$C;};this.toolBarControl.setVisible(false);this.toolBarControl.element.style.visibility="";var $G=this.toolBarControl.element.querySelector('div');$G.style.left=$D+"px";this.toolBarControl.setVisible(true);};PXRichTextEdit1.prototype.$3t=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.linkProps.hide();var $f=__doc(this);var $H=$f.createElement('span');var $I=this.linkProps.targetLink;$H.innerHTML=$I.innerText!=undefined?$I.innerText:$I.text;$I.parentNode.replaceChild($H,$I);this.tryUpdateState();};PXRichTextEdit1.prototype.editLink=function(){var $J=__px_all(this)[this.insertLinkDialog.id];$J.oldLink=this.linkProps.targetLink;this.linkProps.hide();var $K=this.$3u($J.oldLink);var $u=this.$3v($J.oldLink,$K);$J.showDlg($u,$K);};PXRichTextEdit1.prototype.$3w=function(){this.templatePanel.show();this.templatePanel.grid.refresh();};PXRichTextEdit1.prototype.$3x=function(){var $f=this.getEditDoc();this.focusToEdit2();this.lastPlaceholder=undefined;if(this.range()){this.saveUndoStepBeforeEmbedding();try{var $L=this.insertMarkers($f);var $M=Array.prototype.reduce.call($f.body.querySelectorAll('[data-template]'),function($N,$O){return Math.max($N,parseInt("0"+$O.getAttribute('data-template'),10));},0);var $P=$M+1;var $Q=this.getAllNodes($f,$f.body,NodeFilter.SHOW_TEXT);var $R=function(a,b){return a.compareDocumentPosition(b)&document.DOCUMENT_POSITION_FOLLOWING;};var $S=$R($L.startMarker,$L.endMarker);var $T=$S?$L.startMarker:$L.endMarker;var end=$S?$L.endMarker:$L.startMarker;for(var i=0;i<$Q.length;i++){var $U=$Q[i];if($R($T,$U)&&$R($U,end)){if($U.parentNode.getAttribute('data-field')){$U=$U.parentNode;};var $V=this.elemIFrame.contentDocument.createElement('span');$V.setAttribute('data-template',$P);this.lastPlaceholder=$V;if($L.startType=='start'&&$L.startMarker.nextSibling==$U)$L.startType='node';if($L.startType=='end'&&$L.startMarker.previousSibling==$U)$L.startType='node';if($L.endType=='start'&&$L.endMarker.nextSibling==$U)$L.endType='node';if($L.endType=='end'&&$L.endMarker.previousSibling==$U)$L.endType='node';$U.parentNode.insertBefore($V,$U);$V.appendChild($U);}};this.contentChanged();if($L){if($L.startType=='split')$L.startType='end';if($L.endType=='split')$L.endType='start';this.removeMarkers($f,$L.startMarker,$L.startType,$L.endMarker,$L.endType);};this.focusAfterTag(this.lastPlaceholder);}catch(e){if($L){if($L.startMarker&&$L.startMarker.parentNode){$L.startMarker.parentNode.removeChild($L.startMarker);};if($L.endMarker&&$L.endMarker.parentNode){$L.endMarker.parentNode.removeChild($L.endMarker);}};throw e;};this.tryUpdateState();__px_cm(this).notifyOnResize();}};PXRichTextEdit1.prototype.$3y=function(){this.datafieldPanel.show();};PXRichTextEdit1.prototype.$3z=function(){this.datafieldPrevPanel.show();};PXRichTextEdit1.prototype.$3A=["JustifyLeft","JustifyCenter","JustifyRight","JustifyFull","fontname","fontsize","bold","italic","underline","strikethrough","subscript","superscript","InsertHorizontalRule","insertorderedlist","insertunorderedlist","outdent","indent"];PXRichTextEdit1.prototype.executeCommand=function($W,$X){this.lastPlaceholder=undefined;if(this.btnColorText&&this.btnColorText.menu)this.btnColorText.menu.hide2();if(this.btnColorBackground&&this.btnColorBackground.menu)this.btnColorBackground.menu.hide2();if(PXRichTextEdit1.prototype.$3A.indexOf($W)>-1){this.execFormatCommand.call(this,$W,$X);this.tryUpdateState();this.syncButtons(true);}else{switch($W){case "undo":this.undo();break;case "redo":this.redo();break;case "html":this.editMode($W);break;case "source":this.sourceMode($W);break;case "plain":this.plainMode($W);break;case "preview":this.previewCacheKey=undefined;this.previewMode(null,$W);break;case "ImageButton":this.$3B("insi");this.toolBarControl.setVisible(false);break;case "ImageButton2":this.$3B("insi2");this.toolBarControl.setVisible(false);break;case "FileButton":this.$3B("insf");this.toolBarControl.setVisible(false);break;case "LinkButton":this.$3B("insl");this.toolBarControl.setVisible(false);break;case "EditLink":this.editLink();break;case "TemplateButton":this.$3w();this.toolBarControl.setVisible(false);break;case "PlaceholderButton":this.$3x();this.toolBarControl.setVisible(false);break;case "DatafieldButton":this.$3y();this.toolBarControl.setVisible(false);break;case "DatafieldPrevButton":this.$3z();this.toolBarControl.setVisible(false);break;case "toc":this.createTOC();this.toolBarControl.setVisible(false);break;case "sub":this.createSubarticles();this.toolBarControl.setVisible(false);break;case "info":this.insertBox("warncell",this.wikiIconFolder+this.infoimg);this.toolBarControl.setVisible(false);break;case "warn":this.insertBox("infocell",this.wikiIconFolder+this.warnimg);this.toolBarControl.setVisible(false);break;case "files":this.createFileList();this.toolBarControl.setVisible(false);break;case "code":this.insertCode();this.toolBarControl.setVisible(false);break;case "frame":this.insertIframe();this.toolBarControl.setVisible(false);break;case "RemoveMacro":this.removeMacro();break;case "RemoveEdMacro":this.removeEdMacro();break;case "UnlinkLink":this.$3t();break;case "EditMacro":this.edMacroPopup.hide();this.editMacro();break;case "SectionUp":this.moveUp();break;case "SectionDown":this.moveDown();break;case "CreateSection":this.addSection();break;case "RemoveSection":this.removeSection();break;case "Clear":this.clear();break;case "CreateTable":this.createTable();this.toolBarControl.setVisible(true);break;case "TableSpecified":this.tableSpecified();break;case "TableRowBefore":this.addRowBefore();break;case "TableRowAfter":this.addRowAfter();break;case "TableColBefore":this.addColBefore();break;case "TableColAfter":this.addColAfter();break;case "TableDelRow":this.delRow();break;case "TableDelCol":this.delCol();break;case "TableDel":this.delTable();break;case "BarInsert":this.mainMenuClick2($W,this.insertButton);break;case "BarLayout":this.mainMenuClick2($W,this.layoutButton);break;case "BarTables":this.mainMenuClick2($W,this.tablesButton);break;default:var $Y=$W.substr(0,6);if($Y=="Layout"){this.arrangeLayout($W);}}}};PXRichTextEdit1.prototype.$3C=function($H,$Z){var $00=$Z[0];var $01=$Z[1];for(var i in $H.childNodes){var $02=$H.childNodes[i];if($00==$02.nodeName)this.updateTag($02,$01);}};PXRichTextEdit1.prototype.focusToEdit2=function(){var $03=this.$3D();if($03)$03.focus();var $f=this.getEditDoc();if($f.activeElement!=$f.body){if($f.body.focus){$f.body.focus();}else{}};if(__px(this).IsIE||__px(this).IsIE11){this.restoreIESelection();}};PXRichTextEdit1.prototype.storeSelection3=function(){this.selection3=this.range();};PXRichTextEdit1.prototype.restoreSelection3=function(){if(this.selection3)this.setRange(this.selection3);};PXRichTextEdit1.prototype.restoreIESelection=function(){if(this.$3E){if(this.$3F!=this.$3E){return;};this.restoreRange(this.$3E);this.$3E=undefined;}};PXRichTextEdit1.prototype.removePrefixes=function($04,$05){var $p=$04;for(var i in $05){if($p.indexOf($05[i])==0){$p=$p.substring($05[i].length);}};return $p;};PXRichTextEdit1.prototype.isLoaded=function(){return this.createTableDlg&&this.specifyTableSize;};PXRichTextEdit1.prototype.onLoad=function(){if(this.isLoaded())return;this.linkProps=__px_all(this)[this.ID+"_lnkprops"];this.imageProps=__px_all(this)[this.ID+"_imgprops"];this.macroProps=__px_all(this)[this.ID+"_macroprops"];this.edMacroPopup=__px_all(this)[this.ID+"_edMacroProps"];this.templatePanel=__px_all(this)[this.ID+"_tp"];this.datafieldPanel=__px_all(this)[this.ID+"_dfp"];this.datafieldPrevPanel=__px_all(this)[this.ID+"_dfpp"];this.iframePanel=__px_all(this)[this.ID+"_ifrProps"];this.codePanel=__px_all(this)[this.ID+"_codeProps"];this.createTableDlg=__px_all(this)[this.ID+"_creattbl"];this.specifyTableSize=__px_all(this)[this.ID+"_tblsize"];this.previewDS=__px_all(this)[this.ID+"_ds2"];this.fileListDlg=__px_all(this)[this.ID+"_filelist"];if(!this.isLoaded())return;this.element.style.backgroundColor="white";this.$3G();if(this.ddFontsize)this.defFontSize=this.ddFontsize.getValue();var $e=this;var $06=Function.createDelegate(this,function($07){var $08;var $09=__px_all(this);for(var k in $09){if($09[k].__className=="PXDataViewBar")$08=$09[k];};if($08){var ds=__px_cm(this).dataSource;if(this.attachHandle==null)this.attachHandle=Function.createDelegate(this,function($0a,e){ds.events.removeEventHandler("commandPerformed",this.attachHandle);this.attachHandle=null;if(!ds.alert){$07.showUploader2();}});ds.events.addEventHandler("commandPerformed",this.attachHandle);ds.executeCommand(ds.saveCommandName,"AttachEntity;"+$08.ID);}});if(this.insertImageDialog2){var $0b=__px_all(this)[this.insertImageDialog2.id];if($0b){var $0c=Function.createDelegate(this,function(e){this.dialogHide($0b);});$0b.events.addEventHandler("afterHide",$0c);}};var $J=__px_all(this)[this.insertLinkDialog.id];var $0d=Function.createDelegate(this,function(e){this.dialogHide($J);});$J.events.addEventHandler("afterHide",$0d);this.lookup1=__px_all(this)[this.ID+"_lu1"];if(this.lookup1){var $0e=Function.createDelegate(this,function(e){this.lookupHide($e,this.lookup1)});this.lookup1.events.addEventHandler("afterHide",$0e);};this.lookup2=__px_all(this)[this.ID+"_lu2"];if(this.lookup2){var $0f=Function.createDelegate(this,function(e){this.lookupHide($e,this.lookup2)});this.lookup2.events.addEventHandler("afterHide",$0f);};if(this.fileListDlg){var $0g=function(e){this.focusToEdit2();this.contentChanged();};this.fileListDlg.events.addEventHandler("macroUpdated",Function.createDelegate(this,$0g));};var $0h=Function.createDelegate(this,function(e){this.focusToEdit2();this.tryUpdateState();});var $0i=Function.createDelegate(this,function(e){this.focusToEdit2();if(!this.imageProps.openForLink){this.imageProps.targetImage=undefined;};this.imageProps.openForLink=undefined;this.tryUpdateState();});var $0j=Function.createDelegate(this,function($07,e){this.saveUndoStepBeforeEmbedding();e.image.parentNode.removeChild(e.image);this.tryUpdateState();});this.imageProps.events.addEventHandler("afterHide",$0i);this.imageProps.events.addEventHandler("removeImage",$0j);this.linkProps.events.addEventHandler("afterHide",$0h);if(this.templatePanel){this.templatePanel.events.addEventHandler("templateSelected",Function.createDelegate(this,this.templateSelected));};if(this.datafieldPanel){this.datafieldPanel.events.addEventHandler("datafieldSelected",Function.createDelegate(this,this.datafieldSelected));};if(this.datafieldPrevPanel){this.datafieldPrevPanel.events.addEventHandler("datafieldSelected",Function.createDelegate(this,this.datafieldPrevSelected));};if(this.iframePanel){this.iframePanel.events.addEventHandler("iframeSelected",Function.createDelegate(this,this.iframeSelected));this.iframePanel.events.addEventHandler("iframeRemoved",Function.createDelegate(this,this.iframeRemoved));};if(this.codePanel){this.codePanel.events.addEventHandler("codeSelected",Function.createDelegate(this,this.codeSelected));};this.createTableDlg.events.addEventHandler("tableSizeSelected",Function.createDelegate(this,this.tableSizeSelected));this.specifyTableSize.events.addEventHandler("tableSizeSelected",Function.createDelegate(this,this.tableSizeSelected));this.toolBarControl.setVisible(false);for(var $u in this.toolBarControl.items){var $0k=this.toolBarControl.items[$u];if($0k.setVisible)$0k.setVisible(false);};var $f=$e.getEditDoc();var $0l=$f.getElementsByTagName('body')[0];__px_all(this)[this.elemToolbar.id].setVisible(false);var $0m=__px_all(this)[this.mainToolbar.id].items;var $0n=Function.createDelegate(this,this.mainMenuClick);for(var i=0;i<$0m.length;i++){var $r=$0m[i];this.lastItem=$r;if($r instanceof PXToolBarButton){switch($r.commandName){case "BarInsert":this.insertButton=$r;break;case "BarLayout":this.layoutButton=$r;break;case "BarTables":this.tablesButton=$r;break;case "textPaste":this.pasteModeButton=$r;break;};var $0o=PXRichTextEdit1.buttonGroups[$r.key+"Tab"];if($0o){__px(this).addEventHandler($r.element,"mousedown",Function.createDelegate(this,function(e){this.mainMenuClick(e);}));}else{__px(this).addEventHandler($r.element,"mousedown",Function.createDelegate(this,function(e){__px_all(this)[this.elemToolbar.id].setVisible(false);this.lastPushedMenuButton=undefined;}));}}};this.editorMode="edit";this.isPreview=false;this.showPreviewCmd=__px_callback(this).createCommand("Preview",true);this.previewHandler=Function.createDelegate(this,this.previewReady);if(this.sourceFrame){this.createTextArea();};if(this.datafieldPanel){this.datafieldPanel.events.addEventHandler("afterShow",Function.createDelegate(this,function($07,e){this.datafieldPanel.tree.focus();if(this.datafieldPanel.tree.nodes.length){var $0p=this.datafieldPanel.tree.nodes.getNode(0);if($0p){$0p.select();this.datafieldPanel.btn.setEnabled(true)}}}));};this.defaultButtonState();this.showLanguagesCmd=__px_callback(this).createCommand("ShowLanguages",true);this.localizedValueCmd=__px_callback(this).createCommand("LocalizedValue",true);this.localizedValueHandler=Function.createDelegate(this,this.updateLocalizedValue);this.localizedDeleteCmd=__px_callback(this).createCommand("DeleteContent",true);this.langMenu=__px_all(this)[this.ID+"_langMenu"];this.langMenu.events.addEventHandler("itemClick",Function.createDelegate(this,this.langMenuClicked));};PXRichTextEdit1.prototype.langMenuClicked=function($07,ev){var $l=this.alternativeLanguage||(this.language&&this.language.split('|')[0]);var $0q=ev.item.value;if($l!=$0q){if(this.localizedChanges[$l]){this.saveLocalizedUndo($l);this.viewState.update("AlternativeLanguage",$l+'|'+$0q);}else{this.viewState.update("AlternativeLanguage",$0q);};this.alternativeLanguage=$0q;if(!this.restoreLocalizedUndo($0q)){__px_callback(this).execI(this,this.localizedValueCmd,null,this.localizedValueHandler);}else{this.updateLangIndicator(this.langNamesCahce[$0q]);}}};PXRichTextEdit1.prototype.updateLocalizedValue=function($p){if($p.indexOf('|')>-1){var $q=$p.split('|');this.alternativeLanguage=$q[0];this.viewState.update("AlternativeLanguage",this.alternativeLanguage);this.updateLangIndicator($q[1]);}else{this.updateLangIndicator($p);};var $s=__px_callback(this);this.setValue($s.getLargeProp(this,"value"));this.setContent($s.getLargeProp(this,"content"));this.initUndo(this.dataKey);};PXRichTextEdit1.prototype.createTextArea=function(){if(this.sourceText){try{this.deleteNode(this.sourceText);}catch(ex){}};this.sourceText=this.sourceFrame.contentDocument.createElement('textarea');this.sourceText.setAttribute('style','width: 100%;');var $0r=this.sourceFrame.contentDocument.createElement('form');$0r.style.margin="0px";$0r.appendChild(this.sourceText);this.sourceFrame.contentDocument.body.appendChild($0r);__px(this).addEventHandler(this.sourceText,"keyup",Function.createDelegate(this,function(e){this.tryUpdateState();}));__px(this).addEventHandler(this.sourceText,"keydown",Function.createDelegate(this,function(e){if(e.keyCode==83&&e.ctrlKey&&!e.altKey&&!e.altKey){var $0l=this.getEditDoc().body;$0l.innerHTML=this.sourceText.value;__px_cm(this).dataSource.processKeyDown(e);if(e.returnValue===false){return this.stopEvent(e);}}}));};PXRichTextEdit1.prototype.defaultButtonState=function(){for(var i=0;i<this.outsideSection.length;i++){this.outsideSection[i].setEnabled(true);};for(var i=0;i<this.insideSection.length;i++){this.insideSection[i].setEnabled(false);};for(var i=0;i<this.insideTable.length;i++){this.insideTable[i].setEnabled(false);}};PXRichTextEdit1.prototype.selectstartcount=0;PXRichTextEdit1.prototype.previewReady=function($0s){var $0t=this.unescapeCdata($0s);this.previewCacheValue=$0t;var $0u=false;try{$0u=this.viewFrame.contentDocument;}catch(ex){$0u=false;};if(!$0u){var $e=this;var $0v=this.viewOwner.createElement('iframe');$0v.setAttribute('frameborder',0);$0v.setAttribute('ID','ifview');$0v.setAttribute('style',this.viewFrame.getAttribute('style'));$0v.src="about:blank";this.viewParent.replaceChild($0v,this.viewFrame);this.viewFrame=$0v;$0v.contentWindow.location.replace("about:blank");}else{this.viewFrame.contentDocument.open();this.viewFrame.contentDocument.write($0t);this.viewFrame.contentDocument.close();this.viewFrame.contentDocument.body.className="rich";this.addPreviewHandlers();}};PXRichTextEdit1.prototype.hideToolbars=function($0w){var $0m=__px_all(this)[this.mainToolbar.id].items;this.toolBarControl.setVisible(false);for(var i=0;i<$0m.length;i++){var $r=$0m[i];if($r!=$0w&&$r.getMenu){var $0x=$r.getMenu();if($0x){if($0x.setVisible){if($0x.setPushed){$0x.setPushed(false);};$0x.setVisible(false);};if($0x.hide2){$0x.hide2();}}}}};PXRichTextEdit1.prototype.mainMenuClick2=function($0y,$w){if(this.editorMode=="edit"){var $0m=__px_all(this)[this.mainToolbar.id].items;var $0z=[];if($w.element.parentNode.style.display=="none"){var $e=this;for(var i=0;i<$0m.length;i++){if($0m[i].setPushed){$0m[i].setPushed(false);};if($0m[i].element.parentNode.style.display==""){if($0m[i]instanceof PXToolBarButton){$0z.push($0m[i]);}}};var $F=this.mainToolbarControl.overflowMenu.items;for(var i=0;i<$F.items.length;i++){$F.items[i].setChecked(false);};var $v=$0y.substr(3)+"Tab";this.showTab($v,($0z.length>1)?($0z.pop(),$0z.pop()):$0z.pop());}}};PXRichTextEdit1.prototype.mainMenuClick=function(e){if(this.editorMode=="edit"){var $0m=__px_all(this)[this.mainToolbar.id].items;var $r=undefined;for(var i=0;i<$0m.length;i++){if($0m[i].element.contains(e.target)){$r=$0m[i];}};var $0A=this.toolBarControl.getVisible();if($r!=this.lastPushedMenuButton){var $v=$r.key+"Tab";this.showTab($v,$r);}else{var $0B=!this.toolBarControl.getVisible();this.toolBarControl.setVisible($0B);for(var i=0;i<$0m.length;i++){if($0m[i].setPushed){$0m[i].setPushed($0m[i].element.contains(e.target)?$0B:false);}}};__px_cm(this).notifyOnResize();this.lastPushedMenuButton=$r;}};PXRichTextEdit1.prototype.focusExt=function(){var $f=this.getEditDoc();var $0C=PXRichRange.create($f);$0C.setStart($f.body,0);$0C.setEnd($f.body,0);};PXRichTextEdit1.prototype.onVisibleChanged=function($0A){if(!__px(this).IsFirefox20){if(__px(this).IsFirefox)this.$3H(this.getEditDoc(),$0A&&!this.readonly);this.initWYSIWYG((this.editorMode=="source")?this.sourceText.value:this.content);}};PXRichTextEdit1.prototype.onDragAndDrop=function($0D){if(!__px(this).IsFirefox20&&!__px(this).IsIE)this.$3H(this.getEditDoc(),!$0D&&this.getVisible()&&!this.readonly);};PXRichTextEdit1.prototype.$3G=function(){var $0E=function($0F,$T){return $0F.substr(0,$T.length)==$T;};this.toolBarControl=__px_cm(this).createControl("PXToolBar",this.elemToolbar.id,this.elemToolbar.id);__px_all(this)[this.elemToolbar.id]=this.toolBarControl;this.insideSection=[];this.outsideSection=[];this.insideTable=[];this.outsideTable=[];for(var i=0;i<this.toolBarControl.items.length;i++){var $r=this.toolBarControl.items[i];switch($r.key){case "cmdLoadTemplate":this.btnTemplate=$r;break;case "sepAttachFiles":this.sepAttach=$r;break;case "attachImage":this.btnAttachImage=$r;break;case "type":this.ddType=__px_all(this)[$r.element.id];break;case "sepBold":this.sepBold=$r;break;case "sepLink":this.sepLink=$r;break;case "LinkEditor":this.btnLinkEditor=$r;break;case "WebLinkEditor":this.btnWebLinkEditor=$r;break;case "sepCut":this.sepCut=$r;break;case "Cut":this.btnCut=$r;break;case "Copy":this.btnCopy=$r;break;case "Paste":this.btnPaste=$r;break;case "sepH1":this.sepH1=$r;break;case "subscript":this.btnSub=$r;break;case "superscript":this.btnSup=$r;break;case "sepToc":this.sepToc=$r;break;case "InsertHorizontalRule":this.btnHr=$r;break;case "sepFont":this.sepFont=$r;break;case "fontname":this.btnFontname=$r;this.ddFontname=__px_all(this)[$r.element.id];this.ddFontname.caseSensItems=false;break;case "fontsize":this.btnFontsize=$r;this.ddFontsize=__px_all(this)[$r.element.id];break;case "insertParameter":this.btnInsertParameter=$r;break;case "macros":this.btnMacros=$r;break;case "CreateSection":this.outsideSection.push($r);break;case "RemoveSection":case "SectionUp":case "SectionDown":case "LayoutW":case "LayoutWW":case "LayoutNW":case "LayoutWN":case "LayoutWWW":case "LayoutNWN":this.insideSection.push($r);break;case "TableRowBefore":case "TableRowAfter":case "TableColBefore":case "TableColAfter":case "TableDelRow":case "TableDelCol":case "TableDel":this.insideTable.push($r);break;case "PlaceholderButton":this.btnPlaceholder=$r;case "CreateTable":this.outsideTable.push($r);break;}};var $0G=(this.templatePanel?"t":"")+(this.btnPlaceholder?"p":"")+(this.datafieldPanel?"d":"");this.toolBarControl.element.setAttribute("data-features",$0G);this.mainToolbarControl=__px_all(this)[this.mainToolbar.id];var $e=this;for(var i=0;i<this.mainToolbarControl.items.length;i++){var $r=this.mainToolbarControl.items[i];switch($r.key){case "textType":this.textType=__px_all(this)[$r.element.id];var $0H=function($07,e){if(this.editorMode!="edit"){e.cancel=true;}else $e.hideToolbars();};this.textType.events.addEventHandler("showDropDown",Function.createDelegate(this,$0H));break;case "html":this.htmlControlText=$r.element.querySelector('[data-type=button]');break;case "bold":this.btnBold=$r;break;case "italic":this.btnItalic=$r;break;case "underline":this.btnUnderline=$r;break;case "strikethrough":this.btnStrike=$r;break;case "sepJustify":this.sepJus=$r;break;case "JustifyLeft":this.btnJusLeft=$r;break;case "JustifyCenter":this.btnJusCenter=$r;break;case "JustifyRight":this.btnJusRight=$r;break;case "JustifyFull":this.btnJusFull=$r;break;case "indent":this.btnIndent=$r;break;case "outdent":this.btnOutdent=$r;break;case "sepColor":this.sepColor=$r;break;case "colorText":this.btnColorText=$r;break;case "colorBackground":this.btnColorBackground=$r;break;case "Insert":this.btnInsert=$r;break;case "Layout":this.btnLayout=$r;break;case "Tables":this.btnTables=$r;break;case "insertorderedlist":this.btnOrdered=$r;break;case "insertunorderedlist":this.btnUnordered=$r;break;case "EditTab":case "Insert":case "Layout":case "Tables":}};this.$3I();if(this.ddFontname){this.ddFontname.forceFocus=false;};if(this.toolBarControl){this.toolBarControl.setVisible(!this.readonly);this.toolBarControl.onLoad();};var $e=this;this.mainToolbarControl.events.addEventHandler("menuShow",function($07,ev){$e.hideToolbars(ev.srcArgs);});};PXRichTextEdit1.prototype.ensureDefaultBody=function($f){if(!$f.body.childNodes.length){var p=$f.createElement('p');p.className="richp";$f.body.appendChild(p);if(!__px(this).IsIE){var br=$f.createElement('br');p.appendChild(br);this.focusBeforeTag(br);}else{this.focusInsideTag(p);}}};PXRichTextEdit1.prototype.onContentFrameLoaded=function($f,$03){this.sf("loaded1 ");if(this.contentLoadinglock||this.fromInit&&this.initFlag)return;this.contentLoadinglock=true;try{$f.window=$03;this.$3E=null;$0I=this.newContent;$0J=this.newStyleSheet;$f.open();$f.write($0I?$0I:"");$f.close();var $0K;if($0J&&($0K=$f.head)){var s=$f.createElement('style');s.type='text/css';if(s.styleSheet)s.styleSheet.cssText=$0J;else s.appendChild($f.createTextNode($0J));$0K.appendChild(s);};if(!$f.body){$f.firstChild.appendChild($f.createElement('body'));};this.forbidRefreshing=undefined;if(!this.spellcheck&&$f.body.setAttribute)$f.body.setAttribute("spellcheck",true);this.$3H($f,!this.readonly);var fs="small";switch(this.defFontSize){case "1":fs="xx-small";break;case "2":fs="small";break;case "3":fs="medium";break;case "4":fs="large";break;case "5":fs="x-large";break;case "6":fs="xx-large";break;};var $0L="margin: 0px; padding:0px; font-family: arial; font-size: small; ";$f.body.className="rich";this.$3J($f);this.setAttribute($f.body,"style",$0L);this.repairLinks($f);this.ensureDefaultBody($f);if(this.needUpdateState)this.tryUpdateState();if(this.isPreview){this.previewMode(true);};if(this.editorMode=="source"){this.sourceText.value=$f.body.innerHTML;};if(this.mustFocus){if($f.body){$f.body.focus();}};this.syncSpaces($f);if(this.dataKey!=this.undoState.key){var $J=__px_all(this)[this.insertLinkDialog.id];if($J){$J.selectedTab=undefined;};this.initUndo(this.dataKey);this.saveUndoStep();};this.sf("loaded2 ");}catch(ex){alert(ex.type+": "+ex.message);}finally{this.newContent=null;this.newStyleSheet=null;this.needUpdateState=null;this.contentLoadinglock=false;if(this.fromInit)this.initFlag=true;this.mustFocus=undefined;}};PXRichTextEdit1.prototype.repairLinks=function($f){var $0M=$f.head;if($0M){var $0N=$f.createTreeWalker($f.body,NodeFilter.SHOW_ALL,function($0p){return $0p.nodeName=="LINK"||$0p.nodeName=="STYLE"||($0p.nodeType==document.COMMENT_NODE&&($0p.textContent.indexOf('RTE style')>-1));},false);var $0p,$0O=[];while($0p=$0N.nextNode()){$0O.push($0p);}while($0O.length){$0M.appendChild($0O.shift());}}};PXRichTextEdit1.prototype.initWYSIWYG=function($0I,$0J,$0P){var $0Q=this;var $0R=function(){$0Q.newContent=$0I?$0I:"";$0Q.newStyleSheet=$0J;$0Q.needUpdateState=$0P;};this.$3K(this.getEditDoc());this.fromInit=true;this.initFlag=false;$0R();this.elemIFrame.contentWindow.location.replace("about:blank");$0R();this.elemIFrame.contentWindow.location.replace("about:blank");};PXRichTextEdit1.prototype.setEditConfig=function(){var $f=this.getEditDoc();try{if($f&&$f.body&&$f.body.contentEditable){if(__px(this).IsFirefox){$f.execCommand('enableObjectResizing',false,'false');$f.execCommand('enableInlineTableEditing',false,'false');};$f.execCommand("AutoUrlDetect",false,false);$f.execCommand('defaultParagraphSeparator',false,'p');}}catch(ex){}};PXRichTextEdit1.prototype.$3H=function($f,$0S){if($f.body!=null){$f.body.contentEditable=$0S;{try{this.setEditConfig();}catch(e){}}}};PXRichTextEdit1.prototype.getChildElementByTag=function($0T,$0U){if($0T&&$0T.childNodes){for(var i=0;i<$0T.childNodes.length;i++){var $Z=$0T.childNodes[i];if($Z&&String.compare($Z.tagName,$0U,true))return $Z;}};return null;};PXRichTextEdit1.prototype.$3B=function(name){var $0V=__px_all(this)[this.ID+"_"+name];$0V.oldLink=undefined;$0V.showDlg();};PXRichTextEdit1.prototype.getEnabled=function(){return this.mainToolbarControl&&this.mainToolbarControl.getVisible();};PXRichTextEdit1.prototype.setEnabled=function($0W){this.setEditConfig();this.readonly=!$0W;if(this.toolBarControl){$0W=Boolean($0W);if($0W!=this.getEnabled()){if($0W)this.elemIFrame.removeAttribute("enabled");else this.elemIFrame.setAttribute("enabled","false");var $f=this.getEditDoc();var $0X=this.mainToolbarControl.getVisible();var $0Y=this.elemToolbar.offsetHeight;this.mainToolbarControl.setVisible($0W);if($0X!=this.mainToolbarControl.getVisible()){var $0Z=this.elemIFrame.offsetHeight+($0X?1:-1)*$0Y;if(!$0W){$0Z+=60;};this.setHeight($0Z);};this.readonly=!$0W;this.initWYSIWYG(this.getValue());this.ddFontname.setEnabled($0W);this.ddFontsize.setEnabled($0W);this.ddType.setEnabled($0W);this.viewState.update("Enabled",Boolean($0W));if(!$0W){this.previewMode(true);}else{this.editMode();}}}};PXRichTextEdit1.prototype.getVisible=function(){return this.element.style.display!="none";};PXRichTextEdit1.prototype.setVisible=function($10){this.sf("setvisible ");if(!this.isLoaded())this.onLoad();if($10!=this.getVisible()){var $11=$10?"":"none";this.element.style.display=$11;if(this.labelID){var $12=__px(this).elemByID(this.labelID);if($12)$12.style.display=$11;};this.viewState.update("Visible",Boolean($10));this.initWYSIWYG(this.getValue());__px_cm(this).notifyOnResize();}};PXRichTextEdit1.prototype.setValue=function(v){this.sf("setvalue ");var v1=this.unescapeCdata(v);if(v!=this.getValue()){this.initWYSIWYG(v1);if(this.sourceText){this.sourceText.value=this.getEditDoc().body.innerHTML;};this.viewState.update("Value",this.escapeCdata(this.content=(v1!=null)?v1:""));}};PXRichTextEdit1.prototype.setContent=function(c){this.content=this.unescapeCdata(c);};PXRichTextEdit1.prototype.getValue=function(){var $f=this.getEditDoc();var $13="";if(this.editorMode=="source"){var $0l=$f.body;$0l.innerHTML=this.sourceText.value;this.setEditConfig();};for(var i=0;i<$f.childNodes.length;i++){var $r=$f.childNodes[i];if($r.nodeName!="#text")$13="<"+$r.nodeName+">"+($r.nodeValue?$r.nodeValue:$r.innerHTML)+"</"+$r.nodeName+">";};return $13.replace(new RegExp('\u200b','g'),'');};PXRichTextEdit1.prototype.$3L=function(e){if(this.spellcheck)return;var $0x=this.$3M();if($0x){__px(this).cancelEvent(e);if($0x.items.length>0){for(var $14=0;$14<$0x.items.length;$14++){var $15=$0x.items.getItem($14);switch($15.commandName){case "Cut":this.mnuCut=$15;break;case "Copy":this.mnuCopy=$15;break;case "Cut":this.mnuPaste=$15;break;}};var de=this.getEditDoc().documentElement;var $16=de.scrollTop;var $17=de.scrollLeft;var $z=__px(this).getElemLeftPos(this.elemIFrame);var top=__px(this).getElemTopPos(this.elemIFrame);$0x.showAt($z+e.clientX+$17,top+e.clientY+$16);}};return false;};PXRichTextEdit1.prototype.$3M=function(){if(this.localMenu==null){this.localMenu=PXMenu.createMenuControl(this.ID+"_menu",this.px_context);if(this.localMenu){var h=Function.createDelegate(this,this.$3N);this.localMenu.events.addEventHandler("itemClick",h);}};return this.localMenu;};PXRichTextEdit1.prototype.$3N=function($18,e){};PXRichTextEdit1.prototype.initializeButtons=function(){var $19=new Object();$19.setPushed=function($1a){};$19.setEnabled=function($1b){};$19.setVisible=function($0A){};$19.events=new Object();$19.events.addEventHandler=function(){};$19.getMenu=function(){return null;};$19.setValue=function(v){};$19.getValue=function(){return null;};$19.hideMenu=function(){};$19.hideDropDown=function(){};$19.setColor=function(){};$19.clearColor=function(){};this.btnTemplate=$19;this.sepAttach=$19;this.btnAttachImage=$19;this.sepType=$19;this.ddType=$19;this.sepBold=$19;this.btnBold=$19;this.btnItalic=$19;this.btnUnderline=$19;this.btnStrike=$19;this.sepLink=$19;this.btnLinkEditor=$19;this.btnWebLinkEditor=$19;this.sepCut=$19;this.btnCut=$19;this.btnCopy=$19;this.btnPaste=$19;this.sepJus=$19;this.btnJusLeft=$19;this.btnJusCenter=$19;this.btnJusRight=$19;this.btnJusFull=$19;this.sepH1=$19;this.btnSub=$19;this.btnSup=$19;this.sepToc=$19;this.btnHr=$19;this.btnOrdered=$19;this.btnUnordered=$19;this.btnIndent=$19;this.btnOutdent=$19;this.sepFont=$19;this.btnFontname=$19;this.ddFontname=$19;this.btnFontsize=$19;this.ddFontsize=$19;this.sepColor=$19;this.btnColorText=$19;this.btnColorBackground=$19;this.btnInsertParameter=$19;this.mnuCut=$19;this.mnuCopy=$19;this.mnuPaste=$19;};PXRichTextEdit1.prototype.onMyContextMenu=function(e){return this.$3L(e);};PXRichTextEdit1.prototype.$3J=function($f){if(this.mouseHandler==null)this.mouseHandler=Function.createDelegate(this,this.$3O);__px(this).addEventHandler($f,"mouseup",this.mouseHandler);__px(this).addEventHandler($f,"click",this.mouseHandler);if(this.keyupHandler==null)this.keyupHandler=Function.createDelegate(this,this.handleKeyUp);__px(this).addEventHandler($f,"keyup",this.keyupHandler);if(this.keypressHandler==null)this.keypressHandler=Function.createDelegate(this,this.handleKeyPress);if($f.body)__px(this).addEventHandler($f.body,"keypress",this.keypressHandler);if(this.keydownHandler==null)this.keydownHandler=Function.createDelegate(this,this.handleKeyDown);if($f.body)__px(this).addEventHandler($f.body,"keydown",this.keydownHandler);this.inputHandler=Function.createDelegate(this,this.handleInput);if($f.body)__px(this).addEventHandler($f.body,"input",this.inputHandler);if(this.pasteHandler==null)this.pasteHandler=Function.createDelegate(this,this.$3P);__px(this).addEventHandler($f,"paste",this.pasteHandler);this.ie9FocusWorkaround=Function.createDelegate(this,function(){$f.body.focus();});__px(this).addEventHandler($f.documentElement,"focus",this.ie9FocusWorkaround);if($f.documentElement.head){__px(this).addEventHandler($f.documentElement.head,"focus",this.ie9FocusWorkaround);};if(this.domMutatedHandler==null)this.domMutatedHandler=Function.createDelegate(this,this.$3Q);__px(this).addEventHandler($f.documentElement,"DOMSubtreeModified",this.domMutatedHandler);if(this.attribMutatedHandler==null)this.attribMutatedHandler=Function.createDelegate(this,function(e){if(!this.mutationObserved){var $1c=(e.target.nodeName.toLowerCase()!='body')&&$f.body.contains(e.target);if($1c){this.mutationObserved=true;var $e=this;setTimeout(function(){$e.tryUpdateState.call($e);$e.mutationObserved=undefined;},200);}}});__px(this).addEventHandler($f.documentElement,"DOMAttrModified",this.attribMutatedHandler);if(this.deactHandler==null)this.deactHandler=Function.createDelegate(this,Function.createDelegate(this,function(e){this.$3E=this.range();}));if(this.blurHandler==null)this.blurHandler=Function.createDelegate(this,Function.createDelegate(this,function(e){this.$3F=this.$3E;}));__px(this).addEventHandler($f.body,"blur",this.blurHandler);__px(this).addEventHandler($f.body,"beforedeactivate",this.deactHandler);if(this.mdownHandler==null)this.mdownHandler=Function.createDelegate(this,Function.createDelegate(this,function(e){if(e.target.nodeName.toLowerCase()=='table'){e.preventDefault();return false;}}));__px(this).addEventHandler($f.body,"mousedown",this.mdownHandler);if(this.dropHandler==null)this.dropHandler=Function.createDelegate(this,Function.createDelegate(this,function(e){var $e=this;setTimeout(function(){$e.tryUpdateState();$e.contentChanged();},5);}));__px(this).addEventHandler($f,"drop",this.dropHandler);};PXRichTextEdit1.prototype.$3K=function($f){if(this.mouseHandler){__px(this).removeEventHandler($f,"mouseup",this.mouseHandler);__px(this).removeEventHandler($f,"click",this.mouseHandler);};if(this.keyupHandler)__px(this).removeEventHandler($f,"keyup",this.keyupHandler);if(this.keypressHandler)__px(this).removeEventHandler($f.body,"keypress",this.keypressHandler);if(this.keydownHandler)__px(this).removeEventHandler($f.body,"keydown",this.keydownHandler);if(this.contextmenuHandler)__px(this).removeEventHandler($f.documentElement,"contextmenu",this.contextmenuHandler);if(this.pasteHandler)__px(this).removeEventHandler($f,"paste",this.pasteHandler);if(this.domMutatedHandler)__px(this).removeEventHandler($f.documentElement,"DOMSubtreeModified",this.domMutatedHandler);if(this.attribMutatedHandler)__px(this).removeEventHandler($f.documentElement,"DOMAttrModified",this.attribMutatedHandler);if(this.ie9FocusWorkaround)__px(this).removeEventHandler($f.documentElement,"focus",this.ie9FocusWorkaround);if(this.deactHandler)__px(this).removeEventHandler($f.body,"beforedeactivate",this.deactHandler);if(this.actHandler)__px(this).removeEventHandler($f.body,"beforeactivate",this.actHandler);if(this.blurHandler)__px(this).removeEventHandler($f.body,"blur",this.blurHandler);if(this.mdownHandler)__px(this).removeEventHandler($f.body,"mousedown",this.mdownHandler);if(this.dropHandler)__px(this).removeEventHandler($f,"drop",this.dropHandler);};PXRichTextEdit1.prototype.$3I=function(){var $1d=Function.createDelegate(this,this.$3R);this.textType.events.addEventHandler("valueChanged",$1d);var $1e=this.btnColorText.getMenu();if($1e){var h=Function.createDelegate(this,this.$3S);$1e.events.addEventHandler("itemClick",h);};var $1f=this.btnColorBackground.getMenu();if($1f){var h=Function.createDelegate(this,this.$3T);$1f.events.addEventHandler("itemClick",h);};var $1g=Function.createDelegate(this,this.$3U);this.textType.events.addEventHandler("showDropDown",$1g);var $0x=this.btnUnderline.getMenu();if($0x){var h=Function.createDelegate(this,this.$3N);$0x.events.addEventHandler("itemClick",h);}};PXRichTextEdit1.prototype.$3U=function(dd,e){};PXRichTextEdit1.prototype.$3R=function($07,e){this.focusToEdit2();var $f=this.getEditDoc();var $1h=$07.getValue();if(__px(this).IsIE||__px(this).IsIE11){$1h="<"+$1h+">";};this.execCommand2("formatBlock",$1h);var $e=this;setTimeout(function(){var $1i=function(){$f.defaultView.focus();if($f.body)$f.body.focus();this.restoreIESelection();};$1i.call($e);},0);};PXRichTextEdit1.prototype.getElementOffset=function($b){var $z=this.sumAncestors($b,"offsetLeft","offsetParent");var top=this.sumAncestors($b,"offsetTop","offsetParent");return{'left':$z,'top':top};};PXRichTextEdit1.prototype.msieUnselectable=function($0p){return $0p;};PXRichTextEdit1.prototype.assignAttributes=function($b,$1j){if($1j!=undefined){for(var name in $1j){var $1k=name.toLowerCase();var $1h=$1j[name];if($1h!=undefined){if(typeof($1h)=="boolean"){$1h=$1h?"true":"false";};if($1k=="innerhtml"){$b.innerHTML=$1h;}else if($1k=="textcontent"){$b.textContent=$1h;}else{$b.setAttribute(name,$1h);}}}}};PXRichTextEdit1.prototype.embedTag=function($1l,$H,$1j){var $b=$1l.ownerDocument.createElement($H);this.assignAttributes($b,$1j);$1l.appendChild($b);return $b;};PXRichTextEdit1.prototype.insertConvertableTag=function($H,$1j,$K){$1j[this.convertAttr]=$K;return this.insertTag($H,$1j);};PXRichTextEdit1.prototype.debugRange=function(){var $f=this.getEditDoc();if($f){var $1m=$f.getSelection();if($1m&&$1m.rangeCount){var $0C=$1m.getRangeAt(0);if($0C){return;}}}};PXRichTextEdit1.prototype.insertTag=function($H,$1j){var $f=this.getEditDoc();var $1n=$f.createElement($H);this.assignAttributes($1n,$1j);if(__px(this).IsIE){var $1m=this.$3V();var $1o=this.getRange($1m);$1o.insertNode($1n);}else{this.insertNodeAtSelection($1n);this.$3W($1n);};return $1n;};PXRichTextEdit1.prototype.$3W=function($0p){var parent=$0p.parentElement;if(parent&&parent.tagName=="BR"){parent.removeChild($0p);parent.parentElement.insertBefore($0p,parent);parent.parentElement.removeChild(parent);}};PXRichTextEdit1.prototype.insertText=function($1p){var $f=this.getEditDoc();var $1n=$f.createTextNode($1p);if(__px(this).IsIE){var $1m=this.$3V();var $1o=this.getRange($1m);$1o.insertNode($1n);}else{this.insertNodeAtSelection($1n);this.$3W($1n);};return $1n;};PXRichTextEdit1.prototype.getCursorOffset=function(){this.$3E=this.range();var $1n=this.insertTag('span');$1n.innerHTML="@";var $p=this.getElementOffset($1n);$1n.parentNode.removeChild($1n);return $p;};PXRichTextEdit1.prototype.getIframeOrigin=function($0p){var parent=this.findParentNode("BODY",$0p);if(parent&&parent.nodeName=="BODY")return{'left':parseInt(parent.scrollLeft,10),'top':parseInt(parent.scrollTop,10)};return{'left':0,'top':0};};PXRichTextEdit1.prototype.sumAncestors=function($1q,$1r,$1s){var $p=$1q[$1r];var $1t=$1q[$1s];while(null !=$1t){$p+=$1t[$1r];$1t=$1t[$1s];};return $p;};PXRichTextEdit1.prototype.setPosition=function($1u,$z,top){$1u.offsetLeft=this.sumAncestors(this.elemIFrame,"offsetLeft","offsetParent")+$z;$1u.offsetTop=this.sumAncestors(this.elemIFrame,"offsetTop","offsetParent")+top;};PXRichTextEdit1.prototype.lookupClick=function(e){var $1v=function($0p,$1w,$h){return $0p&&$0p.attributes&&$0p.attributes[$1w]&&$0p.attributes[$1w].value&&($0p.attributes[$1w].value==$h);};var $1x=function($0p,$1w,$h){var $1y=$0p;while(($1y!=undefined)&&!$1v($1y,$1w,$h))$1y=$1y.parentNode;return $1v($1y,$1w,$h);};var $1z=$1x(e.target,"id",this.activeLookup.ID);var $1A=$1x(e.target,"controlid",this.activeLookup.ID);if(!$1z&&!$1A){this.activeLookup.hideDropDown();this.activeLookup.element.style.setProperty('display','none');this.$3X();}};PXRichTextEdit1.prototype.$3Y=function($1B){var $f=this.element.ownerDocument.documentElement;var $1C=this.elemIFrame.parentNode.ownerDocument.documentElement;var $1D=this.getEditDoc();this.lookupClickHandler=Function.createDelegate(this,this.lookupClick);this.activeLookup=$1B;__px(this).addEventHandler($f,"click",this.lookupClickHandler);__px(this).addEventHandler($1D,"click",this.lookupClickHandler);__px(this).addEventHandler($1C,"click",this.lookupClickHandler);__px(this).addEventHandler($1B.element,"click",this.lookupClickHandler);this.lookupKeyHandler=Function.createDelegate(this,function($1E,e){var $1F=e.keyCode==13;var escape=e.keyCode==27;if($1F||escape){$1B.hideDropDown($1F);$1B.element.style.setProperty('display','none');this.$3X();e.cancel=true;this.restoreSelection3();};if($1F){this.$3Z($1B);};if(escape){var $f=this.getEditDoc();if(__px(this).IsSafari){this.insertText($1B.imageOnly?'!':'[');$f.body.focus();}else if(__px(this).IsIE||__px(this).IsIE11){this.insertTextAtSelection($1B.imageOnly?'!':'[');}else if(__px(this).IsFirefox){this.insertTextAtSelection($1B.imageOnly?'!':'[');};var $1G=$f.getSelection();if(!(__px(this).IsIE||__px(this).IsIE11))$1G.modify('move','forward','character');if(__px(this).IsIE||__px(this).IsIE11){$1G.collapseToEnd();};return this.cancelEvent(e);}});$1B.events.addEventHandler("keyDown",this.lookupKeyHandler);};PXRichTextEdit1.prototype.$3Z=function($1B){var $1H=$1B.getLastSelectedItem();if($1H){this.saveUndoStep();switch($1H.type){case "Image":this.insertImage(this.fileShowUrl+$1H.value,$1H.text,false);break;case "File":this.insertFile($1H.value,$1H.text,2);break;case "Article":this.insertArticle($1H.value,$1H.text);break;case "Screen":this.insertScreen($1H.value,$1H.text);break;}}};PXRichTextEdit1.prototype.$3X=function(){var $f=this.element.ownerDocument.documentElement;var $1C=this.elemIFrame.parentNode.ownerDocument.documentElement;var $1D=this.getEditDoc();__px(this).removeEventHandler($f,"mouseup",this.mouseHandler);__px(this).removeEventHandler($f,"click",this.lookupClickHandler);__px(this).removeEventHandler($1D,"click",this.lookupClickHandler);__px(this).removeEventHandler($1C,"click",this.lookupClickHandler);__px(this).removeEventHandler(this.activeLookup.element,"click",this.lookupClickHandler);this.activeLookup.events.removeEventHandler("keyDown",this.lookupKeyHandler);this.activeLookup=undefined;};PXRichTextEdit1.prototype.showLookup=function($1B,$1E,$1I){this.storeSelection3();$1B.element.style.setProperty('display','block');$1B.imageOnly=$1I;this.$40($1B.element);var $e=this;setTimeout(function(){$1B.focus();},1);this.$3Y($1B);};PXRichTextEdit1.prototype.$40=function($b){var $1J=this.getCursorOffset();var $e=this;var $0l=this.getEditDoc().body;var $z=this.sumAncestors(this.elemIFrame,"offsetLeft","offsetParent")+8+$1J.left-$0l.scrollLeft-this.sumAncestors($b.offsetParent,"offsetLeft","offsetParent");var top=this.sumAncestors(this.elemIFrame,"offsetTop","offsetParent")+0+$1J.top-$0l.scrollTop-this.sumAncestors($b.offsetParent,"offsetTop","offsetParent");setTimeout(function(){$b.style.setProperty('left',$z+"px");$b.style.setProperty('top',top+"px");},0);};PXRichTextEdit1.prototype.tryUpdateState=function(){if(this.getEnabled()){var $1h=this.getValue(),$1K=this.unescapeCdata(this.viewState.select("Value"));this.content=($1h!=null)?$1h:"";if(this.content&&this.content.length>100000){this.stateNeedsUpdate=true;}else{this.viewState.update("Value",this.escapeCdata(this.content));this.stateNeedsUpdate=false;};if($1K!=this.content)this.contentChanged();}};PXRichTextEdit1.prototype.contentChanged=function(){__px_cm(this).notifyOwnerChanged(this);var $l=this.alternativeLanguage||this.language;if($l){if($l.indexOf('|')>-1)$l=$l.split('|')[0];this.localizedChanges[$l]=true;}};PXRichTextEdit1.prototype.onCallback=function(){if(this.stateNeedsUpdate){this.viewState.update("Value",this.escapeCdata(this.content));this.stateNeedsUpdate=false;}};PXRichTextEdit1.prototype.isEditButton=function(e){return(e.charCode&&(e.ctrlKey||e.altKey))||(e.keyCode>=33&&e.keyCode<=40)||e.keyCode==PX.key_enter||e.keyCode==PX.key_tab||e.keyCode==PX.key_del||e.keyCode==PX.key_backspace;};PXRichTextEdit1.prototype.unexciteButtons=function($1L,$1M){if(!$1M){if(this.textType!=$1L)this.textType.hideDropDown();};var $0m=__px_all(this)[this.mainToolbar.id].items;if($0m){for(var i=0;i<$0m.length;i++){var $r=$0m[i];if($r.setPushed&&$r.key!='textPaste'){$r.setPushed(false);}}};if(this.btnColorText!=$1L)this.btnColorText.hideMenu();if(this.btnColorBackground!=$1L)this.btnColorBackground.hideMenu();};PXRichTextEdit1.prototype.$41=function($1b){this.btnBold.setEnabled($1b);this.btnItalic.setEnabled($1b);this.btnUnderline.setEnabled($1b);this.btnStrike.setEnabled($1b);this.btnSub.setEnabled($1b);this.btnSup.setEnabled($1b);this.btnOrdered.setEnabled($1b);this.btnUnordered.setEnabled($1b);this.btnIndent.setEnabled($1b);this.btnOutdent.setEnabled($1b);this.btnJusLeft.setEnabled($1b);this.btnJusCenter.setEnabled($1b);this.btnJusRight.setEnabled($1b);this.btnJusFull.setEnabled($1b);this.btnColorText.setEnabled($1b);this.btnColorBackground.setEnabled($1b);this.btnAttachImage.setEnabled($1b);this.btnLinkEditor.setEnabled($1b);for(var i=0;i<this.toolBarControl.items.length;i++){var $r=this.toolBarControl.items[i];if($r.setEnabled){$r.setEnabled($1b);}};this.textType.setEnabled($1b);};PXRichTextEdit1.prototype.syncButtons=function($1N){var $0C=this.range();if(!$0C){this.defaultButtonState();return;};var style=this.getSelectedStyle(this.getEditDoc(),$0C,undefined,false);var $1O=this.getSelectedStyle(this.getEditDoc(),$0C,undefined,true);var $1P=function(style,$H){return style.indexOf($H)>-1;};var $1Q=$1P($1O,"pre.source-highlighted");var $1R=$1P($1O,"table.layout");var $1S=$1P($1O,"table.rtetable");var $1T=$1P($1O,"table.MsoTableGrid");this.btnBold.setPushed($1P(style,'b'));this.btnItalic.setPushed($1P(style,'i'));this.btnUnderline.setPushed($1P(style,'u'));this.btnStrike.setPushed($1P(style,'strike'));this.btnSub.setPushed($1P(style,'sub'));this.btnSup.setPushed($1P(style,'sup'));var $1U=style.filter(function(l){return l=='ul'||l=='ol'}).shift();this.btnOrdered.setPushed($1U=='ol');this.btnUnordered.setPushed($1U=='ul');if(this.$42!=$1Q){this.$41(!$1Q);this.$42=$1Q;};if(!$1Q){for(var i=0;i<this.outsideSection.length;i++){this.outsideSection[i].setEnabled(!$1R);};for(var i=0;i<this.insideSection.length;i++){this.insideSection[i].setEnabled($1R);};for(var i=0;i<this.insideTable.length-1;i++){this.insideTable[i].setEnabled($1S);};var $1V=this.insideTable[this.insideTable.length-1];$1V.setEnabled($1S||$1T);};var $1W=['h1','h2','h3','h4','h5','h6','pre'];var $1X=this.diff(style,$1W);var $1Y=$1X.length?$1W.indexOf($1X[0])+1:0;if(this.textType.getValue()!=this.textType.items[$1Y].value){this.textType.setValue(this.textType.items[$1Y].value);this.restoreIESelection();}};PXRichTextEdit1.prototype.$3v=function($04,$1Z){var $20=$04.getAttribute("href");var $07=$04.getAttribute("src");switch($1Z){case "article":return $20.substring(this.wikiShowUrl.length);case "screen":return $20.substring(this.screenShowUrl.length);case "file":case "attFile":return $20.substring(this.fileShowUrl.length);case "attImg":case "img":return $07.substring(this.fileShowUrl.length);case "extFile":return $04;}};PXRichTextEdit1.prototype.$3u=function($04){var $21=$04.getAttribute("objtype")=="attached";var $22=$04.nodeName.toUpperCase()=="IMG";switch($04.getAttribute(this.convertAttr)){case this.wikiConvertAttr:return "article";case this.screenConvertAttr:return "screen";case this.viewConvertAttr:if($22)return $21?"attImg":"img";else return $21?"attFile":"file";default:return $22?"extImg":"extFile";}};PXRichTextEdit1.prototype.positionPopup=function($23,$24,$A,$25){var $26=16;var $27=8;var $z=this.sumAncestors(this.elemIFrame,"offsetLeft","offsetParent");var top=this.sumAncestors(this.elemIFrame,"offsetTop","offsetParent");var $28=this.sumAncestors($24,"offsetLeft","offsetParent")+$z;var $29=this.sumAncestors($24,"offsetTop","offsetParent")+top;var $0l=this.getEditDoc().body;var $2a=$29+$25-$0l.scrollTop;$29=$29-$0l.scrollTop;$28=$28-$0l.scrollLeft;var $b=$23.element;if($b.parentNode.offsetWidth<=$b.offsetWidth+$28+$27){$b.style.setProperty('right',"0px");$b.style.setProperty('left',"");}else{$b.style.setProperty('left',$28+$27+"px");$b.style.setProperty('right',"");};var $2b=$29-$b.offsetHeight-$26;if($b.parentNode.offsetHeight>=$b.offsetHeight+$2a){$b.style.setProperty('top',$2a+$26+"px");}else if($2b<$0l.scrollTop){$b.style.setProperty('top',top-$b.offsetHeight-$26+"px");}else{$b.style.setProperty('top',$2b+"px");}};PXRichTextEdit1.prototype.$43=function($2c){this.imageProps.targetImage=$2c;var parent=$2c.parentNode;if(parent&&(parent.nodeName=="A")){this.imageProps.outerLink=parent;this.imageProps.outerLinkType=this.$3u(parent);}else{this.imageProps.outerLink=undefined;this.imageProps.outerLinkType=undefined;};this.imageProps.showPopup($2c);this.positionPopup(this.imageProps,$2c,$2c.width,$2c.height);};PXRichTextEdit1.prototype.$44=function($04){this.linkProps.targetLink=$04;this.linkProps.targetKey=this.$3u($04);this.linkProps.targetType=this.$3v($04);this.linkProps.show($04);this.positionPopup(this.linkProps,$04,200,5);};PXRichTextEdit1.prototype.$45=function(e){return this.findParentNode('a',e.target);};PXRichTextEdit1.prototype.escapeCdata=function($0F){if($0F&&$0F.length){return $0F.replace(/d@7@/g,"d@7@1").replace(/]]>/g,"d@7@2");};return $0F;};PXRichTextEdit1.prototype.unescapeCdata=function($0F){if($0F&&$0F.length){var $q=$0F.split('d@7@');if($q.length){var $2d=$q.shift();while($q.length){var $2e=$q.shift();if($2e[0]=='1'){$2d+='d@7@'+$2e.substring(1);}else{$2d+=']]>'+$2e.substring(1);}};return $2d;}};return $0F;};PXRichTextEdit1.prototype.$3P=function(e){var $0E=function($2f,$T){return $2f.substr(0,$T.length)==$T;};var $2g=function($07,$2h){if($07.nodeName!='BODY'&&Array.prototype.indexOf.call($2h,$07)==-1)return[$07];var $p=[];for(var i=0;i<$07.childNodes.length;i++){$p=$p.concat($2g($07.childNodes[i],$2h));};return $p;};this.lastPlaceholder=undefined;var $f=this.getEditDoc();var $0t=e.clipboardData?e.clipboardData:__win(this).clipboardData;if($0t!=null){var $2i=$0t.getData("Text");if(this.editorMode=="source"){this.insertTextAtSelection($2i);return this.cancelEvent(e);}else{var $2j=$2i.trim();if(/^(http:\/\/|https:\/\/|www.)([\]!#$&-;=?[_a-zA-Z~/]|%[0-9a-fA-F]{2})+$/.test($2j)){var $04=this.insertExternalLink($2j,$2j);this.syncSpaces($f);this.focusAfterTag($04);this.saveUndoStep();this.tryUpdateState();return this.cancelEvent(e);}else{var $e=this;if(this.undoStateUnsaved()){this.saveUndoStep();};var $f=this.getEditDoc();var r1=this.range();var $2k=$f.body.querySelectorAll('*');var $2l=this.outsideRange($f,r1);setTimeout(function(){var $2m=$e.pasteModeButton&&$e.pasteModeButton.getPushed&&$e.pasteModeButton.getPushed();var $2n=$e.findAlive($f,$2l);if($2m){var $2o=$2g($f.body,$2k);for(var i=0;i<$2o.length;i++){var $0p=$2o[i];if($0p.nodeType==document.TEXT_NODE){}else if($e.isBlock($0p)){var p=$f.createElement('p');p.className="richp";$0p.parentNode.insertBefore(p,$0p);$e.fillWithText(p,$e.node2textRec1($0p));$0p.parentNode.removeChild($0p);}else{var $2p=$f.createElement('span');$0p.parentNode.insertBefore($2p,$0p);$e.fillWithText($2p,$e.node2textRec1($0p));$0p.parentNode.removeChild($0p);}}}else{var $2q=$e.rangeFromLimits($f,[$2n[0].pop(),$2n[1].pop()]);if($e.isMSExport($2q)){var $2r=$e.queryRange($2q,'*');for(var i=0;i<$2r.length;i++){$e.resetStyle.call($e,$2r[i]);}}};$e.syncSpaces.call($e,$f);$e.saveUndoStep.call($e);$e.tryUpdateState();},50);}}}};PXRichTextEdit1.prototype.nodeListFromLimits=function($f,$2s,to){var $p=[];var $0p=$2s.pop();while($0p&&!$0p.nextSibling){$0p=$2s.pop();};if(!$0p){$0p=$f.body.firstChild;}while($0p&&to.indexOf($0p)==-1){$p.push($0p);$0p=$0p.nextSibling;};return $p;};PXRichTextEdit1.prototype.$3O=function(e){var $f=this.getEditDoc();switch(e.type){case "mouseup":if(e.button==0){var $2t=e.target.getAttribute("data-expand");var $2u=this.getParentWithAttribute(e.target,"class","GrayBox",10);if($2u){if(this.contains($2u.querySelector('.boxcontent'),e.target)){$2u=undefined;}};if($2u){this.showMacroPopup($2u);}else if(e.target.tagName=="IMG"){if(e.target.getAttribute("data-expand")){if($2t=="code"){this.showEdMacroPopup(e.target,"code");}else if($2t=="iframe"){if(this.iframePanel){this.iframePanel.oldFrame=e.target;this.iframePanel.showDlg();}}else if($2t=="files"){this.showEdMacroPopup(e.target,"files");}else{this.showMacroPopup(e.target);}}else if($2u){this.showMacroPopup($2u);}else{this.$43(e.target);}}else if($2t){if($2t=="code"){this.showEdMacroPopup(e.target,"code");}else if($2t=="files"){this.showEdMacroPopup(e.target,"files");}else{this.showMacroPopup(e.target);}}else{var $2v=this.$45(e);if($2v&&$2v.tagName=="A"){this.$44($2v);};var $2w=e.target==$f.body||e.target==$f.body.parentNode;var $2x=this.range();if($2w&&(!$2x||$2x.collapsed)){var $2y=$f.body.getBoundingClientRect();if($f.body.lastChild&&$f.body.lastChild.getBoundingClientRect){var $2u=$f.body.lastChild.getBoundingClientRect();if(e.pageY>$2u.bottom&&e.pageX>=$2y.left&&e.pageX<=$2y.right){this.gotoEnd();}}else{var $2z=$f.createElement('span');$f.body.appendChild($2z);var $2u=$2z.getBoundingClientRect();if(e.pageY>$2u.bottom&&e.pageX>=$2y.left&&e.pageX<=$2y.right){$f.body.removeChild($2z);this.gotoEnd();}else{$f.body.removeChild($2z);}}}}};this.unexciteButtons();this.syncButtons();break;}};PXRichTextEdit1.prototype.getElemText2=function($0p,$2A){return this.getElemText($0p,$2A,true);};PXRichTextEdit1.prototype.getElemText=function($0p,$2A,$2B){if(!$0p)return "";var $p="";var $2C=false;var $2D=new Array();$2D.push($0p);while($2D.length>0){var $2E=false;var $r=$2D.pop();switch($r.nodeName){case "#text":$p+=$r.nodeValue;if($2C){if(!$2A)$p+="<br />";$2C=false;};break;case "BR":case "HR":if(!$2A)$p+="<br />";break;case "LI":$2E=true;$2C=true;break;case "STYLE":$2E=!$2B;break;default:$2E=true;break;};if($2E){var $2F=$r.childNodes;if($2F){for(var i=$2F.length-1;i>=0;i--)$2D.push($2F[i]);}}};if($2A)$p=$p.replace('<br />','').replace('<br/>','');return $p;};PXRichTextEdit1.prototype.$3S=function($18,$2G){this.focusToEdit2();this.unexciteButtons();this.execCommand2("ForeColor",$2G.event.color);var $e=this;if(!__px(this).IsIE){setTimeout(function(){var $f=$e.getEditDoc();var $0l=$f.getElementsByTagName('body')[0];$0l.focus();},1);}};PXRichTextEdit1.prototype.focus=function(){if(this.editorMode=="edit"||this.editorMode=="plain"){var $f=this.getEditDoc();if($f.body){$f.body.focus();}}else if(this.editorMode=="source"){if(this.sourceText){this.sourceText.focus();}}};PXRichTextEdit1.prototype.refocus=function(){var $e=this;{setTimeout(function(){var $f=$e.getEditDoc();$f.defaultView.focus();var $0l=$f.getElementsByTagName('body')[0];$0l.focus();},50);}};PXRichTextEdit1.prototype.$3T=function($18,$2G){this.focusToEdit2();this.unexciteButtons();this.execCommand2("BackColor",$2G.event.color);};PXRichTextEdit1.prototype.setFontSize=function($2H){var $1G=this.getSelection();if(!$1G.isCollapsed())this.execCommand2("FontSize",$2H);};PXRichTextEdit1.prototype.getSelection=function(){var $f=this.getEditDoc();var $1G=PXRichRange.fromSelection($f);if($1G.isCollapsed())return $1G;var $2I=$1G.getStartContainer();var $2J=$1G.getStartOffset();if(this.isTextNode($2I)){if($2J>=$2I.length){var $1t=this.getNextNode($2I,true,$2K);if($1t){$2I=$1t;$2J=0;}}}else if($2J>0){var $2L=$2I.childNodes.length;if($2J>=$2L){$2I=$1G.getStartContainer();$2J=$2L;}else{$2I=$2I.childNodes[$2J];$2J=0;}};var $2K=$1G.getEndContainer();var $2M=$1G.getEndOffset();if(this.isTextNode($2K)){if($2M<=0){var $N=this.getPreviousNode($2K,true,$2I);if($N){$2K=$N;$2M=this.isTextNode($N)?$N.length:$N.childNodes.length;}}}else if($2M>0){var $2L=$2K.childNodes.length;if($2M>=$2L){$2K=$1G.getEndContainer();$2M=$2L;}else{$2K=$2K.childNodes[$2M];$2M=0;}};var $0C=PXRichRange.create($f);$0C.setStart($2I,$2J);$0C.setEnd($2K,$2M);return $0C;};PXRichTextEdit1.prototype.isTextNode=function($0p){return $0p&&$0p.nodeName=="#text";};PXRichTextEdit1.prototype.getNextNode=function($0p,$2N,$2K){if($2K==$0p)return null;if($0p.firstChild&&!$2N)return $0p.firstChild;if(!$0p.parentNode)return null;return $0p.nextSibling||this.getNextNode($0p.parentNode,true,$2K);};PXRichTextEdit1.prototype.getPreviousNode=function($0p,$2N,$2K){if($2K==$0p)return null;if($0p.firstChild&&!$2N)return $0p.firstChild;if(!$0p.parentNode)return null;return $0p.previousSibling||this.getNextNode($0p.parentNode,true,$2K);};PXRichTextEdit1.prototype.getNodesInRange=function($1o){var $T=$1o.getStartContainer();if($1o.isCollapsed()){var $13=new Array();if(this.isTextNode($T))$13.push($T);else $13.push($T.childNodes[$1o.getStartOffset()]||$T);return $13;};var $2I=$T.childNodes[$1o.getStartOffset()]||$T;var end=$1o.getEndContainer();var $2K=end.childNodes[$1o.getEndOffset()]||end;var $2O=this.getCommonContainerNode($2I,$2K);var $p=new Array();$p.push($2I);if($2I!=$2K||$2I.childNodes.length!=0){while($2I=this.getNextNode($2I,false,$2K)&&$2I!=$2O){$p.push($2I);}};return $p;};PXRichTextEdit1.prototype.getCommonContainerNode=function($2I,$2K){while($2I&&$2K&&$2I!=$2K){$2I=$2I.parentNode;$2K=$2K.parentNode;};return(!$2I||!$2K)?null:$2I;};PXRichTextEdit1.prototype.isChildNode=function($2P,$0p){if($2P==$0p)return true;if($2P.childNodes&&$2P.childNodes.length>0){for(var i=0;i<$2P.childNodes.length;i++){var $13=this.isChildNode($2P.childNodes[i]);if($13)return true;}};return false;};PXRichTextEdit1.prototype.getRange=function($1m){return $1m.createRange?$1m.createRange():$1m.getRangeAt(0);};PXRichTextEdit1.prototype.$3D=function(){return this.elemIFrame.contentWindow;};PXRichTextEdit1.prototype.getEditDoc=function(){return this.$3D().document;};PXRichTextEdit1.prototype.$3V=function(){var $2Q=this.$3D();var $f=$2Q.document;var $1m=null;if($2Q.getSelection){$1m=$2Q.getSelection();}else if($f.getSelection){$1m=$f.getSelection();}else if($f.selection){$1m=$f.selection;};return $1m;};PXRichTextEdit1.prototype.cleanUpCode=function($f){var $2R=$f.querySelectorAll("[data-expand=code]:not(pre)");for(var i=0;i<$2R.length;i++){$2R[i].removeAttribute('data-expand');}};PXRichTextEdit1.prototype.execCommand2=function($2S,$h){var $p=true;this.$3D().focus();var $f=this.getEditDoc();switch($2S){case "JustifyLeft":case "JustifyCenter":case "JustifyRight":case "JustifyFull":case "BackColor":case "HiliteColor":case "ForeColor":this.execFormatCommand.call(this,$2S,$h);this.lastRange=null;break;default:this.execFormatCommand.call(this,$2S,$h);break;};this.tryUpdateState();this.syncButtons(true);return $p;};PXRichTextEdit1.prototype.insertHTML=function($2T){if(__px(this).IsIE){this.getEditDoc().selection.createRange().pasteHTML($2T);}else{var $2p=this.getEditDoc().createElement("span");$2p.innerHTML=$2T;this.insertNodeAtSelection($2p);}};PXRichTextEdit1.prototype.insertTextAtSelection=function($1p){var $f=this.getEditDoc();var $0p=$f.createTextNode($1p);this.insertNodeAtSelection($0p);};PXRichTextEdit1.prototype.insertNodeAtSelection=function($2U){var $f=this.getEditDoc();var r1=this.range();if(this.tagNClass(r1.commonAncestorContainer,'html','#document','head')){};if(!$f.activeElement||$f.activeElement!=$f.body){};var $1o=PXRichRange.fromSelection($f);$1o.deleteContents();var $2P=$1o.getStartContainer();var $2V=$1o.getStartOffset();if($2P.nodeType==3&&$2U.nodeType==3){$2P.insertData($2V,$2U.data);$1o.setEnd($2P,$2V+$2U.length);$1o.setStart($2P,$2V+$2U.length);}else{var $2W;var $2X;if($2P.nodeType==3){var $U=$2P;$2P=$U.parentNode;var $1p=$U.nodeValue;var $2Y=$1p.substr(0,$2V);var $2Z=$1p.substr($2V);var $30=$2P.ownerDocument;$2X=$30.createTextNode($2Y);$2W=$30.createTextNode($2Z);$2P.insertBefore($2W,$U);$2P.insertBefore($2U,$2W);$2P.insertBefore($2X,$2U);$2P.removeChild($U);}else{$2W=$2P.childNodes[$2V];if($2W){$2P.insertBefore($2U,$2W);if(this.toArray($2P.childNodes).indexOf($2U)==-1){var $31=$2P.ownerDocument.createElement('div');$2P.insertBefore($31,$2W);this.insertAfter($2U,$31);this.deleteNode($31);}}else{$2P.appendChild($2U);if(this.toArray($2P.childNodes).indexOf($2U)==-1){var $31=$2P.ownerDocument.createElement('div');$2P.appendChild($31);$2P.appendChild($2U);this.deleteNode($31);};$2W=$2U;}};try{$1o.setEnd($2W,0);$1o.setStart($2W,0);$1o.collapse(true);$1o.select();}catch(e){}}};PXRichTextEdit1.prototype.findParent=function($32,$1o){$32=$32.toUpperCase();var $33;var $34=null;try{if(!__px(this).IsIE){var $0p=$1o.startContainer;var $2V=$1o.startOffset;if($0p.nodeType!=3){$0p=$0p.childNodes[$2V];};return this.findParentNode($32,$0p);}else{$34=($1o.length>0)?$1o.item(0):$1o.parentElement();$34=this.findParentNode($32,$34);if($34!=null)return $34;$33=$1o.duplicate();$33.collapse(true);$33.moveEnd("character",1);if($33.text.length>0){while($33.compareEndPoints("EndToEnd",$1o)<0){$33.move("Character");if(null !=this.findParentTag($32,$33)){return this.findParentTag($32,$33);}}}}}catch(e){};return null;};PXRichTextEdit1.prototype.getTag=function($1o){try{if(!__px(this).IsIE){var $0p=$1o.startContainer;var $2V=$1o.startOffset;if($0p.nodeType!=3){$0p=$0p.childNodes[$2V];};if($0p.nodeName&&$0p.nodeName.search(/#/)!=-1){return $0p.parentNode;};return $0p;}else{if($1o.length>0){return $1o.item(0);}else if($1o.parentElement()){return $1o.parentElement();}};return null;}catch(e){return null;}};PXRichTextEdit1.prototype.getParent=function(element){if(element.parentNode){return element.parentNode;};return null;};PXRichTextEdit1.prototype.getTextRange=function(element){var $1o=element.parentTextEdit.createTextRange();$1o.moveToElementText(element);return $1o;};PXRichTextEdit1.prototype.selectNode=function($35){var $1m=this.$3V();var $1o=this.getRange($1m);var $36=this.getTag($1o);var i=0;for(var $0p=$36;($0p&&($0p.nodeType==1));$0p=$0p.parentNode){if(i==$35){this.nodeSelection($0p);};i++;}};PXRichTextEdit1.prototype.nodeSelection=function($0p){var $f=this.getEditDoc();var $1m=this.$3V();var $1o=this.getRange($1m);if(!__px(this).IsIE){if($0p.nodeName=="BODY"){$1o.selectNodeContents($0p);}else{$1o.selectNode($0p);};if($1m)$1m.removeAllRanges();if($1m)$1m.addRange($1o);}else{if(($0p.nodeName=="TABLE")||($0p.nodeName=="IMG")||($0p.nodeName=="INPUT")||($0p.nodeName=="SELECT")||($0p.nodeName=="TEXTAREA")){try{$1o=$f.body.createControlRange();$1o.addElement($0p);$1o.select();}catch(e){}}else{$1o=$f.body.createTextRange();if($1o){$1o.collapse();if($1o.moveToElementText){try{$1o.moveToElementText($0p);$1o.select();}catch(e){try{$1o=$f.body.createTextRange();$1o.moveToElementText($0p);$1o.select();}catch(e){}}}else{try{$1o=$f.body.createTextRange();$1o.moveToElementText($0p);$1o.select();}catch(e){}}}}}};PXRichTextEdit1.prototype.$46=function($0p,style){if(style==null)return;var $37=style.split(";");var $2V;for(var i=0;i<$37.length;i++){var $1j=$37[i].split(":");if($1j.length==2){try{var $38=$1j[0].trim();while(($2V=$38.search(/-/))!=-1){var $39=$38.substring(0,$2V);var $3a=$38.substring($2V+1,$2V+2);var $3b=$38.substring($2V+2,$38.length);$38=$39+$3a.toUpperCase()+$3b;};var $h=$1j[1].trim().toLowerCase();$0p.style[$38]=$h;}catch(e){}}}};PXRichTextEdit1.prototype.setAttribute=function($0p,$38,$h){if($h==null||$0p==null||$38==null)return;if(String.compare($38,"style",true))this.$46($0p,$h);else $0p.setAttribute($38,$h);};PXRichTextEdit1.prototype.removeAttribute=function($0p,$38){$0p.removeAttribute($38,false);};PXRichTextEdit1.prototype.insertAdjacentElement=function($0p,$3c,$3d){if($0p.insertAdjacentElement){$0p.insertAdjacentElement($3c,$3d);}else{switch($3c){case 'beforeBegin':$0p.parentNode.insertBefore($3d,$0p);break;case 'afterBegin':$0p.insertBefore($3d,$0p.firstChild);break;case 'beforeEnd':$0p.appendChild($3d);break;case 'afterEnd':if($0p.nextSibling)$0p.parentNode.insertBefore($3d,$0p.nextSibling);else $0p.parentNode.appendChild($3d);break;}}};PXRichTextEdit1.prototype.insertAdjacentHTML=function($0p,$3c,$3e){if($0p.insertAdjacentHTML){$0p.insertAdjacentHTML($3c,$3e);}else{var r=($0p.ownerDocument?$0p.ownerDocument:$0p.document).createRange();r.setStartBefore($0p);var $3f=r.createContextualFragment($3e);this.insertAdjacentElement($0p,$3c,$3f);}};PXRichTextEdit1.prototype.insertAdjacentText=function($0p,$3c,$3g){if($0p.insertAdjacentText){$0p.insertAdjacentText($3c,$3g);}else{var $3h=__doc(this).createTextNode($3g);this.insertAdjacentElement($0p,$3c,$3h);}};PXRichTextEdit1.prototype.setHeight=function($25){this.sf("setheight ");var $3i=this.element,$0Z=parseInt($25);var $3j=$3i.rows[1].cells[0],ds=this.elemIFrame.parentNode.style,$3k=this.viewParent.style;$0Z-=($3i.offsetHeight-$3j.clientHeight)+(__px(this).IsIE?1:0);$0Z=($0Z>0?$0Z:0);var $3l=this.readonly?-5:0;$3i.style.height=$3j.style.height=$0Z+$3l+"px";var $3m=$0Z-PX.convertInt(ds.paddingTop)-PX.convertInt(ds.paddingBottom)+$3l;var $3n=$0Z-PX.convertInt($3k.paddingTop)-PX.convertInt($3k.paddingBottom)+$3l;if($3m>0){this.elemIFrame.parentNode.style.height=$3m+"px";this.elemIFrame.style.height=$3m+"px";this.viewParent.style.height=$3n+"px";if(this.sourceFrame){this.sourceFrame.style.height=$3m+20+"px";this.sourceText.setAttribute('style','width: 100%;height:'+$3m+"px");};this.viewFrame.style.height="100%";}};PXRichTextEdit1.prototype.$47=function($b){var $0p=$b;while($0p){if($0p.getAttribute&&($0p.getAttribute('data-template')))return $0p;$0p=$0p.parentNode;}};PXRichTextEdit1.prototype.$3Q=function(e){if(this.lastPlaceholder){return;};var $3o=this.$47(e.target);if(undefined !=$3o){var $3p=$3o.getAttribute('data-template');if($3p=="yes"){$3o.removeAttribute('data-template');}else{var $f=this.getEditDoc();var $3q=$f.body.querySelectorAll('[data-template="'+$3p+'"]');Array.prototype.forEach.call($3q,function($b){$b.removeAttribute('data-template');});}}};PXRichTextEdit1.prototype.addChild=function(parent,$0U,$1j){var $f=this.getEditDoc();var $Z=$f.createElement($0U);if($1j){this.assignAttributes($Z,$1j);};parent.appendChild($Z);return $Z;};



function PXColorToolBarSelector1($a,$b,$c,ei){this.px_context=$a.px_context;PXColorToolBarSelector1.initializeBaseA(this,[$a,$b,$c,ei]);var $d=Function.createDelegate(this,this.$t);__px(this).addEventHandler(this.element,"click",$d);__px(this).addEventHandler(this.element,"dbclick",$d);__px(this).addEventHandler(this.element,"mousedown",$d);};PXColorToolBarSelector1.__baseType=PXToolBarButton;PXColorToolBarSelector1.prototype.getMenu=function(){if(!this.menu){var $e=this.getMenuID();this.menu=__px_cm(this).createControl("PXColorToolBarMenu1",$e);if(this.menu){__px_all(this)[$e]=this.menu;this.menu.onLoad(this);var h=Function.createDelegate(this,this.$u);this.menu.events.addEventHandler("deactivate",h);this.menu.events.addEventHandler("itemClick",h);this.menu.linkedButton=this;}};return this.menu;};PXColorToolBarSelector1.prototype.setStyle=function(){this.dropPushed=this.getMenu().getVisible();PXColorToolBarSelector1.callBase(this,"setStyle",null);};PXColorToolBarSelector1.prototype.$t=function(e){switch(e.type){case "mousedown":if(this.getEnabled()){var $f=new Object(),$g=this.getMenu();$f.button=this;this.owner.fireEvent(1,e,$f);$g.getVisible()?$g.hide2():[$g.show2(),this.owner.fireEvent("menuShow",null,this)];this.setStyle();};break;default:break;}};PXColorToolBarSelector1.prototype.$u=function($a,e){switch(e.id){case 0:this.dropPushed=false;this.setStyle();break;case 1:this.hideMenu();break;}};PXColorToolBarSelector1.prototype.clearColor=function(){var $g=this.getMenu();if($g)$g.clearColor();};PXColorToolBarSelector1.prototype.setColor=function(v){var $g=this.getMenu();if($g)$g.setColor(v);};PXColorToolBarSelector1.prototype.hideMenu=function(){var $g=this.getMenu();if($g)$g.hide2();};function PXColorToolBarMenu1($h,$i,$c){this.px_context=$h;this.$v="c";this.elem=$i;this.ID=$i.id;this.highlighted=new Array();this.events=new PXEventList(this,PXColorToolBarMenu1.events,null);__px_cm(this).readProperties(this,$c,PXColorToolBarMenu1.properties);};PXColorToolBarMenu1.properties=[["highlightColor",JSType.String,"#FABC4E"]];PXColorToolBarMenu1.events={$deactivate:0,$itemClick:1};PXColorToolBarMenu1.prototype.onLoad=function($a){this.owner=$a;var $j=Function.createDelegate(this,this.$w);__px(this).addEventHandler(this.elem,"mouseover",$j);__px(this).addEventHandler(this.elem,"mouseout",$j);__px(this).addEventHandler(this.elem,"dblclick",$j);__px(this).addEventHandler(this.elem,"mousedown",$j);__px(this).addEventHandler(this.elem,"selectstart",$j);__px(this).addEventHandler(this.elem,"mouseup",$j);};PXColorToolBarMenu1.prototype.setActive=function($k){};PXColorToolBarMenu1.prototype.getVisible=function(){return this.elem.style.display=='';};PXColorToolBarMenu1.prototype.show=function(){};PXColorToolBarMenu1.prototype.show2=function(){var $l=this.owner.element;var $m=__px(this).getDropDownPos(this.linkedButton.element,this.elem,2);var $n=$m.left-20;var top=$m.top;this.elem.style.left=$n+'px';this.elem.style.top=10+top+'px';this.elem.style.display='';};PXColorToolBarMenu1.prototype.hide=function(){};PXColorToolBarMenu1.prototype.hide2=function(){this.elem.style.display='none';this.events.fireEvent(0,null);};PXColorToolBarMenu1.prototype.getSelectedColor=function(){return this.$x;};PXColorToolBarMenu1.prototype.$w=function(e){switch(e.type){case "mouseup":if(this.$y){var $f=new Object();$f.color=this.$y.style.backgroundColor;if(!__px(this).IsIE)$f.color=__px(this).colorToHex($f.color);this.$z=this.$y;this.clearHighlight();this.hide();this.events.fireEvent(1,$f);e.cancelBubble=true;e.preventDefault();e.cancel=true;return false;};break;case "mouseover":if(this.highlightColor)this.tryHighlight(e);break;case "mouseout":if(this.highlightColor)this.clearHighlight();break;case "selectstart":__px(this).cancelEvent(e);break;}};PXColorToolBarMenu1.prototype.tryHighlight=function(e){var $i=this.getHoverElement(e);if($i){this.clearHighlight($i);this.setHighlight($i);}else this.clearHighlight();};PXColorToolBarMenu1.prototype.getHoverElement=function(e){var se=__px(this).eventElem(e);var $i=null;while(se&&se!=this.elem){if(se.getAttribute&&se.getAttribute(this.$v)!=null){$i=se;break;};se=se.parentNode;};return $i;};PXColorToolBarMenu1.prototype.setHighlight=function(ae){if(ae!=this.$y){var parent=ae.parentNode;ae.ownColor=parent.style.backgroundColor;parent.style.backgroundColor=this.highlightColor;this.$y=ae;var $o=false;for(var i=0;i<this.highlighted.length;i++){if(this.highlighted[i]==ae){$o=true;break;}};if(!$o)this.highlighted.push(ae);}};PXColorToolBarMenu1.prototype.clearHighlight=function($i){var ae=null;for(var i=0;i<this.highlighted.length;){var ae=this.highlighted[i];if(ae&&ae!=$i&&ae!=this.$z){var parent=ae.parentNode;if(parent)parent.style.backgroundColor=ae.ownColor;if(ae==this.$y)this.$y=null;this.highlighted.splice(i,1)}else i++;}};PXColorToolBarMenu1.prototype.clearColor=function(){this.$z=null;this.clearHighlight();};PXColorToolBarMenu1.prototype.setColor=function(v){var $p=function(el){var style=el.currentStyle?el.currentStyle:__win(this).getComputedStyle(el,null);if(style.backgroundColor==v)return el;if(el.childNodes){for(var i=0;i<el.childNodes.length;i++){var $q=el.childNodes[i];if($q&&$q.nodeName!="#text"){var $r=$p($q);if($r)return $r;}}};return null;};var $s=$p(this.elem);if($s){this.$z=$s;this.setHighlight($s);};this.clearHighlight();};



function PXRichRange($a,$b){this.doc=$a;this.range=$b;};PXRichRange.create=function($a){if(px.IsIE)return new PXOldIERichRange($a,$a.createRange());if(px.IsIE11)return new PXIE11RichRange($a,$a.getSelection().getRangeAt(0));return new PXFFRichRange($a,$a.createRange());};PXRichRange.fromSelection=function($a){if(px.IsIE){var $c=$a.getSelection();return new PXOldIERichRange($a,$c.getRangeAt(0));};if(px.IsIE11){var $c=$a.getSelection();if($c.rangeCount>0)return new PXIE11RichRange($a,$c.getRangeAt(0));return new PXEmptyRichRange($a);}else{var $c=$a.defaultView.getSelection();if($c.rangeCount>0)return new PXFFRichRange($a,$c.getRangeAt(0));return new PXEmptyRichRange($a);}};function PXOldIERichRange($a,$b){PXOldIERichRange.initializeBaseA(this,[$a,$b]);this.$N=$a.defaultView;};PXOldIERichRange.__baseType=PXRichRange;PXOldIERichRange.prototype.getStartContainer=function(){return this.range.startContainer;};PXOldIERichRange.prototype.getStartOffset=function(){return this.range.startOffset;};PXOldIERichRange.prototype.getEndContainer=function(){return this.range.endContainer;};PXOldIERichRange.prototype.getEndOffset=function(){return this.range.endOffset;};PXOldIERichRange.prototype.select=function(){if(!this.$N)return;var $c=this.$N.getSelection();$c.removeAllRanges();$c.addRange(this.range);};PXOldIERichRange.prototype.selectNode=function($d){this.range.selectNode($d);};PXOldIERichRange.prototype.selectNodeContents=function($d){this.range.selectNodeContents($d);};PXOldIERichRange.prototype.toString=function(){this.range.toString();};PXOldIERichRange.prototype.isEqual=function($e){return this.doc==$e.doc&&this.range.compareBoundaryPoints(0,$e.range)==0&&this.range.compareBoundaryPoints(2,$e.range)==0;};PXOldIERichRange.prototype.clone=function(){return new PXOldIERichRange(this.doc,this.range.cloneRange());};PXOldIERichRange.prototype.surroundContents=function($d){this.range.surroundContents($d);return $d;};PXOldIERichRange.prototype.isCollapsed=function(){return this.range.collapsed;};PXOldIERichRange.prototype.setStart=function($d,$f){return this.range.setStart($d,$f);};PXOldIERichRange.prototype.setEnd=function($d,$f){return this.range.setEnd($d,$f);};PXOldIERichRange.prototype.selectTextElem=function($g){this.range.selectNode($g);};PXOldIERichRange.prototype.collapse=function($h){if(undefined==$h)this.range.collapse(false);else this.range.collapse(true);};PXOldIERichRange.prototype.deleteContents=function(){this.range.deleteContents();};PXOldIERichRange.prototype.ancestorContainer=function(){return this.range.commonAncestorContainer;};function PXIERichRange($a,$b){PXIERichRange.initializeBaseA(this,[$a,$b]);this.$O();};PXIERichRange.__baseType=PXRichRange;PXIERichRange.prototype.getStartContainer=function(){return this.$P;};PXIERichRange.prototype.getStartOffset=function(){return this.$Q;};PXIERichRange.prototype.getEndContainer=function(){return this.$R;};PXIERichRange.prototype.getEndOffset=function(){return this.$S;};PXIERichRange.prototype.$O=function(){if(this.range.duplicate){var $i=this.range.duplicate();$i.collapse(true);var $j=this.$T($i);this.$P=$j.container;this.$Q=$j.offset;var $k=this.range.duplicate();$k.collapse(false);$j=this.$T($k);this.$R=$j.container;this.$S=$j.offset;}else{if(this.range.length){this.$P=this.range.item(0);this.$Q=0;this.$R=this.range.item(this.range.length-1);this.$S=0;}}};PXIERichRange.prototype.$T=function($l){var element=$l.parentElement();var $b=this.doc.body.createTextRange();$b.moveToElementText(element);$b.setEndPoint("EndToStart",$l);var $m=0;for(var i=0;i<$b.text.length;i++){var $n=$b.text.charCodeAt(i);if($n!=10&&$n!=13)$m++;};var forward=true;var $d=null;if($m<element.innerText.length/2){forward=true;$d=element.firstChild;}else{forward=false;$d=element.lastChild;$b.moveToElementText(element);$b.setEndPoint("StartToStart",$l);$m=$b.text.length;};var $o=new Object();while($d&&!$o.container&&!$o.offset){switch($d.nodeType){case 3:var $p=$d.data.length;if($p<$m){var $q=$m-$p;if(forward)$b.moveStart("character",$q);else $b.moveEnd("character",-$q);$m=$q;}else{if(forward){$o.container=$d;$o.offset=$m;}else{$o.container=$d;$o.offset=$p-$m;}};break;case 1:var $p=$d.innerText.length;if(forward)$b.moveStart("character",$p);else $b.moveEnd("character",-$p);$m=$m-$p;break;};if(forward)$d=$d.nextSibling;else $d=$d.previousSibling;};if(!$o.container)$o.container=element;if(!$o.offset)$o.offset=0;return $o;};PXIERichRange.prototype.select=function(){this.range.select();};PXIERichRange.prototype.selectNode=function($d){var $r=function($d){if(!$d.parentNode)return null;var $s=0;var $t=$d.previousSibling;while($t){$s++;$t=$t.previousSibling;};return $s;};this.setStart($d.parentNode,$r($d));this.setEnd($d.parentNode,$r($d)+1);};PXIERichRange.prototype.selectNodeContents=function($d){this.setStart($d,0);if($d.nodeType==3)this.setEnd($d,$d.data.length);else this.setEnd($d,$d.childNodes.length);};PXIERichRange.prototype.toString=function(){this.range.text;};PXIERichRange.prototype.isEqual=function($e){if(this.range.constructor !=$e.range.constructor){return false;};return this.doc==$e.doc&&this.range.isEqual($e.range);};PXIERichRange.prototype.clone=function(){return new PXIERichRange(this.doc,this.range.duplicate());};PXIERichRange.prototype.$U=function(){var df=this.doc.createDocumentFragment();var $u=function($v,$w,$x){var $y=$w;while($y){if($y==$v)return true;else if($y==$x)return false;else $y=$y.parentNode;};return false;};var $z=null;if(this.$P==null||this.$R==null){$z=null;}else if(this.$P==this.$R){$z=this.$P;}else{var $z=this.$P;while($z){if($u($z,this.$R))break;else $z=$z.parentNode;}};if($z.nodeType==3){df.appendChild(this.doc.createTextNode(this.range.text));return df;};var $A=this.$P;if(this.$P.nodeType!=3)$A=this.$P.childNodes[this.$Q];var $B=this.$R;if(this.$R.nodeType!=3)$B=this.$R.childNodes[this.$S-1];if($A==$B){df.appendChild($A.cloneNode(true));return df;};var $C=$z.firstChild;var parent=null;var $D;while($C){if(!parent){if($u($C,$A,$z)){parent=df;}else{$C=$C.nextSibling;continue;}};if($C==$A&&this.$P.nodeType==3){$E=this.$P.data.substring(this.$Q);parent.appendChild(this.doc.createTextNode($E));}else if($C==$B){if(this.$R.nodeType==3){$E=this.$R.data.substring(0,this.$S);parent.appendChild(this.doc.createTextNode($E));}else parent.appendChild($B.cloneNode(false));break;}else{$D=$C.cloneNode(false);parent.appendChild($D);};if($C.firstChild){parent=$D;$C=$C.firstChild;}else if($C.nextSibling){$C=$C.nextSibling;}else while($C){if($C.parentNode){parent=parent.parentNode;$C=$C.parentNode;if($C.nextSibling){$C=$C.nextSibling;break;}}else $C=null;}};return df;};PXIERichRange.prototype.surroundContents=function($d){var $F=this.$U();this.$R=this.$P;this.$S=this.$Q;$d.appendChild($F);if(this.$P.nodeType==3){this.$P.splitText(this.$Q);this.$P.parentNode.insertBefore($d,this.$P.nextSibling);this.setStart(this.$P,this.$Q);}else{var $G=this.$P.parentNode;if(this.$P.childNodes.length==this.$Q){$G.appendChild($d);}else{this.$P.insertBefore($d,this.$P.childNodes[this.$Q]);this.setStart(this.$P,this.$Q+1);}};return $F;};PXIERichRange.prototype.isCollapsed=function(){return this.$P==this.$R&&this.$Q==this.$S;};PXIERichRange.prototype.setStart=function($d,$f){var $z=$d;if($d.nodeType==3||$d.nodeType==8||$d.nodeType==4){$z=$z.parentNode;};var $H=this.range.duplicate();$H.moveToElementText($z);$H.collapse(true);$H.move('Character',this.$V($d,$f));this.range.setEndPoint('StartToStart',$H);this.$P=$d;this.$Q=$f;if(this.$R==null&&this.$S==null){this.$R=$d;this.$S=$f;}};PXIERichRange.prototype.$V=function($A,$I){var $d,$J;if($A.nodeType==3){$J=$I;$d=$A.previousSibling;}else if($A.nodeType==1){$J=0;if($I>0)$d=$A.childNodes[$I-1];else return 0;}else{return 0;}while($d){var $p=0;if($d.nodeType==1){$p=$d.innerText.length;switch($d.nodeName.toLowerCase()){case 'img':case 'br':case 'hr':$p=1;break;};switch($d.nodeName.toLowerCase()){case 'p':case 'div':case 'h1':case 'h2':case 'h3':case 'h4':case 'h5':case 'h6':case 'pre':$p++;break;}}else if($d.nodeType==3){$p=$d.data.length;};$J+=$p;$d=$d.previousSibling;};return $J;};PXIERichRange.prototype.setEnd=function($d,$f){var $H=this.range.duplicate();$H.collapse(true);var $z=$d;if($d.nodeType==3||$d.nodeType==8||$d.nodeType==4){$z=$z.parentNode;};$H=this.range.duplicate();$H.moveToElementText($z);$H.collapse(true);$H.move('Character',this.$V($d,$f));this.range.setEndPoint('EndToEnd',$H);this.$R=$d;this.$S=$f;if(this.$P==null&&this.$Q==null){this.$P=$d;this.$Q=$f;}};PXIERichRange.prototype.selectTextElem=function($g){this.range.moveToElementText($g);this.range.move("character",0);};PXIERichRange.prototype.collapse=function($K){this.range.collapse(!$K);};PXIERichRange.prototype.deleteContents=function(){this.range.pasteHTML("");return;};PXIERichRange.prototype.ancestorContainer=function(){if(this.range.parentElement){return this.range.parentElement();}else if(this.range.length){var $L=[];var $g=this.getStartContainer();while($g){$L.push($g);$g=$g.parentNode;};var $M=this.getEndContainer();while($M){if($L.indexOf($M)>-1){return $M;};$M=$M.parentNode;}}};function PXFFRichRange($a,$b){PXFFRichRange.initializeBaseA(this,[$a,$b]);this.$N=$a.defaultView;};PXFFRichRange.__baseType=PXRichRange;PXFFRichRange.prototype.getStartContainer=function(){return this.range.startContainer;};PXFFRichRange.prototype.getStartOffset=function(){return this.range.startOffset;};PXFFRichRange.prototype.getEndContainer=function(){return this.range.endContainer;};PXFFRichRange.prototype.getEndOffset=function(){return this.range.endOffset;};PXFFRichRange.prototype.select=function(){if(!this.$N)return;var $c=this.$N.getSelection();$c.removeAllRanges();$c.addRange(this.range);};PXFFRichRange.prototype.selectNode=function($d){this.range.selectNode($d);};PXFFRichRange.prototype.selectNodeContents=function($d){this.range.selectNodeContents($d);};PXFFRichRange.prototype.toString=function(){this.range.toString();};PXFFRichRange.prototype.isEqual=function($e){return this.doc==$e.doc&&this.range.compareBoundaryPoints(0,$e.range)==0&&this.range.compareBoundaryPoints(2,$e.range)==0;};PXFFRichRange.prototype.clone=function(){return new PXFFRichRange(this.doc,this.range.cloneRange());};PXFFRichRange.prototype.surroundContents=function($d){this.range.surroundContents($d);return $d;};PXFFRichRange.prototype.isCollapsed=function(){return this.range.collapsed;};PXFFRichRange.prototype.setStart=function($d,$f){return this.range.setStart($d,$f);};PXFFRichRange.prototype.setEnd=function($d,$f){return this.range.setEnd($d,$f);};PXFFRichRange.prototype.selectTextElem=function($g){this.range.selectNode($g);};PXFFRichRange.prototype.collapse=function(){this.range.collapse();};PXFFRichRange.prototype.deleteContents=function(){this.range.deleteContents();};PXFFRichRange.prototype.ancestorContainer=function(){return this.range.commonAncestorContainer;};function PXIE11RichRange($a,$b){PXIE11RichRange.initializeBaseA(this,[$a,$b]);this.$N=$a.defaultView;};PXIE11RichRange.__baseType=PXRichRange;PXIE11RichRange.prototype.getStartContainer=function(){return this.range.startContainer;};PXIE11RichRange.prototype.getStartOffset=function(){return this.range.startOffset;};PXIE11RichRange.prototype.getEndContainer=function(){return this.range.endContainer;};PXIE11RichRange.prototype.getEndOffset=function(){return this.range.endOffset;};PXIE11RichRange.prototype.select=function(){if(!this.$N)return;var $c=this.$N.getSelection();$c.removeAllRanges();$c.addRange(this.range);};PXIE11RichRange.prototype.selectNode=function($d){this.range.selectNode($d);};PXIE11RichRange.prototype.selectNodeContents=function($d){this.range.selectNodeContents($d);};PXIE11RichRange.prototype.toString=function(){this.range.toString();};PXIE11RichRange.prototype.isEqual=function($e){return this.doc==$e.doc&&this.range.compareBoundaryPoints(0,$e.range)==0&&this.range.compareBoundaryPoints(2,$e.range)==0;};PXIE11RichRange.prototype.clone=function(){return new PXIE11RichRange(this.doc,this.range.cloneRange());};PXIE11RichRange.prototype.surroundContents=function($d){this.range.surroundContents($d);return $d;};PXIE11RichRange.prototype.isCollapsed=function(){return this.range.collapsed;};PXIE11RichRange.prototype.setStart=function($d,$f){return this.range.setStart($d,$f);};PXIE11RichRange.prototype.setEnd=function($d,$f){return this.range.setEnd($d,$f);};PXIE11RichRange.prototype.selectTextElem=function($g){this.range.selectNode($g);};PXIE11RichRange.prototype.collapse=function($h){if(undefined==$h)this.range.collapse(false);else this.range.collapse(true);};PXIE11RichRange.prototype.deleteContents=function(){this.range.deleteContents();};PXIE11RichRange.prototype.ancestorContainer=function(){return this.range.commonAncestorContainer;};function PXEmptyRichRange($a){this.emptyNode=new Object();this.emptyNode.nodeValue="";this.emptyNode.nodeType=3;this.emptyNode.nodeName="#text";this.emptyNode.parentNode=$a.body;};PXEmptyRichRange.__baseType=PXRichRange;PXEmptyRichRange.prototype.getStartContainer=function(){return this.emptyNode;};PXEmptyRichRange.prototype.getStartOffset=function(){return 0;};PXEmptyRichRange.prototype.getEndContainer=function(){return this.emptyNode;};PXEmptyRichRange.prototype.getEndOffset=function(){return 0;};PXEmptyRichRange.prototype.select=function(){};PXEmptyRichRange.prototype.selectNode=function($d){};PXEmptyRichRange.prototype.selectNodeContents=function($d){};PXEmptyRichRange.prototype.toString=function(){return this.emptyNode.nodeValue;};PXEmptyRichRange.prototype.isEqual=function($e){return $e.constructor==PXEmptyRichRange;};PXEmptyRichRange.prototype.clone=function(){return this;};PXEmptyRichRange.prototype.surroundContents=function($d){return $d;};PXEmptyRichRange.prototype.isCollapsed=function(){return true;};PXEmptyRichRange.prototype.setStart=function($d,$f){return null;};PXEmptyRichRange.prototype.setEnd=function($d,$f){return null;};PXEmptyRichRange.prototype.selectTextElem=function($g){};PXEmptyRichRange.prototype.collapse=function(){};PXEmptyRichRange.prototype.deleteContents=function(){};PXEmptyRichRange.prototype.ancestorContainer=function(){};


PXRichTextEdit1.prototype.toArray=function($a){if($a)return Array.prototype.slice.call($a);return[];};PXRichTextEdit1.prototype.partition=function($a,$b,$c,$d){$c=$c?$c:'accepted';$d=$d?$d:'rejected';var ok=[];var $e=[];for(var i=0;i<$a.length;i++){if($b($a[i])){ok.push($a[i]);}else{$e.push($a[i]);}};var $f={};$f[$c]=ok;$f[$d]=$e;return $f;};PXRichTextEdit1.prototype.startsWith=function($a,$g){if($a.length<$g.length)return false;for(var i=0;i<$g.length;i++){var $h=$g[i];if(typeof($h)!="object"){if($h!=$a[i])return false;}else{if(!$g.reduce(function($i,$j){$i|=($j==$a[i]);},false))return false;}};return true;};PXRichTextEdit1.prototype.diff=function($k,$l){var $f=[];for(var i=0;i<$k.length;i++){var $m=$k[i];if($l.indexOf($m)>-1){$f.push($m);}};return $f;};PXRichTextEdit1.prototype.substract=function($k,$l){var $f=[];for(var i=0;i<$k.length;i++){var $m=$k[i];if($l.indexOf($m)==-1){$f.push($m);}};return $f;};PXRichTextEdit1.prototype.inlineNodeNames=["b","big","i","small","tt","abbr","acronym","cite","code","dfn","em","kbd","strong","samp","var","a","bdo",,"img","map","object","q","script","span","sub","sup","button","input","label","select","textarea","#text","#comment","#cdata-section","s","strike","u","font"];PXRichTextEdit1.prototype.blockNodeNames=["address","article","aside","audio","blockquote","canvas","dd","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","video","tr","td","li","th"];PXRichTextEdit1.prototype.atomicNodeNames=["img","br","object","embed"];PXRichTextEdit1.prototype.isInline=function($n){if($n&&$n.nodeName){return PXRichTextEdit1.prototype.inlineNodeNames.indexOf($n.nodeName.toLowerCase())>-1;};return false;};PXRichTextEdit1.prototype.isBlock=function($n){if($n&&$n.nodeName){return PXRichTextEdit1.prototype.blockNodeNames.indexOf($n.nodeName.toLowerCase())>-1;};return false;};PXRichTextEdit1.prototype.isAtomic=function($n){if($n&&$n.nodeName){return PXRichTextEdit1.prototype.atomicNodeNames.indexOf($n.nodeName.toLowerCase())>-1;};return false;};PXRichTextEdit1.prototype.hasBlock=function($n){return $n.nodeType==document.ELEMENT_NODE&&$n.querySelector(this.blockNodeNames.join(","));};PXRichTextEdit1.prototype.specialEmptyNode=function($n){if($n.nodeType==document.TEXT_NODE&&$n.textContent=='\u200b')return true;if($n.nodeType==document.ELEMENT_NODE&&!$n.childNodes.length&&$n.getAttribute('data-filler'))return true;if($n.nodeType==document.ELEMENT_NODE&&$n.getAttribute('data-filler')&&($n.childNodes.length==1)&&($n.childNodes[0].textContent=='\u200b'))return true;return false;};PXRichTextEdit1.prototype.isTextual=function($n){return[3,4,8].indexOf($n.nodeType)>-1;};PXRichTextEdit1.prototype.whitespace=function($n){return $n.nodeType==document.TEXT_NODE&&!(/[^\t\n\r]/.test($n.textContent));};PXRichTextEdit1.prototype.tagNClass=function($n,$o){if($n){var name=$n.nodeName.toLowerCase();for(var i=1;i<arguments.length;i++){var $p=arguments[i];var $q=$p.split('.');if($q.length==2){if(name==$q[0]&&$n.className==$q[1]){return true;}}else{if(name==$q[0]){return true;}}}};return false;};PXRichTextEdit1.prototype.tagNClassUp=function($n,$o){var $r=$n;do{if(this.tagNClass($r,$o))return true;$r=$r.parentNode;}while($r&&$r.childNodes.length==1);};PXRichTextEdit1.prototype.hasAttr=function($n,$s){if($n.getAttribute){for(var i=1;i<arguments.length;i++){if($n.getAttribute(arguments[i]))return true;}};return false;};PXRichTextEdit1.prototype.isSingleStyleSet=function($n,$t){return $n&&$n.style&&$n.style[$t]&&($n.style.length==1);};PXRichTextEdit1.prototype.isSingleAttrSet=function($n,$u){return $n&&$n.attributes&&$n.getAttribute&&$n.getAttribute($u)&&($n.attributes.length==1);};PXRichTextEdit1.prototype.isColorTag=function($n){if($n.nodeName){var name=$n.nodeName.toLowerCase();return(name=='font'&&this.isSingleAttrSet($n,'color'))||(name='span'&&this.isSingleStyleSet($n,'color'));};return false;};PXRichTextEdit1.prototype.isBGColorTag=function($n){if($n.nodeName){var name=$n.nodeName.toLowerCase();return name='span'&&this.isSingleStyleSet($n,'backgroundColor');};return false;};PXRichTextEdit1.prototype.isOnlyChild=function($n){return $n.parentNode.childNodes.length==1;};PXRichTextEdit1.prototype.insertBefore=function($v,$w){if($w){$w.parentNode.insertBefore($v,$w);}else{$w.parentNode.appendChild($v);}};PXRichTextEdit1.prototype.insertAfter=function($v,$w){if($w.nextSibling){$w.parentNode.insertBefore($v,$w.nextSibling);}else{$w.parentNode.appendChild($v);}};PXRichTextEdit1.prototype.transferChildren=function($x,$y){while($x.childNodes.length){$y.appendChild($x.childNodes[0]);}};PXRichTextEdit1.prototype.deleteNode=function($n){if($n.parentNode){$n.parentNode.removeChild($n);}};PXRichTextEdit1.prototype.deleteNodes=function($z){for(var i=0;i<$z.length;i++){$z[i].parentNode.removeChild($z[i]);}};PXRichTextEdit1.prototype.prune=function($n,$A){if(!$n)return;var $B=$n.textContent&&$n.textContent.length;var $C=$n.querySelectorAll&&$n.querySelectorAll('br').length;var $D=$n.querySelectorAll&&$n.querySelectorAll('img').length;var $E=$n.contains&&$A&&$A.filter(function(e){return $n.contains(e);}).length;var $F=$n.nodeName.toLowerCase();if(!($B||$C||$D||$E)&&$F!='br'&&$F!="img"){if(!$A||$A.indexOf($n)==-1){this.deleteNode($n);}}else if($n.childNodes&&$F!='table'){for(var i=0;i<$n.childNodes.length;i++){this.prune($n.childNodes[i],$A);}}};PXRichTextEdit1.prototype.removeExtraBlocks=function($n){if(!this.isInline($n)){if($n.childNodes&&$n.childNodes.length==1){var $G=$n.firstChild;var name=$G.nodeName.toLowerCase();if(name=="div"||name=="p"){while($G.childNodes&&$G.childNodes.length){$n.appendChild($G.childNodes.firstChild);};this.deleteNode($G);}}}};PXRichTextEdit1.prototype.wrapNode=function($H,$n,$I){var $v=$H.createElement($I);$n.parentNode.insertBefore($v,$n);$v.appendChild($n);return $v;};PXRichTextEdit1.prototype.promoteNode=function($n){var parent=$n.parentNode;parent.parentNode.insertBefore($n,parent);parent.parentNode.removeChild(parent);};PXRichTextEdit1.prototype.replaceNode=function($H,$n,$J){var $v=$H.createElement($J);for(var i=0;i<$n.attributes.length;i++){var $K=$n.attribuets[i];$v.setAttribute($K.name,$K.value);}while($n.childNodes.length){$v.appendChild($n.childNodes[0]);};$n.parentNode.replaceChild($v,$n);};PXRichTextEdit1.prototype.normalizeTag=function($H,$J){var $z=this.toArray($H.body.querySelectorAll($J));for(var i=1;i<$z.length;i++){var $L=$z[i-1];var $n=$z[i];if($L==$n.previousSibling){while($n.childNodes.length){$L.appendChild($n.childNodes[0]);};this.deleteNode($n);}}};PXRichTextEdit1.prototype.getSelectedBottomNodes=function($H,$M){var $N=$H.createTreeWalker($H,NodeFilter.SHOW_ALL,null,false);var $n=undefined;var $f=[];if($M){while($n=$N.nextNode()){if(!$n.childNodes||!$n.childNodes.length){if(this.withinRange($n,$M))$f.push($n);}}};if($f.length>1){if($f[0]==$M.startContainer&&$f[0].childNodes.length<=$M.startOffset){$f.shift();};if($f.length>1){if($f[$f.length-1]==$M.endContainer&&!$M.startOffset){$f.pop();}}};return $f;};PXRichTextEdit1.prototype.getSelectedTextNodes=function($H,$M){var $O=$H.body.querySelectorAll("span[data-field=yes]");var $P=[];for(var i=0;i<$O.length;i++){var $Q=$O[i];var $R=[];var $S=$H.createTreeWalker($Q,NodeFilter.SHOW_TEXT,null,false);var $T;while($T=$S.nextNode()){$R.push($T);};$P.push({'field':$Q,'text':$R});};var $N=$H.createTreeWalker($H,NodeFilter.SHOW_TEXT,null,false);var $n=undefined;var $f=[];if($M){while($n=$N.nextNode()){if(this.withinRange($n,$M)){var $U=false;for(var i=0;i<$P.length;i++){var $V=$P[i];if($V.text.indexOf($n)>-1){if(!$V.visited){$f.push($V.field);$V.visited=true;};$U=true;}};if(!$U){$f.push($n);}}}};if($f.length>1){if($f[0]==$M.startContainer&&$f[0].childNodes.length<=$M.startOffset){$f.shift();};if($f.length>1){if($f[$f.length-1]==$M.endContainer&&!$M.startOffset){$f.pop();}}};return $f;};PXRichTextEdit1.prototype.getAllNodes=function($H,$W,$X){var $N=$H.createTreeWalker($W,$X,null,false);var $n=undefined;var $f=[];while($n=$N.nextNode()){$f.push($n);};return $f;};PXRichTextEdit1.prototype.getAllTextNodes=function($H,$W){var $N=$H.createTreeWalker($W,NodeFilter.SHOW_TEXT,null,false);var $n=undefined;var $f=[];while($n=$N.nextNode()){if(document.DOCUMENT_POSITION_CONTAINED_BY&$W.compareDocumentPosition($n)){$f.push($n);}};return $f;};PXRichTextEdit1.prototype.getParentChain=function($n,$Y){var $f=[];var $r=$n;do{$f.push($r);if(this.tagNClass($r,$Y)){break;};$r=$r.parentNode;}while($r);return $f;};PXRichTextEdit1.prototype.getOneChildChain=function($n){var $f=[$n];var $r=$n;while($r.childNodes&&$r.childNodes.length==1){$r=$r.childNodes[0];$f.push($r);};return $f;};PXRichTextEdit1.prototype.getExclusiveParentChain=function($n){var $f=[];var $r=$n;do{$f.push($r);$r=$r.parentNode;}while($r&&$r.childNodes.length==1);return $f;};PXRichTextEdit1.prototype.findParentNode=function($I,$n){if($n){while($n&&(($I=='HTML')||($n.tagName!="HTML"))){if(this.tagNClass($n,$I)){return $n;};$n=$n.parentNode;}};return null;};PXRichTextEdit1.prototype.getParentWithAttribute=function($Z,$u,$00,$01){if(!$Z){return false;};var parent=$Z;for(var i=0;i<$01;i++){if(parent.getAttribute){var $K=parent.getAttribute($u);if($K==$00){return parent;}};parent=parent.parentNode;if(!parent)break;};return false;};PXRichTextEdit1.prototype.findAlive=function($H,$02){var $03,$04;var $05=Array.prototype.filter;var $06=function($07){var $08=$H.body.compareDocumentPosition($07);if(document.DOCUMENT_POSITION_CONTAINED_BY&$08){if(!($08&document.DOCUMENT_POSITION_DISCONNECTED)){return true;}};return false;};return[$05.call($02[0],$06),$05.call($02[1],$06)];};PXRichTextEdit1.prototype.findTagNClass=function($09,$p){var $q=this.toArray(arguments).slice(1);for(var i=0;i<$09.length;i++){var $n=$09[i];if(this.tagNClass.apply(this,[$n].concat($q)))return $n;}};PXRichTextEdit1.prototype.nextSibling=function($n,$I){if($n){var $0a=$n.nextSibling;while($0a&&$0a.nodeName.toLowerCase()!=$I.toLowerCase()){$0a=$0a.nextSibling;}};return $0a;};PXRichTextEdit1.prototype.prevSibling=function($n,$I){if($n){var $i=$n.previousSibling;while($i&&$i.nodeName.toLowerCase()!=$I.toLowerCase()){$i=$i.previousSibling;}};return $i;};PXRichTextEdit1.prototype.firstChild=function($n,$I){for(var i=0;i<$n.childNodes.length;i++){if($n.childNodes[i].nodeName.toLowerCase()==$I.toLowerCase()){return $n.childNodes[i];}}};PXRichTextEdit1.prototype.lastChild=function($n,$I){for(var i=$n.childNodes.length-1;i>=0;i--){if($n.childNodes[i].nodeName.toLowerCase()==$I.toLowerCase()){return $n.childNodes[i];}}};PXRichTextEdit1.prototype.afterRangeAnchor=function($n,$W,$0b){var $0c=$n==$W&&this.isTextual($n);var $0d=$n.compareDocumentPosition($W);if(document.DOCUMENT_POSITION_PRECEDING==$0d){$0c=true;}else if(document.DOCUMENT_POSITION_CONTAINS&$0d){if(!$0b){$0c=true;}else{if(document.DOCUMENT_POSITION_PRECEDING==$n.compareDocumentPosition($W.childNodes[$0b-1]))$0c=true;}};return $0c;};PXRichTextEdit1.prototype.beforeRangeAnchor=function($n,$W,$0b){var $0e=$n==$W&&this.isTextual($n);var $0f=$n.compareDocumentPosition($W);if(document.DOCUMENT_POSITION_FOLLOWING==$0f){$0e=true;}else if(document.DOCUMENT_POSITION_CONTAINS&$0f){if($0b==$W.childNodes.length){$0e=true;}else{if(document.DOCUMENT_POSITION_FOLLOWING==$n.compareDocumentPosition($W.childNodes[$0b]))$0e=true;}};return $0e;};PXRichTextEdit1.prototype.outsideRange=function($H,$M){var $N=$H.createTreeWalker($H.body,NodeFilter.SHOW_ALL,null,false);var $03=[];var $04=[];var $0g=undefined;if($M){var $0h=this.orderedRange($H,$M);while($n=$N.nextNode()){if(this.beforeRangeAnchor($n,$0h.startContainer,$0h.startOffset)){$03.push($n);}else if(this.afterRangeAnchor($n,$0h.endContainer,$0h.endOffset)){$04.push($n);}};return[$03,$04];}};PXRichTextEdit1.prototype.withinRange=function($n,$M){var $0i=this.afterRangeAnchor($n,$M.startContainer,$M.startOffset);var $0j=this.beforeRangeAnchor($n,$M.endContainer,$M.endOffset);var $0k=$n==$M.startContainer&&!$M.startOffset;var $0l=$n==$M.endContainer&&$M.endOffset==$M.endContainer.childNodes.length;return($0i||$0k)&&($0j||$0l);};PXRichTextEdit1.prototype.setRange=function($0m){var $0n=this.getEditDoc();var s1=$0n.getSelection();if(s1){s1.removeAllRanges();s1.addRange($0m);}else{var $0o=1;}};PXRichTextEdit1.prototype.withinRange1=function($n,$M){var $0c=$n==$M.startContainer&&this.isTextual($n);var $0d=$n.compareDocumentPosition($M.startContainer);if(document.DOCUMENT_POSITION_PRECEDING==$0d){$0c=true;}else if(document.DOCUMENT_POSITION_CONTAINS&$0d){if(!$M.startOffset){$0c=true;}else{if(document.DOCUMENT_POSITION_PRECEDING==$n.compareDocumentPosition($M.startContainer.childNodes[$M.startOffset-1]))$0c=true;}};var $0e=$n==$M.endContainer&&this.isTextual($n);var $0f=$n.compareDocumentPosition($M.endContainer);if(document.DOCUMENT_POSITION_FOLLOWING==$0f){$0e=true;}else if(document.DOCUMENT_POSITION_CONTAINS&$0f){if($M.endOffset==$M.endContainer.childNodes.length){$0e=true;}else{if(document.DOCUMENT_POSITION_FOLLOWING==$n.compareDocumentPosition($M.endContainer.childNodes[$M.endOffset]))$0e=true;}};return $0c&&$0e;};PXRichTextEdit1.prototype.touchesRange=function($n,$M){var $0p=this.withinRange($n,$M);var $0q=$n.compareDocumentPosition($M.startContainer);var $0r=$n.compareDocumentPosition($M.endContainer);var $0k=!$0q;var $0s=document.DOCUMENT_POSITION_CONTAINED_BY&$0q;var $0l=!$0r;var $0t=document.DOCUMENT_POSITION_CONTAINED_BY&$0r;return $0p||(($0k||$0s)||($0l||$0t));};PXRichTextEdit1.prototype.insideRange=function($H,$n,$M){var $0u=this.orderedRange($H,$M);return this.withinRange($n,$0u)&&this.withinRange(this.getLastDescendant($H,$n),$0u);};PXRichTextEdit1.prototype.insideRangeExt=function($H,$n,$M){if(this.insideRange($H,$n,$M))return true;var $r=$n;while($r=$r.childNodes.length==1?$r.firstChild:undefined)if(this.insideRange($H,$r,$M))return true;};PXRichTextEdit1.prototype.isOutsideRange=function($H,$n,$M){var $0v=this.orderedRange($H,$M);return this.afterRangeAnchor($n,$0v.endContainer,$0v.endOffset)||$0w($n,$M.startContainer,$M.startOffset);};PXRichTextEdit1.prototype.range=function(){var d=this.getEditDoc();if(d){var s=d.getSelection();if(s&&s.rangeCount){return s.getRangeAt(0).cloneRange();}}};PXRichTextEdit1.prototype.createRange=function($H,$0x,$0y,$0z,$0A){var r=$H.createRange();r.setStart($0x,$0y);r.setEnd($0z,$0A);return r;};PXRichTextEdit1.prototype.getEncompassingRange=function($H,$z){var $0B=$z[0];var end=$z[0];for(var i=1;i<$z.length;i++){var $n=$z[i];if(document.DOCUMENT_POSITION_PRECEDING&$n.compareDocumentPosition(end)){end=$n;};if(document.DOCUMENT_POSITION_FOLLOWING&$n.compareDocumentPosition($0B)){$0B=$n;}};var $M=$H.createRange();$M.setStart($0B,0);$M.setEnd(end,end.textContent.length);return $M;};PXRichTextEdit1.prototype.rangeFromLimits=function($H,$0C){var r2=$H.createRange();if($0C[0]){r2.setStartAfter($0C[0]);}else{r2.setStart($H.body,0);};if($0C[1]){r2.setEndBefore($0C[1]);}else{r2.setEnd($H.body,$H.body.childNodes.length);};return r2;};PXRichTextEdit1.prototype.isReversedRange=function($H,$M){var $08=$M.startContainer.compareDocumentPosition($M.endContainer);if(!$08){return $M.startOffset>$M.endOffset;}else if($08==document.DOCUMENT_POSITION_PRECEDING){return true;}else if($08&document.DOCUMENT_POSITION_CONTAINED_BY){return this.beforeRangeAnchor($M.endContainer,$M.startContainer,$M.startOffset);}else if($08&document.DOCUMENT_POSITION_CONTAINS){return !this.beforeRangeAnchor($M.startContainer,$M.endContainer,$M.endOffset)}};PXRichTextEdit1.prototype.orderedRange=function($H,$M){if($M){var $08=$M.startContainer.compareDocumentPosition($M.endContainer);var $0D=function(r){var $0m=$H.createRange();$0m.setStart(r.endContainer,r.endOffset);$0m.setEnd(r.startContainer,r.startOffset);return $0m;};if(!$08){if($M.startOffset>$M.endOffset){return $0D($M);}}else if($08==document.DOCUMENT_POSITION_PRECEDING){return $0D($M);}else if($08&document.DOCUMENT_POSITION_CONTAINED_BY){if(this.beforeRangeAnchor($M.endContainer,$M.startContainer,$M.startOffset)){return $0D($M);}}else if($08&document.DOCUMENT_POSITION_CONTAINS){if(!this.beforeRangeAnchor($M.startContainer,$M.endContainer,$M.endOffset)){return $0D($M);}};return $M;}};PXRichTextEdit1.prototype.getRangeForListEnds=function($H,$z){if($z.length){var $M=$H.createRange();var $0B=$z[0];var end=$z[$z.length-1];$M.setStart($0B.parentNode,this.nodeIndex($0B));$M.setEnd(end.parentNode,this.nodeIndex(end)+1);return $M;}};PXRichTextEdit1.prototype.focusAfterTag=function($Z){var $H=this.getEditDoc();var r1=$H.createRange();r1.setEndAfter($Z);r1.setStartAfter($Z);this.setRange(r1);};PXRichTextEdit1.prototype.focusBeforeTag=function($Z){var $H=this.getEditDoc();var r1=$H.createRange();r1.setEndBefore($Z);r1.setStartBefore($Z);this.setRange(r1);};PXRichTextEdit1.prototype.focusAtTheEnd=function($Z){var $H=this.getEditDoc();var r1=$H.createRange();r1.setEndAfter($Z);r1.setStartAfter($Z);this.setRange(r1);};PXRichTextEdit1.prototype.focusInsideTag=function($Z){if($Z==undefined)return;var $H=this.getEditDoc();var r1=$H.createRange();r1.setStart($Z,0);r1.setEnd($Z,0);this.setRange(r1);};PXRichTextEdit1.prototype.focusInsideContainersEnd=function($Z){if($Z==undefined)return;var $0E=$Z;while(true){if($0E.nodeName.toLowerCase()=='br'){break;};if($0E.lastChild&&!this.nameIs($0E.lastChild,'br')){$0E=$0E.lastChild;}else if($0E.lastChild&&this.nameIs($0E.lastChild,'br')&&$0E.lastChild.previousSibling&&!this.nameIs($0E.lastChild.previousSibling,'br')){$0E=$0E.lastChild.previousSibling;}else{break;}};var $H=this.getEditDoc();var r1=$H.createRange();if($0E.nodeType==document.TEXT_NODE){var $0F=$0E.textContent.length;r1.setStart($0E,$0F);r1.setEnd($0E,$0F);}else{var $0F=$0E.childNodes.length;if($0E&&this.nameIs($0E.lastChild,'br')){$0F--;};r1.setStart($0E,$0F);r1.setEnd($0E,$0F);};this.setRange(r1);};PXRichTextEdit1.prototype.topmostInline=function($H,$M){var $0G=[];var $0H=this;var $0I=function($n){var $f=[];for(var i=0;i<$n.childNodes.length;i++){var $G=$n.childNodes[i];if($0H.touchesRange($G,$M)){if($0H.isInline($G)){if($0H.withinRange($G,$M)){$f=$f.concat($G);}}else{$f=$f.concat($0I.call($0H,$G));}}};return $f;};return $0I.call(this,$H.body);};PXRichTextEdit1.prototype.getSiblingIndex=function($n){var $0J=$n.parentNode.children;var $0K=-1;for(var i=0;i<$0J.length;i++){if($0J[i].nodeName==$n.nodeName)$0K++;if($0J[i]==$n)return $0K;}};PXRichTextEdit1.prototype.getSiblingByIndex=function($n,$0K){var $0J=$n.parentNode.children;for(var i=0;i<$0J.length;i++){if($0J[i].nodeName==$n.nodeName)$0K--;if(!$0K)return $0J[i];}};PXRichTextEdit1.prototype.surroundBySpace=function($n,$0L){return;var $H=this.getEditDoc();var $0M=function($H){var $0N=$H.createElement("span");$0N.innerHTML="\u200b";return $0N;};if(!$0L){$n.parentNode.insertBefore($0M($H),$n);};var $04=$0M($H);if($n.nextSibling){$n.parentNode.insertBefore($04,$n.nextSibling);}else{$n.parentNode.appendChild($04);};return $04;};PXRichTextEdit1.prototype.nodeIndex=function($n){for(var i=0;i<$n.parentNode.childNodes.length;i++){if($n.parentNode.childNodes[i]==$n)return i;};return -1;};PXRichTextEdit1.prototype.getLastDescendant=function($H,$0O){var $N=$H.createTreeWalker($0O,NodeFilter.SHOW_ALL,null,false);var $0P=$0O;while($n=$N.nextNode()){$0P=$n;};return $0P;};PXRichTextEdit1.prototype.partitionTextNodes=function($H,$0Q,$0R){var $N=$H.createTreeWalker($0Q,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,null,false);var $n=undefined;var $03=[];var $04=[];while($n=$N.nextNode()){var $0S=$n.nodeName.toLowerCase();if($n.nodeType==document.TEXT_NODE||$0S=='br'||$0S=='img'){var $0d=$n.compareDocumentPosition($0R);if($0d&document.DOCUMENT_POSITION_PRECEDING){$04.push($n);};if($0d&document.DOCUMENT_POSITION_FOLLOWING){$03.push($n);}}};return{'before':$03,'after':$04};};PXRichTextEdit1.prototype.getRangeTopNodes=function($M,$0T){var $f=[];for(var i=0;i<$M.commonAncestorContainer.childNodes.length;i++){var $n=$M.commonAncestorContainer.childNodes[i];if(this.withinRange($n,$M)){if($0T){var $0U=$n==$0T.startMarker||($0T.endMarker&&$n==$0T.endMarker);if(!$0U){$f.push($n);}}else{$f.push($n);}}};return $f;};PXRichTextEdit1.prototype.getSelectedStyle=function($H,$M,$A,$0V){if(!$A){$A=[];};var $0W=undefined;var $0X=($M.startContainer==$M.endContainer)&&($M.startOffset==$M.endOffset);var $z=$0X?[$M.commonAncestorContainer]:this.getSelectedBottomNodes($H,$M);for(var i=0;i<$z.length;i++){var $n=$z[i];if($A.indexOf($n)>-1||(!$0V&&($n.nodeType==document.TEXT_NODE&&$n.textContent=='\u200b'))){continue;};var $0Y=this.nodes2names(this.getParentChain($n,"BODY")).slice(0);if($0W==undefined){$0W=this.substract($0Y,['#text','body']);}else{$0W=this.diff($0W,$0Y);};if($0W&&!$0W.length)break;};return $0W?$0W:[];};PXRichTextEdit1.prototype.getNodeStyle=function($H,$n){return this.substract(this.nodes2names(this.getParentChain($n,"BODY")).slice(0),['#text','body','#comment']);};PXRichTextEdit1.prototype.restoreRange=function($M){var $H=this.getEditDoc();var $0H=this;var $0Z=function($H,$n,$0K){if($0H.contains($H.body,$n))return{'node':$n,'index':$0K};var $G=$n;var parent=$n.parentNode;while(parent.parentNode&&!$0H.contains($H.body,parent)){$G=parent;parent=parent.parentNode;};if($0H.contains($H.body,parent)){for(var i=0;i<parent.childNodes.length;i++){if(parent.childNodes[i]==$G)return{'node':parent,'index':i};}}};var s1=$H.getSelection();s1.removeAllRanges();var $10=false;try{s1.addRange($M);}catch(ex){$10=true;};if(!s1.rangeCount&&!$10){var $11=$0Z($H,$M.startContainer,$M.startOffset);var $12=$0Z($H,$M.endContainer,$M.endOffset);if($11&&$12){$M.setStart($11.node,$11.index);$M.setEnd($12.node,$12.index);s1.removeAllRanges();s1.addRange($M);}}};PXRichTextEdit1.prototype.clamp=function($13,x,$14){if(x<$13){return $13;};if(x>$14){return $14;};return x;};PXRichTextEdit1.prototype.between=function($00,$0C){for(var i=1;i<arguments.length;i++){var $15=arguments[i][0];var to=arguments[i][1];if($00>=$15&&$00<=to){return true;}};return false;};PXRichTextEdit1.prototype.stopEvent=function(e){e.preventDefault();e.cancel=true;return false;};PXRichTextEdit1.prototype.cancelEvent=function(e){__px(this).cancelEvent(e);e.cancel=true;return false;};PXRichTextEdit1.prototype.log=function(){};PXRichTextEdit1.prototype.assert=function($16,$17){};PXRichTextEdit1.prototype.nodes2names=function($18){var $f=[];for(var i=0;i<$18.length;i++){var $n=$18[i];var name=$n.nodeName.toLowerCase();if(name=='strong')name='b';var $19=$n.getAttribute?$n.getAttribute('class'):undefined;var $1a=$19?(name+"."+$19):name;$f.push($1a);};return $f;};PXRichTextEdit1.prototype.px2int=function($00){return parseInt($00.substring(0,$00.length-2),10);};PXRichTextEdit1.prototype.pseudoRangeAround=function($1b,$1c){var $1d=$1b;var $0y=this.toArray($1d.childNodes).indexOf($1b);var $1e=$1c.parentNode;var $0A=this.toArray($1d.childNodes).indexOf($1b);return{'startContainer':$1d,'startOffset':$0y,'endContainer':$1e,'endOffset':$0A};};PXRichTextEdit1.prototype.pseudoRangeAt=function($0x,$0y,$0z,$0A){return{'startContainer':$1d,'startOffset':$0y,'endContainer':$1e,'endOffset':$0A};};PXRichTextEdit1.prototype.queryRange=function($M,$1f){var $f=[];if($M.commonAncestorContainer.querySelectorAll){var $z=$M.commonAncestorContainer.querySelectorAll($1f);for(var i=0;i<$z.length;i++){var $n=$z[i];if(this.withinRange($n,$M))$f.push($n);}};return $f;};PXRichTextEdit1.prototype.isRangeFlipped=function($M){if($M.startContainer==$M.endContainer)return $M.startOffset>$M.endOffset;return document.DOCUMENT_POSITION_PRECEDING&$M.startContainer.compareDocumentPosition($M.endContainer);};PXRichTextEdit1.prototype.splitParent=function($H,$n,$1g,$1h){var $03=[];var $04=[];var parent=$n.parentNode;var $0J=parent.childNodes;var $1i=false;for(var i=0;i<$0J.length;i++){var $G=$0J[i];if($G==$n){$1i=true;}else if($1i){$04.push($G);}else{$03.push($G);}};if($03.length){var $1j=parent.cloneNode(false);while($03.length){var $1k=$03.shift();if(!($03.length==0&&$1k==$1g)){$1j.appendChild($1k);}};if($1j.childNodes.length){this.insertBefore($1j,parent);}};if($04.length){var $1l=parent.cloneNode(false);if($04.length>0&&$04[0]==$1h){$04.shift();}while($04.length){$1l.appendChild($04.shift());};if($1l.childNodes.length){this.insertAfter($1l,parent);}};return parent;};PXRichTextEdit1.prototype.stripChars=function($1m,$1n){var $f=$1m;for(var i=0;i<$1n.length;i++){$f=this.replace($f,[$1n[i],'']);};return $f;};PXRichTextEdit1.prototype.realChildCount=function($n){var $1o=0;for(var i=0;i<$n.childNodes.length;i++){if($n.nodeType==document.TEXT_NODE){var $1p=$n.textContent;if($1p.length>0&&$1p!='\u200b'){$1o++;}}else if($n.nodeType==document.ELEMENT_NODE&&!this.specialEmptyNode($n)){$1o++;}};if($n.lastChild&&$n.lastChild.nodeName.toLowerCase()=='br'){$1o--;};return $1o;};PXRichTextEdit1.prototype.contains=function($W,$n){if($W.compareDocumentPosition){var $08=$W.compareDocumentPosition($n);return(16&$08)||!$08;};return false;};PXRichTextEdit1.prototype.node2textRec1=function($n){var $0H=this;var $1q=function($n){var $1r=function($0J){var $1s=[];for(var i=0;i<$0J.length;i++){$1s=$1s.concat($0J[i]);};return $1s;};var $1t=function($0J){var $1s=$1r($0J);var $f=[];var $1u;for(var i=0;i<$1s.length;i++){var $G=$1s[i];if(typeof($G)=="string"){if($G){if($1u){$1u+=$G;}else{$1u=$G;}}}else if(typeof($G)=="number"){if($1u){$f.push($1u);$1u=undefined;};$f.push($G);}else{if($G.length){if($1u){$f.push($1u);$1u=undefined;};$f.push($G);}}};if($1u){$f.push($1u);};return $f;};var $0J=$n.childNodes?Array.prototype.map.call($n.childNodes,$1q):[];var name=$n.nodeName.toLowerCase();if($n.nodeType==document.TEXT_NODE){if($n.textContent.replace(RegExp('[\r\n]','g'),"").length){return[$n.textContent];}else{return[];}}else if(name=='br'){return[0];}else if($0H.isBlock($n)||name=='body'){return $1t($0J).map(function(x){return(typeof(x)=="string")?[x]:x;});}else{return $1t($0J);}};return $1q($n);};PXRichTextEdit1.prototype.br2p=function($1v){var $H=this.getEditDoc();var $1w=$1v.querySelectorAll('br');for(var i=0;i<$1w.length;i++){var br=$1w[i];var $1p=[];while($L&&$L.nodeType==document.TEXT_NODE){$1p.unshift($L);$L=$L.previousSibling;};var p=$H.createElement('p');p.className="richp";p.appendChild()}};PXRichTextEdit1.prototype.fillWithText=function($1x,$1y){var $H=this.getEditDoc();if(typeof($1y)=="string"){$1x.textContent=$1y;}else{var $1u;for(var i=0;i<$1y.length;i++){var $n;if(typeof($1y[i])=="string"){if($1u){$1u+=$1y[i];}else{$1u=$1y[i];}}else if(typeof($1y[i])=="number"){$n=$H.createElement('p');$n.className="richp";if($1u){$n.appendChild($H.createTextNode($1u));$1u=undefined;}else{$n.appendChild($H.createTextNode('\u200b'));};$1x.appendChild($n);}else{if($1u){$1x.appendChild($H.createTextNode($1u));$1u=undefined;};$n=$H.createElement('p');$n.className="richp";$n.textContent=$1y[i];$1x.appendChild($n);}};if($1u){$1x.appendChild($H.createTextNode($1u));}}};PXRichTextEdit1.prototype.stripBody=function($H){var $f=this.node2textRec1($H.body);$H.body.innerHTML="";this.fillWithText($H.body,$f);};PXRichTextEdit1.prototype.node2text=function($H,$n){var $1z=function($1x){var $1p=$1x.textContent;var $1A='@';while($1p.indexOf($1A)>-1){$1A+=String.fromCharCode(93*Math.random()+33);};return $1A;};var $1B=function($H,$1x,$1A){if($1x.querySelectorAll){var $z=$1x.querySelectorAll('div, p, br, table, tr');for(var i=0;i<$z.length;i++){var $n=$z[i];if($n.nodeName=="TR"){$n.parentNode.insertBefore($H.createTextNode($1A),$n)}else{if($n.nodeName!="BR"&&$n.previousSibling&&$n.previousSibling.nodeType==3&&$n.previousSibling.textContent!=$1A){$n.parentNode.insertBefore($H.createTextNode($1A),$n);};if($n.nextSibling){$n.parentNode.insertBefore($H.createTextNode($1A),$n.nextSibling);}else{$n.parentNode.appendChild($H.createTextNode($1A));}}}}};var $1A=$1z($n);$1B($H,$n,$1A);return $n.textContent.replace(RegExp($1A,'g'),"<br>");};PXRichTextEdit1.prototype.removeNested=function($09){var $1C=[];for(var i=0;i<$09.length;i++){var $n=$09[i];var $1D=false;for(var j=0;j<$09.length;j++){if(i!=j){var $1E=$09[j];var $1F=document.DOCUMENT_POSITION_CONTAINED_BY&$1E.compareDocumentPosition($n);$1D|=$1F;if($1D){break;}}};if(!$1D){$1C.push($n);}};var $f=[];for(var i=0;i<$1C.length;i++){if($1C.indexOf($1C[i],i+1)==-1){$f.push($1C[i]);}};return $f;};PXRichTextEdit1.prototype.any=function($00,$1G){for(var i=1;i<arguments.length;i++){if($00==arguments[i])return true;};return false;};PXRichTextEdit1.prototype.isCursorAtTop=function($M){return $M.collapsed&&$M.startContainer.nodeName.toLowerCase()=="body";};PXRichTextEdit1.prototype.topList=function($n){var parent=$n;while(this.tagNClass(parent.parentNode,"ul","ol")){parent=parent.parentNode;};return parent;};PXRichTextEdit1.prototype.updateTag=function($J,$1H,$1I,$1J,$1K){for(var $1A in $1H){var $1L=$1H[$1A];if($1A=="innerHTML"){if($1L==undefined)$J.innerHTML="";else $J.innerHTML=$1L;}else{if($1L==undefined)$J.removeAttribute($1A);else $J.setAttribute($1A,$1L);}};if($1I)this.$1X($J,$1I);if($1J)this.$1X($J,$1J);if($1K)this.$1X($J,$1K);};PXRichTextEdit1.prototype.removeChildren=function($J){while($J.childNodes.length>0){$J.removeChild($J.childNodes[0]);}};PXRichTextEdit1.prototype.getAnyProp=function($1M,$1N,$1O){for(var i=0;i<$1N.length;i++){var $1P=$1N[i];var $00=$1M[$1P];if(undefined !=$00){return $00;}};return $1O;};PXRichTextEdit1.prototype.hasNoStyle=function($n){if($n.getAttribute('id')||$n.getAttribute('class')){return false;};for(var i in $n.style){if($n.style.hasOwnProperty(i)&&$n.style[i]!=""){if(i=="parentRule"){continue;};return false;}};return true;};PXRichTextEdit1.prototype.textBeforeCursor=function($H,$M){var $1Q=this.makeUniqueKey('cursor',$H.body.textContent);var $1A=$H.createTextNode($1Q);$M.insertNode($1A);var $1p=$H.body.textContent;this.deleteNode($1A);return $1p.substring(0,$1p.indexOf($1Q));};PXRichTextEdit1.prototype.endsWithSpace=function($1R){if($1R.length){var c=$1R[$1R.length-1];return c==' '||c=='\u00a0';}};PXRichTextEdit1.prototype.chopOffBr=function($n){if($n.nodeName.toLowerCase()=="p"&&$n.childNodes.length&&$n.childNodes[$n.childNodes.length-1].nodeName.toLowerCase()=="br"){this.deleteNode($n.childNodes[$n.childNodes.length-1]);}else if($n.nodeName.toLowerCase()=="p"&&$n.childNodes.length&&$n.childNodes[0].nodeName.toLowerCase()=="br"){this.deleteNode($n.childNodes[0]);}};PXRichTextEdit1.prototype.noText=function($n){if(!$n)return true;return this.replace($n.textContent,['\u200b',''])==""&&!$n.querySelector('img');};PXRichTextEdit1.prototype.prepareForEdit=function($1S){{var $H=this.getEditDoc();var $1T=$H.createElement('iframe');var $0n=$1T.contentDocument;var $1U=$0n.body;$1U.innerHTML=$1S;var $1V=$1U.querySelectorAll('.rtetable > tbody > tr > td, .rtetable > tr > td');for(var i=0;i<$1V.length;i++){var $1W=$1V[i];if($1W.childNodes.count==1&&$1W.innerHTML=="&nbsp;"){if(__px(this).IsIE||__px(this).IsIE11){$1W.removeChild($1W.firstChild);}else{$1W.removeChild($1W.firstChild);$1W.appendChild($H.createElement('br'));}}};return $1U.innerHTML;}};PXRichTextEdit1.prototype.prepareForSave=function($W){var $H=this.getEditDoc();var $1T=$H.createElement('iframe');var $0n=$1T.contentDocument;var $1U=$0n.body;$1U.innerHTML=$1S;var $1V=$1U.querySelectorAll('.rtetable > tbody > tr > td, .rtetable > tr > td');for(var i=0;i<$1V.length;i++){var $1W=$1V[i];if(!__px(this).IsIE&&!__px(this).IsIE11){if($1W.lastChild.nodeName.toLowerCase()=='br'){$1W.removeChild($1W.lastChild);}};if(!$1W.childNodes.length){$1W.innerHTML="&nbsp;";}};return $1U.innerHTML;};PXRichTextEdit1.prototype.nameIs=function($n,name){return $n&&$n.nodeName.toLowerCase()==name.toLowerCase();};PXRichTextEdit1.prototype.hasAnyContent=function($n){if(!$n)return true;return $n.textContent.length||$n.querySelector('img, br');};PXRichTextEdit1.prototype.hasVisibleContent=function($n){if(!$n)return true;return this.replace($n.textContent,['\u200b','']).length||($n.querySelector&&$n.querySelector('img, br'));};PXRichTextEdit1.prototype.hasMoreVisibleContent=function($n){if(!$n)return true;var $1o=this.replace($n.textContent,['\u200b','']).length;if($n.querySelectorAll){$1o+=$n.querySelectorAll('img, br').length;};return $1o>1;};PXRichTextEdit1.prototype.nodeLen=function($n){if(!$n)return 0;if($n.nodeType==document.ELEMENT_NODE)return $n.childNodes.length;return($n['textContent']!=undefined)?$n.textContent.length:$n.text.length;};


PXRichTextEdit1.prototype.getFirstSelected=function(){var $a=this.elemIFrame.contentWindow.getSelection();if($a.rangeCount){var $b=$a.getRangeAt(0);return $b.startContainer;}};PXRichTextEdit1.prototype.getLayoutRow=function(){var $c=this.getFirstSelected();return this.getParentWithAttribute($c,'class','layout',10);};PXRichTextEdit1.prototype.getCurrentCellIndex=function(){var $c=this.getFirstSelected();if($c){var td=this.findParentNode('TD',$c);if(td){return this.getSiblingIndex(td);}}};PXRichTextEdit1.prototype.focusAtCell=function($d,$e){var $f=$d.querySelector('tr');for(var i=0;i<$f.childNodes.length;i++){if($f.childNodes[i].tagName=='TD'){if(!$e){this.focusInsideTag($f.childNodes[i]);};$e--;}}};PXRichTextEdit1.prototype.childByNameAndIndexOrLast=function($f,$g,$h){var $i=$f.children;var $e=-1;var $j=undefined;for(var i=0;i<$i.length;i++){if($i[i].nodeName==$g){$j=$i[i];$e++;};if($e==$h){return $i[i];}};return $j;};PXRichTextEdit1.prototype.arrangeLayout=function($k){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $c=this.getLayoutRow();if($c){$c=$c.querySelector('tr');};if($c){var $l=this.getCurrentCellIndex();var $m=$k.substr(6);var $n=[];var $o=[];for(var i=0;i<Math.max($m.length,$c.childNodes.length);i++){if(i<$m.length&&i<$c.childNodes.length){var $p=$c.childNodes[i];$p.setAttribute('class','rtecell'+($m[i]=='N'?' rteside':''));}else if(i<$m.length){var $q=this.getEditDoc();var $r=$q.createElement('td');$r.setAttribute('class','rtecell'+($m[i]=='N'?' rteside':''));$r.innerHTML="&nbsp;";$c.appendChild($r);}else{var $p=$c.childNodes[i];$o.push($p);for(var j=0;j<$p.childNodes.length;j++){$n.push($p.childNodes[j]);}}};var $j=$c.childNodes[$m.length-1];for(var i=0;i<$n.length;i++){$j.appendChild($n[i]);};for(var i=0;i<$o.length;i++){$o[i].parentNode.removeChild($o[i]);};this.tryUpdateState();var $s=this.childByNameAndIndexOrLast($c,'TD',$l);this.focusInsideTag($s);this.syncButtons(true);}};PXRichTextEdit1.prototype.getLayoutRows=function($c){var $i=[];var $t=this.getEditDoc().querySelectorAll('table.layout');for(var i=0;i<$t.length;i++){$i.push($t[i]);};return $i;};PXRichTextEdit1.prototype.moveUp=function(){this.focusToEdit2();var $c=this.getLayoutRow();var $u=this.getCurrentCellIndex();if($c){this.saveUndoStepBeforeEmbedding();var $i=this.getLayoutRows($c.parentNode);var $v=$i.indexOf($c);var $w=$v-1;if($w>=0){this.getEditDoc().body.insertBefore($c,$i[$w]);};this.focusAtCell($c,$u);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.moveDown=function(){this.focusToEdit2();var $c=this.getLayoutRow();var $u=this.getCurrentCellIndex();if($c){this.saveUndoStepBeforeEmbedding();var $i=this.getLayoutRows($c.parentNode);var $v=$i.indexOf($c);var $w=$v+2;$c.parentNode.insertBefore($c,$i[$w]);this.focusAtCell($c,$u);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.topLevelParent=function($q,$x){if($q.body){for(var i=0;i<$q.body.childNodes.length;i++){var $p=$q.body.childNodes[i];if($p&&$p.contains&&$p.contains($x)){return $q.body.childNodes[i];}}}};PXRichTextEdit1.prototype.addSection=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $q=this.getEditDoc();var $r=$q.createElement('table');this.msieUnselectable($r);this.assignAttributes($r,{'class':'layout'});var $b=this.range();var $y=$q.createTextNode('\u200b');if($b){var $z=this.topLevelParent($q,$b.endContainer);if($z){if($z.nextSibling){$z.parentNode.insertBefore($y,$z.nextSibling);$z.parentNode.insertBefore($r,$z.nextSibling);}else{$q.body.appendChild($r);$q.body.appendChild($y);}}else{var $A=($q.body.childNodes.length>$b.startOffset)?$q.body.childNodes[$b.startOffset].nextSibling:undefined;if($A){$q.body.insertBefore($y,$A);$q.body.insertBefore($r,$A);}else{$q.body.appendChild($r);$q.body.appendChild($y);}};var tr=this.embedTag($r,'tr',{});var $B=this.embedTag(tr,'td',{'class':'rtecell'});$B.innerHTML="&nbsp;&nbsp;&nbsp;";this.syncSpaces($q);this.focusInsideTag($B);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.removeSection=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $c=this.getLayoutRow();if($c){this.saveUndoStepBeforeEmbedding();$c.parentNode.removeChild($c);this.tryUpdateState();this.syncButtons(true);}};


PXRichTextEdit1.prototype.createTable=function(){this.createTableDlg.show();};PXRichTextEdit1.prototype.createCell=function($a){var $b=$a.createElement('td');if(!__px(this).IsIE&&!__px(this).IsIE11){$b.appendChild($a.createElement('br'));};return $b;};PXRichTextEdit1.prototype.tableSpecified=function(){var $c=this.createTableDlg.getCols();var $d=this.createTableDlg.getRows();if($c>0&&$d>0){this.tableSizeSelected(undefined,{'width':$c,'height':$d});this.createTableDlg.hide();}};PXRichTextEdit1.prototype.getParent2=function($e){var $f=this.getEditDoc().getSelection();if($f.rangeCount>0){var parent=$f.getRangeAt(0).commonAncestorContainer;while(parent&&parent.tagName!=$e)parent=parent.parentNode;return parent;}};PXRichTextEdit1.prototype.childArray=function($g){var $h=[];for(var i=0;i<$g.children.length;i++){$h.push($g.children[i]);};return $h;};PXRichTextEdit1.prototype.getColIndex=function(){var td=this.getParent2('TD');if(td){return this.childArray(td.parentNode).indexOf(td);}};PXRichTextEdit1.prototype.getRowIndex=function(){var tr=this.getParent2('TR');if(tr){return this.childArray(tr.parentNode).indexOf(tr);}};PXRichTextEdit1.prototype.createRow=function($i){var $j=$i.querySelectorAll('td').length;var $a=this.getEditDoc();var $k=$a.createElement('tr');for(var i=0;i<$j;i++){$k.appendChild(this.createCell($a));};return $k;};PXRichTextEdit1.prototype.addRowBefore=function(){this.focusToEdit2();var $i=this.getParent2('TR');if($i){this.saveUndoStepBeforeEmbedding();var $d=this.childArray($i.parentNode);var $k=this.createRow($i);$i.parentNode.insertBefore($k,$i);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.addRowAfter=function(){this.focusToEdit2();var $i=this.getParent2('TR');if($i){this.saveUndoStepBeforeEmbedding();var $d=this.childArray($i.parentNode);var $k=this.createRow($i);var $l=$d.indexOf($i);if($l==$d.length-1){$i.parentNode.appendChild($k);}else{$i.parentNode.insertBefore($k,$d[$l+1]);};this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.addCell=function($i,$m){var $n=this.childArray($i);var $a=this.getEditDoc();var $o=this.createCell($a);if($n.length<=$m){$i.appendChild($o);}else{$i.insertBefore($o,$n[$m]);};this.tryUpdateState();this.syncButtons(true);};PXRichTextEdit1.prototype.addColBefore=function(){this.focusToEdit2();var $p=this.getColIndex();var $q=this.getParent2('TR');if($q&&$p!=undefined){this.saveUndoStepBeforeEmbedding();for(var i=0;i<$q.parentNode.childNodes.length;i++){var $i=$q.parentNode.childNodes[i];this.addCell($i,$p);};this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.addColAfter=function(){this.focusToEdit2();var $p=this.getColIndex();var $q=this.getParent2('TR');if($q&&$p!=undefined){this.saveUndoStepBeforeEmbedding();for(var i=0;i<$q.parentNode.childNodes.length;i++){var $i=$q.parentNode.childNodes[i];this.addCell($i,$p+1);};this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.cleanUpTable=function($r){if(!$r.querySelectorAll("td").length){$r.parentNode.removeChild($r);}};PXRichTextEdit1.prototype.countTags=function($s,$e){var $t=0;for(var i=0;i<$s.length;i++){if($s[i].nodeName==$e){$t++;}};return $t;};PXRichTextEdit1.prototype.getRowsCount=function(){var $r=this.getParent2('TABLE');if($r){$r=this.tbody($r);return this.countTags($r.childNodes,'TR');}};PXRichTextEdit1.prototype.getColsCount=function(){var tr=this.getParent2('TR');if(tr){return this.countTags(tr.childNodes,'TD');}};PXRichTextEdit1.prototype.tbody=function($r){if($r.childNodes.length&&$r.childNodes[0].nodeName=='TBODY'){return $r.childNodes[0];};return $r;};PXRichTextEdit1.prototype.focusOnCell=function($r,x,y){if((x==undefined)||(y==undefined)){return;};$r=this.tbody($r);for(var i=0;i<$r.childNodes.length;i++){var $i=$r.childNodes[i];if($i.nodeName=='TR'){if(!y){for(var j=0;j<$i.childNodes.length;j++){var $u=$i.childNodes[j];if($u.nodeName=='TD'){if(!x){this.focusInsideTag($u);this.scrollIntoView(this.getEditDoc(),$u);break;};x--;}};break;};y--;}}};PXRichTextEdit1.prototype.delRow=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var x=this.getColIndex();var y=this.getRowIndex();var $v=this.getRowsCount();var $w=this.getColsCount();var tr=this.getParent2("TR");var $r=this.getParent2("TABLE");if(tr){tr.parentNode.removeChild(tr);this.cleanUpTable($r);var $x=this.clamp(0,x,$w-1);var $y=this.clamp(0,y,$v-2);this.focusOnCell($r,$x,$y);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.delCol=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $p=this.getColIndex();var y=this.getRowIndex();var $v=this.getRowsCount();var $w=this.getColsCount();var $r=this.getParent2("TABLE");if($p!=undefined){var tr=this.getParent2("TR");if(tr){var $d=tr.parentNode.childNodes;for(var i=0;i<$d.length;i++){var $i=$d[i];if($i.tagName=="TR"){var $b=this.childArray($i)[$p];$b.parentNode.removeChild($b);}}};this.cleanUpTable($r);var $x=this.clamp(0,$p,$w-2);var $y=this.clamp(0,y,$v-1);this.focusOnCell($r,$x,$y);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.delTable=function(){this.focusToEdit2();var $r=this.getParent2("TABLE");if($r){this.saveUndoStepBeforeEmbedding();$r.parentNode.removeChild($r);this.tryUpdateState();this.syncButtons(true);}};PXRichTextEdit1.prototype.tableSizeSelected=function($z,$A){this.focusToEdit2();var $a=this.getEditDoc();var $r=$a.createElement('table');this.msieUnselectable($r);$r.setAttribute('class','rtetable');for(var i=0;i<$A.height;i++){var $i=$a.createElement('tr');for(var j=0;j<$A.width;j++){var $b=this.createCell($a);$i.appendChild($b);};$r.appendChild($i);};this.saveUndoStepBeforeEmbedding();this.insertNodeAtSelection($r);this.surroundBySpace($r,true);this.syncSpaces($a);this.focusAfterTag($r);this.tryUpdateState();__px_cm(this).notifyOnResize();};


PXRichTextEdit1.prototype.updateMainToolbar=function(){var $a=__px_all(this)[this.mainToolbar.id].items;var $b=Function.createDelegate(this,this.mainMenuClick);var $c=function($d,$e){for(var i=$d;i<$a.length;i++){var $f=$a[i];if($f.setEnabled){if($f.setPushed&&$f.key!='textPaste'){$f.setPushed(false);};$f.setEnabled($e);}}};if(this.isPreview){$c(1,false);this.textType.setEnabled(false);}else{switch(this.editorMode){case "source":$c(1,false);this.textType.setEnabled(false);break;case "edit":$c(1,true);this.textType.setEnabled(true);break;case "plain":$c(3,false);$a[2].setEnabled(false);$a[3].setEnabled(false);this.textType.setEnabled(false);break;}}};PXRichTextEdit1.prototype.replace=function($g,$h){var $i=$g;for(var i=0;i<$h.length;i+=2){$i=$i.replace(RegExp($h[i],'g'),$h[i+1]);};return $i;};PXRichTextEdit1.prototype.htmlEncode=function($g){return this.replace($g,["<","&lt;",">","&gt;","<","&lt;"]);};PXRichTextEdit1.prototype.htmlDecode=function($g){return this.replace($g,["&lt;","<","&gt;",">","&lt;","<"]);};PXRichTextEdit1.prototype.disablePreview=function(){if(this.imageHandlers)while(this.imageHandlers.length){var $j=this.imageHandlers.pop();$j.image.removeEventListener("click",$j.handler);};this.viewParent.style.display="none";this.isPreview=false;var $k=this.getEditDoc();if($k.body){$k.body.contentEditable=true;$k.body.focus();};if(__px(this).IsFirefox){this.initWYSIWYG(this.content);};if(__px(this).IsIE||__px(this).IsIE11){this.restoreIESelection();}};PXRichTextEdit1.prototype.sourceMode=function($l){if(!this.sourceFrame){return;};if(this.editorMode!="source"||this.isPreview){var $k=this.getEditDoc();var $m=$k.body;this.sf("source mode 1 ");this.elemIFrame.parentElement.style.display="none";if(!this.sourceFrame.contentDocument.body.contains(this.sourceText)){this.createTextArea();};this.sourceText.value=$m.innerHTML;this.sourceFrame.style.display="";this.sourceText.style.display="";this.sf("source mode 2 ");this.editorMode="source";if(this.isPreview){this.disablePreview();};this.htmlControlText.textContent=this.modeName($l||'source');px_cm.performAutoSize(this);this.updateMainToolbar();}};PXRichTextEdit1.prototype.editMode=function($l){if(this.editorMode!="edit"||this.isPreview){if(this.editorMode=="source"){this.mustFocus=true;var $k=this.getEditDoc();var $m=$k.body;$m.innerHTML=this.sourceText.value;this.elemIFrame.parentElement.style.display="";this.sourceFrame.style.display="none";};if(this.isPreview){this.disablePreview();this.elemIFrame.parentElement.style.display="";};this.editorMode="edit";this.htmlControlText.textContent=this.modeName($l||'html');this.updateMainToolbar();this.setEditConfig();}};PXRichTextEdit1.prototype.plainMode=function($l){if(this.editorMode!="plain"||this.isPreview){if(this.editorMode=="edit"||this.editorMode=="source"){if(confirm(this.loseFormatting)){if(this.editorMode=="edit"&&this.undoStateUnsaved()){this.saveUndoStep();};this.mustFocus=true;var $k=this.getEditDoc();var $m=$k.body;if(this.editorMode=="source"){$m.innerHTML=this.sourceText.value;this.elemIFrame.parentElement.style.display="";this.sourceFrame.style.display="none";};this.stripBody($k);this.initWYSIWYG($k.head.innerHTML+$k.body.innerHTML);this.editorMode="plain";this.tryUpdateState();this.htmlControlText.textContent=this.modeName($l||'plain');if(this.isPreview){this.disablePreview();this.elemIFrame.parentElement.style.display="";};this.updateMainToolbar();}}else if(this.editorMode=="plain"){this.editorMode="plain";this.htmlControlText.textContent=this.modeName($l||'plain');;if(this.isPreview){this.disablePreview();};this.elemIFrame.parentElement.style.display="";}}};PXRichTextEdit1.prototype.previewLoaded=function(){if(this.isPreview){if(this.viewFrame&&this.elemIFrame&&this.viewParent&&this.elemIFrame.parentElement){this.viewParent.style.display="";var $k=this.viewFrame.contentDocument;if($k&&$k.body)$k.body.className=$k.body.className+" preview";this.elemIFrame.parentElement.style.display="none";if(this.viewFrame.contentWindow){this.viewFrame.contentWindow.onkeydown=function(e){if(e.keyCode==8)return false;};}};if(this.sourceFrame){this.sourceFrame.style.display="none";}}};PXRichTextEdit1.prototype.recreatePreviewFrame=function(){var pt=__px(this);if(pt&&(pt.IsEdge||pt.IsAnyIE))return;var $k=this.getEditDoc();var $n=this.viewParent;var $o=$k.createElement('iframe');$o.id=this.viewId;$o.src="about:blank";$o.setAttribute('style',this.viewStyle.cssText);$o.setAttribute('frameborder',"0");$o.addEventListener("load",Function.createDelegate(this,this.previewLoaded));this.viewParent.replaceChild($o,this.viewFrame);this.viewFrame=$o;};PXRichTextEdit1.prototype.previewMode=function($p,$l){var $k=this.getEditDoc();var $m=$k.body;if($p||!this.isPreview){if(this.editorMode=="source"){$m.innerHTML=this.sourceText.value;this.setEditConfig();this.sourceFrame.style.display="none";this.editorMode="edit";};this.recreatePreviewFrame();this.viewParent.style.display="";this.elemIFrame.parentElement.style.display="none";this.isPreview=true;$m.setAttribute('contenteditable',false);var $q=$k.head.outerHTML+this.replace($m.outerHTML,['\u200b','']);$m.setAttribute('contenteditable',true);if(!this.forbidRefreshing){if(this.previewCacheKey!=$k.body.innerHTML){this.previewCacheKey=$k.body.innerHTML;__px_callback(this).execI(this,this.showPreviewCmd,this.escapeCdata($q),this.previewHandler);}else{if(this.previewCacheValue){this.previewReady(this.previewCacheValue);}}}};this.isPreview=true;this.updateMainToolbar();this.htmlControlText.textContent=this.modeName('preview');$k.body.contentEditable=false;};PXRichTextEdit1.prototype.addPreviewHandlers=function(){this.closeImgAlt="Close";var $r=this.viewFrame.contentDocument.querySelectorAll('[data-clickable]');var $s,$t=__px(this).topWin();if($t){var $u=$t.PXPopupImage;$s=new $u(this,this.spinnerUrl,this.closeUrl);}else $s=new PXPopupImage(this,this.spinnerUrl,this.closeUrl);this.imageHandlers=[];var $v=function($w,$x){var $y=$x.getAttribute('src');var $z=function(){$s.setParameters($x,false,false,false);$s.allowNavigation=false;$s.showImage($y);};$w.push({'image':$x,'handler':$z});return $z;};for(var i=0;i<$r.length;i++){$r[i].addEventListener("click",$v(this.imageHandlers,$r[i]));};var $A=this.viewFrame.contentDocument.links;for(var i=0;i<$A.length;i++){if($A[i].className!="noextwnd"){$A[i].onclick=function(e){window.open(this.href,"_blank","toolbar=1,location=1,menubar=1");return false;};}}};PXRichTextEdit1.prototype.modeName=function($l){var $B=this.mainToolbarControl.items.filter(function(a){return a.key=="html"}).shift();var $C;if($B&&($C=$B.getMenu())){var $D=$C.items.items.filter(function(b){return $l==b.commandName}).shift();if($D)return $D.element.textContent.trim();};return $l;};


PXRichTextEdit1.prototype.stateChanged=function(){this.unsavedState=true;this.undoState.undoStack.splice(this.undoState.undoPos+1);};PXRichTextEdit1.prototype.getNodeIndices=function($a,$b){$b.index+=1;for(var i=0;i<$b.nodes.length;i++){var $c=$b.nodes[i];if($c==$a){$b.indices[$c]=$b.index;}};for(var j=0;j<$a.childNodes.length;j++){this.getNodeIndices($a.childNodes[j],$b);}};PXRichTextEdit1.prototype.getNodesByIndices=function($a,$b){$b.index+=1;for(var i=0;i<$b.indices.length;i++){var $d=$b.indices[i];if($d==$b.index){$b.nodes[$d]=$a;}};for(var j=0;j<$a.childNodes.length;j++){this.getNodesByIndices($a.childNodes[j],$b);}};PXRichTextEdit1.prototype.getSelectionNodesIndices=function($e,$f,$g){var $b={'index':0,'nodes':[$f,$g],'indices':{}};this.getNodeIndices($e,$b);return{'start':$b.indices[$f],'end':$b.indices[$g]};};PXRichTextEdit1.prototype.getSelectionNodesByIndices=function($e,$h,$i){var $b={'index':0,'indices':[$h,$i],'nodes':{}};this.getNodesByIndices($e,$b);return{'start':$b.nodes[$h],'end':$b.nodes[$i]};};PXRichTextEdit1.prototype.saveUndoStepBeforeEmbedding=function(){this.wasEmbedded=true;this.saveUndoStep();this.stateChanged();};PXRichTextEdit1.prototype.undoStateUnsaved=function(){return this.wasEmbedded||this.unsavedState;};PXRichTextEdit1.prototype.saveUndoStepBeforeKeypress=function(){if(this.wasEmbedded){this.wasEmbedded=undefined;this.saveUndoStep();}};PXRichTextEdit1.prototype.selection2obj=function($e){if($e){var $j=$e.getSelection();if($j&&$j.rangeCount){var $k=$j.getRangeAt(0);return{'startNode':$k.startContainer,'startOffs':$k.startOffset,'endNode':$k.endContainer,'endOffs':$k.endOffset};}}};PXRichTextEdit1.prototype.obj2selection=function($e,$l){if($e&&$l){var $k=$e.createRange();$k.setStart($l.startNode,$l.startOffs);$k.setEnd($l.endNode,$l.endOffs);this.setRange($k);}};PXRichTextEdit1.prototype.realNormalize=function($e){if($e){var $m=$e.body;if($m){$m.normalize();var $n=this.selection2obj($e);var $o=$m.querySelectorAll('table');for(var i=0;i<$o.length;i++){var $p=$o[i];var $q=$p.childNodes;if($q.length&&$q[0].nodeName!='TBODY'){var $r=$e.createElement('tbody');while($q.length){$r.appendChild($q[0]);};$p.appendChild($r);if($n){if($n.startNode==$p){$n.startNode=$r;};if($n.endNode==$p){$n.endNode=$r;}}}};this.obj2selection($e,$n);}}};PXRichTextEdit1.prototype.saveUndoStep1=function(){var $e=this.getEditDoc();var $s=undefined;this.realNormalize($e);var $n=$e.getSelection();if($n&&$n.rangeCount){var $t=$n.getRangeAt(0);var $u=this.getSelectionNodesIndices($e,$t.startContainer,$t.endContainer);if($u.start&&$u.end){$s={'startContainer':$u.start,'endContainer':$u.end,'startOffset':$t.startOffset,'endOffset':$t.endOffset};}};var $m=$e.body;var $v={'content':$m?$m.innerHTML:'','selection':$s};this.undoState.undoStack.splice(this.undoState.undoPos+1);this.undoState.undoStack.push($v);this.undoState.undoPos+=1;this.unsavedState=false;};PXRichTextEdit1.prototype.saveUndoStep=function($w){var $e=this.getEditDoc();var $s=undefined;var $x=this.insertMarkers($e);var $m=$e.body;if($x){$s={'start':$x.startText,'end':$x.endText,'startType':$x.startType,'endType':$x.endType};};var $v={'content':$m?$m.innerHTML:'','selection':$s,'action':$w};if($w&&this.undoState.undoPos>0&&this.undoState.undoStack[this.undoState.undoPos].action==$w){}else{this.undoState.undoStack.splice(this.undoState.undoPos+1);this.undoState.undoStack.push($v);this.undoState.undoPos+=1;this.unsavedState=false;};if($x){this.removeMarkers($e,$x.startMarker,$x.startType,$x.endMarker,$x.endType);}};PXRichTextEdit1.prototype.restoreState=function($y){var $e=this.getEditDoc();$e.body.innerHTML=$y.content;this.setEditConfig();if($y.selection){var $n=$e.getSelection();var $t=$e.createRange();var $x=this.findMarkers($e,$y.selection.start,$y.selection.end);if($x){this.removeMarkers($e,$x.start,$y.selection.startType,$x.end,$y.selection.endType);}};this.viewState.update("Value",this.escapeCdata($e.body.innerHTML));this.content=$e.body.innerHTML;};PXRichTextEdit1.prototype.getAllComments=function($e,$z){var $A=[];var $B=$e.createTreeWalker($e,NodeFilter.SHOW_COMMENT,function($a){var $C=$a.textContent;if($z.indexOf($C)>-1)return NodeFilter.FILTER_ACCEPT;return NodeFilter.FILTER_REJECT;},false);var $a=undefined;while($a=$B.nextNode()){$A.push($a);};return $A;};PXRichTextEdit1.prototype.insertNodeAt=function(parent,$a,$d){if(parent.childNodes.length>$d){parent.insertBefore($a,parent.childNodes[$d]);}else{parent.appendChild($a);}};PXRichTextEdit1.prototype.textNodeConstructors={3:'createTextNode',4:'createCDATASection',8:'createComment'};PXRichTextEdit1.prototype.shiftMarkersOutside=function($e,$x){if(!$x.endMarker){var $D=$e.createComment($x.endText);this.insertAfter($D,$x.startMarker);$x.endMarker=$D;$x.exStartType=$x.startType;$x.endType='start';$x.startType='end';var $k=$e.createRange();$k.setStartAfter($x.startMarker);$k.setEndBefore($x.endMarker);this.restoreRange($k);};return $x;};PXRichTextEdit1.prototype.unshiftMarkersOutside=function($e,$x){if($x.startMarker.nextSibling==$x.endMarker){this.deleteNode($x.endMarker);$x.startType=$x.exStartType;$x.endMarker=undefined;};return $x;};PXRichTextEdit1.prototype.assertMarkers=function($E){};PXRichTextEdit1.prototype.makeUniqueKey=function($c,$C){while($C.indexOf($c)>-1){$c+=String.fromCharCode(93*Math.random()+33);};return $c;};PXRichTextEdit1.prototype.renameMarkers=function($e,$x){if($x.startMarker){var $F=this.makeUniqueKey($x.startText+'1',$e.body.innerHTML);$x.startMarker.textContent=$F;$x.startText=$F;};if($x.endMarker){var $F=this.makeUniqueKey($x.endText+'1',$e.body.innerHTML);$x.endMarker.textContent=$F;$x.endText=$F;}};PXRichTextEdit1.prototype.insertMarkers=function($e){var $G="Start marker42";var $H="End marker42";var $I=function($J,end){var r1=$e.createRange();if($J==end){r1.setStart($J.parentNode,this.nodeIndex($J));r1.setEnd($J.parentNode,this.nodeIndex($J));}else{r1.setStart($J.parentNode,this.nodeIndex($J));r1.setEnd(end.parentNode,this.nodeIndex(end)+1);};this.restoreRange(r1);};var $K=function($e,$a,$L,$c){var $M=$e.createComment($c);var $N=this.textNodeConstructors[$a.nodeType];if($N){var constructor=$e[this.textNodeConstructors[$a.nodeType]];var $O=$a.textContent.substring(0,$L);var $P=$a.textContent.substring($L);var $Q=constructor.call($e,$O);var $R=constructor.call($e,$P);if($L){$a.parentNode.insertBefore($Q,$a);};$a.parentNode.insertBefore($M,$a);if($P.length){$a.parentNode.insertBefore($R,$a);};if($a.textContent.length){$a.parentNode.removeChild($a);}}else{this.insertNodeAt($a,$M,$L);};var $S=undefined;if($N){if(!$L){$S="start";}else if($L==$a.textContent.length){$S="end";}else{$S="split";}}else{$S="node";};return{'node':$M,'type':$S};};var $j=$e.getSelection();if($e.body&&$j&&$j.rangeCount){var $T=$e.body.innerHTML;$G=this.makeUniqueKey($G,$T);$H=this.makeUniqueKey($H,$T);var $t=$j.getRangeAt(0);if($t.startContainer.nodeName.toLowerCase()=='br'){$t.setStart($t.startContainer.parentNode,this.nodeIndex($t.startContainer)+1);};if($t.endContainer.nodeName.toLowerCase()=='br'){$t.setEndt($t.endContainer.parentNode,this.nodeIndex($t.endContainer)+1);};if($t.startContainer!=$t.endContainer){if($t.compareBoundaryPoints(Range.START_TO_END,$t)){var $U=$t.startContainer;var $V=$t.startOffset;var $D=$K.call(this,$e,$t.endContainer,$t.endOffset,$H);var $W=$K.call(this,$e,$U,$V,$G);$I.call(this,$W.node,$D.node);return{'startMarker':$W.node,'endMarker':$D.node,'startText':$G,'endText':$H,'startType':$W.type,'endType':$D.type};}else{var $X=$t.endContainer;var $Y=$t.endOffset;var $W=$K.call(this,$e,$t.startContainer,$t.startOffset,$G);var $D=$K.call(this,$e,$X,$Y,$H);$I.call(this,$W.node,$D.node);return{'startMarker':$W.node,'endMarker':$D.node,'startText':$G,'endText':$H,'startType':$W.type,'endType':$D.type};}}else if($t.startOffset==$t.endOffset){var $W=$K.call(this,$e,$t.startContainer,$t.startOffset,$G);$I.call(this,$W.node,$W.node);return{'startMarker':$W.node,'startText':$G,'startType':$W.type,'endText':$H};}else{var $Z=$t.startContainer;var $00=$e.createComment($G);var $01=$e.createComment($H);var $N=this.textNodeConstructors[$t.startContainer.nodeType];var $02=undefined;var $03=undefined;if($N){var $04=Math.min($t.startOffset,$t.endOffset);var $05=Math.max($t.startOffset,$t.endOffset);var constructor=$e[this.textNodeConstructors[$Z.nodeType]];var $O=$Z.textContent.substring(0,$04);var $06=$Z.textContent.substring($04,$05);var $P=$Z.textContent.substring($05);var $Q=constructor.call($e,$O);var $R=constructor.call($e,$06);var $07=constructor.call($e,$P);var $08=undefined;if($O.length){$Z.parentNode.insertBefore($Q,$Z);$08="split";}else{$08="start";};if($t.startOffset<=$t.endOffset){$Z.parentNode.insertBefore($00,$Z);$02=$08;}else{$Z.parentNode.insertBefore($01,$Z);$03=$08;};$Z.parentNode.insertBefore($R,$Z);$Z.parentNode.insertBefore($t.startOffset<$t.endOffset?$01:$00,$Z);if($P.length){$Z.parentNode.insertBefore($07,$Z);if($t.startOffset<$t.endOffset){$03="split";}else{$02="split";}}else{if($t.startOffset<$t.endOffset){$03="end";}else{$02="end";}};$Z.parentNode.removeChild($Z);}else{if($t.startOffset<$t.endOffset){this.insertNodeAt($Z,$01,$t.endOffset);this.insertNodeAt($Z,$00,$t.startOffset);}else{this.insertNodeAt($Z,$00,$t.startOffset);this.insertNodeAt($Z,$01,$t.endOffset);};$02="node";$03="node";};$I.call(this,$00,$01);return{'startMarker':$00,'endMarker':$01,'startText':$G,'endText':$H,'startType':$02,'endType':$03};}}};PXRichTextEdit1.prototype.findMarkers=function($e,$G,$H){var $09=[$G];if($H)$09.push($H);var $A=this.getAllComments($e,$09);var $W,$D;for(var i=0;i<$A.length;i++){if($A[i].textContent==$G){$W=$A[i];};if($H&&$A[i].textContent==$H){$D=$A[i];};if($W&&$D){break;}};if($W){return{'start':$W,'end':$D};}};PXRichTextEdit1.prototype.removeMarkers=function($e,$J,$02,end,$03){var $0a=function($e,$0b,$0c){if(!$0b)return;if($0c=="split"){var $a=$0b.previousSibling;var $0d=$a.textContent.length;$a.textContent+=$0b.nextSibling.textContent;this.deleteNode($0b.nextSibling);this.deleteNode($0b);return{'node':$a,'offset':$0d};}else if($0c=="start"){var $a=$0b.nextSibling?$0b.nextSibling:$0b.parentNode;this.deleteNode($0b);if(typeof($a)=="undefined")return;return{'node':$a,'offset':0};}else if($0c=="end"){var $a=$0b.previousSibling?$0b.previousSibling:$0b.parentNode;this.deleteNode($0b);if(typeof($a)=="undefined")return;return{'node':$a,'offset':$a.textContent.length};}else{var $0d=this.nodeIndex($0b);var $0e=$0b.parentNode;this.deleteNode($0b);if(typeof($0e)=="undefined")return;return{'node':$0e,'offset':$0d};}};var $0f=$0a.call(this,$e,$J,$02);var $0g=$0a.call(this,$e,end,$03);if($0f){var $t=$e.createRange();$t.setStart($0f.node,$0f.offset);if($0g){$t.setEnd($0g.node,$0g.offset);}else{$t.setEnd($0f.node,$0f.offset);};this.setRange($t);};this.assertMarkers("PXRichTextEdit1.prototype.removeMarkers");};PXRichTextEdit1.prototype.undo=function(){this.focusToEdit2();if(this.unsavedState){this.saveUndoStep();};if(this.undoState.undoPos>0){var $v=this.undoState.undoStack[--this.undoState.undoPos];this.restoreState($v);this.unsavedState=false;this.syncButtons();}};PXRichTextEdit1.prototype.initUndo=function($c){this.undoState=new Object();this.undoState.undoStack=[];this.undoState.undoPos=-1;this.undoState.key=$c;this.localizedUndo={};this.localizedChanges={};};PXRichTextEdit1.prototype.saveLocalizedUndo=function($0h){this.saveUndoStep();this.localizedUndo[$0h]=this.undoState;};PXRichTextEdit1.prototype.restoreLocalizedUndo=function($0h){if(this.localizedUndo[$0h]){this.undoState=this.localizedUndo[$0h];this.undo();return true;}};PXRichTextEdit1.prototype.redo=function($0i){this.focusToEdit2();if(this.undoState.undoPos<this.undoState.undoStack.length-1){var $v=this.undoState.undoStack[++this.undoState.undoPos];this.restoreState($v);this.unsavedState=false;}};PXRichTextEdit1.prototype.getNodesBetweenMarkers=function($e,$J,end,$0j){var $B=$e.createTreeWalker($e,$0j,null,false);var $a=undefined;var $0k=[];while($a=$B.nextNode()){var $0l=$J.compareDocumentPosition($a);var $0m=end.compareDocumentPosition($a);if((($0l&document.DOCUMENT_POSITION_FOLLOWING)&&($0m&document.DOCUMENT_POSITION_PRECEDING))||(($0m&document.DOCUMENT_POSITION_FOLLOWING)&&($0l&document.DOCUMENT_POSITION_PRECEDING))){$0k.push($a);}};return $0k;};


PXRichTextEdit1.prototype.normalizeInline=function($a,$b){var $c=$b;while($c.parentNode&&!this.tagNClass($c.parentNode,'body','html')){if(this.isInline($c.parentNode)){var $d=this.splitParent($a,$c);$d.parentNode.replaceChild($c,$d);};$c=$c.parentNode;}};PXRichTextEdit1.prototype.removeMacro=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.macroProps.macro.parentNode.removeChild(this.macroProps.macro);this.macroProps.hide();this.tryUpdateState();};PXRichTextEdit1.prototype.removeEdMacro=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.edMacroPopup.macro.parentNode.removeChild(this.edMacroPopup.macro);this.edMacroPopup.hide();this.tryUpdateState();};PXRichTextEdit1.prototype.createMacroPlaceholder=function($e,$f,$g,$h){var $a=this.elemIFrame.contentDocument;var $i=$a.createElement("img");this.msieUnselectable($i);$i.setAttribute("data-expand",$e);if($g){$i.setAttribute("width",$g);};if($h){$i.setAttribute("height",$h);};$i.setAttribute("src",$f);$i.setAttribute('class','macro');this.insertNodeAtSelection($i);this.normalizeInline($a,$i);this.syncSpaces($a);this.focusAfterTag($i);this.tryUpdateState();return $i;};PXRichTextEdit1.prototype.createTOC=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.createMacroPlaceholder("toc",this.icons+"toc.svg");};PXRichTextEdit1.prototype.createSubarticles=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.createMacroPlaceholder("sub",this.icons+"sub.svg");};PXRichTextEdit1.prototype.createFileList=function(){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.createMacroPlaceholder("files",this.icons+"files.svg");};PXRichTextEdit1.prototype.insertIframe=function(){if(this.iframePanel){this.iframePanel.oldFrame=undefined;this.iframePanel.showDlg();}};PXRichTextEdit1.prototype.infoimg="info.png";PXRichTextEdit1.prototype.warnimg="warn.png";PXRichTextEdit1.prototype.insertCode=function($j){if(!$j){this.edMacroPopup.macro=undefined;};this.codePanel.showDlg(this.edMacroPopup.macro);};PXRichTextEdit1.prototype.insertFileList=function($j){if(!$j){this.edMacroPopup.macro=undefined;};this.fileListDlg.showDlg(this.edMacroPopup.macro);};PXRichTextEdit1.prototype.editMacro=function(){switch(this.macroType){case "code":this.insertCode(true);break;case "files":this.insertFileList(true);break;}};PXRichTextEdit1.prototype.iframeRemoved=function($k,$l){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();$l.frame.parentNode.removeChild($l.frame);this.tryUpdateState();__px_cm(this).notifyOnResize();};PXRichTextEdit1.prototype.iframeSelected=function($k,$l){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $m=function($n,$o){var $p=$o;try{if(!isNaN(parseInt($n,10))){if(parseInt($n,10)>=$o){$p=$n;}}}catch(ex){};return $p;};var $g=$m($l.width,100);var $h=$m($l.height,100);var getClass=function($q,$r){var $s=$q.getAttribute('class');if($r){$s=__px(this).appendCss($q,["iframeBorder"]);}else{$s=__px(this).excludeCss($q,["iframeBorder"]);};return $s;};if(this.iframePanel.oldFrame){var $s=getClass.call(this,this.iframePanel.oldFrame,$l.border);this.assignAttributes(this.iframePanel.oldFrame,{"data-src":$l.src,"title":$l.src,"class":$s,"width":$g,"height":$h});this.focusAfterTag(this.iframePanel.oldFrame);}else{var $t=this.createMacroPlaceholder("iframe",this.icons+"iframe.svg",$g,$h);var $s=getClass.call(this,$t,$l.border);this.assignAttributes($t,{"data-src":$l.src,"title":$l.src,"class":$s});this.focusAfterTag($t);};this.tryUpdateState();__px_cm(this).notifyOnResize();};PXRichTextEdit1.prototype.codeSelected=function($k,$l){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $a=this.getEditDoc();var $u=this.edMacroPopup.macro||$a.createElement("pre");this.assignAttributes($u,{'class':'source-highlighted',"data-expand":"code","data-lines":$l.lines,"data-firstLine":$l.firstLine,"style":"min-height: 24px",'textContent':$l.code});this.msieUnselectable($u);if(!this.edMacroPopup.macro){this.insertNodeAtSelection($u);};this.syncSpaces($a);this.focusAfterTag($u);this.tryUpdateState();__px_cm(this).notifyOnResize();};PXRichTextEdit1.prototype.insertBox=function($s,$v){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $w=this.elemIFrame.contentWindow.getSelection();if($w.rangeCount){var $x=$w.getRangeAt(0);var $a=this.elemIFrame.contentDocument;var $y=$a.createElement("table");$y.setAttribute("class","GrayBox");$y.setAttribute('contentEditable','false');this.msieUnselectable($y);var tr=this.addChild($y,"tr");var td=this.addChild(tr,"td");var $z=this.addChild(td,"table",{'class':"GrayBoxContent"});this.msieUnselectable($z);var $A=this.addChild($z,"tr");var $B=this.addChild($A,"td",{'class':$s,'contentEditable':'false'});this.msieUnselectable(this.addChild($B,"img",this.addConvertAttr({'src':$v,'contentEditable':'false'},this.iconConvertAttr)));var $C=this.addChild($A,"td",{'class':'boxcontent','contentEditable':'true'});var $C=this.addChild($C,"span",{'textContent':"placeholder"});$y.appendChild(tr);var $D=$y.querySelector('span');var parent=$D.parentNode;parent.replaceChild($x.extractContents(),$D);$x.insertNode($y);this.syncSpaces($a);this.normalizeInline($a,$y);this.focusInsideTag(parent);this.tryUpdateState();}};PXRichTextEdit1.prototype.isInsideCode=function(){var $a=this.getEditDoc();var $w=$a.getSelection();if($w&&$w.rangeCount){var $x=$w.getRangeAt(0);return this.getParentWithAttribute($x.commonAncestorContainer,'class','source-highlighted',100);};return false;};PXRichTextEdit1.prototype.storeCode=function($a){var $u=[];var $E=$a.querySelectorAll('pre.source-highlighted');for(var i=0;i<$E.length;i++){$u.push({'oldCode':$E[i],'newCode':$E[i].cloneNode(true)});};return $u;};PXRichTextEdit1.prototype.restoreCode=function($u){for(var i=0;i<$u.length;i++){if(!$u[i].oldCode.parentNode){return;}};for(i=0;i<$u.length;i++){$u[i].oldCode.parentNode.replaceChild($u[i].newCode,$u[i].oldCode);}};PXRichTextEdit1.prototype.showMacroPopup=function($F){this.macroProps.showDlg($F);var $g=this.getAnyProp($F,['width','offsetWidth'],100);var $h=this.getAnyProp($F,['height','offsetHeight'],50);this.positionPopup(this.macroProps,$F,$g,$h);};PXRichTextEdit1.prototype.showEdMacroPopup=function($F,$G){this.edMacroPopup.showDlg($F);this.macroType=$G;var $g=$F.width?$F.width:100;var $h=$F.offsetHeight?$F.offsetHeight:50;this.positionPopup(this.edMacroPopup,$F,$g,$h);};


PXRichTextEdit1.prototype.inlineCmd2Tag={'bold':'b','italic':'i','strikeThrough':'s','subscript':'sub','superscript':'sup','underline':'u'};PXRichTextEdit1.prototype.colorCmd2Style={'hilitecolor':'backgroundColor','backcolor':'backgroundColor','forecolor':'color',};PXRichTextEdit1.prototype.isMSExport=function($a){return this.queryRange($a,'[class^=Mso]').length;};PXRichTextEdit1.prototype.execFormatCommand=function($b,$c){this.focusToEdit2();this.assertMarkers("PXRichTextEdit1.prototype.execFormatCommand");this.saveUndoStepBeforeEmbedding();var $d=this.getEditDoc();if(typeof($c)=="undefined")$c=null;var $e=($b=="formatBlock")&&($c&&$c.indexOf("blockquote")>-1);if(!__px(this).IsIE&&$b=='BackColor')$b='HiliteColor';if(!__px(this).IsIE&&($b=="Cut"||$b=="Paste"||$b=="Copy")){try{$d.execCommand($b,false,$c);}catch(e){alert(this.ccpError)}}else{var $f=PXRichTextEdit1.prototype.inlineCmd2Tag[$b];var $g=PXRichTextEdit1.prototype.colorCmd2Style[$b.toLowerCase()];if($e){this.quote($d);}else if($b=="insertunorderedlist"){this.insertList($d,false);}else if($b=="insertorderedlist"){this.insertList($d,true);}else if($b=="indent"){this.indent($d);}else if($b=="outdent"){this.outdent($d);}else if($b=="formatBlock"){switch($c.toLowerCase()){case "blockquote":this.quote($d);break;default:this.formatBlock($d,$c);}}else if($f){this.formatInline($d,$f);}else if($g){this.formatColor($d,$g,$c);}else{$d.execCommand($b,false,$c);}}};PXRichTextEdit1.prototype.clear=function(){var $d=this.getEditDoc();var $h=this.range();if($h&&!$h.collapsed){var $i=this.getRangeTopNodes($h);for(var i=0;i<$i.length;i++){var $j=$i[i];if($j.nodeType==document.ELEMENT_NODE){var $k=$d.createElement('div');$k.innerHtml=this.node2text($d,$j);$j.parentNode.replaceChild($k,$j);}}}};PXRichTextEdit1.prototype.skipCode=function($d,$l){var $m=[];for(var i=0;i<$l.length;i++){if(this.nodes2names(this.getParentChain($l[i],"BODY")).indexOf("pre.source-highlighted")==-1)$m.push($l[i]);};return $m;};PXRichTextEdit1.prototype.formatColor=function($d,style,$c){var r1=this.expandToUpperInline($d,this.range());var $n=this.insertMarkers($d);try{if($n.endMarker){var $o=this.skipCode($d,this.getNodesBetweenMarkers($d,$n.startMarker,$n.endMarker,NodeFilter.SHOW_ELEMENT));for(var i=0;i<$o.length;i++){var $j=$o[i];if(style=='color'){$j.removeAttribute('color');if($j.style&&$j.style.color){$j.style.color="";}}else if(style=='backgroundColor'){if($j.style&&$j.style.backgroundColor){$j.style.backgroundColor="";}}};var $p=this.skipCode($d,this.getNodesBetweenMarkers($d,$n.startMarker,$n.endMarker,NodeFilter.SHOW_TEXT));for(var i=0;i<$p.length;i++){var $j=$p[i];var $q=$d.createElement('span');$q.style[style]=$c;$j.parentNode.insertBefore($q,$j);$q.appendChild($j);if($n.startType=='split')$n.startType='node';if($n.endType=='split')$n.endType='node';}}else{var $q=$d.createElement('span');$q.style[style]=$c;var $r=$d.createTextNode('\u200b');$q.appendChild($r);r1.insertNode($q);r1.setStart($q,1);r1.setEnd($q,1);if($n.startMarker){$q.appendChild($n.startMarker);var $s=$n.startMarker.previousSibling&&($n.startMarker.previousSibling.nodeType==document.TEXT_NODE);$n.startType=$s?'end':'node';};this.setRange(r1);};if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);}}catch(e){if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);};throw e;}};PXRichTextEdit1.prototype.formatInline=function($d,$t){this.restoreRange(this.expandToUpperInline($d,this.range()));var r1=this.range();var $n=this.insertMarkers($d);try{var $u=$n.startMarker.nextSibling;var $v=$n.endMarker?$n.endMarker.previousSibling:undefined;var $a={'startContainer':$n.startMarker,'startOffset':0,'endContainer':$n.endMarker};if($n.endMarker){$a.endOffset=$n.endMarker.length;var style=this.getSelectedStyle($d,$a,[$n.startMarker,$n.endMarker]);var $w=style.indexOf($t)>-1;var $p=this.skipCode($d,this.getSelectedTextNodes($d,$a));var $x=$n.startMarker&&$n.endMarker&&(document.DOCUMENT_POSITION_PRECEDING&$n.startMarker.compareDocumentPosition($n.endMarker));var $y=$x?$n.endMarker:$n.startMarker;var $z=$x?$n.startMarker:$n.endMarker;if($w){for(var i=0;i<$p.length;i++){var $j=$p[i];if(this.nodes2names(this.getParentChain($j,"BODY")).indexOf($t)==-1){continue;};if(this.specialEmptyNode($j)){if($j.parentNode.childNodes.length==1){this.deleteNode($j.parentNode);}else{this.deleteNode($j);};continue;};var $A=$j.previousSibling==$y;var $B=$j.nextSibling==$z;while($j.parentNode.nodeName.toLowerCase()!=$t){$j=this.splitParent($d,$j,$y,$z);};var $C=this.splitParent($d,$j,$y,$z);this.promoteNode($j);if($A){this.insertBefore($y,$j);};if($B){this.insertAfter($z,$j);}}}else{for(var i=0;i<$p.length;i++){var $j=$p[i];if(!this.whitespace($j)){if(this.nodes2names(this.getParentChain($j,"BODY")).indexOf($t)==-1){this.wrapNode($d,$j,$t);}}};if($u){this.insertBefore($n.startMarker,$u);if($n.endMarker&&$v){this.insertAfter($n.endMarker,$v);}}}}else{var style=this.getNodeStyle($d,$n.startMarker);var $w=style.indexOf($t)>-1;if($w){var $j=$n.startMarker;while($j.parentNode.nodeName.toLowerCase()!=$t){$j=this.splitParent($d,$j);if($j.nextSibling&&!$j.nextSibling.childNodes.length){this.deleteNode($j.nextSibling);}};var $C=this.splitParent($d,$j);this.promoteNode($j);$n.startType='node';this.insertBefore($d.createTextNode('\u200b'),$n.startMarker);}else{var $k=$d.createElement($t);var $r=$d.createTextNode('\u200b');$k.appendChild($r);r1.insertNode($k);r1.setStart($k,1);r1.setEnd($k,1);if($n.startMarker){$k.appendChild($n.startMarker);var $s=$n.startMarker.previousSibling&&($n.startMarker.previousSibling.nodeType==document.TEXT_NODE);$n.startType=$s?'end':'node';};this.setRange(r1);}};if($n){if($n.startType=='split')$n.startType='start';if($n.endType=='split')$n.endType='end';this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);}}catch(e){if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);};throw e;}};PXRichTextEdit1.prototype.justify=function($d,$D){var $h=this.range();if($h){var $n=this.insertMarkers($d);var $E=this.expandRangeToLines($d,$h);var $F=$E.commonAncestorContainer==$d.body?$E.commonAncestorContainer.childNodes:[$E.commonAncestorContainer];this.justifyRec($d,$F,$E,$D);if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);}}};PXRichTextEdit1.prototype.justifyRec=function($d,$G,$a,$D){var $H=function($d,$D){var $I=$d.createElement("div");if($D=="right"){$I.setAttribute('class',"justifyRight");}else if($D=="center"){$I.setAttribute('class',"justifyCenter");};return $I;};var $J=function($K){var $L=this;return $K.some(function($j){if($j.nodeType==$j.TEXT_NODE){if($L.specialEmptyNode($j)||$j.textContent=="")return false;};if($j.nodeType==$j.COMMENT_NODE)return false;return true;});};for(var i=0;i<$G.length;i++){var $M=$G[i];if(this.touchesRange($M,$a)){if(this.isInline($M)){var $N=[$M];var $O=$M;while($O=$O.nextSibling){if($O&&this.isInline($O)){$N.push($O);}else{break;}};if($J.call(this,$N)){var $I=$H($d,$D);this.insertBefore($I,$M);while($N.length){$I.appendChild($N.shift());};if($O&&this.tagNClass($O,"br")){this.deleteNode($O);}}}else if(this.tagNClass($M,"ul","ol","li")){this.indentList($d,$M,$a,true);}else if(this.tagNClass($M,"table.layout","blockquote.realbq","tbody","tr","td")||!this.insideRange($d,$M,$a)){this.indentRec($d,$M.childNodes,$a);}else if(!this.tagNClass($M,'br')){$P.call(this,$M);}}}};PXRichTextEdit1.prototype.inlineStrides=function($l){var $m=[];var $Q;var $R=[];for(var i=0;i<$l.length;i++){var $j=$l[i];if($Q&&$j.previousSibling==$Q){$R.push($j);}else{if($R.length){$m.push($R);};$R=[$j];};$Q=$j;};if($R.length)$m.push($R);return $m;};PXRichTextEdit1.prototype.adjustInsaneRange=function($a){if(__px(this).IsFirefox){var $a=this.range();var end=$a.endContainer;if(end.nodeName.toLowerCase()=='body'){if(end.childNodes.length>0){if(end.childNodes.length==$a.endOffset){var $j=end.childNodes[end.childNodes.length-1];if($j.nodeName.toLowerCase()=='br'&&$j.getAttribute('type')=='_moz'){$a.setEnd(end,$a.endOffset-1);return $a;}}}}};return $a;};PXRichTextEdit1.prototype.includeFirefoxLine=function($a){if(__px(this).IsFirefox){var $a=this.range();var end=$a.endContainer;if(end.nodeName.toLowerCase()=='body'){if(end.childNodes.length>$a.endOffset){var $Q=end.childNodes[$a.endOffset-1];var $S=$Q.nextSibling;if($S.nodeType==document.COMMENT_NODE){$S=$S.nextSibling;};if($S.nodeName.toLowerCase()=="br"){$a.setEnd(end,this.nodeIndex($S)+1);return $a;}}}};return $a;};PXRichTextEdit1.prototype.adjustInsaneStrides=function($T){if(__px(this).IsIE||__px(this).IsIE11){if($T.length){var $U=$T[$T.length-1];if($U.length==1){var $V=$U[0];if($V.nodeType==document.TEXT_NODE&&!$V.textContent.length){$T.pop();}}}}};PXRichTextEdit1.prototype.adjustInsaneNodes=function($l){if(__px(this).IsIE||__px(this).IsIE11){if($l.length){var $V=$l[$l.length-1];if($V.nodeType==document.TEXT_NODE&&!$V.textContent.length){$l.pop();}}}};PXRichTextEdit1.prototype.formatBlockRec=function($d,$W,$j,$a,$X){for(var i=0;i<$j.childNodes.length;i++){}};PXRichTextEdit1.prototype.cutSelection=function($d,$j,$a,$Y){var $Z=[];var $00=[];var $01;var $02=[];for(var i=0;i<$j.childNodes.length;i++){var $M=$j.childNodes[i];if(this.withinRange($M,$a)){if($01===true){$02.push($M);}else if($01===false){if($02.length){$Z.push($02);$00.push($01);$02=[];};$01=false;$02.push($M);}else if($01===undefined){$01=true;$02.push($M);}}else if(this.touchesRange($M,$a)){}else{}}};PXRichTextEdit1.prototype.formatBlock1=function($d,$W){var $a=this.range();if($a){var $03=this.expandRangeToLines($d,$a);this.cutSelection($d,$d.body,$03,false);this.formatBlockRec($d,$W,$d.body,$03,false);}};PXRichTextEdit1.prototype.formatBlock=function($d,$W){var $L=this;var $04=function($05){var $06;var $07=[];for(var i=0;i<$05.length;i++){var $j=$05[i];var $S=$j.nextSibling;if($S&&$S.nodeName.toLowerCase()=="br"){$L.deleteNode($S);};if($06&&$j.previousSibling==$06&&$j.parentNode!=$d.body){$L.transferChildren($j,$06);$L.deleteNode($j);}else{$07.push($j);$06=$05[i];}};return $07;};var $08=function($j){var parent=$j.parentNode;if(parent&&this.realChildCount(parent)==1&&['h1','h2','h3','h4','h5','h6','pre','div','p'].indexOf(parent.nodeName.toLowerCase())>-1){this.promoteNode($j);}};var $t=this.stripChars($W,'<>');var $h=this.range();if($h){$h=this.expandRangeToLines($d,this.adjustInsaneRange($h));if($h.collapsed){var $k=$d.createElement($t);var br=$d.createElement('br');$k.appendChild(br);$h.insertNode($k);$08.call(this,$k);$h.setStart($k,0);$h.setEnd($k,0);this.setRange($h);this.refocus();}else{var $i=this.inlineStrides(this.skipCode($d,this.topmostInline($d,$h)));this.adjustInsaneStrides($i);var $05=[];for(var i=0;i<$i.length;i++){var $09=$i[i];var $0a=$09.every(this.whitespace);if($0a){}else{var $k=$d.createElement($t);$05.push($k);$09[0].parentNode.insertBefore($k,$09[0]);while($09.length){var $M=$09.shift();if(this.whitespace($M)){this.deleteNode($M);}else{$k.appendChild($M);}}}};$05=$04($05);for(var i=0;i<$05.length;i++){$08.call(this,$05[i]);};$04($05);if($05.length){this.focusInsideContainersEnd($05.pop());}}}};PXRichTextEdit1.prototype.hasSingleChild=function($j,$W){if($j.childNodes.length!=1){return false;};if(!$W){return true;};return $j.childNodes[0].nodeName.toLowerCase()==$W;};PXRichTextEdit1.prototype.isBlockNode=function($j){if($j){switch($j.nodeName.toLowerCase()){case "div":case "p":case "h1":case "h2":case "h3":case "h4":case "h5":case "pre":case "blockquote":case "br":return true;}};return false;};PXRichTextEdit1.prototype.removeContainingBlock=function($j){var $0b=function($j){switch($j.nodeName.toLowerCase()){case "div":case "p":return true;};return false;};var parent=$j.parentNode;if((parent.childNodes.length==1)&&$0b($j)){this.transferChildren($j,parent);parent.removeChild($j);}};PXRichTextEdit1.prototype.getSelectedTopNodeStrides=function($a){var $0c=function($0d){var $0e=$0d;var $m=[];if($0e.children[0]&&$0e.children[0].nodeName.toLowerCase()=="tbody"){$0e=$0e.children[0];};for(var i=0;i<$0e.children.length;i++){var $0f=$0e.children[i];for(var j=0;j<$0f.children.length;j++){$m.push($0f.children[j]);}};return $m;};var $m=[];var $02=[];var $0g=function(){if($02.length){$m.push($02);$02=[];}};var $L=this;var $0h=function($j){if($j&&$j.childNodes){return Array.prototype.filter.call($j.childNodes,function(n){return $L.withinRange(n,$a);})};return[];};var $0i=this.getSelectedTopNodes($a);for(var i=0;i<$0i.length;i++){var $j=$0i[i];if(this.tagNClass($j,"blockquote.realbq")){$0g();for(var j=0;j<$j.childNodes;j++){var $0j=$j.childNodes[j];if(this.tagNClass($0j,"table.layout")){var $0k=$0c($0j);for(var k=0;k<$0k.length;k++){$0g();$02=$02.concat($0h($0k[k]));};$0g();}else{$02.push($0j);}};$0g();}else if(this.tagNClass($j,"table.layout")){var $0k=$0c($j);for(var k=0;k<$0k.length;k++){$0g();$02=$02.concat($0h($0k[k]));};$0g();}else{$02.push($j);}};if($02.length){$m.push($02);};return $m;};PXRichTextEdit1.prototype.getSelectedTopNodes=function($a){var $0l=function($j,$0m){if($j==$0m)return true;return this.contains($j,$0m);};var $0n=false;var $l=[];var $j=this.getEditDoc().body;for(var i=0;i<$j.childNodes.length;i++){var $M=$j.childNodes[i];if(this.touchesRange($M,$a)){$l.push($M);}};return $l;};PXRichTextEdit1.prototype.emulateFormat=function($d,$0o,$0p){var $0q="pre";var $0r=$d.querySelectorAll($0q);for(var i=0;i<$0r.length;i++){$0r[i].setAttribute('data-realtag',"1");};$d.execCommand("formatBlock",false,"<"+$0q+">");var $0s=$d.querySelectorAll($0q+":not([data-realtag])");for(var i=0;i<$0r.length;i++){$0r[i].removeAttribute('data-realtag');};var $0t=[];var $0u=undefined;for(var i=0;i<$0s.length;i++){var $0v=$0s[i];var $0w=!$0p||!$0u||$0v.previousSibling!=$0u;if($0w){$0u=$0o.cloneNode(true);$0v.parentNode.replaceChild($0u,$0v);$0t.push($0u);}else{$0v.parentNode.removeChild($0v);}while($0v.childNodes.length){if(!$0w){$0u.appendChild($d.createElement('br'));};$0u.appendChild($0v.childNodes[0]);}};return $0t;};PXRichTextEdit1.prototype.rangeIsNode=function($h,$0x){if($h.commonAncestorContainer!=$h.startContainer)return false;if($h.startContainer!=$h.endContainer)return false;if(!$0x)return true;return $h.startContainer.nodeName.toLowerCase()==$0x;};PXRichTextEdit1.prototype.rangeContainedIn=function($h,$0x){if($h.startContainer!=$h.endContainer)return false;if($h.startContainer.parentNode.childNodes.length!=1)return false;return $h.startContainer.parentNode.nodeName.toLowerCase()==$0x;};PXRichTextEdit1.prototype.expandToUpperInline=function($d,$a){if($a!=this.orderedRange($d,$a)){var $0y=this.orderedRange($d,$a).cloneRange();while(!$0y.endContainer&&this.isInline($0y.endContainer)&&!this.tagNClass($0y.endContainer,"br")){var $0z=this.nodeIndex($0y.endContainer);$0y.setEnd($0y.endContainer.parentNode,$0z);}while(($0y.startOffset==this.nodeLen($0y.startContainer))&&this.isInline($0y.startContainer)&&!this.tagNClass($0y.startContainer,"br")){var $0z=this.nodeIndex($0y.startContainer)+1;$0y.setStart($0y.startContainer.parentNode,$0z);};return $0y;}else{var $0y=this.orderedRange($d,$a).cloneRange();while(!$0y.startOffset&&this.isInline($0y.startContainer)&&!this.tagNClass($0y.startContainer,"br")){var $0z=this.nodeIndex($0y.startContainer);$0y.setStart($0y.startContainer.parentNode,$0z);}while(($0y.endOffset==this.nodeLen($0y.endContainer))&&this.isInline($0y.endContainer)&&!this.tagNClass($0y.endContainer,"br")){var $0z=this.nodeIndex($0y.endContainer)+1;$0y.setEnd($0y.endContainer.parentNode,$0z);};return $0y;}};PXRichTextEdit1.prototype.expandToUpperBlocks=function($d,$a){var $0A=function($j){return this.tagNClass($0y.startContainer,"ul","ol","li","table.layout","blockquote.realbq","tbody","tr","td","body","#document");};var $0y=this.orderedRange($d,$a).cloneRange();while(!$0A.call(this,$0y.startContainer)){var $0z=this.nodeIndex($0y.startContainer);$0y.setStart($0y.startContainer.parentNode,$0z);}while(!$0A.call(this,$0y.endContainer)){var $0z=this.nodeIndex($0y.endContainer)+1;$0y.setEnd($0y.endContainer.parentNode,$0z);};return $0y;};PXRichTextEdit1.prototype.expandRangeToLeft=function($0B,$0C){while(true){if($0B.nodeType==document.TEXT_NODE||$0B.nodeType==document.COMMENT_NODE){$0C=this.nodeIndex($0B);$0B=$0B.parentNode;}else if(!$0C){var $0D=$0B.nodeName.toLowerCase();if(this.isBlock($0B)||$0D=="body"||$0D=="html"||$0D=="#document"){break;}else{$0C=this.nodeIndex($0B);$0B=$0B.parentNode;}}else{var $j=$0B[$0C];if(this.nameIs($j,'br')||this.isBlock($j)){break;}else{$0C--;}}};return{'container':$0B,'offset':$0C};};PXRichTextEdit1.prototype.expandRangeToRight=function($0B,$0C){while(true){if($0B.nodeType==document.TEXT_NODE||$0B.nodeType==document.COMMENT_NODE){$0C=this.nodeIndex($0B)+1;$0B=$0B.parentNode;}else if($0C>=$0B.childNodes.length){var $0D=$0B.nodeName.toLowerCase();if(this.isBlock($0B)||$0D=="body"||$0D=="html"||$0D=="#document"){break;}else{$0C=this.nodeIndex($0B)+1;$0B=$0B.parentNode;}}else{var $j=$0B[$0C];if(this.nameIs($j,'br')||this.isBlock($j)){break;}else{$0C++;}}};return{'container':$0B,'offset':$0C};};PXRichTextEdit1.prototype.expandRangeToLines1=function($d,$a){if($a){var $0y=$a.cloneRange();if(this.isReversedRange($d,$a)){var $0E=this.expandRangeToRight($a.startContainer,$a.startOffset);var end=this.expandRangeToLeft($a.endContainer,$a.endOffset);}else{var $0E=this.expandRangeToLeft($a.startContainer,$a.startOffset);var end=this.expandRangeToRight($a.endContainer,$a.endOffset);};$0y.setStart($0E.container,$0E.offset);$0y.setEnd(end.container,end.offset);return $0y;};return $a;};PXRichTextEdit1.prototype.expandRangeToLines=function($d,$a){if($a){var $0y=$d.createRange();var $0F=$d.body;if($a.collapsed&&$a.startContainer==$0F&&($0F.childNodes.length>$a.startOffset)){if(this.isInline($0F.childNodes[$a.startOffset])){var $S=$0F.childNodes[$a.startOffset];var $0G;while($S&&this.isInline($S)){$0G=$S;$S=$S.nextSibling;};var $0H=$0F.childNodes[$a.startOffset].previousSibling;var $0I;while($0H&&this.isInline($0H)){$0I=$0H;$0H=$0H.previousSibling;};if($0I){$0y.setStart($0F,this.nodeIndex($0I));}else{$0y.setStart($0F,$a.startOffset);};if($0G){$0y.setEnd($0F,this.nodeIndex($0G)+1);}else{$0y.setEnd($0F,$a.endOffset);}}else{var $M=$0F.childNodes[$a.startOffset];while($M.childNodes.length&&!this.isInline($M.childNodes[0])){$M=$M.childNodes[0];};$0y.setStart($M,0);$0y.setEnd($M,$M.childNodes.length);}}else{if(!this.isInline($a.startContainer)){var $0z=$a.startOffset;while($0z>0&&this.isInline($a.startContainer.childNodes[$0z-1])){$0z--;};$0y.setStart($a.startContainer,$0z);}else{var $0E=this.isTextual($a.startContainer)?$a.startContainer:($a.startOffset?$a.startContainer.childNodes[$a.startOffset-1]:$a.startContainer);while(this.isInline($0E)&&this.isInline($0E.parentNode)){$0E=$0E.parentNode;};if(this.isInline($0E)){while(this.isInline($0E.previousSibling)){$0E=$0E.previousSibling;}};$0y.setStart($0E.parentNode,this.nodeIndex($0E));};if(!this.isInline($a.endContainer)){var $0z=$a.endOffset;while($0z<$a.endContainer.childNodes.length&&this.isInline($a.endContainer.childNodes[$0z])){$0z++;};$0y.setEnd($a.endContainer,$0z);}else{var end=undefined;if(this.isTextual($a.endContainer)){end=$a.endContainer;}else if($a.endOffset==$a.endContainer.childNodes.length){if(this.isInline($a.endContainer)){end=$a.endContainer;}else{$0y.setEnd($a.endContainer,$a.endOffset);}}else if(!$a.endOffset){if(this.isInline($a.endContainer)){end=$a.endContainer;}else if($a.endContainer.childNodes.length&&this.isInline($a.endContainer.childNodes[0])){end=$a.endContainer.childNodes[0];}else{$0y.setEnd($a.endContainer,0);}}else{end=$a.endContainer.childNodes[$a.endOffset-1];};if(end){while(this.isInline(end)&&this.isInline(end.parentNode)){end=end.parentNode;};if(this.isInline(end)){while(this.isInline(end.nextSibling)){end=end.nextSibling;}};$0y.setEnd(end.parentNode,this.nodeIndex(end)+1);}}};var $0J=this.createRange($d,$a.startContainer,$a.startOffset,$0y.startContainer,$0y.startOffset);var $0K=this.queryRange($0J,"br");if($0K.length){var $0L=this.isRangeFlipped($0J)?$0K[0]:$0K[$0K.length-1];var $0M=this.partition(this.getSelectedTextNodes($d,$0J),function($0N){return document.DOCUMENT_POSITION_FOLLOWING&$0L.compareDocumentPosition($0N)},"before","after");if($0M.before.length){$0y.setStartBefore($0M.before.pop());}};var $0O=this.createRange($d,$a.endContainer,$a.endOffset,$0y.endContainer,$0y.endOffset);var $0P=this.queryRange($0O,"br");if($0P.length){var $0Q=this.isRangeFlipped($0O)?$0P[$0P.length-1]:$0P[0];var $0M=this.partition(this.getSelectedTextNodes($d,$0J),function($0N){return document.DOCUMENT_POSITION_FOLLOWING&$0L.compareDocumentPosition($0N)},"before","after");if($0M.after.length){$0y.setEndBefore($0M.after.shift());}};return $0y;};return $a;};PXRichTextEdit1.prototype.filterNodes=function($l,$0R){return $l.filter(function($j){return $0R.indexOf($j.nodeName.toLowerCase())>-1});};PXRichTextEdit1.prototype.filteredParentChain=function($j,$0R){return this.filterNodes(this.getParentChain($j,'BODY'),$0R);};PXRichTextEdit1.prototype.quote=function($d){var $h=this.range();var $i=this.getSelectedTopNodes($h);var $L=this;var $0S=$i.filter(function($j){return $L.tagNClass($j.parentNode,'blockquote.realbq');});if($0S.length){var $0T=undefined;while($0S.length){var $0U=$0S.shift();if($0U.childNodes.length){$0T=$0U.childNodes[0];this.insertBefore($0T,$0U);while($0U.childNodes.length){var $M=$0U.childNodes[0];this.insertAfter($M,$0T);$0T=$M;}};this.deleteNode($0U);};if($0T){this.focusAfterTag($0T);}}else{var $0V=$d.createElement('blockquote');$0V.setAttribute('class','realbq');var $i=this.getSelectedTopNodes($h);if($i.length){this.insertBefore($0V,$i[0]);while($i.length){$0V.appendChild($i.shift());}}else{$h.insertNode($0V);};this.syncSpaces($d);this.focusInsideContainersEnd($0V);}};PXRichTextEdit1.prototype.indent=function($d){var $h=this.range();if($h){var $n=this.insertMarkers($d);try{var $E=this.expandRangeToLines($d,this.range());var $F=$E.commonAncestorContainer==$d.body?$E.commonAncestorContainer.childNodes:[$E.commonAncestorContainer];this.indentRec($d,$F,$E);}catch(e){if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);};throw e;};if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);}}};PXRichTextEdit1.prototype.indentRec=function($d,$G,$a){var $H=function($d){var $I=$d.createElement("blockquote");$I.setAttribute('class','shift');$I.style.marginLeft="40px";return $I;};var $P=function($j){var $0W;if(this.tagNClass($j,'blockquote.shift')){$0W=$j;}else if(this.tagNClass($j.parentNode,'blockquote.shift')){$0W=$j.parentNode;};if($0W){var $0X=$0W.style.marginLeft;var $0Y=this.px2int($0X?$0X:"0px");$0W.style.marginLeft=$0Y+40+"px";}else{var $I=$H($d);$j.parentNode.insertBefore($I,$j);var $S=$j.nextSibling;if($S&&$S.nodeType==document.COMMENT_NODE){$S=$S.nextSibling;};if($S&&$S.nodeName.toLowerCase()=="br"){this.deleteNode($S);};$I.appendChild($j);}};var $J=function($K){var $L=this;return $K.some(function($j){if($L.specialEmptyNode($j)){return false;};if($j.nodeType==$j.TEXT_NODE&&$j.textContent==""){return false;};if($j.nodeType==$j.COMMENT_NODE)return false;return true;});};var $0Z=[];for(var i=0;i<$G.length;i++){var $M=$G[i];if($0Z.indexOf($M)>-1){continue;};if(this.touchesRange($M,$a)){if(this.isInline($M)){var $N=[$M];var $O=$M;while($O=$O.nextSibling){if($O&&this.isInline($O)){$N.push($O);}else{break;}};var $10=$M;while($10=$10.previousSibling){if($10&&this.isInline($10)){$N.shift($10);}else{break;}};if($J.call(this,$N)){var $I=$H($d);this.insertBefore($I,$M);while($N.length){$I.appendChild($N.shift());};if($O&&this.tagNClass($O,"br")){this.deleteNode($O);}};$0Z=$0Z.concat($N);}else if(this.tagNClassUp($M,"ul","ol","li")){this.indentList($d,$M,$a,true);}else if(this.tagNClass($M,"table.layout","blockquote.realbq","tbody","tr","td")||!this.insideRange($d,$M,$a)){this.indentRec($d,$M.childNodes,$a);}else if(!this.tagNClass($M,'br')){$P.call(this,$M);}}}};PXRichTextEdit1.prototype.indentList=function($d,$j,$h,$11){if(!this.tagNClass($j,"ul","ol")){$j=this.findTagNClass(this.getParentChain($j,"body").reverse(),"ul","ol");}while(this.tagNClass($j.parentNode,"ul","ol")){$j=$j.parentNode;};var $12=this.deconstructList($j,$h);this.shiftList($d,$12.list,$12.start,$12.end,$11);this.removeDuplicateListNodes($12.list);this.reconstructList($d,$12.list,$j);this.deleteNode($j);};PXRichTextEdit1.prototype.outdent=function($d){var $h=this.range();if($h){var $n=this.insertMarkers($d);try{var $E=this.expandToUpperBlocks($d,this.expandRangeToLines($d,$h));var $F=$E.commonAncestorContainer==$d.body?$E.commonAncestorContainer.childNodes:[$E.commonAncestorContainer];this.outdentRec($d,$F,$E);}catch(e){if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);};throw e;};if($n){this.removeMarkers($d,$n.startMarker,$n.startType,$n.endMarker,$n.endType);}}};PXRichTextEdit1.prototype.outdentRec=function($d,$G,$a){var $13=function($j){return $j.childNodes.length==1&&!this.isInline($j.childNodes[0]);};for(var i=0;i<$G.length;i++){var $M=$G[i];if(this.touchesRange($M,$a)){if(this.tagNClass($M,"ul","ol","li")){this.indentList($d,$M,$a,false);}else if(this.tagNClass($M,'blockquote.shift')){var $14=$M;var $0X=$14.style.marginLeft;if($0X){var $15=this.px2int($0X)-40;if($15>0){$14.style.marginLeft=$15+"px";}else{if($13.call(this,$14)){this.promoteNode($14.childNodes[0]);}else{var $16=$d.createElement('div');this.insertBefore($16,$14);this.transferChildren($14,$16);this.deleteNode($14);}}}}else{this.outdentRec($d,$M.childNodes,$a);}}}};PXRichTextEdit1.prototype.nodes2StyleNames=function($17){var $m=[];for(var i=0;i<$17.length;i++){var $j=$17[i].nodeName;var name=$j.nodeName.toLowerCase();switch($j.nodeName.toLowerCase()){case "h1":case "h2":case "h3":case "h4":case "h5":case "i":case "sub":case "sup":case "pre":$m.push(name);break;case "b":case "strong":$m.push("b");break;case "blockquote":if($j.getAttribute('style')=='realbq')$m.push("blockquote");break;}};return $m;};PXRichTextEdit1.prototype.resetStyle=function($j){var $0l=function($18,$19){var $1a=$18.toLowerCase();for(var i=0;i<$19.length;i++){if($1a.indexOf($19[i])>-1){return true;}};return false;};if($j.style){for(var k in $j.style){if($0l(k,['margin','padding','indent'])){$j.style[k]="";}}}};


PXRichTextEdit1.prototype.addConvertAttr=function($a,$b){$a[this.convertAttr]=$b;return $a;};PXRichTextEdit1.prototype.imageDialogHide=function($c){this.focusToEdit2();if($c.dialogResult==PXDialogResult.OK){this.saveUndoStepBeforeEmbedding();this.insertImage($c.getSelectedFile(),$c.getCaption(),$c.isExternalFile());}};PXRichTextEdit1.prototype.imageDialogHide=function($c){this.focusToEdit2();if($c.dialogResult==PXDialogResult.OK){this.saveUndoStepBeforeEmbedding();this.insertImage($c.getSelectedFile(),$c.getCaption(),$c.isExternalFile());}};PXRichTextEdit1.prototype.insertedId=0;PXRichTextEdit1.prototype.insertImage=function($d,$e,$f,$g){if($d!=undefined){var $h={'id':(this.insertedId++),'src':$d,'title':$e};if($g){$h['objType']='attached';};if(this.fileAttr){$h[this.fileAttr]=true;};var $i=this.getEditDoc();var $j=$f?this.insertTag('img',$h):this.insertConvertableTag('img',$h,this.viewConvertAttr);this.msieUnselectable($j);this.syncSpaces($i);this.focusAfterTag($j);this.tryUpdateState();this.refocus();}};PXRichTextEdit1.prototype.insertFile=function($k,$e,$l){if($k!=undefined){var $m={};switch($l){case 0:$m=this.addConvertAttr({'href':this.fileShowUrl+$k,'objType':'attached','target':'_blank'},this.viewConvertAttr);break;case 1:$m={'href':$k,'target':'_blank'};break;case 2:$m=this.addConvertAttr({'href':this.fileShowUrl+$k,'objType':'file','target':'_blank'},this.viewConvertAttr);break;};if(this.fileAttr){$m[this.fileAttr]=true;};var $n=$e!=""?$e:$k;var $o=this.insertTag('a',$m);$o.textContent=$n;this.syncSpaces(this.getEditDoc());this.focusAfterTag($o);this.tryUpdateState();this.refocus();return $o;}};PXRichTextEdit1.prototype.insertImageLink=function($p,$e,$l){var $i=this.getEditDoc();var $q=$i.createElement('a');switch($l){case 3:this.assignAttributes($q,{'href':$p,'target':'_blank'});break;case 2:this.assignAttributes($q,this.addConvertAttr({'href':this.screenShowUrl+$p,'target':'_blank'},this.screenConvertAttr));break;case 1:this.assignAttributes($q,this.addConvertAttr({'href':this.fileShowUrl+$p,'target':'_blank'},this.viewConvertAttr));break;case 0:this.assignAttributes($q,this.addConvertAttr({'href':this.wikiShowUrl+$p,'target':'_blank'},this.wikiConvertAttr));break;};this.imageProps.targetImage.parentNode.replaceChild($q,this.imageProps.targetImage);$q.appendChild(this.imageProps.targetImage);this.imageProps.targetImage.removeAttribute("data-clickable");this.focusAfterTag($q);};PXRichTextEdit1.prototype.insertArticle=function($p,$r){var $s=this.wikiShowUrl+$p;var $p=this.insertConvertableTag('a',{'href':$s,'target':'_blank'},this.wikiConvertAttr);$p.textContent=$r;return $p;};PXRichTextEdit1.prototype.insertScreen=function($p,$r){var $s=this.screenShowUrl+$p;var $p=this.insertConvertableTag('a',{'href':$s,'target':'_blank'},this.screenConvertAttr);$p.textContent=$r;return $p;};PXRichTextEdit1.prototype.normalizeLink=function($t){var $u=$t.substr(0,7)=="http://";var $v=$t.substr(0,8)=="https://";if($u||$v){var $w=$t.substr($u?7:8);return{'url':$t,'text':$w};}else{return{'url':"http://"+$t,'text':$t};}};PXRichTextEdit1.prototype.insertExternalLink=function($p,$r,$x){var $y=this.normalizeLink($p);var $n=$r==undefined?$y.text:$r;var $z=this.insertTag('a',{'href':$y.url,'innerHTML':$n,'target':'_blank'});return $z;};PXRichTextEdit1.prototype.insertLink=function($p,$e,$l){var $A=undefined;switch($l){case 3:$A=this.insertExternalLink($p,$e);break;case 2:$A=this.insertScreen($p,$e);break;case 1:$A=this.insertFile($p,$e,2);break;case 0:$A=this.insertArticle($p,$e);break;};if($A){var $i=this.getEditDoc();this.syncSpaces($i);this.focusAfterTag($A);}};PXRichTextEdit1.prototype.createNewTag=function($i,$B,$C,$D){var $E=$i.createElement($B);this.assignAttributes($E,$D);$E.setAttribute(this.convertAttr,$C);if(this.fileAttr){$E.setAttribute(this.fileAttr,true);};return $E;};PXRichTextEdit1.prototype.createArticle=function($i,$F,$e){var $E=$i.createElement("a");var $s=this.wikiShowUrl+$F;this.assignAttributes($E,{'href':$s,'target':'_blank'});$E.setAttribute(this.convertAttr,this.wikiConvertAttr);return $E;};PXRichTextEdit1.prototype.createScreen=function($i,$F,$e){var $E=$i.createElement("a");var $s=this.screenShowUrl+$F;this.assignAttributes($E,{'href':$s,'target':'_blank'});$E.setAttribute(this.convertAttr,this.screenConvertAttr);return $E;};PXRichTextEdit1.prototype.createAttFile=function($i,$F,$e){var $E=$i.createElement("a");var $s=this.fileShowUrl+$F;this.assignAttributes($E,{'href':$s,'target':'_blank','objtype':'attached'});$E.setAttribute(this.convertAttr,this.viewConvertAttr);return $E;};PXRichTextEdit1.prototype.createFile=function($i,$F,$e){var $E=$i.createElement("a");var $s=this.fileShowUrl+$F;this.assignAttributes($E,{'href':$s,'target':'_blank','objtype':'file'});$E.setAttribute(this.convertAttr,this.viewConvertAttr);return $E;};PXRichTextEdit1.prototype.createImage=function($i,$F,$e){var $E=$i.createElement("img");var $s=this.fileShowUrl+$F;this.assignAttributes($E,{'src':$s,'objtype':'file'});$E[this.convertAttr]=this.viewConvertAttr;return $E;};PXRichTextEdit1.prototype.createAttImage=function($i,$F,$e){var $E=$i.createElement("img");var $s=this.fileShowUrl+$F;this.assignAttributes($E,{'src':$s,'objtype':'attached'});$E[this.convertAttr]=this.viewConvertAttr;return $E;};PXRichTextEdit1.prototype.dialogHide=function($G){this.focusToEdit2();if($G.dialogResult==PXDialogResult.OK){this.saveUndoStepBeforeEmbedding();var $H=$G.editedImage;$G.editedImage=undefined;var $I=$G.getSelection();var $i=this.getEditDoc();if($I){var $e=$I.caption?$I.caption:$I.value;var $j=undefined;switch($I.type){case 'AttachedImagesTab':$j=this.createNewTag($i,'img',this.viewConvertAttr,{'src':$I.key,'objtype':'attached'});break;case 'SearchImagesTab':$j=this.createNewTag($i,'img',this.viewConvertAttr,{'src':$I.key,'objtype':'file'});break;case 'WebImagesTab':$j=$i.createElement('img');$j.setAttribute('src',$I.key);break;case 'AttachedFilesTab':$j=this.createNewTag($i,'a',this.viewConvertAttr,{'href':this.fileShowUrl+$I.key,'objtype':'attached','target':'_blank'});break;case 'SearchFilesTab':$j=this.createNewTag($i,'a',this.viewConvertAttr,{'href':this.fileShowUrl+$I.key,'objtype':'file','target':'_blank'});break;case 'WebFilesTab':$j=$i.createElement('a');var k=$I.key.trim();var $J=k.slice&&k.slice(0,2)=="(("&&k.slice(-2)=="))";var $K=new RegExp("(http|https|ftp)://").test(k);var $L=($J||$K)?k:("http://"+k);$j.setAttribute('href',encodeURI($L));$j.setAttribute('target','_blank');break;case 'LinkedArticlesTab':$j=this.createNewTag($i,'a',this.wikiConvertAttr,{'href':this.wikiShowUrl+$I.key,'objtype':'file','target':'_blank'});break;case 'LinkedScreensTab':$j=this.createNewTag($i,'a',this.screenConvertAttr,{'href':this.screenShowUrl+$I.key,'objtype':'file','target':'_blank'});break;};if($j){var $M=$G.onShowKey;if($H){var $N=$H.parentNode;var $O=this.nodeIndex($H);if($M){this.transferChildren($M,$j);}else{$j.appendChild($H);};if($N&&!this.range()){var $P=$i.createRange();$P.setStart($N,$O);$P.setEnd($N,$O);this.restoreRange($P);}}else{switch($j.nodeName.toLowerCase()){case "a":$j.textContent=$e;break;case "img":$j.setAttribute('title',$e.replace(this.fileShowUrl,''));}};if($M){$M.parentNode.replaceChild($j,$M);}else{this.insertNodeAtSelection($j);}}};this.tryUpdateState();};this.imageProps.targetImage=undefined;$G.oldLink=undefined;this.refocus();};PXRichTextEdit1.prototype.updateInternalLink=function($x,$p,$e,$Q,$R,$S){var $s=$Q+$p;this.updateTag($x,this.addConvertAttr({'href':$s,'target':'_blank'},$R));if(this.imageProps.targetImage){if($e)this.updateTag(this.imageProps.targetImage,{'title':$e});}else{this.removeChildren($x);this.embedTag($x,'span',{'innerHTML':$e});}};PXRichTextEdit1.prototype.updateLink=function($x,$p,$e,$l){switch($l){case 3:var $n=$e==undefined?this.removePrefixes($p,["http://","ftp://"]):$e;this.updateTag($x,this.addConvertAttr({'href':$p,'target':'_blank'}));if(!this.imageProps.targetImage){this.removeChildren($x);this.updateTag($x,{'innerHTML':$n});};break;case 2:this.updateInternalLink($x,$p,$e,this.screenShowUrl,this.screenConvertAttr,'richScreen');break;case 1:this.updateInternalLink($x,$p,$e,this.fileShowUrl,this.viewConvertAttr,'richAttach');break;case 0:this.updateInternalLink($x,$p,$e,this.wikiShowUrl,this.wikiConvertAttr,'richArticle');break;};this.focusAfterTag($x);};PXRichTextEdit1.prototype.lookupHide=function($T,$U){this.restoreIESelection();if($U.lookupResult==2){var $V=$U.getSelectedItem();if(undefined !=$V){switch($V.ItemType){case 1:this.insertImage(this.fileShowUrl+$V.Link,$V.Caption,false);break;case 3:this.insertArticle($V.Link,$V.Caption);break;case 4:this.insertScreen($V.Link,$V.Caption);break;default:this.insertFile($V.Link,$V.Caption,2);break;}}}else{var $i=this.getEditDoc();if(__px(this).IsSafari){this.insertText($U.imageOnly?'!':'[');$i.body.focus();}else if(__px(this).IsIE||__px(this).IsIE11){this.insertTextAtSelection($U.imageOnly?'!':'[');}else if(__px(this).IsFirefox){this.insertTextAtSelection($U.imageOnly?'!':'[');};var $I=$i.getSelection();if(!(__px(this).IsIE||__px(this).IsIE11))$I.modify('move','forward','character');if(__px(this).IsIE||__px(this).IsIE11){$I.collapseToEnd();}}};PXRichTextEdit1.prototype.templateSelected=function($W,$X){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();this.insertHTML($X.content);this.tryUpdateState();__px_cm(this).notifyOnResize();};PXRichTextEdit1.prototype.datafieldSelected=function($W,$X){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $i=this.getEditDoc();var $Y=$i.createElement("span");$Y.textContent=$X.value;$Y.setAttribute("data-field","yes");this.insertNodeAtSelection($Y);this.syncSpaces($i);var $Z=$i.createTextNode('\u200b');this.insertAfter($Z,$Y);this.focusAfterTag($Z);this.tryUpdateState();__px_cm(this).notifyOnResize();};PXRichTextEdit1.prototype.datafieldPrevSelected=function($W,$X){this.focusToEdit2();this.saveUndoStepBeforeEmbedding();var $i=this.getEditDoc();var $Y=$i.createElement("span");$Y.textContent="PREV"+$X.value;$Y.setAttribute("data-field","yes");this.insertNodeAtSelection($Y);this.syncSpaces($i);var $Z=$i.createTextNode('\u200b');this.insertAfter($Z,$Y);this.focusAfterTag($Z);this.tryUpdateState();__px_cm(this).notifyOnResize();};


PXRichTextEdit1.prototype.k={'left':37,'right':39,'up':38,'down':40,'tab':9,'enter':13,'home':36,'end':40,'~':192,'!':49,'[':219,'a':65,'z':90,'0':48,'9':57,'del':8,'backspace':9};PXRichTextEdit1.prototype.handleKeys=true;PXRichTextEdit1.prototype.scrollIntoView=function($a,$b,$c){var $d=$a.body;var $e=$b.getBoundingClientRect();if($e.bottom>$d.clientHeight){$a.body.scrollTop+=$e.bottom-$d.clientHeight+($c?$e.height:0);}else if($e.top<0){$a.body.scrollTop+=$e.top+($c?$e.height:0);}};PXRichTextEdit1.prototype.untouchables=function($f){return[];};PXRichTextEdit1.prototype.retypeMarker=function($b,$g){var $h=$b.previousSibling&&($b.previousSibling.nodeType==document.TEXT_NODE);var $i=$b.nextSibling&&($b.nextSibling.nodeType==document.TEXT_NODE);if($h&&$i)return 'split';if($h)return 'end';if($i)return 'start';return "node";};PXRichTextEdit1.prototype.enterPressed=function(e,$j){this.saveUndoStep();this.stateChanged();var $a=this.getEditDoc();var $k=this.getParentChain($j.startContainer,"body");var $l=this.findTagNClass($k,"li");if(!$l){$l=this.findTagNClass($k,"h1","h2","h3","h4","h5","h6","div","p","blockquote","td");};var $m=this.findTagNClass($k,"li","td","blockquote.realbq");if(!this.tagNClass($m,"blockquote.realbq")){$m=undefined;};if(!$l){var $n=this.insertMarkers($a);var $o=this.expandRangeToLines($a,this.range());this.restoreRange($o);var $p=$a.createElement('p');$p.className="richp";$p.appendChild($o.extractContents());$o.insertNode($p);if($p.nextSibling&&$p.nextSibling.nodeName.toLowerCase()=='br'){this.deleteNode($p.nextSibling);};$l=$p;if($n){this.removeMarkers($a,$n.startMarker,$n.startType);}};if($l){if($m){if(this.noText($l)){var p=$a.createElement('p');p.className="richp";p.appendChild($a.createTextNode('\u200b'));this.insertAfter(p,$m);if(($l.firstChild==$l.lastChild)&&this.tagNClass($l,'p.richp')&&this.tagNClass($l.firstChild,'br')){this.deleteNode($l);};this.focusInsideTag(p);return this.cancelEvent(e);}};if($l.nodeName.toLowerCase()=="li"&&!this.replace($l.textContent,['\u200b','']).length){var $q=this.splitParent($a,$l);if(this.tagNClass($q.parent,'ul','ol')){$q.parentNode.replaceChild($l,$q);this.focusInsideTag($l);}else{var $r=$a.createElement('p');$r.className="richp";$q.parentNode.replaceChild($r,$q);$r.appendChild($a.createElement('br'));this.focusInsideTag($r);};return this.cancelEvent(e);};if($l.nodeName.toLowerCase()=="td"){var $s=this.insertMarkers($a);if($l.textContent){if($l.lastChild.nodeName.toLowerCase()=='br'){$l.removeChild($l.lastChild);}};var $o=this.expandRangeToLines($a,$j);this.restoreRange($o);var $p=$a.createElement('p');$p.className="richp";$p.appendChild($o.extractContents());$j.insertNode($p);$l=$p;this.removeMarkers($a,$s.startMarker,$s.startType,$s.endMarker,$s.endType);};var $s=this.insertMarkers($a);if($s){var $t=$l.cloneNode(true);$l.parentNode.insertBefore($t,$l);var $u=this.partitionTextNodes($a,$l,$s.startMarker).before;this.deleteNodes($u);this.chopOffBr($s.startMarker.parentNode);if(this.noText($l)){if(!(__px(this).IsIE||__px(this).IsIE11)&&!this.tagNClass($l.lastChild,'br')){$s.startMarker.parentNode.insertBefore($a.createElement('br'),$s.startMarker.nextSibling);}else if((__px(this).IsIE||__px(this).IsIE11)&&!$s.startMarker.parentNode.textContent.length){$s.startMarker.parentNode.insertBefore($a.createTextNode('\u200b'),$s.startMarker.nextSibling);}};this.prune($l,this.untouchables($l).concat($l,$s.startMarker));this.normalizeTrailingBr($l,$s.startMarker);this.reduceColor($s.startMarker,true);this.reduceColor($s.startMarker,false);$s.startType=this.retypeMarker($s.startMarker,$s.startType);this.removeMarkers($a,$s.startMarker,$s.startType);var $v=this.findMarkers($a,$s.startText);var $w=this.partitionTextNodes($a,$t,$v.start).after;this.deleteNodes($w);this.chopOffBr($v.start.parentNode);if(this.noText($t)){if(!(__px(this).IsIE||__px(this).IsIE11)&&!this.tagNClass($t.lastChild,'br')){$v.start.parentNode.insertBefore($a.createElement('br'),$v.start.nextSibling);}else if((__px(this).IsIE||__px(this).IsIE11)&&!$v.start.parentNode.textContent.length){$v.start.parentNode.insertBefore($a.createTextNode('\u200b'),$v.start.nextSibling);}};this.prune($t,this.untouchables($t).concat($t));var $x=$a.createElement('span');$x.innerHTML='.';$v.start.parentNode.insertBefore($x,$v.start);this.scrollIntoView($a,$x,true);this.deleteNode($x);this.deleteNode($v.start);};return this.cancelEvent(e);}};PXRichTextEdit1.prototype.reduceColor=function($y,$z){var $k=this.getParentChain($y,"body");$k.shift();var $A=$z?'isBGColorTag':'isColorTag';while($k.length&&!this[$A]($k[0])){$k.shift();};if($k.length&&this[$A]($k[0])&&this.isOnlyChild($k[0])){var $B=$k.shift();while($k.length&&this[$A]($k[0])&&this.isOnlyChild($k[0])){var $C=$k.shift();$C.parentNode.insertBefore($B,$C);this.deleteNode($C);}}};PXRichTextEdit1.prototype.normalizeTrailingBr=function($D,$y){if((!(__px(this).IsIE))&&$y.parentNode.childNodes.length<=1){$y.parentNode.appendChild(this.getEditDoc().createElement('br'));};if($y.parentNode!=$D){var parent=$y.parentNode.parentNode;while(true){if(parent.childNodes.length==2&&this.nameIs(parent.lastChild,'br')){parent.removeChild(parent.lastChild);};if(parent==$D||!parent.parentNode){break;};parent=parent.parentNode;}}};PXRichTextEdit1.prototype.enterInList=function($E,e,$j){var $a=this.getEditDoc();if(this.replace($E.textContent,['\u200b','']).length){var $F=this;var $k=this.getParentChain($j.endContainer,'li');$k.pop();var $G=$k.filter(function(n){return n.nodeType==document.ELEMENT_NODE;}).map(function(n){return n.cloneNode(false);});if(!$j.collapsed){$j.deleteContents();};var $H=$a.createElement('li');this.insertAfter($H,$E);var $I=$H;while($G.length){var $J=$G.pop();$I.appendChild($J);$I=$J;};this.focusInsideTag($I);return this.stopEvent(e);}else{var $q=this.splitParent($a,$E);if(this.tagNClass($q.parent,'ul','ol')){$q.parentNode.replaceChild($E,$q);this.focusInsideTag($E);}else{var $r=$a.createElement('div');$q.parentNode.replaceChild($r,$q);if(!(__px(this).IsIE)){if(!$r.childNodes.length){$r.appendChild($a.createElement('<br>'));}};this.focusInsideTag($r);};return this.stopEvent(e);}};PXRichTextEdit1.prototype.enterInIndent=function(bq,e,$j){var $a=this.getEditDoc();{var $F=this;var $k=this.getParentChain($j.endContainer,'blockquote.shift');var $K=$k.pop().cloneNode(false);var $G=$k.filter(function(n){return n.nodeType==document.ELEMENT_NODE;}).map(function(n){return n.cloneNode(false);});if(!$j.collapsed){$j.deleteContents();};this.insertAfter($K,bq);var $I=$K;while($G.length){var $J=$G.pop();$I.appendChild($J);$I=$J;};if(!$I.childNodes.length){if(!(__px(this).IsIE)){$I.appendChild($a.createElement('<br>'));}};this.focusInsideTag($I);return this.stopEvent(e);}};PXRichTextEdit1.prototype.ctrlAltShift=function(e,$L,$M,$N){var $O=e.ctrlKey||e.metaKey;return($O==$L)&&(e.altKey==$M)&&(e.shiftKey==$N);};PXRichTextEdit1.prototype.handleInput=function(e){if(e.inputType=="insertReplacementText"){__px_cm(this).notifyOwnerChanged(this);this.tryUpdateState();}};PXRichTextEdit1.prototype.handleKeyDown=function(e){if(this.editorMode!='edit')return;var $P=!(e.ctrlKey||e.altKey||e.shiftKey);var $Q=e.ctrlKey&&!e.altKey&&!e.shiftKey;var $R=(this.editorMode=="edit")&&!this.isPreview;this.lastPlaceholder=undefined;this.hideToolbars();var $a=this.getEditDoc();if(e.keyCode==83&&$Q){__px_cm(this).dataSource.processKeyDown(e);if(e.returnValue===false){return this.cancelEvent(e);}};if(e.keyCode==66&&$Q){this.execCommand2('bold');return this.cancelEvent(e);};if(this.handleKeys&&e.keyCode==13&&$P){var $j=this.range();if($j){if(!$j.collapsed){$j.deleteContents();};return this.enterPressed(e,$j);}};if(e.keyCode==36&&this.ctrlAltShift(e,true,false,false)){this.gotoStart();return this.cancelEvent(e);};if(e.keyCode==35&&this.ctrlAltShift(e,true,false,false)){this.gotoEnd();return this.cancelEvent(e);};if((e.keyCode==37||e.keyCode==39)&&!e.ctrlKey&&!e.altKey&&!e.metaKey){};if((e.keyCode==40||e.keyCode==38)&&$P){var $j=this.range();if($j){var $S=this.findParentNode('td',$j.endContainer);if($S){var $T=this.getColIndex();var $U=this.getRowIndex();var $V=this.getRowsCount()-1;var $W=this.findParentNode('table',$j.endContainer);if(e.keyCode==40){if($U>=$V){this.focusAfterTag($W);}else{this.focusOnCell($W,$T,$U+1);}}else{if($U<=0){this.focusBeforeTag($W);}else{this.focusOnCell($W,$T,$U-1);}};return this.stopEvent(e);}}};if(e.keyCode==9&&!e.ctrlKey&&!e.altKey){var $j=this.range();if($j){var $S=this.findParentNode('td',$j.endContainer);if($S){if(e.shiftKey){var $X=this.prevSibling($S,'td');if($X){this.focusInsideTag($X);}else{var $Y=this.prevSibling($S.parentNode,'tr');if($Y){var $Z=this.lastChild($Y,'td');this.focusInsideTag($Z);}else{var $W=this.findParentNode('table',$S);if($W){this.focusBeforeTag($W);}}}}else{var $00=this.nextSibling($S,'td');if($00){this.focusInsideTag($00);}else{var $01=this.nextSibling($S.parentNode,'tr');if($01){var $Z=this.firstChild($01,'td');this.focusInsideTag($Z);}else{var $W=this.findParentNode('table',$S);if($W){this.focusAfterTag($W);}}}}}else{this.saveUndoStepBeforeEmbedding();if(e.shiftKey){this.outdent($a);}else{this.indent($a);}};return this.stopEvent(e);}};if((e.keyCode==90)&&this.ctrlAltShift(e,true,false,false)){this.undo();return this.stopEvent(e);};if((e.keyCode==89)&&this.ctrlAltShift(e,true,false,false)){this.redo();return this.stopEvent(e);};if(e.keyCode==PX.key_backspace||e.keyCode==46){if($P){this.saveUndoStep(e.keyCode==PX.key_backspace?"backspace":"del");this.stateChanged();}else{this.saveUndoStep();};if(this.handleKeys&&e.keyCode==PX.key_backspace){var $02=this.range();if(this.afterIcon($a,$02)||this.destroyMacro($02)||this.mergeLines($02)){return this.stopEvent(e);}}else if(this.handleKeys){var $02=this.range();if(this.beforeIcon($a,$02)){return this.stopEvent(e);}}};var $j=this.range();if($j&&$j.collapsed&&!this.modifier(e.keyCode)){this.saveUndoStepBeforeKeypress();}else{if(!$j&&!this.between(e.keyCode,[37,40],[33,36])){this.saveUndoStep();this.stateChanged();}}};PXRichTextEdit1.prototype.modifier=function($03){return this.between($03,[16,20],[91,92],[144,145])};PXRichTextEdit1.prototype.handleKeyPress=function(e){if(this.editorMode!='edit')return;if((this.lookup1&&this.lookup1.getVisible())||(this.lookup2&&this.lookup2.getVisible())){return this.stopEvent(e);};var $a=this.getEditDoc();var $d=$a.body;var $P=!(e.ctrlKey||e.altKey||e.shiftKey);if((e.keyCode==PX.key_enter)&&$P){this.saveUndoStep();}else{this.stateChanged();};var $04=(e.charCode&&(e.ctrlKey||e.altKey))||(e.keyCode>=33&&e.keyCode<=40)||e.keyCode==PX.key_enter||e.keyCode==PX.key_tab||e.keyCode==PX.key_del||e.keyCode==PX.key_backspace;var $05=e.charCode;var $06;var $b;if(e.ctrlKey){var $07=e.keyCode?e.keyCode:e.which;var $08=null;$07=String.fromCharCode($07);var $09=true;switch($07){case 'b':$08='bold';break;case 'i':$08='italic';break;case 'u':$08='underline';break;case 'd':$08='strike';break;case '=':$08=e.shiftKey?'superscript':'subscript';break;case 'f':if(e.shiftKey)this.ddFontname.focus();break;case 'p':if(e.shiftKey)this.ddFontsize.focus();break;case 'l':$08='JustifyLeft';break;case 'e':$08='JustifyCenter';break;case 'r':$08='JustifyRight';break;case 'j':$08='JustifyFull';break;default:$09=false;break;};if($09){__px(this).cancelEvent(e);if($08)this.execCommand2($08);}}else if(e.keyCode==PX.key_enter&&__px(this).IsIE){};var $R=(this.editorMode=="edit")&&!this.isPreview;if((e.charCode==33)&&this.ctrlAltShift(e,false,false,true)&&!this.portalMode){if($R){var $0a=this.textBeforeCursor($a,this.range());if(this.endsWithSpace($0a)){this.saveUndoStepBeforeKeypress();this.showLookup(this.lookup2,e.target,true);return this.stopEvent(e);}}};if((e.charCode==91)&&$P&&!this.portalMode){if($R){var $0a=this.textBeforeCursor($a,this.range());if(this.endsWithSpace($0a)){this.saveUndoStepBeforeKeypress();this.showLookup(this.lookup1,e.target,false);return this.stopEvent(e);}}}};PXRichTextEdit1.prototype.handleKeyUp=function(e){if(this.editorMode!='edit'&&this.editorMode!='plain')return;var $a=this.getEditDoc();if(false&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode!=17&&e.keyCode!=18&&e.keyCode!=91&&this.between(e.keyCode,[65,90],[48,57],[219,222],[186,191])){var $j=this.range();if(this.handleKeys&&$j&&$j.collapsed){var $s=this.insertMarkers($a);var $0b=$j.commonAncestorContainer;var $0c=$0b==$a.body;var $0d=$0b.nodeType==document.TEXT_NODE&&$0b.parentNode==$a.body;var p=$a.createElement('p');p.className="richp";var $0e=[];if($0c){for(var i=$j.endOffset-1;i>=0;i--){var $J=$a.body.childNodes[i];if($J.nodeType==document.TEXT_NODE||$J.nodeType==document.COMMENT_NODE){$0e.unshift($J);}else{break;}}}else if($0d){var $f=$j.commonAncestorContainer;while($f&&$f.nodeType==document.TEXT_NODE){$0e.unshift($f);$f=$f.previousSibling;}};if($0e.length){$a.body.insertBefore(p,$0e[0]);while($0e.length){var $f=$0e.shift();p.appendChild($f);};var $o=$a.createRange();};if($s){this.removeMarkers($a,$s.startMarker,$s.startType);};var $0f=this.range();if($0f){var end=$0f.endContainer;if(end.nodeType==document.TEXT_NODE){end=end.parentNode;};if(end.nodeName.toLowerCase()=='p'&&$0f.collapsed&&end.childNodes.length>1){this.chopOffBr(end);}}};if(this.between(e.keyCode,[65,90],[48,57],[219,222],[186,191])){this.syncSpaces($a);}};this.unexciteButtons();this.syncButtons();var $P=!(e.ctrlKey||e.metaKey||e.altKey);if($P&&!this.between(e.keyCode,[112,123],[37,40],[33,36],[45,45])&&!this.modifier(e.keyCode)){this.tryUpdateState();}};PXRichTextEdit1.prototype.syncSpaces=function($a){var $0g=[];var $0h=$a.createTreeWalker($a,NodeFilter.SHOW_TEXT,function($f){return $f.textContent.indexOf('\u200b')>-1;},false);var $f=undefined;while($f=$0h.nextNode()){if(!(this.tagNClass($f.parentNode,'td')&&!this.replace($f.parentNode.textContent,['\u200b','']).length)){$0g.push($f);}};var $j=this.range();if($j&&$j.collapsed){for(var i=0;i<$0g.length;i++){$f=$0g[i];if(this.specialEmptyNode($f)){if(($j.startContainer==$f.parentNode)&&$j.startOffset>this.nodeIndex($f)){$j.setStart($f,$j.startOffset-1);$j.setEnd($f,$j.endOffset-1);};this.deleteNode($f);}else{var $0i=$f.textContent.indexOf('\u200b');if($0i>-1){var $0j=$j.startContainer==$f;var $0k=$0j&&($j.startOffset>$0i);var $0l=$0k?$j.startOffset-1:$j.startOffset;$f.textContent=this.replace($f.textContent,['\u200b','']);if($0j){$j.setStart($f,$0l);$j.setEnd($f,$0l);}}}};this.setRange($j);}};PXRichTextEdit1.prototype.afterIcon=function($a,$02){if($02.collapsed){var $0m=$02.endContainer;var $0n;if(!$02.endOffset){while($0m.parentNode.firstChild==$0m&&$0m!=$a.body){$0m=$0m.parentNode;};$0n=$0m.previousSibling;}else{$0n=$0m.childNodes[$02.endOffset-1];};if($0n){while($0n&&$0n.childNodes&&$0n.nodeName.toLowerCase()!='br'&&$0n.childNodes.length){$0n=$0n.lastChild;}};if($0n&&$0n.getAttribute&&$0n.getAttribute('data-convert')=='icons'){return true;}}else{if($02&&$02.commonAncestorContainer.querySelectorAll){var $0o=$02.commonAncestorContainer.querySelectorAll('[data-convert="icons"]');for(var i=0;i<$0o.length;i++){var $0p=$0o[i];if(this.insideRange($a,$0p,$02)){var parent=this.findParentNode('table.GrayBox',$0p);if(!this.insideRange($a,parent,$02)){return true;}}}}}};PXRichTextEdit1.prototype.beforeIcon=function($a,$02){if($02.collapsed){var $0m=$02.endContainer;var $C;if($02.endOffset==$02.endContainer.childNodes.length){while($0m.parentNode.lastChild==$0m&&$0m!=$a.body){$0m=$0m.parentNode;};$C=$0m.nextSibling;}else{$C=$0m.childNodes[$02.endOffset];};if($C){while($C&&$C.childNodes&&$C.nodeName.toLowerCase()!='br'&&$C.childNodes.length){$C=$C.firstChild;}};if($C&&$C.getAttribute&&$C.getAttribute('data-convert')=='icons'){return true;}}else{if($02&&$02.commonAncestorContainer.querySelectorAll){var $0o=$02.commonAncestorContainer.querySelectorAll('[data-convert="icons"]');for(var i=0;i<$0o.length;i++){var $0p=$0o[i];if(this.insideRange($a,$0p,$02)){var parent=this.findParentNode('table.GrayBox',$0p);if(!this.insideRange($a,parent,$02)){return true;}}}}}};PXRichTextEdit1.prototype.destroyMacro=function($02){if(!$02){return false;};var $0q=function($f){return $f&&$f.getAttribute&&$f.getAttribute('data-expand');};var $0r=function($f){return $f&&$f.nodeName.toLowerCase()=='br';};if($02.collapsed){var $0s=this.firstNode($02);if($0s){var $0t=$0s;while($0t&&!this.nodeIndex($0t)&&!this.tagNClass($0t.parentNode,'body','td','blockquote.realbq')){$0t=$0t.parentNode;};if($0t&&$0q($0t.previousSibling)){this.saveUndoStep();this.deleteNode($0t.previousSibling);}else if($0t&&$0r($0t.previousSibling)&&$0t.previousSibling&&$0q($0t.previousSibling.previousSibling)){this.saveUndoStep();this.deleteNode($0t.previousSibling.previousSibling);this.deleteNode($0t.previousSibling);}}}};PXRichTextEdit1.prototype.firstNode=function($02){var $f;if($02.startContainer.nodeType==document.TEXT_NODE&&!$02.startOffset){$f=$02.startContainer;}else if($02.startContainer.nodeType==document.ELEMENT_NODE&&$02.startContainer.childNodes.length>$02.startOffset){$f=$02.startContainer.childNodes[$02.startOffset];}else if($02.startContainer.nodeType==document.ELEMENT_NODE&&!$02.startContainer.childNodes.length){$f=$02.startContainer;};return $f;};PXRichTextEdit1.prototype.mergeLines=function($02){var $0u=function($f){var $0t=$f;while($0t.childNodes.length==1&&$0t.firstChild.nodeType==document.ELEMENT_NODE&&this.isBlock($0t.firstChild)&&$0t.firstChild.nodeName.toLowerCase()!='br'){$0t=$0t.firstChild;};return $0t;};var $0v=function($f){var $0t=$f;while($0t.firstChild){$0t=$0t.firstChild;};return $0t;};var $0w=function($f){var $0x=[];for(var i=0;i<$f.childNodes.length;i++){var $J=$f.childNodes[i];if(this.isInline($J)){$0x.push($J);}else{$0x=$0x.concat($0w.call(this,$J));}};return $0x;};var $0y=function($f){var $0e=$0w.call(this,$f);for(var i=0;i<$0e.length;i++){if($0e[i].nodeName.toLowerCase()=='br'){return $0e.slice(0,i);}};return $0e;};var $0z=function($f){if(!$0t||this.nodeIndex($0t)){return false;};if(!this.tagNClass($0t.parentNode,'body','td','blockquote.realbq')){return true;};if(this.tagNClass($0t.parentNode,'blockquote.realbq')&&this.noText($0t)){return true;};return false;};if(!$02){return false;};if($02.collapsed){var $f=this.firstNode($02);if($f){var $0t=$f;while($0z.call(this,$0t)){$0t=$0t.parentNode;};if($0t&&$0t.previousSibling){var $0A=this.isInline($0t.previousSibling);var $0B=this.isInline($0t);var $0C=this.isAtomic($0t.previousSibling);var $0D=this.isAtomic($0t);if($0C){this.deleteNode($0C);}else if($0A&&$0D){return;}else if($0A&&!$0B){var $0E=$0y.call(this,$0t);var $J;while($J=$0E.shift()){$0t.parentNode.insertBefore($J,$0t);};this.deleteNode($0t);}else if(!$0A&&$0B){if(this.noText($0t.previousSibling)){this.deleteNode($0t.previousSibling);}else{var $C=$0t.nextSibling;var $0F=$0u.call(this,$0t.previousSibling);while(this.isInline($0t)&&!this.tagNClass($0t,'br')){$0F.appendChild($0t);$0t=$C;$C=$0t.nextSibling;}}}else if(!$0A&&!$0B){if(this.noText($0t.previousSibling)){this.deleteNode($0t.previousSibling);}else{var $0E=$0y.call(this,$0t);var $J,$0G=$0E[0];var $0F=$0u.call(this,$0t.previousSibling);if($0E.length){this.chopOffBr($0F);}while($J=$0E.shift()){$0F.appendChild($J);};this.deleteNode($0t);if($0G){this.focusBeforeTag($0v.call(this,$0G));}else if($0F&&$0F.nodeName.toLowerCase()!='br'){this.focusInsideContainersEnd($0F);}}}else{return;};return true;}else if($0t&&this.noText($0t)){this.deleteNode($0t);this.ensureDefaultBody(this.getEditDoc());return true;}}}};PXRichTextEdit1.prototype.leftPressed=function($N){var r1=this.range();if(r1){var $0H=this.leftPressed1(r1.startContainer,r1.startOffset);if($0H){var r2=r1.cloneRange();r2.setStart($0H.container,$0H.offset);if(!$N){r2.setEnd($0H.container,$0H.offset);};this.setRange(r2);return true;}}};PXRichTextEdit1.prototype.rightPressed=function($N){var r1=this.range();if(r1){var $0H=this.rightPressed1(r1.endContainer,r1.endOffset);if($0H){var r2=r1.cloneRange();r2.setEnd($0H.container,$0H.offset);if(!$N){r2.setStart($0H.container,$0H.offset);};this.setRange(r2);return true;}}};PXRichTextEdit1.prototype.leftPressed1=function($0I,$0J){var $a=this.getEditDoc();var $0K=false;var $0L=function($f){if($f){if($f.nodeType==document.TEXT_NODE){var $0M=$f.textContent;for(var i=$0M.length-1;i>=0;i--){var c=$0M[i];if(c=='\u200b'){if($0K){return{$D:$f,$0N:i};}else{continue;}};if(!this.any(c,' ','\t','\r','\r')){return{$D:$f,$0N:$0K?i+1:i};}}}else if($f.nodeType==document.ELEMENT_NODE){if($f.nodeName.toLowerCase()=='br'){return{$D:$f.parentNode,$0N:this.nodeIndex($f)};};if(this.isBlock($f)){$0K=true;};for(var i=$f.childNodes.length-1;i>=0;i--){var $0O=$0L.call(this,$f.childNodes[i]);if($0O){return $0O;}}}}};var $0P=function($0O){if($0O.container.nodeType==document.TEXT_NODE){var $0M=$0O.container.textContent;while($0O.offset&&$0M.length>=$0O.offset&&$0M[$0O.offset-1]=='\u200b'){$0O.offset--;};if($0O.offset){return{$D:$0O.container,$0N:$0O.offset-1};}else return;}else if($0O.container.nodeType==document.ELEMENT_NODE){for(var i=$0O.offset-1;i>=0;i--){var $0Q=$0L.call(this,$0O.container.childNodes[i]);if($0Q)return $0Q;}}};var $0R=function($0O){$0K|=this.isBlock($0O.container);while($0O.container!=$a.body&&!$0O.offset){$0K|=this.isBlock($0O.container);$0O.offset=this.nodeIndex($0O.container);$0O.container=$0O.container.parentNode;};if($0O.offset){return $0O;}};var $0H={$D:$0I,$0N:$0J};for(var k=0;k<1000;k++){var $0S=$0P.call(this,$0H);if($0S){return $0S;};$0S=$0R.call(this,$0H);if(!$0S){return;};$0H=$0S;}};PXRichTextEdit1.prototype.rightPressed1=function($0I,$0J){var $a=this.getEditDoc();var $0K=false;var $0L=function($f){if($f){if($f.nodeType==document.TEXT_NODE){var $0M=$f.textContent;for(var i=0;i<$0M.length;i++){var c=$0M[i];if(c=='\u200b'){if($0K){return{$D:$f,$0N:i};}else{continue;}};if($0K){return{$D:$f,$0N:i};};if(!this.any(c,' ','\t','\r','\r')){$0K=true;}}}else if($f.nodeType==document.ELEMENT_NODE){if($f.nodeName.toLowerCase()=='br'){if($0K){return{$D:$f.parentNode,$0N:this.nodeIndex($f)};};$0K=true;};if(this.isBlock($f)||this.any($f.nodeName.toLowerCase(),'img')){return{$D:$f.parentNode,$0N:this.nodeIndex($f)+($0K?0:1)};};for(var i=0;i<$f.childNodes.length;i++){var $J=$f.childNodes[i];if($J.nodeName.toLowerCase()=='br'&&$f.lastChild==$J){return;};var $0O=$0L.call(this,$J);if($0O){return $0O;}}}}};var $0T=function($0O){if($0O.container.nodeType==document.TEXT_NODE){var $0M=$0O.container.textContent;while($0O.offset<$0M.length&&$0M[$0O.offset]=='\u200b'){$0O.offset++;};if($0O.offset<$0M.length){return{$D:$0O.container,$0N:$0O.offset+1};}else return;}else if($0O.container.nodeType==document.ELEMENT_NODE){$0K|=$0O.container.childNodes[$0O.offset].nodeName.toLowerCase()=='br';for(var i=$0O.offset+1;i<$0O.container.childNodes.length;i++){var $0Q=$0L.call(this,$0O.container.childNodes[i]);if($0Q){return $0Q;}}}};var $0R=function($0O){var $0U=function($D,$0N){if($D.nodeType==document.TEXT_NODE){return $D.textContent.length<=$0N+1;}else if($D.nodeType==document.ELEMENT_NODE){var $f=$D.childNodes[$0N];var $0V=$D.lastChild;return $f==$0V||($0V.nodeName.toLowerCase()=='br'&&$0V.previousSibling==$f);}else{return true;}};$0K|=this.isBlock($0O.container);while($0O.container!=$a.body&&$0U($0O.container,$0O.offset)){$0K|=this.isBlock($0O.container);$0O.offset=this.nodeIndex($0O.container);$0O.container=$0O.container.parentNode;};if($0O.offset<$0O.container.childNodes.length-1){return $0O;}};var $0H={$D:$0I,$0N:$0J};for(var k=0;k<1000;k++){var $0S=$0T.call(this,$0H);if($0S){return $0S;};$0S=$0R.call(this,$0H);if(!$0S){return;};$0H=$0S;}};


var PXDataViewCommand={NoteShow:"NoteShow",FilesMenuShow:"FilesMenuShow",ActivityShow:"ActivityShow",LinkShow:"LinkShow",LinkUpdate:"LinkUpdate",LinkSend:"LinkSend",NotifyMenuShow:"NotifyMenuShow",NotifyShow:"NotifyShow",CreateProviderFile:"CreateProviderFile",Refresh:"Refresh"};function PXDataViewBar($a,$b,$c){PXDataViewBar.initializeBaseA(this,[$a,$b,$c]);__px_cm(this).readProperties(this,$c,PXDataViewBar.properties);this.commandSourceID=this.ID;this.noteBtnCss=" noteButtonSel";var $d=this.$R(PXDataViewCommand.FilesMenuShow);if($d){this.filesText=$d.getText();this.setFilesState(this.filesCount);};$d=this.$R(PXDataViewCommand.ActivityShow);if($d){this.activityText=$d.getText();this.setActivityState(this.activityCount);};this.events.appendEvents(PXDataViewBar.events,$c.clientEvents);__px_cm(this).registerRequiresOnLoad(this,$b.id);};PXDataViewBar.__baseType=PXToolBar;PXDataViewBar.properties=[["dataSourceID",JSType.String,""],["hasNote",JSType.Bool,false],["activityCount",JSType.Int,0],["filesCount",JSType.Int,0],["screenLink",JSType.String,""],["screenParams",JSType.String,""],["callbacks",JSType.Array,PXCallbackManager.commandDesc],["forceNoteCallback",JSType.Bool,false]];PXDataViewBar.callbackProps=[["dataKey",JSType.String,"","setDataKey"],["hasNote",JSType.Bool,false,"setNoteState"],["activityCount",JSType.Int,0,"setActivityState"],["filesCount",JSType.Int,0,"setFilesState"]];PXDataViewBar.events={$filesMenuShown:2,$uploaderShown:3,$notifyMenuShown:4,$afterUpload:5};PXDataViewBar.prototype.onLoad=function(){this.$S(this.screenLink,this.screenParams);};PXDataViewBar.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXDataViewBar.callbackProps);if(this.$T)this.$T.autoRepaint=true;this.$S($c.screenLink,$c.screenParams);};PXDataViewBar.prototype.$S=function($e,$f){if($e&&__win(this).parentPanel==null&&!__win(this).__suppressUrlUpdate){try{var $g=(__win(this)==__px(this).topWin()),ar=new Array();if($g){var $h=__px(this).getQueryParam("TimeStamp",__loc(this).href);var $i=__px(this).getQueryParam("PopupPanel",__loc(this).href);if($f&&$e.toLowerCase().indexOf($f.toLowerCase())<0)ar.push($f);if($h)ar.push($h);if($i)ar.push($i);ar.push(__px(this).removeQueryParam("ScreenID",$e));$e=ar.join('&');};__win(this).top.history.replaceState({},__doc(this).title,"?"+decodeURIComponent(escape($e)));__win(this).__urlUpdated=true;}catch(ex){}}};PXDataViewBar.prototype.setDataKey=function($j){if($j!=null&&this.dataKey!=$j){delete this.noteText;delete this.popupNoteText;this.dataKey=$j;if(this.$T)this.$T.autoRepaint=true;}};PXDataViewBar.prototype.setNoteState=function($k){this.hasNote=$k;var $d=this.$R(PXDataViewCommand.NoteShow);if($d){var be=$d.element;$d.setImage("main@"+($k?"Note":"NoteEmpty"));if($k){if(be.className.indexOf(this.noteBtnCss)<0)be.className=be.className+this.noteBtnCss;}else be.className=be.className.replace(this.noteBtnCss,"");;};if(this.noteStateCallback)this.noteStateCallback($k);};PXDataViewBar.prototype.setFilesState=function($l){this.filesCount=$l;var $d=this.$R(PXDataViewCommand.FilesMenuShow);if($d){$d.setText(this.filesText+($l>0?(' ('+$l+')'):""));$d.setImage("main@"+($l>0?"Files":"FilesEmpty"));};if(this.filesStateCallback)this.filesStateCallback($l);};PXDataViewBar.prototype.setActivityState=function($m){this.activityCount=$m;var $d=this.$R(PXDataViewCommand.ActivityShow);if($d){$d.setText(this.activityText+($m>0?(' ('+$m+')'):""));$d.setImage("main@"+($m>0?"Activity":"ActivityEmpty"));}};PXDataViewBar.prototype.$R=function($n){var $o=null;for(var i=0;i<this.items.length;i++)if(this.items[i].commandName==$n){$o=this.items[i];break;};return $o;};PXDataViewBar.prototype.showNote=function(){var ib=this.$U;if((this.noteText==undefined&&this.hasNote)||ib==null||this.forceNoteCallback){var $p=this.callbacks[1],$a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,"",Function.createDelegate(this,this.processNoteShow),$a);}else{ib.setText(this.noteText?this.noteText:"");if(ib.setPopupText)ib.setPopupText(this.popupNoteText?this.popupNoteText:"");this.$V(ib);}};PXDataViewBar.prototype.saveNote=function($q,$r){var $p=this.callbacks[2],$a=new Object();$a.id=this.ID;$a.command=$p.name;$a.text=$q;$a.popupText=$r;if($r)$q+='#|#'+$r;__px_callback(this).execI(this,$p,$q,Function.createDelegate(this,this.processNoteSave),$a);};PXDataViewBar.prototype.processNoteSave=function($s,$a){var $t=__px_all(this)[$a.id],$q=$a.text;if($t){$t.noteText=$q;$t.popupNoteText=$a.popupText;$t.setNoteState(!!$q||!!$a.popupText);}};PXDataViewBar.prototype.processNoteShow=function($s,$a){if($s){var $t=__px_all(this)[$a.id];var $u=new PXXmlDoc("",$s),$v=$u.rootNode;var $w=$t.$U,me=this;if($v.childNodes.length>0){__px_cm(this).processHtmlData($v.childNodes[0].nodeValue);setTimeout(function(){me.$W($t);},0);}else if($w){$w.setText($v.getAttribute("Note"));if($w.setPopupText)$w.setPopupText($v.getAttribute("PopupNote"));this.$V($w);}}};PXDataViewBar.prototype.$W=function($t){var $w=$t.$U=__px_all(this)[$t.ID+"_ib"];if($w){$w.linkedPanel=$t;$w.events.addEventHandler("afterHide",Function.createDelegate(this,this.$X));$t.viewState.update("InputBox",true);this.$V($w);}};PXDataViewBar.prototype.$V=function($w){this.noteText=$w.getText();if($w.getPopupText)this.popupNoteText=$w.getPopupText();$w.show(this.$R(PXDataViewCommand.NoteShow));$w.elemText.setSelectionRange(10000,10000);};PXDataViewBar.prototype.$X=function($w){var $s=$w.dialogResult;if($s==1){var $x=$w.getPopupText?$w.getPopupText():null;$w.linkedPanel.saveNote($w.getText(),$x);}};PXDataViewBar.prototype.showFiles=function(){var ds=__px_alls(this)[this.dataSourceID];if(ds!=null){if(this.$Y==null)this.$Y="AttachEntity;"+this.ID;if(this.$Z==null)this.$Z=Function.createDelegate(this,this.$00);if(ds.saveCommandName){var $y=ds.getCommandState(this,ds.saveCommandName);if(this.filesCount==0||$y.getEnabled()){ds.events.addEventHandler("commandPerformed",this.$Z);ds.executeCommand(ds.saveCommandName,this.$Y);}else this.$01();}else this.$01();}};PXDataViewBar.prototype.$00=function($z,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$Z);if($a.commandArg==this.$Y&&!$a.alert&&!ds.alert)this.$01();};PXDataViewBar.prototype.$01=function(){if(this.$T==null){__px_callback(this).execI(this,this.callbacks[3],"",Function.createDelegate(this,this.processFilesShow));}else this.$02();};PXDataViewBar.prototype.$02=function(){this.$T.show();this.$T.autoRepaint=false;};PXDataViewBar.prototype.processFilesShow=function($s,$a){if($s){__px_cm(this).processHtmlData($s);var me=this;setTimeout(function(){me.$03();},0);}};PXDataViewBar.prototype.$03=function($t){this.$T=__px_all(this)[this.ID+"_fb"];if(this.$T){var h=Function.createDelegate(this,this.$04);this.$T.events.addEventHandler("afterUpload",h);this.$02();}};PXDataViewBar.prototype.$04=function($z,$A){this.executeCommand(PXDataViewCommand.Refresh);this.fireEvent("afterUpload",null,$A);};PXDataViewBar.prototype.showLinkPanel=function(){if(!this.linkPanel){var $p=this.callbacks[6],$a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,"",Function.createDelegate(this,this.processLinkShow),$a);}else{var $p=this.callbacks[7],$a=new Object();$a.id=this.ID;$a.command=$p.name;var $d=this.$R(PXDataViewCommand.LinkShow);if($d==null)this.linkPanel.position=1;this.linkPanel.show($d);__px_callback(this).execI(this,$p,"",Function.createDelegate(this,this.processLinkUpdate),$a);}};PXDataViewBar.prototype.processLinkShow=function($s,$a){if($s){var $t=__px_all(this)[$a.id];var $u=new PXXmlDoc("",$s),$v=$u.rootNode;if($v.childNodes.length>0){__px_cm(this).processHtmlData($v.childNodes[0].nodeValue);setTimeout(function(){$t.$05();},0);}}};PXDataViewBar.prototype.processLinkUpdate=function($s,$a){var $t=__px_all(this)[$a.id];if($t&&$t.linkPanel){var $u=new PXXmlDoc("",$s);var $B=$u.rootNode.getAttribute("int");var $C=$u.rootNode.getAttribute("ext");$t.linkPanel.setLink($B,$C);}};PXDataViewBar.prototype.$05=function(){this.linkPanel=__px_all(this)[this.ID+"_gtlnk"];var $d=this.$R(PXDataViewCommand.LinkShow);if($d==null)this.linkPanel.position=1;this.linkPanel.show($d);var $D=Function.createDelegate(this,this.$06);__px(this).addEventHandler(this.linkPanel.btnEmail.element,"click",$D);};PXDataViewBar.prototype.$06=function(){var $p=this.callbacks[8];var $a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,this.linkPanel.getExternalLink());};PXDataViewBar.prototype.showActivity=function(){var ds=__px_alls(this)[this.dataSourceID];if(ds!=null){if(this.$Y==null)this.$Y="AttachEntity;"+this.ID;if(this.$07==null)this.$07=Function.createDelegate(this,this.$08);if(ds.saveCommandName){var $y=ds.getCommandState(this,ds.saveCommandName);if(this.activityCount==0||$y.getEnabled()){ds.events.addEventHandler("commandPerformed",this.$07);ds.executeCommand(ds.saveCommandName,this.$Y);}else this.$09();}else this.$09();}};PXDataViewBar.prototype.$08=function($z,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$07);if($a.commandArg==this.$Y&&!$a.alert&&!ds.alert)this.$09();};PXDataViewBar.prototype.$09=function(){if(!this.$0a){var $p=this.callbacks[4],$a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,"",Function.createDelegate(this,this.processActivityShow),$a);}else{var $E=this.$0a.containerPanel;$E.show();}};PXDataViewBar.prototype.processActivityShow=function($s,$a){if($s){var $t=__px_all(this)[$a.id];var $u=new PXXmlDoc("",$s),$v=$u.rootNode;var $F=$t.$0a;if($v.childNodes.length>0){__px_cm(this).processHtmlData($v.childNodes[0].nodeValue);setTimeout(function(){$t.$0b();},0);}}};PXDataViewBar.prototype.$0b=function(){if(!this.$0a){var $E=__px_all(this)[this.ID+"_ab"];this.$0a=__px_all(this)[this.ID+"_ab_abc"];this.$0a.setCallbackProxy(this);this.$0a.containerPanel=$E;$E.linkedPanel=this;$E.events.addEventHandler("afterHide",Function.createDelegate(this,this.$0c));this.viewState.update("ActivityBox",true);$E.show();}};PXDataViewBar.prototype.$0c=function(){var $G=__win(this),top=$G.top;if(top!=$G&&top.MainFrame!=null&&top.MainFrame.refreshEventsInfo)top.MainFrame.refreshEventsInfo();this.executeCommand(PXDataViewCommand.Refresh);};PXDataViewBar.prototype.checkActivity=function(){var $a=new Object(),$p=this.callbacks[5];$a.id=this.ID;$a.command="CheckActivity";__px_callback(this).execI(this,$p,"",null,$a);};PXDataViewBar.prototype.packCallbackCommand=function(id,$n){return "ActivityBox$"+id+"$"+$n;};PXDataViewBar.prototype.showNotify=function(){var $p=this.callbacks[9];if(this.$0d){this.$0d.show(this.$R(PXDataViewCommand.NotifyShow).element,true);var $H=new Object();$H.menu=this.$0e;this.fireEvent("notifyMenuShown",null,$H);}else{var $a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,"",Function.createDelegate(this,this.processNotifyMenuShow),$a);}};PXDataViewBar.prototype.processNotifyMenuShow=function($s,$a){if($s){var $t=__px_all(this)[$a.id],me=this;var $u=new PXXmlDoc("",$s),$v=$u.rootNode;if($v.childNodes.length>0){__px_cm(this).processHtmlData($v.childNodes[0].nodeValue);setTimeout(function(){me.$0f($t);},0);}}};PXDataViewBar.prototype.$0f=function($t){var $I=$t.$0d=__px_all(this)[$t.ID+"_nmnu"];if($I){var $A=new Object();var h=Function.createDelegate($t,$t.$0g);$I.events.addEventHandler("itemClick",h);$I.show(this.$R(PXDataViewCommand.NotifyShow).element,true);$A.menu=$I;$t.fireEvent("notifyMenuShown",null,$A);}};PXDataViewBar.prototype.$0g=function($J,e){var $p=this.callbacks[10];if($p&&this.$0d){var $K=__px(this).eventElem(e.event).tagName=="SPAN"?"+":"";if($K=="+"){var ds=__px_alls(this)[this.dataSourceID];if(ds!=null){if(this.$0h==null)this.$0h=Function.createDelegate(this,this.$0i);if(this.$0j==null)this.$0j="AttachEntity;"+this.ID;this.onNotifyItemClickedCommand=e.item.value+"+";ds.events.addEventHandler("commandPerformed",this.$0h);ds.executeCommand(ds.saveCommandName,this.$0j);}}else{var $a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,e.item.value+(__px(this).eventElem(e.event).tagName=="SPAN"?"+":""),null,$a);};var $L=this;setTimeout(function(){$L.deleteNotifyMenu();},0);}};PXDataViewBar.prototype.$0i=function($z,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$0h);if($a.commandArg==this.$0j&&!$a.alert&&!ds.alert){var $p=this.callbacks[10];if($p){$a=new Object();$a.id=this.ID;$a.command=$p.name;__px_callback(this).execI(this,$p,this.onNotifyItemClickedCommand,null,$a);}}};PXDataViewBar.prototype.deleteNotifyMenu=function(){if(this.$0d){this.$0d.element.parentNode.removeChild(this.$0d.element);delete this.$0d;}};PXDataViewBar.prototype.executeCommand=function($M,$N){if(!this.getCommandState(this,$M).getEnabled())return;switch($M){case PXDataViewCommand.NoteShow:this.showNote();break;case PXDataViewCommand.FilesMenuShow:this.showFiles();break;case PXDataViewCommand.ActivityShow:this.showActivity();break;case PXDataViewCommand.LinkShow:this.showLinkPanel();break;case PXDataViewCommand.NotifyShow:this.showNotify();break;case PXDataViewCommand.CreateProviderFile:__px_callback(this).execI(this,__px_callback(this).createCommand("CreateProviderFile",true,false,true,true),"",null,null,{$O:true,$n:PXDataViewCommand.Refresh,$P:this.ID});break;case PXDataViewCommand.Refresh:__px_callback(this).execI(this,__px_callback(this).createCommand(PXDataViewCommand.Refresh,true,false,false),"",Function.createDelegate(this,this.processRefresh));break;}};PXDataViewBar.prototype.processRefresh=function($s,$a){if($s){var $props;eval("$props = "+unescape($s));this.setProperties($props);}};PXDataViewBar.prototype.getCommandState=function($z,$M){switch($M){case PXPanelCommand.NoteShow:case PXPanelCommand.FilesMenuShow:case PXPanelCommand.ActivityShow:case PXPanelCommand.LinkShow:case PXPanelCommand.LinkUpdate:case PXPanelCommand.NotifyMenuShow:case PXPanelCommand.NotifyShow:case PXPanelCommand.CreateProviderFile:case PXDataViewCommand.Refresh:return new PXCommandState(true,true);};return PXCommandState.empty;};PXDataViewBar.prototype.executeCallback=function($M,$N){this.executeCommand($M,$N);};PXDataViewBar.prototype.registerCommandControl=function($Q,$M){__px_cm(this).registerCommandControl(this,$Q,$M);};PXDataViewBar.prototype.notifyCommandState=function(){__px_cm(this).notifyCommandState(this,PXDataViewCommand);};


var PXFilesDialogCommand={AddFile:"AddFile",UploadFile:"UploadFile",CreateProviderFile:"CreateProviderFile",GetFile:"GetFile",AddLink:"AddLink",RemoveLink:"RemoveLink",ForceRefresh:"ForceRefresh"};function PXFilesDialog($a,$b,$c,$d){PXFilesDialog.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXFilesDialog.properties);if(this.allowedFiles){this.allowedFilesMsg=this.allowedFilesMsg.replace("{0"+String.fromCharCode(125),this.allowedFiles);this.allowedFiles=this.allowedFiles.toLowerCase().split(';');};__px(this).addEventHandler(this.element,"drop",Function.createDelegate(this,this.$K));__px_cm(this).registerRequiresOnLoad(this,$b.id);this.events.appendEvents(PXFilesDialog.events,$c.clientEvents);this.uploadFileCall=__px_callback(this).createCommand(PXFilesDialogCommand.UploadFile,true,false,false);this.providerFileCall=__px_callback(this).createCommand(PXFilesDialogCommand.CreateProviderFile,true,false,true,true);this.getFileCall=__px_callback(this).createCommand(PXFilesDialogCommand.GetFile,false,false,false,false);this.addLinkCall=__px_callback(this).createCommand(PXFilesDialogCommand.AddLink,false,false,false,false);this.removeLinkCall=__px_callback(this).createCommand(PXFilesDialogCommand.RemoveLink,false,false,false,false);this.forceRefreshCall=__px_callback(this).createCommand(PXFilesDialogCommand.ForceRefresh,false,false,false,false);this.banner=this.element.querySelector('.fileDialogInfo');if(this.banner){this.bannerText=this.banner.children[1];var me=this;this.banner.lastElementChild.onclick=function(){me.banner.classList.remove('shown');}};this.events.addEventHandler('beforeShow',Function.createDelegate(this,this.$L));this.events.addEventHandler('afterHide',Function.createDelegate(this,this.$M));this.$N={};};PXFilesDialog.properties=[["maxFileSize",JSType.Int,25000],["maxFileSizeMsg",JSType.String,""],["allowedFiles",JSType.String,""],["allowedFilesMsg",JSType.String,""],["viewHash",JSType.Int,0],["signalUrls",JSType.String,""],];PXFilesDialog.events={$afterUpload:9};PXFilesDialog.__baseType=PXSmartPanel;PXFilesDialog.prototype.executeCallback=function($e,$f){if($e==PXFilesDialogCommand.CreateProviderFile){__px_callback(this).execI(this,this.providerFileCall,"",null,null,{$g:true,$h:"Refresh",$i:this.grid.ID});};if($e==PXFilesDialogCommand.GetFile){__px_callback(this).execI(this,this.getFileCall,"",null,null,null);};if($e==PXFilesDialogCommand.AddLink){__px_callback(this).execI(this,this.addLinkCall,"",null,null,null);};if($e==PXFilesDialogCommand.RemoveLink){var $j=this.grid.activeRow;if($j){var $k=$j.getCell(0).getValue();if($k){var $l=$k.lastIndexOf('fileID');if($l>-1)__px_callback(this).execI(this,this.removeLinkCall,$k.substring($l+"fileID=".length),null,null,null);}}};if($e==PXFilesDialogCommand.ForceRefresh){__px_callback(this).execI(this,__px_callback(this).createCommand(PXFilesDialogCommand.ForceRefresh,true,false,false),$f,null);}};PXFilesDialog.prototype.onLoad=function(){this.grid=__px_all(this)[this.ID+"_files"];this.uploader=__px_all(this)[this.ID+"_upldr"];this.uploader2=__px_all(this)[this.ID+"_upld2"];var h=Function.createDelegate(this,this.$O);this.uploader.events.addEventHandler("hideAfterUpload",h);this.uploader2.events.addEventHandler("fileUploaded",h);h=Function.createDelegate(this,this.$P);this.grid.events.addEventHandler("toolsButtonClick",h);var $m=this.grid.getLocalMenu();h2=Function.createDelegate(this,this.$Q);$m.events.addEventHandler("itemClick",h2);this.grid.events.addEventHandler("filterDialogCreated",function($n){if(null !=$n.filterDialog.dateFilters){$n.filterDialog.dateFilters=["EQ","BETWEEN","TODAY","THIS_MONTH"].filter(function($b){return $n.filterDialog.dateFilters.indexOf($b)>-1;});};var ss=$n.element.ownerDocument.styleSheets[0];ss.insertRule('#'+$n.ID+'_fd_date1_drop_customItems, #'+$n.ID+'_fd_date2_drop_customItems {display:none};');});};PXFilesDialog.prototype.$L=function($o,$p){this.banner.classList.remove('shown');if(this.signalUrls){if(!this.grid.actionsTop.toolBar.items.filter(function(_){return _.usesSignalR;}).pop())return;var me=this;if(!$.connection){var $q=this.signalUrls.split('|');var $r=function($s){var $t=document.createElement('script');$t.onerror=function(){me.bannerText.textContent="Error loading script";me.banner.classList.add('shown');};$t.onload=function(){if($q.length){$r($q.shift());}else{$.connection.fileDialogHub.client.updateStatus=function(status){try{me.grid.refresh();}catch(ex){};if(status){me.bannerText.textContent=status;me.banner.classList.add('shown');}else{me.banner.classList.remove('shown');}};$.connection.hub.start().done(function(){me.grid.actionsTop.toolBar.items.forEach(function($u){if($u.setConnection)$u.setConnection($.connection.fileDialogHub.connection.id);});}).fail(function(e){me.bannerText.textContent="Failed to init SignalR hub";me.banner.classList.add('shown');});}};$t.src=$s;$t.type='text/javascript';document.head.append($t);};$r($q.shift());}else if($.connection.hub.state===$.signalR.connectionState.disconnected){$.connection.fileDialogHub.client.updateStatus=function(status){try{me.grid.refresh();}catch(ex){};if(status){me.bannerText.textContent=status;me.banner.classList.add('shown');}else{me.banner.classList.remove('shown');}};$.connection.hub.start().done(function(){me.grid.actionsTop.toolBar.items.forEach(function($u){if($u.setConnection)$u.setConnection($.connection.fileDialogHub.connection.id);});})}else{me.grid.actionsTop.toolBar.items.forEach(function($u){if($u.setConnection)$u.setConnection($.connection.fileDialogHub.connection.id);});}}};PXFilesDialog.prototype.$M=function($o,$p){if(this.signalUrls){var id='|'+$.connection.fileDialogHub.connection.id;$.connection.hub.stop();this.grid.actionsTop.toolBar.items.forEach(function($u){if($u.removeConnection)$u.removeConnection();});}};PXFilesDialog.prototype.$P=function($o,$p){this.$R($p.button.key,$p.button);};PXFilesDialog.prototype.$Q=function($o,$p){this.$R($p.item.value,$p.item);};PXFilesDialog.prototype.$R=function($e,$o){if($e==PXFilesDialogCommand.AddFile)this.uploader.show();var $v=$o.commandSourceID?$o.commandSourceID:$o.autoCallBack.target;var $w=$o.commandName?$o.commandName:$o.autoCallBack.command;if($v&&$w){var $x=__px_cm(this).findDataSource();if($x&&$x.ID==$v){var cs=new Object();cs.enabled=true;cs.command=PXFilesDialogCommand.ForceRefresh;cs.target=this.ID;$o.popupCommand=cs;}}};PXFilesDialog.prototype.$O=function($o,$p){this.grid.refresh();this.fireEvent("afterUpload",null,$p);if(!$p.hasError)__px_cm(this).notifyFileUploaded($p.fileName,this.viewHash);};PXFilesDialog.prototype.dsCommandPerformed=function($o,$a){$o.events.removeEventHandler("commandPerformed",this.$S);delete this.$S;if(this.getVisible())this.grid.refresh();};PXFilesDialog.prototype.$K=function(e){__px(this).cancelEvent(e);if(window.FileReader==null)return;if(this.uploadFileCall.uploadCallback==null)this.uploadFileCall.uploadCallback=Function.createDelegate(this,this.$T);var $y=e.dataTransfer.files,me=this;var $z=Function.createDelegate(this,this.$U);for(var i=0;i<$y.length;i++){var $A=new FileReader(),$B=$y[i];if($B.size>this.maxFileSize*1000){alert(this.maxFileSizeMsg);break;};if(this.allowedFiles){var $C=$B.name.toLowerCase().lastIndexOf("."),$D=true;if($C>0)$D=Array.contains(this.allowedFiles,$B.name.substr($C).toLowerCase());if(!$D){alert(this.allowedFilesMsg);break;}};__px(this).addEventHandler($A,"load",function(e){var $E=[e.target.fileName,e.target.fileSize];__px_callback(me).execI(me,me.uploadFileCall,e.target.fileName+'|'+e.target.result,$z,$E);});__px(this).addEventHandler($A,"progress",function(e){var $E=[e.target.fileName,e.target.fileSize];if(e.lengthComputable)me.$T(Math.round(e.loaded/e.total*100),$E,true);});$A.fileName=$B.name;$A.fileSize=$B.size;$A.readAsDataURL($B);}};PXFilesDialog.prototype.$T=function($F,ar,$G){var $H=ar[1],$I=ar[0],px=__px(this);if($H&&$H>250000){$F=$G?($F/ 2):(percent/ 2+50);if(px.isActiveWC())px.stopWC();if(px.isActivePI()){px.setPIValue($F>=99?100:$F);if($F>=99)px.setPIText(px.getLocalMessage('fileSaving','File saving, please wait...'));}else px.startPI(px.getLocalMessage('uploading','Uploading: ')+$I);}};PXFilesDialog.prototype.$U=function($J,$a){__px(this).stopPI();this.fireEvent("afterUpload",null,new Object());this.grid.refresh();};PXFilesDialog.prototype.refresh=function(){__px_callback(this).execI(this,this.forceRefreshCall,null,null);};


var PXEditorType={TextBox:0,TextArea:1,ComboBox:2,Control:3,FocusDiv:4,MaskEdit:5,NumberEdit:6,DateEdit:7,DropDown:8,Selector:9,Password:10,SegmentMask:11};function PXInlineEditor($a,$b,$c,$d){$a.inlineEditor=true;if(!$d&&$a.topElem)$d=$a.topElem;this.container=$b;this.control=$a;this.id=$a.ID?$a.ID:$a.element.id;this.element=$a.element.id?$a.element:$a.element.querySelector('#'+this.id);if(this.element==null)this.element=$a.element.firstElementChild;this.elemText=$a.elemText;this.elemFocus=$a.elemFocus;this.px_context=$a.px_context;if(this.element.tagName=="INPUT"&&!$d){this.topElem=__doc(this).createElement("div");this.topElem.appendChild(this.element);var ds=this.topElem.style,es=this.element.style;ds.position="absolute";ds.display="none";es.position="relative";es.display="";es.left=es.top="0px";}else{this.topElem=$d?$d:this.element;this.topElem.style.position="absolute";this.topElem.style.display="none";};$a.topElem=this.topElem;this.topElem.style.zIndex=1000;var fe=$a.elemFocus?$a.elemFocus:this.element;fe.setAttribute("unblock",1);if($c)this.attachEditorEvents(fe,$c);__px(this).addEventHandler(fe,"keypress",Function.createDelegate(this,this.onKeyPress));};PXInlineEditor.prototype.getClass=function(){return this.className;};PXInlineEditor.prototype.setClass=function($e,$f){var $g=$e+$f?(" "+$f):"";if($g!=this.className){this.element.className=__px(this).appendCss(this.element,[$e]);if($f){if(this.elemText)this.elemText.className=__px(this).appendCss(this.elemText,[$f]);else this.element.className=__px(this).appendCss(this.element,[$f]);};this.element.style.position="absolute";this.className=$g;}};PXInlineEditor.prototype.onKeyPress=function(){if(this.autoAdjustSize){var me=this;setTimeout(function(){me.adjustSize();},1);}};PXInlineEditor.prototype.getValue=function(){return this.control.getValue(true);};PXInlineEditor.prototype.setValue=function($h,$i){this.control.setValue($h,$i);if(this.isAuControl&&__px_cm(this).au_flush)__px_cm(this).au_flush();};PXInlineEditor.prototype.getValues=function(){return this.control.getValues?this.control.getValues():null;};PXInlineEditor.prototype.select=function($j,$k){if(this.control.select)this.control.select($j,$k);};PXInlineEditor.prototype.adjustSize=function(){var $l=this.getAdjustedSize();if(this.control.setWidth)this.control.setWidth($l);else this.element.style.width=$l+"px";};PXInlineEditor.prototype.getAdjustedSize=function(){var $l=__px(this).getTextWidth(this.getValue(),this.className);if($l<100)$l=100;return $l+10;};PXInlineEditor.prototype.getDisplayText=function($h){var $a=this.control,$i=null;$i=$a.getDisplayText?$a.getDisplayText($h):this.getText($h);return $i?$i.trimEnd():"";};PXInlineEditor.prototype.getText=function($h){var $m=this.elemText?this.elemText:this.element;if($m.tagName=="INPUT")return $m.value;return($h==null)?"":__px(this).getInvariantText($h);};PXInlineEditor.prototype.filterInlineKey=function(e){if(this.control.filterInlineKey)return this.control.filterInlineKey(e);};PXInlineEditor.prototype.addCustomHandler=function($n,$o){var $p=this.control.events;if($p)$p.addEventHandler($n,$o);};PXInlineEditor.prototype.storeChanges=function(){var $q=this.control.elemFocus?this.elemFocus:this.element;if($q){var $r=__doc(this).createEvent('HTMLEvents');$r.initEvent('blur',true,true);$q.dispatchEvent($r);if(__px_cm(this).au_flush)__px_cm(this).au_flush();}};PXInlineEditor.prototype.show=function($s,$t){if(!__px(this).elemByID(this.id)){this.container.appendChild(this.topElem);if(this.control&&this.control.removeLanguage)this.control.removeLanguage();};if($s){var $u=this.element.resizer,$a=this.control;this.element.style.display=this.topElem.style.display="";this.setPosition($s,true);if($u&&$u.adjust){$u.initTextarea();$u.adjust();};if($a.adjustInline)$a.adjustInline(this.language);var $q=this.control.elemFocus;this.element.editElem=$s;if($q)$q.editElem=$s;var $v=this.control.viewState;if($v&&$v.elemState){$v.oldOwner=$v.elemState.object;$v.elemState.object=this.control;};if($a.setEnabled)$a.setEnabled(true);if($a.setReadOnly)$a.setReadOnly(false);if($t!=null){var id=this.id,me=this;if($t)setTimeout(function(){__px(me).selectElement(id,0);},0);else $q?$q.focus():this.element.focus();}}};PXInlineEditor.prototype.hide=function(){if(this.control.hideDropDown)this.control.hideDropDown();var $q=this.control.elemFocus?this.elemFocus:this.element;$q.blur();if(__px(this).IsIE&&this.control.handleBlur)this.control.handleBlur();var $v=this.control.viewState;if($v&&$v.elemState&&$v.oldOwner){$v.elemState.object=$v.oldOwner;delete $v.oldOwner;};this.topElem.style.display="none";this.element.object&&this.element.object.hideInline&&this.element.object.hideInline();if(!__px(this).IsIE||this.topElem.childNodes.length){try{this.container.removeChild(this.topElem);}catch(ex){}};var $q=this.control.elemFocus;this.element.editElem=null;if($q)$q.editElem=null;};PXInlineEditor.prototype.setPosition=function($s,$w){var $x=__px(this).getElemLeftPos($s,this.container,false);var top=__px(this).getElemTopPos($s,this.container,false);var $y=this.topElem.style;$y.top=top+"px";$y.left=$x+"px";if($w)this.setSize($s);};PXInlineEditor.prototype.setSize=function($s){var $m=this.element,$y=$m.style;var $z=($m.tagName=="TEXTAREA");if($m.tagName=="SELECT")$m.style.padding="0px";var w=this.autoAdjustSize?this.getAdjustedSize():$s.clientWidth;var h=__px(this).getStyleHeight($m,$s.clientHeight);var $A=true,$B=$s.object;if($s.object&&$B.row){$A=$B.row.level.grid.extendButtonEditors;if($A&&$B.isLastCell())$A=false;};if($A&&this.elemText&&this.elemText!=this.element){var $B=this.elemText.parentNode;if($B)w+=this.element.clientWidth-$B.offsetWidth;};if(this.control.setSize){this.control.setSize(w,h);}else{$y.width=__px(this).getStyleWidth($m,w)+"px";if(!$z)$y.height=h+"px";}};PXInlineEditor.prototype.getCSSRule=function($C){if(PXInlineEditor.$03==null)PXInlineEditor.$03=new Object();var $D=PXInlineEditor.$03;if($D[$C]==null)$D[$C]=__px(this).getCSSRule($C);return $D[$C];};PXInlineEditor.prototype.attachEditorEvents=function($m,$E){__px(this).addEventHandler($m,"keydown",$E);__px(this).addEventHandler($m,"keyup",$E);__px(this).addEventHandler($m,"keypress",$E);__px(this).addEventHandler($m,"blur",$E);__px(this).addEventHandler($m,"focus",$E);};PXInlineEditor.$04=function($F,id,$b,$G){var $m=__doc($F).createElement("INPUT");$m.type=$G?"password":"text";$m.id=id;$m.value="";$m.style.display="none";$b.appendChild($m);return $m;};PXInlineEditor.createTextBox=function($F,id,$b,$c,$H){var $m=PXInlineEditor.$04($F,id,$b);var $a=new PXTextEdit($F,$m,{},$H?$H:{});$m.object=$a;$a.__className="PXTextEdit";var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.TextBox;return $I;};PXInlineEditor.createPassword=function($F,id,$b,$c,$H){var $m=PXInlineEditor.$04($F,id,$b,true);var $a=new PXTextEdit($F,$m,{},$H?$H:{});$m.object=$a;$a.__className="PXTextEdit";var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.Password;return $I;};PXInlineEditor.createTextArea=function($F,id,$b,$c,$H){var $m=__doc($F).createElement("TEXTAREA");$m.id=id;$m.rows=4;$m.value="";$m.style.display="none";$b.appendChild($m);var $a=new PXTextEdit($F,$m,{},$H?$H:{});$m.object=$a;if($a.initInlineEditor)$a.initInlineEditor();$a.__className="PXTextEdit";var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.TextArea;return $I;};PXInlineEditor.createMaskEdit=function($F,id,$b,$c,$H){var $m=PXInlineEditor.$04($F,id,$b);var $a=new PXMaskEdit($F,$m,{},$H?$H:{});$m.object=$a;$a.__className="PXMaskEdit";var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.MaskEdit;return $I;};PXInlineEditor.createNumberEdit=function($F,id,$b,$c,$H){var $m=PXInlineEditor.$04($F,id,$b);var $a=new PXNumberEdit($F,$m,{},$H?$H:{});$m.object=$a;$a.__className="PXNumberEdit";var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.NumberEdit;return $I;};PXInlineEditor.createComboBox=function($F,id,$b,$c,$J,$H){var $m=__doc($F).createElement("SELECT");$m.id=id;$m.style.display="none";var $K=$m.options;if($K.length==0&&$J&&$J.length>0)for(var i=0;i<$J.length;i++){var v=$J[i];$K[$K.length]=new Option(v.displayValue,v.value,false,false);};$b.appendChild($m);var $a=new PXComboBox($F,$m,{},$H?$H:{});$m.object=$a;var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.ComboBox;return $I;};PXInlineEditor.createDropDown=function($F,$L,$b,$c,$M,bc,$J){var $N=PXInlineEditor.createControl($F,$L,$b,$c,$M,bc);if($N!=null){PXInlineEditor.fillValueItems($N.control,$J);}else{$N=PXInlineEditor.createComboBox($F,$M,$b,$c,$J);};return $N;};PXInlineEditor.fillValueItems=function($O,$J){if($J==null)$J=new Array();var $P=new Array();for(var i=0;i<$J.length;i++){var v=$J[i],$Q=new Object();$Q.value=v.value;$Q.text=v.displayValue;$Q.enabled=(v.enabled==null)?true:v.enabled;$Q.imageUrl=v.imageUrl;$P.push($Q);};$O.setItems($P);};PXInlineEditor.createControl=function($F,$L,$b,$c,$M,bc){if(!$L||!__px_all($F)[$L])return null;var fe=__px_all($F)[$L];var $R=$M?$M:("_"+$L);var $m=fe.element,$S=$m.getAttribute("name");var $a=__px_all($F)[$R],$T;if($a==null){var $U=$m.classList.contains('au-target');var $V=$U?$m:$m.parentNode;var $W,$d;if($V&&$V.classList.contains('au-target')){$W=$d=$V.cloneNode(false);if(!$U)$W.appendChild(fe.element.cloneNode(true));$W.removeAttribute('au-target-id');$W.classList.remove('au-target');var $X=$W.querySelectorAll('.au-target');for(var i=0;i<$X.length;i++){$X[i].removeAttribute('au-target-id');$X[i].classList.remove('au-target');};if($U){var $Y=$W.attributes;if($Y)for(var i=0;i<$Y.length;i++){if($Y[i].nodeName.indexOf('.')<0)continue;var $Z=$Y[i].value.replace(new RegExp($L,'g'),$R);$W.setAttribute($Y[i].nodeName,$Z);};$W.setAttribute('source-id',$L);};$m=$T=$U?$W:$W.firstElementChild;}else{$m=$T=$W=fe.element.cloneNode(true);};$m.style.display="none";$m.style.visibility="";$m.style.left=$m.style.right="";$m.object=null;if(!$U){$m.id=$R;if(fe.errorCss)$m.className=$m.className.replace(fe.errorCss,"");if($m.childNodes.length)PXInlineEditor.$05($L,$M,$m);if($S)$m.setAttribute("name","_"+$S);if($T.tagName!="INPUT")$T=$T.getElementsByTagName("INPUT")[0];if($T&&$T.tabIndex==-1)$T.tabIndex=100;};$b.appendChild($W);if($U){__px_cm($F).au_enhance($d);$a=__px_all($F)[$R];}else $a=__px_cm($F).createControl(fe.__className,$R,$L);$a.sourceID=$L;$a.sourceName=$S;$a.bindingContainer=bc;$a.viewState=fe.viewState;var et=$a.elemText;if(et&&et.object&&et.object.bindingContainer)et.object.bindingContainer=bc;if($a.setEnabled)$a.setEnabled(true);if($a.setReadOnly)$a.setReadOnly(false);if($a.setValue){$a.setValueOld=$a.setValue;$a.setValue=PXInlineEditor.$06;};var cs=$a.autoCallBack;if(cs&&cs.enabled){cs.enabled=false;cs.command=cs.target="";};if($a.onValueChange)$a.onValueChange=0;if($a.initInlineEditor)$a.initInlineEditor(fe);__px_all($F)[$R]=$a;if(__px($F).IsIE&&!__px($F).IsIE910&&$a.detachEventHandlers)$a.detachEventHandlers();if(__px($F).IsAnyIE)$b.removeChild($W);}else $c=null;var $I=new PXInlineEditor($a,$b,$c,$d);$I.isAuControl=$U;$I.editorType=PXEditorType.Control;return $I;};PXInlineEditor.$06=function($00,$i,$01){this.setValueOld($00,$i,$01);__px_all(this)[this.sourceID].setValue($00,$i,$01);};PXInlineEditor.$05=function($L,$M,parent){for(var i=0;i<parent.childNodes.length;i++){var n=parent.childNodes[i];if(n.id&&n.id.indexOf($L)==0)n.id=$M+n.id.substr($L.length);var name=n.getAttribute?n.getAttribute("name"):null;if(name)n.setAttribute("name","_"+name);if(n.childNodes.length>0)arguments.callee($L,$M,n);}};PXInlineEditor.createFocusDiv=function($F,id,$b,$c){var $m=__doc($F).createElement("SPAN");$m.id=id;$m.style.borderStyle="dotted";$m.style.borderColor="gray";$m.style.borderWidth="1px";$m.style.fontSize="0px";$m.style.display="none";$m.style.backgroundColor="transparent";__px($F).addEventHandler($m,"mousedown",$c);__px($F).addEventHandler($m,"mouseup",$c);$b.appendChild($m);var $a=new PXFocusDiv($F,$m);var $I=new PXInlineEditor($a,$b,$c);$I.editorType=PXEditorType.FocusDiv;return $I;};function PXFocusDiv($F,$m){this.element=$m;this.id=$m.id;this.px_context=$F;this.elemFocus=__px($F).createFocusElem();$m.object=this;};PXFocusDiv.prototype.adjustInline=function(){var $02=this.elemFocus.parentNode;var de=__px(this).getDocScrollElem();$02.style.top=de.scrollTop+1+"px";$02.style.left=de.scrollLeft+"px";};PXFocusDiv.prototype.getValue=function(){return this.element.value;};PXFocusDiv.prototype.setValue=function(v){this.element.value=v;};


function PXAttribPanel($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;__px_cm(this).readProperties(this,$c);__px(this).addEventHandler(this.element,"click",Function.createDelegate(this,this.$k));};PXAttribPanel.properties=[["sourceName",JSType.String,null]];PXAttribPanel.callbackProps=[["content",JSType.String,"","updateContent"],["title",JSType.String,"","updateTitle"]];PXAttribPanel.prototype.$k=function(ev){var $b=ev.target;while($b&&$b!=this.element){var $d=$b.getAttribute('data-delfor');if($d){var ds=__px_cm(this).findDataSource();ds.executeCommand('Del',$d);return;};var $e=$b.getAttribute('data-editfor');if($e){var ds=__px_cm(this).findDataSource();ds.executeCommand('Edit',$e);return;};$b=$b.parentNode;}};PXAttribPanel.prototype.refresh=function(id){__px_callback(this).execI(this,this.refreshCmd,"",this.$l);};PXAttribPanel.prototype.$m=function($f){};PXAttribPanel.prototype.updateContent=function($g){__px_cm(this).processHtmlData($g,this.element);var $h=this.element.querySelector('.wideAttrib');var tr=document.createElement('tr');tr.innerHTML='<td><div class="fld-lc"><div class="fld-l"></div> <div class="fld-c"></div></div ></td > <td><div class="fld-lc"><div class="fld-l"></div><div class="fld-c"></div>	</div></td>';if($h)$h.firstElementChild.insertBefore(tr,$h.firstElementChild.firstElementChild);var $i=this.element.querySelectorAll('.wideAttrib input, .wideAttrib .editorCont');for(var i in $i){$i[i].onfocus=function(ev){setTimeout(function(){ev.target.blur();},0);};if($i[i].type=='checkbox')$i[i].onclick=function(ev){if(ev.preventDefault)ev.preventDefault();return false;};}};PXAttribPanel.prototype.updateTitle=function($g){var toolbar=__px_alls(this)["tlbPath"];if(toolbar){var $j=toolbar.getButton('title');if($j){var $b=$j.element.firstElementChild;if($b&&$b.textContent.indexOf(':')==-1){$b.textContent=$b.textContent+': '+$g;}}}};PXAttribPanel.prototype.setProperties=function($c){__px_cm(this).readProperties(this,$c,PXAttribPanel.callbackProps);};


function PXPopupNoteEdit($a,$b,$c,$d){PXPopupNoteEdit.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c);this.zIndex=11000;this.elemText=__px(this).elemByID(this.ID+"_txt");this.elemTextP=__px(this).elemByID(this.ID+"_txtP");this.buttonsCell=__px(this).elemByID(this.ID+"_btnCont");this.$l();this.$m();};PXPopupNoteEdit.__baseType=PXSmartPanel;PXPopupNoteEdit.properties=[];PXPopupNoteEdit.prototype.getText=function(){return this.elemText.value;};PXPopupNoteEdit.prototype.setText=function(v){this.elemText.value=v;};PXPopupNoteEdit.prototype.getPopupText=function(){return this.elemTextP.value;};PXPopupNoteEdit.prototype.setPopupText=function(v){this.elemTextP.value=v;this.chkPopupNote.setChecked(Boolean(v));this.repaint();};PXPopupNoteEdit.prototype.show=function($e){PXPopupNoteEdit.callBase(this,"show",[$e]);if(this.elemText){this.elemText.focus();this.elemText.select();}};PXPopupNoteEdit.prototype.repaint=function(){var $f=!!this.elemTextP.value||this.chkPopupNote.getChecked();var $g=this.elemTextP.parentNode;__px(this).toggleCss(!$f,$g.parentNode,["note-only"],true);};PXPopupNoteEdit.prototype.$l=function(){var $h=this.buttonsCell.childNodes;for(var i=0,j=0;i<$h.length;i++){var $b=$h[i];if($b.tagName!="BUTTON")continue;$b.id=this.ID+"_"+j;var $c=new Object();$c.styles=new Object();$c.styles.normal=$b.className;$c.dialogResult=(j==0)?PXDialogResult.OK:PXDialogResult.Cancel;var $i=__px_all(this)[$b.id]=new PXButton(this.px_context,$b,$c);if(j==0)this.btnOk=$i;else this.btnCancel=$i;j++;}};PXPopupNoteEdit.prototype.$m=function(){var $b=__px(this).elemByID(this.ID+"_chkPopup"),me=this;var $j=__px_all(this)[$b.id]=new PXCheckBox(this.px_context,$b,new Object());this.chkPopupNote=$j;$j.events.addEventHandler("valueChanged",function($k){if(!$k.getChecked())me.elemTextP.value="";me.repaint();});};


function lastEvent($a){var $b=-1;for(var i in $a){$b=Math.max($b,$a[i]);};return $b;};function PXFileUploader($c,$d,$e){this.px_context=$c;this.element=$d;this.ID=$d.id;__px_cm(this).readProperties(this,$e,PXFileUploader.properties);this.btnUpload=__px(this).elemByID($d.id+"_upBtn");this.uploadElem=__px(this).elemByID($d.id+"_FileUpldr");this.fileInput=this.element.querySelector('input[type="file"]');this.textInput=this.element.querySelector('.messageDiv');this.textCell=this.element.querySelector('.textCell');this.browseCell=this.element.querySelector('.browseCell');this.uploadCell=this.element.querySelector('.uploadCell');this.uploadDiv=this.element.querySelector('.uploadDiv');if(this.fileInput){__px(this).addEventHandler(this.fileInput,"change",Function.createDelegate(this,this.uploadSelected));};if(this.uploadDiv){this.uploadDiv.style.zIndex=__px_cm(this).getNextZIndex(this.zIndex?this.zIndex:2000)+1;};this.cross=this.element.querySelector('[icon="ClearN"]');if(this.cross){this.cross.style.display="none";this.cross.style.zIndex=__px_cm(this).getNextZIndex(this.zIndex?this.zIndex:2000)+2;__px(this).addEventHandler(this.cross,"click",Function.createDelegate(this,function(){this.cross.style.display="none";if(this.fileInput)this.fileInput.value="";if(this.textInput)this.textInput.textContent=this.selectMessage;this.textInput.className="messageDiv";}));};if(this.uploadCell)__px(this).addEventHandler(this.uploadCell,"click",Function.createDelegate(this,this.uploadClick));this.events=new PXEventList(this,PXFileUploader.events,null);this.mouseFollower=Function.createDelegate(this,this.$05);if(this.textCell){__px(this).addEventHandler(this.textCell,"mousemove",this.mouseFollower);__px(this).addEventHandler(this.textCell,"mouseleave",this.mouseFollower);};if(this.browseCell){__px(this).addEventHandler(this.browseCell,"mousemove",this.mouseFollower);__px(this).addEventHandler(this.browseCell,"mouseleave",this.mouseFollower);}};PXFileUploader.events={$fileUploaded:0,$beforeUpload:1};PXFileUploader.setTypes=function($f,$g){if($g){$f.allowedFiles=$g.toLowerCase().split(',');}};PXFileUploader.properties=[["allowedTypes",JSType.Empty,undefined,PXFileUploader.setTypes],["selectMessage",JSType.String,"Select file"],["dataSourceID",JSType.String,""],["maxFileSize",JSType.Int,25000],["maxFileSizeMsg",JSType.String,""],["unsupportedMsg",JSType.Empty,"Unsupported file type. Supported types are: "]];PXFileUploader.prototype.setEnabled=function($h){if($h){this.fileInput.disabled=undefined;}else{this.fileInput.disabled=true;};this.btnUpload.object.setEnabled($h);};PXFileUploader.prototype.onVisibleChanged=function($i){var $j=function($h,$k){if($h<$k)return $k;return $h;};if(this.fileInput&&this.uploadDiv){this.fileInput.style.height=$j(this.fileInput.parentNode.parentNode.offsetHeight,20)+2+"px";this.fileInput.style.width=this.uploadDiv.style.width=$j(this.textCell.offsetWidth+this.browseCell.offsetWidth,500)+5+"px";}};PXFileUploader.prototype.fireEvent=function(id,ev,$l){return this.events.fireEvent(id,ev,$l);};PXFileUploader.prototype.uploadClick=function(e){var $m=this.element.querySelector('input[type=file]');var $n=$m&&$m.files;if($n){var $o=false;for(var i=0;i<$n.length;i++){$o=$o||($n[i].size>this.maxFileSize*1024);};if($o){alert(this.maxFileSizeMsg);__px(this).cancelEvent(e);return false;}};var ds=this.dataSourceClientID?__px_all(this)[this.dataSourceClientID]:__px_cm(this).dataSource;if(ds.isNewRecord&&ds.saveCommandName){if(this.savedHandle==null)this.savedHandle=Function.createDelegate(this,function($p,e){ds.events.removeEventHandler("commandPerformed",this.savedHandle);this.savedHandle=null;if(!ds.alert){this.doUpload();}});ds.events.addEventHandler("commandPerformed",this.savedHandle);var $q;var $r=__px_all(this);for(var k in $r){if($r[k].__className=="PXDataViewBar")$q=$r[k];};if($q){ds.executeCommand(ds.saveCommandName,"AttachEntity;"+$q.ID);}else{ds.executeCommand(ds.saveCommandName);}}else{this.doUpload();}};PXFileUploader.prototype.unsupportedMessage=function(){var $s=this.allowedFiles?this.allowedFiles.join(","):"none";return this.unsupportedMsg+$s;};PXFileUploader.prototype.doUpload=function(){if(this.fileInput.disabled)return false;if(this.textInput){this.textInput.textContent="Uploading";this.textInput.className="messageDiv";};__px(this).doPostNoDisabledReset(this.btnUpload.getAttribute("name"),"click",undefined,this.ID);};PXFileUploader.prototype.uploadSelected=function(e){if(this.textInput){var $t=this.fileInput.value;if($t==""){this.cross.style.display="none";if(this.fileInput)this.fileInput.value="";this.textInput.textContent=this.selectMessage;this.textInput.className="messageDiv";}else{if(this.allowedFiles){var $u=$t.toLowerCase().lastIndexOf("."),$v=true;if($u>0)$v=Array.contains(this.allowedFiles,$t.substr($u).toLowerCase());if(!$v){alert(this.unsupportedMessage());return false;}};try{var $w=this.fileInput.value.split('\\');this.textInput.textContent=$w.pop().split("").join('\u200b');this.textInput.className="messageDiv selected";}catch(ex){this.textInput.textContent=this.selectMessage;this.textInput.className="messageDiv";};if(this.cross)this.cross.style.display="";}}};PXFileUploader.prototype.onSubmit=function($x){if(this.ID!=$x)return;if(this.fileInput.disabled)return false;if(this.allowedFiles){var $t=this.fileInput.value;var $u=$t.toLowerCase().lastIndexOf("."),$v=true;if($u>0)$v=Array.contains(this.allowedFiles,$t.substr($u).toLowerCase());if(!$v){alert(this.unsupportedMessage());return false;}};var id="fileUpload_"+this.ID,$y="fileUpload_div_"+this.ID;var $z="<iframe style='display:none' src='about:blank' suppressCallbacks='true' id='"+id+"' name='"+id+"' ></iframe>";var $A=__doc(this).getElementById($y);if($A)$A.innerHTML=$z;else{var $B=__doc(this).createElement('DIV');$B.id=$y;$B.innerHTML=$z;__doc(this).body.appendChild($B);};var $C=__doc(this).forms[0];$C.setAttribute('target',id);if($C.action&&$C.action.indexOf("fileupload")<0){var ip=$C.action.indexOf("?");this.srcAction=$C.action;$C.action+=(ip>0?"&":"?")+"fileupload=1"};var $D=__px(this).elemByID(id),$E=$D.contentWindow;__px(this).addEventHandler($D,"load",Function.createDelegate(this,this.hiddenFrameLoaded));$E.suppressChanges=true;$E.suppressCallbacks=true;return true;};PXFileUploader.prototype.fireFileEvent=function($F){var ar=this.uploadElem.value.split('\\');var $l=new Object();$l.fileName=ar[ar.length-1];$l.hasError=$G;this.fireEvent($F,null,$l);};PXFileUploader.prototype.hiddenFrameLoaded=function(){var $H="fileUpload_"+this.ID;var $D=__doc(this).getElementById($H);var $C=__doc(this).forms[0];$C.removeAttribute('target');$C.__EVENTTARGET.value=$C.__EVENTARGUMENT.value="";if(this.srcAction){$C.action=this.srcAction;delete this.srcAction;};$D.contentWindow.suppressChanges=true;$D.contentWindow.suppressCallbacks=true;var $G=($D.contentWindow.uploadErr!=null);if($G)alert($D.contentWindow.uploadErr);setTimeout(function(){$D.contentWindow.__doPostBack=function(){};$D.parentNode.removeChild($D);delete $D;},0);var ar=this.uploadElem.value.split('\\');var $l=new Object();$l.fileName=ar[ar.length-1];$l.hasError=$G;this.fireEvent("fileUploaded",null,$l);if(this.cross){this.cross.style.display="none";};if(this.fileInput)this.fileInput.value="";if(this.textInput){this.textInput.textContent=this.selectMessage;this.textInput.className="messageDiv";};var $I="_tlbDataView";var $J;for(var $K in px_alls){if($K.substr(-$I.length)==$I){$J=px_alls[$K];break;}};try{if(!$J){var $L=__px_all(this);for(var $K in $L){if($K.substr(-$I.length)==$I){$J=$L[$K];break;}}}}catch(ex){$M.log(ex);};if($J){$J.executeCommand(PXDataViewCommand.Refresh);}};PXFileUploader.prototype.$06=function(e,$N,$O){if($N){var $P=$N.getBoundingClientRect();var x=e.clientX-$P.left;var y=e.clientY-$P.top;var $Q=x>=0&&x<=$P.width&&y>=0&&y<=$P.height;var style=this.uploadDiv.style;if($Q){var $R=x-5+$N.offsetLeft;style.left=$R+'px';var $S=function(c){return parseInt(c.width?c.width:c.offsetWidth,10);};style.width=($S($N)+$S($O)-$R)+"px";}else{return true;};return false;};return true;};PXFileUploader.prototype.$07=function(e,$N){if($N){var $P=$N.getBoundingClientRect();var x=e.clientX-$P.left;var y=e.clientY-$P.top;var $Q=x>0&&x<$P.width&&y>0&&y<$P.height;if($Q){$N.className=__px(this).appendCss($N,["helicopter"]);}else{$N.className=__px(this).excludeCss($N,["helicopter"]);}}};PXFileUploader.prototype.$05=function(e){if(this.uploadDiv){if(this.$06(e,this.textCell,this.browseCell)&&this.$06(e,this.browseCell,this.textCell)){var $T=function($N){return $N?$N.offsetWidth:30;};this.uploadDiv.style.left="0px";this.uploadDiv.style.width=$T(this.textCell)+$T(this.browseCell)+"px";};this.$07(e,this.browseCell);this.$07(e,this.uploadCell);}};function DisableDrop($f,$U){$f.handleDropFile=function(e){__px($f).cancelEvent(e);return false;};__px($f).addEventHandler($f.element,"drop",Function.createDelegate($f,$f.handleDropFile));};function DragNDropMixIn($f,$V,$W,$U){$f.uploadCallback2=function($X,ar,$Y){var $Z=ar[1],$00=ar[0],px=__px($f);if($Z&&$Z>250000){if($Y){$X=$X/2;}else{$X=$X/2+50;};if(px.isActiveWC())px.stopWC();if(px.isActivePI()){px.setPIValue($X>=99?100:$X);if($X>=99)px.setPIText(px.getLocalMessage('fileSaving','File saving, please wait...'));}else px.startPI(px.getLocalMessage('uploading','Uploading: ')+$00);}};$f.processFileLoaded2=function($01,$c){__px($f).stopPI();$f.events.fireEvent("afterUpload",null,{'filename':$c[0]});};$f.handleDropFile=function(e){__px($f).cancelEvent(e);if($f.canUpload&&!$f.canUpload())return false;var $n=e.dataTransfer.files;var ds=$f.dataSourceClientID?__px_all($f)[$f.dataSourceClientID]:__px_cm($f).dataSource;var $q;var $r=__px_all(this);for(var k in $r){if($r[k].__className=="PXDataViewBar")$q=$r[k];};if(ds.isNewRecord&&$q){if($f.attachHandle==null)$f.attachHandle=Function.createDelegate($f,function($p,e){ds.events.removeEventHandler("commandPerformed",$f.attachHandle);$f.attachHandle=null;if(!ds.alert){$f.handleDropFile2(e.dataTransfer.files);}});ds.events.addEventHandler("commandPerformed",this.attachHandle);ds.executeCommand(ds.saveCommandName,"AttachEntity;"+$q.ID);}else{$f.handleDropFile2(e.dataTransfer.files);}};$f.handleDropFile2=function($n){if(window.FileReader==null)return;if($f.uploadFileCall.uploadCallback==null)$f.uploadFileCall.uploadCallback=Function.createDelegate($f,$f.uploadCallback2);var me=$f;var $02=Function.createDelegate($f,$f.processFileLoaded2);for(var i=0;i<$n.length;i++){var $03=new FileReader(),$t=$n[i];if($t.size>this.maxFileSize*1000){alert(this.maxFileSizeMsg);break;};if(this.allowedFiles){var $s=this.allowedFiles?this.allowedFiles.join(","):"none";var $U=this.unsupportedMsg+$s;var $u=$t.name.toLowerCase().lastIndexOf("."),$v=true;if($u>0)$v=Array.contains(this.allowedFiles,$t.name.substr($u).toLowerCase());if(!$v){alert($U);break;}};__px(me).addEventHandler($03,"load",function(e){var $04=[e.target.fileName,e.target.fileSize];__px_callback(me).execI(me,me.uploadFileCall,e.target.fileName+'|'+e.target.result,$02,$04);});__px(me).addEventHandler($03,"progress",function(e){var $04=[e.target.fileName,e.target.fileSize];if(e.lengthComputable)me.uploadCallback2(Math.round(e.loaded/e.total*100),$04,true);});$03.fileName=$t.name;$03.fileSize=$t.size;$03.readAsDataURL($t);}};if($f.events){$f.events.appendEvents({$afterUpload:lastEvent($f.events.events)+1});}else{$f.events=new PXEventList($f,{$afterUpload:1},null);};__px($f).addEventHandler($f.element,"drop",Function.createDelegate($f,$f.handleDropFile));$f.uploadFileCall=__px_callback($f).createCommand("UploadFile",true,false,false);};



PXRichTextEdit1.prototype.createListTree=function(){return{'list':[],'addItem':function($a){this.list.push($a);},'last':function(){return this.list[this.list.length-1];},'ensureListItem':function(){if(!this.list.length){this.list.push([]);};if(this.last().constructor !=Array){this.list.push([]);}},'addListItem':function($a){this.ensureListItem();this.last().push(Array.prototype.slice.call($a.childNodes));},'appendToListItem':function($a){this.ensureListItem();var $b=this.last();if(!$b.length){$b.push([]);};$b[$b.length-1].push($a);},'hasLists':function(){return this.list.some(function(n){return n.constructor==Array;});},'isList':function($a){return $a.constructor==Array;},'removeBR':function(){}}};PXRichTextEdit1.prototype.insertList=function($c,$d){var $e=this;var $f=this.range();if($f){var $g=[];var $h=this.expandRangeToListItems($c,$f);if(this.isCursorAtTop($h)){if($c.body.childNodes.length>$f.startOffset){var $i=$c.body.childNodes[$f.startOffset];if(this.tagNClass($i,"ul","ol")){$g=[$i];}}}else{$g=this.queryRange($h,'li').map(function($a){return $e.topList($a.parentNode);});};if(!$g.length){if($h.commonAncestorContainer.nodeName.toLowerCase()=='li'){$g=this.topList($h.commonAncestorContainer.parentNode);}};var $j=this.nodes2names($g);if($g.length){var $k=this.insertMarkers($c);var $l=$d?'ul':'ol';var $m=this.removeNested($g);if($j.indexOf($l)>-1){for(var i=0;i<$m.length;i++){var $n=$m[i];var $o=this.deconstructList($n,$h);this.setListType($c,$o.list,$o.start,$o.end,$n,$d?'ol':'ul');this.removeDuplicateListNodes($o.list);this.reconstructList($c,$o.list,$n);this.deleteNode($n);}}else{for(var i=0;i<$m.length;i++){var $n=$m[i];var $o=this.deconstructList($n,$h);for(var i=$o.start;i<=$o.end;i++){$o.list[i].markers.splice(0,$o.list[i].markers.length);};this.shadowList($c,$o.list);this.removeDuplicateListNodes($o.list);this.reconstructList($c,$o.list,$n);this.deleteNode($n);}};if($k){this.removeMarkers($c,$k.startMarker,$k.startType,$k.endMarker,$k.endType);}}else{var $h=this.expandRangeToLines1($c,$f);var $p=this.getSelectedTopNodeStrides($h);for(var j=0;j<$p.length;j++){var $q=this.createListTree();var $r=[];var $s=$p[j];if($s.some(function(n){return this.insideRangeExt($c,n,$h);},this)){this.adjustInsaneNodes($s);if($s.length){var $t=false;for(var i=0;i<$s.length;i++){var cr=this.isCR($s[i]);if(!cr&&this.replace($s[i].textContent,['\u200b','',' ','','\r','','\n','','\t',''])==""){$r.push($s[i]);continue;};if(cr){$q.addItem($s[i]);}else{if(this.isBlockNode($s[i])){$q.addListItem($s[i]);$r.push($s[i])}else{$q.appendToListItem($s[i]);}}}};if($q.hasLists()){$q.removeBR();var $u=$c.createElement('span');var $v=$s[0];var parent=$v.parentNode;parent.insertBefore($u,$v);$v=$u;var $w;for(var i=$q.list.length-1;i>=0;i--){var $x=$q.list[i];if($q.isList($x)){var $y=$c.createElement($d?'ol':'ul');parent.insertBefore($y,$v);$v=$y;for(var j=0;j<$x.length;j++){var $z=$x[j];var li=$c.createElement('li');$y.appendChild(li);for(var k=0;k<$z.length;k++){li.appendChild($z[k]);}};if(!$w){$w=$y.lastChild;}}else{parent.insertBefore($x,$v);$v=$x;if(!$w){$w=$x;}}};for(var i=0;i<$r.length;i++){this.deleteNode($r[i]);};this.deleteNode($u);this.focusInsideContainersEnd($w);}else{var $b=$c.createElement($d?"ol":"ul");var $A=$c.createElement('li');$b.appendChild($A);$h.insertNode($b);this.focusInsideTag($A);}}}}}};PXRichTextEdit1.prototype.isCR=function($B){if($B.nodeName=='BR')return true;if($B.nodeName=='DIV'&&this.hasSingleChild($B,'br'))return true;if($B.nodeName=='P'){if(!$B.childNodes.length){return true;};if(this.hasSingleChild($B,'#text')&&$B.childNodes[0].textContent==" "){return true;};if($B.childNodes.length==1&&$B.firstChild.nodeName=="BR"){return true;}};return false;};PXRichTextEdit1.prototype.deconstructList=function($b,$C){var $D=[];var $E,end;var $e=this;var $F=function($G,$H){var $I=[];for(var i=0;i<$G.childNodes.length;i++){var $i=$G.childNodes[i];if($i.nodeName.toLowerCase()=='li'){var $a={'markers':$H.slice(0),'item':$i};$I.push($a);var $J=$e.withinRange($i,$C);if(!$E&&($e.contains($i,$C.startContainer)||$J||$e.afterRangeAnchor($i,$C.startContainer,$C.startOffset))){$E=$a;end=$a;};if($E&&($e.contains($i,$C.endContainer)||$J))end=$a;}else{$I=$I.concat($F($i,$H.concat($i)));}};return $I;};var $K=$F($b,[$b]);return{'list':$K,'start':$K.indexOf($E),'end':$K.indexOf(end)};};PXRichTextEdit1.prototype.shadowList=function($c,$b){for(var i=0;i<$b.length;i++){var $L=$b[i];for(var j=0;j<$L.markers.length;j++){$L.markers[j]=$c.createElement($L.markers[j].nodeName);}}};PXRichTextEdit1.prototype.shiftList=function($c,$b,$E,end,forward){this.shadowList($c,$b);if(forward){for(var i=$E;i<=end;i++){var $k=$b[i].markers;$k.push($c.createElement($k[$k.length-1].nodeName));}}else{for(var i=$E;i<=end;i++){$b[i].markers.pop();}}};PXRichTextEdit1.prototype.setListType=function($c,$b,$E,end,$M,$N){var $O=1000;for(var i=$E;i<=end;i++){var $a=$b[i];$O=Math.min($O,$a.markers.length-1);};for(var i=$E;i<=end;i++){var $a=$b[i];var $P=$O;if($P>-1){for(var j=$P;j<$a.markers.length;j++){$a.markers[j]=$c.createElement($N);}}};this.shadowList($c,$b);};PXRichTextEdit1.prototype.removeDuplicateListNodes=function($b){if($b.length){var $L=$b[0];$L.newMarkers=$L.markers.slice(0);for(var i=1;i<$b.length;i++){var $L=$b[i];var $Q=$b[i-1];var $R=Math.min($L.markers.length,$Q.markers.length);var $S=false;for(var j=0;j<$R;j++){if($L.markers[j].nodeName.toLowerCase()!=$Q.markers[j].nodeName.toLowerCase()){$L.insertAt=$Q.markers[j-1];$L.newMarkers=$L.markers.slice(j);$S=true;break;};$L.markers[j]=$Q.markers[j];};if(!$S){$L.insertAt=$Q.markers[$R-1];$L.newMarkers=$L.markers.slice($R);}}}};PXRichTextEdit1.prototype.reconstructList=function($c,$b,$T){var $U=$T;for(var i=0;i<$b.length;i++){var $V=$b[i];var $W=!$V.markers.length;if($W){var $X=$c.createElement('div');this.transferChildren($V.item,$X);this.insertAfter($X,$U);$U=$X;}else{var $Y=$V.insertAt;if(!$Y){var $Z=$V.newMarkers.shift();if($Z){this.insertAfter($Z,$U);$U=$Z;$Y=$Z;}}while($V.newMarkers.length){var $Z=$V.newMarkers.shift();$Y.appendChild($Z);$Y=$Z;};$Y.appendChild($V.item);}}};PXRichTextEdit1.prototype.expandRangeToItems=function($c,$f,$00){var $E=this.filteredParentChain($f.startContainer,$00).pop();var end=this.filteredParentChain($f.endContainer,$00).pop();if($E||end){var $01=$c.createRange();if($E){$01.setStartBefore($E);}else{$01.setStart($f.startContainer,$f.startOffset);};if(end){$01.setEndAfter(end);}else{$01.setEnd($f.endContainer,$f.endOffset);};return $01;};return $f;};PXRichTextEdit1.prototype.expandRangeToListItems=function($c,$f){return this.expandRangeToItems($c,$f,['li']);};PXRichTextEdit1.prototype.expandRangeToList=function($c,$f){return this.expandRangeToItems($c,$f,['ul','ol']);};


