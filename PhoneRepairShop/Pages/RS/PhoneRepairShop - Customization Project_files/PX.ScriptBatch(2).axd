
function PXActionBar($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;this.sourceID=$b.getAttribute("sourceID");__px_cm(this).readProperties(this,$c);this.pagerElem=__px(this).elemByID(this.ID+"_pager");this.toolsElem=__px(this).elemByID(this.ID+"_tlb");if(this.pagerElem!=null){var hp=Function.createDelegate(this,this.$u);__px(this).addEventHandler(this.pagerElem,"click",hp);};if(this.toolsElem!=null)this.$v();this.events=new PXEventList(this,PXActionBar.events,$c.clientEvents);};PXActionBar.properties=[["pagerMode",JSType.Int,2],["pagerLinks",JSType.Int,10]];PXActionBar.events={$initialize:0,$pagerClick:1,$actionClick:2};PXActionBar.prototype.$v=function(){var $d=this.sourceID?(this.sourceID+"_tlb"):this.toolsElem.id;this.toolBar=__px_cm(this).createControl("PXToolBar",this.toolsElem.id,$d);if(this.toolBar){this.toolBar.events.addEventHandler("buttonClick",PXActionBar.$w);this.toolBar.$x=this;__px_all(this)[this.toolsElem.id]=this.toolBar;this.toolBar.trackSeparators=true;}};PXActionBar.prototype.$y=function(){return this.owner.getPageCount?this.owner.getPageCount():this.owner.pageCount;};PXActionBar.prototype.getVisible=function(){return this.element.style.display!="none";};PXActionBar.prototype.setVisible=function($e){this.element.style.display=($e?"":"none");};PXActionBar.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXActionBar.prototype.setEnabled=function($f){__px(this).setEnabled(this.element,$f);};PXActionBar.prototype.setPagerHtml=function($g){if(this.pagerElem==null)return;var $h=this.pageEditorView;if($h){$h.detached();$h.unbind();delete this.pageEditorView;};this.pagerElem.innerHTML=$g;if(this.pagerMode==4&&this.owner){var id=this.ID+"_edPi",$b=__px(this).elemByID(id),ed;if($b){var $i=$b.parentNode;if($i&&$i.tagName.toLowerCase().startsWith("qp-")){var $j=$b.value;this.pageEditorView=__px_cm(this).au_enhance($i);ed=this.pageEditor=__px_all(this)[id];ed.setValue($j?parseInt($j):0);}else ed=this.pageEditor=new PXNumberEdit(this.px_context,$b,new Object());ed.setMinValue(1);ed.setMaxValue(this.$y());var h=Function.createDelegate(this,this.$z);ed.events.addEventHandler("valueChanged",h);if(this.$A){delete this.$A;setTimeout(function(){ed.focus();},1);}}else this.pageEditor=null;}};PXActionBar.prototype.setPagerVisible=function($k){var pe=this.pagerElem;if(pe&&this.pagerMode!=4&&!pe.getElementsByTagName('A').length&&$k)return;if(pe!=null){var $l=$k?"":"none";if(pe.style.display!=$l){pe.style.display=$l;if(this.toolBar)this.toolBar.arrangeOverflowItems();}}};PXActionBar.prototype.hasPager=function(){return this.pagerElem!=null;};PXActionBar.prototype.getButton=function($m){if(this.toolBar)return this.toolBar.getButton($m);return null;};PXActionBar.$w=function($n,ev){var $o=$n.$x;if($o){var $p=new Object();$p.button=ev.button;$o.events.fireEvent("actionClick",null,$p);}};PXActionBar.prototype.$z=function(ed,ev){if(this.owner.setPage){if(ed.hasFocus)this.$A=true;this.owner.setPage(ed.getValue()-1);}};PXActionBar.prototype.$u=function(e){var se=__px(this).eventElem(e);if(se&&se.tagName=="A"&&!se.getAttribute("disabled")){var $o=__px(this).eventObject(e,PXActionBar);if($o){switch(e.type){case "click":__px(this).cancelEvent(e);$o.$B(e,se);break;}}}};PXActionBar.prototype.$B=function(e,se){var $q=se.getAttribute("cmd");if(this.owner==null){var $p=new Object();$p.command=$q;this.events.fireEvent("pagerClick",null,$p);return;};var $r=this.owner.pageIndex;switch($q){case "nextP":$r++;break;case "prevP":$r--;break;case "firstP":$r=0;break;case "lastP":var $s=this.$y();$r=($s>0)?($s-1):-1;break;case "nextR":var $t=Math.floor($r/this.pagerLinks)+1;$r=$t*this.pagerLinks;break;case "prevR":var $t=Math.floor($r/this.pagerLinks);$r=$t*this.pagerLinks-1;break;default:$r=parseInt($q.substr(1));};var $p=new Object();$p.command=$q;$p.pageIndex=$r;if(!this.events.fireEvent("pagerClick",null,$p)){if(this.owner.setPage)this.owner.setPage($r);if(this.owner.focus)this.owner.focus();}};



var PXGridCommand={Refresh:"Refresh",PageNext:"PageNext",PagePrev:"PagePrev",PageFirst:"PageFirst",PageLast:"PageLast",Save:"Save",Delete:"Delete",AddNew:"AddNew",Search:"Search",AdjustCols:"AdjustColumns",EditRecord:"EditRecord",NoteShow:"NoteShow",FilterShow:"FilterShow",FilterRemove:"FilterRemove",FilterSet:"FilterSet",FilterSave:"FilterSave",FilterSavePivot:"FilterSavePivot",ExportExcel:"ExportExcel",FilesMenu:"FilesMenu",LayoutSave:"LayoutSave",LayoutReset:"LayoutReset",Upload:"Upload",CreateProviderFile:"CreateProviderFile",Edit:"Edit",Copy:"Copy",Paste:"Paste",DelDefault:"DelDefault",CommandEditPivot:"EditPivot"};var PXCondition={EQ:0,NE:1,GT:2,GE:3,LT:4,LE:5,LIKE:6,RLIKE:7,LLIKE:8,NOTLIKE:9,BETWEEN:10,ISNULL:11,ISNOTNULL:12,TODAY:13,OVERDUE:14,TODAY_OVERDUE:15,TOMMOROW:16,THIS_WEEK:12,NEXT_WEEK:18,THIS_MONTH:19,NEXT_MONTH:20,IN:21,NI:22,ER:23,NestedSelector:24};function PXGrid($a,$b,$c){this.px_context=$a;this.element=$b;this.ID=$b.id;this.$3A();__px_cm(this).setStackElements(this);this.viewState=new PXStateBag(this,"PXGrid");var $d=this.viewState.stateBag;$d.addNode("Levels");$d.addNode("ClientState");__px_cm(this).readProperties(this,$c);__px_cm(this).registerAutoSize(this,$c);if(this.autoSize&&this.autoSize.minHeight==0)this.autoSize.minHeight=200;this.expandEffects=new PXExpandEffects(this,$c.expandEffects);__px_cm(this).registerRequiresOnLoad(this,$b.id);__px_cm(this).registerRequiresOnReLoad(this,$b.id);if(!this.allowPaging)this.adjustPageSize=0;if(!this.dataSourceID||this.autoAdjustColumns)this.autoSaveLayout=false;this.$3B($c);this.$3C();if(this.externalToolBarID)this.$3D();if(this.filterID){this.viewState.update("FilterID",this.filterID);this.setFilterActive(true);};this.attachCommonEvents();this.attachHeaderEvents(this.statHTable);this.element.object=this;this.events=new PXEventList(this,PXGrid.events,$c.clientEvents);var $e=this.xmlDoc.getElementsByTagName("Rows")[0];this.rows=new PXGridRows(this,null,this.scrollDiv,$e);var $f=[1,2,3];for(var i=0;i<$f.length;i++)this.callbacks[$f[i]].ownCommit=true;var toolbar=this.actionsTop||this.actionsBottom;this.exportManager=new PXExcelExportManager(this,this.callbacks[7]);__px_tm(this).registerContainerOverflowTip(this.scrollDiv);};PXGrid.prototype.dispose=function(){var $g=this.levels[0].columns;for(var i=0;i<$g.length;i++)$g[i].dispose();this.levels[0].dispose();if(this.xmlDocObject){this.xmlDocObject.dispose();delete this.xmlDocObject;delete this.xmlDoc;};if(this.xslProc){this.xslProc.dispose();delete this.xslProc;};this.rows.dispose();delete this.rows;delete this.activeRow;delete this.activeCell;delete this.levels;delete this.actionsTop;delete this.actionsBottom;delete this.pivotTable;delete this.extToolbar;delete this.localMenu;delete this.tlbFilterTabs;delete this.tlbFilters;delete this.tlbFilterTools;delete this.filterBar;delete this.$3E;delete this.commandControls;delete this.exportManager;delete this.customCommands;delete this.focusElem;delete this.scrollDiv;delete this.statFDiv;delete this.statFTable;delete this.statHDiv;delete this.statHTable;delete this.actionCellB;delete this.actionCellT;delete this.pivotEditor;};PXGrid.clientStateDesc=[["activeRowID",JSType.String,""],["activeCell",JSType.Int,0],["scrollLeft",JSType.Int,undefined],["scrollTop",JSType.Int,undefined],["columnsOrder",JSType.String,""]];PXGrid.emptyMessages=[["selectorMessage",JSType.String,"No records found."],["searchMessage",JSType.String,"Nothing found for '{0};'.\nTry using different search term or something less specific.\n[a type=clear]Clear search[/a]"],["dataMessage",JSType.String,"No records in this list."],["incompleteDataMessage",JSType.String,"Once you provide more information above you can add records in here."],["inqMessage",JSType.String,"No records found.\nTry to modify parameters above to see records here."],["inqAddMessage",JSType.String,"No records found.\nTry to modify parameters above to see records here."],["filteredMessage",JSType.String,"No records found.\nTry to change filter to see records here."],["filteredAddMessage",JSType.String,"No records found.\nTry to change filter to see records here."],["comboMessage",JSType.String,"No records found.\nTry to change filter or modify parameters above to see records here."],["comboAddMessage",JSType.String,"No records found.\nTry to change filter or modify parameters above to see records here."],["namedComboMessage",JSType.String,"No records found as '{0};'.\nTry to change filter or modify parameters above to see records here."],["namedComboAddMessage",JSType.String,"No records found as '{0};'.\nTry to change filter or modify parameters above to see records here."],["namedFilteredMessage",JSType.String,"No records found as '{0};'.\nTry to change filter to see records here."],["namedFilteredAddMessage",JSType.String,"No records found as '{0};'.\nTry to change filter to see records here."],["anonFilteredMessage",JSType.String,"No records found.\nTry to change filter to see records here."],["anonFilteredAddMessage",JSType.String,"No records found.\nTry to change filter to see records here."],["bareInqMessage",JSType.String,"No records found."],["bareInqAddMessage",JSType.String,"No records found."]];PXGrid.properties=[["viewMode",JSType.Int,0],["floatingEditor",JSType.Bool,true],["batchUpdate",JSType.Bool,false],["matrixMode",JSType.Bool,false],["autoAdjustColumns",JSType.Bool,false],["adjustPageSize",JSType.Int,0],["allowPaging",JSType.Bool,false],["allowSearch",JSType.Bool,false],["allowFilter",JSType.Bool,true],["allowNote",JSType.Bool,false],["checkChanges",JSType.Bool,true],["postValues",JSType.Bool,true],["keepPosition",JSType.Bool,false],["preservePage",JSType.Bool,false],["layoutLoaded",JSType.Bool,false],["defaultAction",JSType.String,""],["dataSourceID",JSType.String,""],["totalRowCount",JSType.Int,0,"setRowsCount"],["pageSize",JSType.Int,25,"setPageSize"],["pageIndex",JSType.Int,0,"setPageIndex"],["isFirstPage",JSType.Bool,true],["isLastPage",JSType.Bool,true],["pagerMode",JSType.Int,1],["xslFile",JSType.String,""],["xslEditFile",JSType.String,""],["searchCss",JSType.String,""],["searchTextCss",JSType.String,""],["hasEditPage",JSType.Bool,false],["contextMenuID",JSType.String,""],["storeCookie",JSType.Bool,true],["clientState",JSType.Object,PXGrid.clientStateDesc],["callbacks",JSType.Array,PXCallbackManager.commandDesc],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc],["onChangeCommand",JSType.Object,PXCallbackManager.settingsDesc],["filters",JSType.Empty,null],["filterID",JSType.Int,null],["isSharedFilterEditable",JSType.Bool,false],["filesMenuUrls",JSType.Object,null],["statusField",JSType.String,""],["requiredImageUrl",JSType.String,"control@Required"],["recordNumMsg",JSType.String,""],["fastFilterID",JSType.String,""],["gridViewText",JSType.String,""],["externalFilter",JSType.Bool,false],["editStr",JSType.String,""],["uploadCommand",JSType.String,""],["pasteCommand",JSType.String,""],["exportCommand",JSType.Bool,true],["exportImages",JSType.Object,PXExcelExportManager.exportImagesDesc],["extendButtonEditors",JSType.Bool,true],["markRequired",JSType.Int,1],["restrictFields",JSType.Bool,false],["externalToolBarID",JSType.String,""],["autoSaveLayout",JSType.Bool,true],["allowDrop",JSType.Int,0],["fileDialogId",JSType.String,""],["timeStr",JSType.String,""],["rowChangedMsg",JSType.String,""],["gridChangedMsg",JSType.String,""],["filterAppliedMsg",JSType.String,""],["filterAllMsg",JSType.String,""],["filterEmptyMsg",JSType.String,""],["filterNameMsg",JSType.String,""],["filterRemoveMsg",JSType.String,""],["filterChangesInSharedMsg",JSType.String,""],["emptyMsg",JSType.Object,PXGrid.emptyMessages],["emptyMessageMode",JSType.Int,0],["addCommandName",JSType.String,""],["dataMember",JSType.String,""],["filterNames",JSType.Array,null],["editPivotTableUrl",JSType.String,""],["filterPivots",JSType.Object,null]];PXGrid.events={$initialize:0,$beforeColMove:1,$afterColMove:2,$beforeColResize:3,$afterColResize:4,$gridCornerClick:5,$colHeaderClick:6,$rowSelectorClick:7,$cellButtonClick:8,$beforeColSort:9,$afterColSort:10,$beforeRowChange:11,$afterRowChange:12,$beforeCellChange:13,$afterCellChange:14,$beforeRowFormOpen:15,$afterRowFormOpen:16,$beforeRowFormClose:17,$afterRowFormClose:18,$beforeEnterEditMode:19,$afterEnterEditMode:20,$beforeExitEditMode:21,$afterExitEditMode:22,$beforeCellUpdate:23,$afterCellUpdate:24,$beforeRowDelete:25,$afterRowDelete:26,$beforeRowUpdate:27,$afterRowUpdate:28,$beforeRowInsert:29,$afterRowInsert:30,$cellClick:31,$keyDown:32,$keyUp:33,$beforeRefresh:34,$afterRefresh:35,$toolsButtonClick:36,$horizontalScroll:37,$startCellEdit:38,$endCellEdit:39,$afterResize:40,$commandState:41,$afterRepaint:42,$afterRepaintRow:43,$filesMenuShown:44,$beforeCellEdit:45,$keyPress:46,$cellEditorCreated:47,$dragover:48,$dragdrop:49,$afterAdjustColumns:50,$editorKeyDown:51,$filterDialogCreated:52};PXGrid.callbackProps=[["totalRowCount",JSType.Int,0,"setRowsCount"],["pageSize",JSType.Int,25,"setPageSize"],["pageIndex",JSType.Int,0,"setPageIndex"],["searchValue",JSType.String,null,"setSearchValue"],["externalSearch",JSType.Bool,false,"setExternalSearchValue"],["isFirstPage",JSType.Bool,true],["isLastPage",JSType.Bool,true],["isFilterSavable",JSType.Bool,true],["isFilterEditable",JSType.Bool,true],["isFilterShared",JSType.Bool,false],["isFilterChanged",JSType.Bool,false],["hasAdvancedFilters",JSType.Bool,false],["emptyMessageMode",JSType.Int,0],["delDefaultsVisible",JSType.Bool,false],["delDefaultsEnabled",JSType.Bool,false]];PXGrid.prototype.setProperties=function($c,$h){__px_cm(this).readProperties(this,$c,PXGrid.callbackProps);if($c==null||$c.levels==null)return;var $h=__px_callback(this).isReloadPage;if($h)this.dataMember=$c.dataMember;if($c.hidden!=null)this.setVisible(!$c.hidden);if($c.layoutLoaded!=null)this.layoutLoaded=$c.layoutLoaded;if($c.colsFilterActive===0)this.clearColumnFilters();if($c.filterPivots!==undefined)this.filterPivots=$c.filterPivots;this.setFilterID($c.filterID);this.setFilterActive($c.filterID!=null);if(!$c.fastFilter)this.clearFastFilter();else if($h)this.setFastFilter($c.fastFilter);var $i=$c.columnFilters;if($i&&!this.hasQuickFilters()){for(var i=0;i<$i.length;i++){var cf=$i[i],$j=this.levels[0].getColumn(cf.dataField);if(!$j||!cf)continue;$j.filter=new Object();$j.filter.condition=cf.condition;$j.filter.value=cf.value;$j.filter.value2=cf.value2;$j.repaintDataImage();};this.storeColumnsFilter();};this.setFilterHighlightState();if(this.cmbFilter){var e=this.cmbFilter.element;this.hasAdvancedFilters?e.setAttribute("data-active",1):e.removeAttribute("data-active");};if(!this.hasAdvancedFilters&&this.filterBox&&this.filterBox.getFilterID()==-1)this.filterBox.clear();if(this.tlbFilters!=null){delete this.quickFilterChaged;this.quickFilters=$c.quickFilters;if(__px_callback(this).isReloadPage)this.quickFiltersA=$c.quickFiltersA;this.renderQuickFilters();if(this.hasNoFilterID()){this.quickFiltersA=this.quickFilters;this.storeQuickFilterState();}else this.clearQuickFilterState();var $g=this.levels[0].columns;for(var i=0;i<$g.length;i++)$g[i].repaintDataImage();};if($c.activeRowIndex!=null&&!this.suppressRowActivate){this.$3F($c.activeRowIndex);this.activeRow=null;};delete this.suppressRowActivate;if($c.sqlTimeout||this.sqlTimeout){var $k=[this.actionsBottom,this.actionsTop];if(this.oldPagerMode==null)this.oldPagerMode=this.pagerMode;this.sqlTimeout=Boolean($c.sqlTimeout);this.pagerMode=this.sqlTimeout?1:this.oldPagerMode;for(var i=0;i<$k.length;i++){if($k[i]==null)continue;$k[i].pagerMode=this.pagerMode;var $l=$k[i].getButton("countWarn");if($l)$l.setVisible(this.sqlTimeout);}};var $m=Math.min($c.levels.length,this.levels.length);for(var i=0;i<$m;i++){var $n=this.levels[i],lp=$c.levels[i],lf=$n.formView;__px_cm(this).readProperties($n,lp,PXGridLevel.callbackProps);if(lf){lf.allowInsert=$n.allowAddNew;lf.allowUpdate=$n.allowUpdate;lf.allowDelete=$n.allowDelete;};if(lp.dataKey)$n.dataKey=lp.dataKey.split(",");if(lp.columns)for(var j=0;j<lp.columns.length;j++){var cp=lp.columns[j],$j=$n.getColumn(cp.dataField);if($j)$j.setProperties(cp,$h);}}};PXGrid.prototype.setFilterHighlightState=function(){if(this.tlbFilterTools){var $l=this.tlbFilterTools.getButton('FilterShow');if($l)__px(this).toggleCss(this.hasAdvancedFilters,$l.element,['highlight'],true);}};PXGrid.prototype.$3A=function(){var id=this.ID;this.scrollDiv=__px(this).elemByID(id+"_scrollDiv");this.statHDiv=__px(this).elemByID(id+"_headerDiv");this.statFDiv=__px(this).elemByID(id+"_footerDiv");this.statHTable=__px(this).elemByID(id+"_headerT");this.statFTable=__px(this).elemByID(id+"_footerT");this.actionCellT=__px(this).elemByID(id+"_at");this.actionCellB=__px(this).elemByID(id+"_ab");this.pivotEditor=__px(this).elemByID(id+"_pivotE");};PXGrid.prototype.$3B=function($c){var $o=this.$3G();var $p=$o.xmlDoc.getElementsByTagName("Levels")[0];this.levels=new Array();for(var i=0;i<$c.levels.length;i++){var $q=$c.levels[i],$r=$p.childNodes[i];this.levels[i]=new PXGridLevel(this,i,$q,$r);}};PXGrid.prototype.$3F=function($s){var id=[this.ID,"row",$s];if($s>=0)this.clientState.activeRowID=id.join("_");else delete this.clientState.activeRowID;this.clientState.activeRow=$s;};PXGrid.prototype.getVisible=function(){return this.element.style.display!="none";};PXGrid.prototype.getActualVisible=function(){return this.element.offsetParent!=null&&this.element.offsetHeight>0;};PXGrid.prototype.setVisible=function($t){var $u=$t!=this.getVisible();this.element.style.display=($t?"":"none");__px_cm(this).setStackElementsVisible(this,$t);if($u)__px_cm(this).notifyOnResize();};PXGrid.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXGrid.prototype.setEnabled=function($v){__px(this).setEnabled(this.element,$v);};PXGrid.prototype.getActionBarWidth=function(){var $w=[this.actionsTop,this.actionsBottom],$x=0;for(var i=0;i<$w.length;i++){if($w[i]==null)continue;var $y=$w[i].toolBar,$z=$w[i].element.clientWidth;if($y!=null){$z=$y.element.offsetWidth;if($y.elemItems.offsetWidth>$z)$z=$y.elemItems.offsetWidth;};if($z>$x)$x=$z;};return $x;};PXGrid.prototype.hasRows=function(){return(this.rows&&this.rows.length>0);};PXGrid.prototype.getStatusText=function(){var $A="",$B;if(this.statusField){if(this.activeForm!=null){var $j=this.levels[0].getColumn(this.statusField);var $C=$j?$j.getFormEditor():null;if($C)$B=$C.getValue();}else if(this.activeRow){var $D=this.activeRow.getCell(this.statusField);if($D)$B=$D.getValue();};$A=String(($B!=null)?$B:"");};return $A;};PXGrid.prototype.repaintStatusBar=function(){if(this.hasFocus)__px_cm(this).repaintStatusBar(this);var ab=this.actionsBottom;if(ab==null||ab.toolBar==null)return;var $E=ab.toolBar.items,$F=(ab.pagerMode==4);for(var i=0;i<$E.length;i++){var $G=$E[i],es=$G.itemCell.style;if($G.type=="PXToolBarSeperator"&&es.width=="100%"){var $A=this.getStatusText();if(!$A&&$F&&this.totalRowCount>0){var br=String.fromCharCode(125),$H=this.pageIndex*this.pageSize+1;var $I=$H+'-'+($H+this.rows.length-1);$A=this.recordNumMsg.replace('{0'+br,$I).replace('{1'+br,this.totalRowCount);};$G.setText($A);break;}}};PXGrid.prototype.getHeight=function(){if(this.height==null&&this.element.offsetHeight>0)this.height=this.element.offsetHeight;return this.height;};PXGrid.prototype.setHeight=function($J){var h=parseInt($J);if(h>0){var $K=this.element,sd=this.scrollDiv,$D=sd.parentNode;h-=($K.offsetHeight-$D.clientHeight);$K.style.height=$D.style.height=sd.style.height=(h>0?h:0)+"px";if(this.activeForm)this.activeForm.level.adjustEditFormSize();this.height=this.element.offsetHeight;delete this.windowHeight;}};PXGrid.prototype.restoreHeight=function(){var $J=this.getHeight(),$L=this.element.offsetHeight;if($J!=null&&$L!=$J&&__px(this).isVisible(this.element)){this.setHeight($J);return true;};return false;};PXGrid.prototype.getWidth=function(){return this.element.offsetWidth;};PXGrid.prototype.setWidth=function($x){var w=parseInt($x);this.element.style.width=w+"px";};PXGrid.prototype.focus=function(){var $M=(this.element.offsetHeight>0);if($M&&this.getEnabled()){__px_cm(this).setFocus(this,this.handleFocusEvents);this.repaintStatusBar();}};PXGrid.prototype.getRowObject=function($N){if($N==null||$N.tagName!="TR")return null;if(typeof($N.object)!="undefined")return $N.object;var $O=new Array();while(true){var $s=-1;if(this.levels.length==1)$s=$N.sectionRowIndex;else{var $P=$N.parentNode.rows;for(var i=0;i<$P.length;i++)if(!$P[i].getAttribute("childLevel")){$s++;if($P[i]==$N)break;}};$O[$O.length]=$s;if($N.parentNode.parentNode==this.rows.dataTable)break;$N=$N.parentNode;while($N!=null&&$N.tagName!="TR")$N=$N.parentNode;if($N!=null)$N=$N.previousSibling;else break;};$O=$O.reverse();var $P=this.rows,$Q;for(var i=0;i<$O.length;i++){$Q=$P.getRow(parseInt($O[i]));if($Q&&$Q.expandable&&i<($O.length-1))$P=$Q.rows;else if(i<($O.length-1)){$Q=null;break;}};return $Q;};PXGrid.prototype.getRowByID=function(id){var $b=__px(this).elemByID(id);if($b)return this.getRowObject($b);return null;};PXGrid.prototype.getColByID=function(id){id=id.substr(this.ID.length+1);var ar=id.split("_");if(ar.length<3)return null;var $R=parseInt(ar[1]),$S=parseInt(ar[2]);if($R>=this.levels.length)return null;return this.levels[$R].columns[$S];};PXGrid.prototype.find=function($T,$j,$U,$V){return this.rows.find($T,$j,$U,$V);};PXGrid.prototype.findExt=function($W,$X,$U){return this.rows.findExt($W,$X,$U);};PXGrid.prototype.autoInsertRow=function(){if(!this.levels[0].allowAddNew||this.element.offsetParent==null||this.element.offsetHeight==0)return;try{this.suppressFocus=true;if(this.rows.length==0){var $Q=this.addNewRow(true);if($Q)$Q.autoCreated=true;}else{var ar=this.activeRow;if(ar&&ar.autoCreated)this.beginEdit();}}finally{delete this.suppressFocus;}};PXGrid.prototype.hasAutoInsertedRow=function(){return(this.rows.length==1)&&this.rows.getRow(0).autoCreated;};PXGrid.prototype.navigate=function($Y,ev){var $j=this.levels[0].getColumn($Y);if($j&&$j.viewLink){var ds=__px_alls(this)[this.dataSourceID],$Z=new Object();var $l=this.getActionFromToolBarOrDS($j.linkCommand);if($l==null){var $00=ds?ds.getCallback($j.linkCommand):null;if(!$00){var $Z=new Object(),pt;if($j.popupCommandTarget&&(pt=__px_alls(this)[$j.popupCommandTarget])!=null){$Z.target=pt.ID;$Z.command=$j.popupCommand;}else{$Z.target=this.ID;$Z.command=PXGridCommand.Refresh;};$Z.enabled=$Z.checkSave=true;var $01=Function.createDelegate(this,this.processNavigate);var $a={'popupCmd':$Z};__px_callback(this).execI(this,this.callbacks[11],$Y,$01,$a,$Z);}else ds.executeCallback($j.linkCommand);}else $l.exec(ev);}};PXGrid.prototype.processNavigate=function($02,$a){if($02)__px(this).openUrl($02,this.ID,false,true,$a.popupCmd);};PXGrid.prototype.$3H=function($03){if($03.closePopup)this.refresh();};PXGrid.prototype.execDefaultAction=function(e){var $l=this.getActionFromToolBarOrDS(this.defaultAction);if($l){$l.exec(e);}else{var ds=__px_alls(this)[this.dataSourceID];var $00=ds?ds.getCallback(this.defaultAction):null;if($00){ds.executeCallback(this.defaultAction);}}};PXGrid.prototype.getActionFromToolBarOrDS=function($04){var $05=[this.actionsTop,this.actionsBottom],$l=null;for(var i=0;i<$05.length&&!$l;i++)if($05[i])$l=$05[i].getButton($04);if($l==null){var ds=__px_alls(this)[this.dataSourceID];$l=ds&&ds.toolBar&&ds.toolBar.getButton($04);};return $l;};PXGrid.prototype.repaint=function($06){if(this.rows&&this.rows.length>0)this.storePosition(false);this.checkRowChanges(0);if($06 instanceof PXXmlDoc){var $07=$06.xmlDoc.getElementsByTagName("Rows")[0];this.rows.xmlNode=this.xmlDocObject.replaceNode($07);};if(this.rows)this.rows.repaint();this.restorePosition();if(this.activeRow)this.activeRow.scrollToView();var $08=this.rows.xmlNode.getAttribute("ErrorText");var $09=parseInt(this.rows.xmlNode.getAttribute("ErrorLevel"))-1;var $0a=new Object();$0a["hasError"]=$09>0;$0a["errorStatus"]=$09;$0a["errorText"]=$08;this.fireEvent("afterRepaint",null,$0a);};PXGrid.prototype.refresh=function($01,$0b,$0c){if(this.activeForm!=null){var $n=this.activeForm.level,$0d=$n.formView;if($0b){$0d.clearDataKey();$n.refreshRows=true;};$0d.setPageIndex(0);$0d.refresh();}else{if(this.batchUpdate&&this.getChanged()){this.refreshAfterUpdate=true;this.update();}else{if($01==null)$01=Function.createDelegate(this,this.processRefresh2);if(!this.fireEvent("beforeRefresh",null)){if(this.isPivotVisible()){this.pivotTable.setResetTable();this.pivotIdChanged?this.pivotTable.setReload(true):this.pivotTable.showSpinner();this.pivotIdChanged=false;}else{if(this.editMode)this.endEdit(true);this.storePosition();this.storeDataValues();this.rows.reset();};if(!$0c)$0c="";__px_callback(this).execI(this,this.callbacks[0],$0c,$01);}}}};PXGrid.prototype.refreshSilent=function(){if(this.activeForm!=null){this.refresh();}else if(!this.fireEvent("beforeRefresh",null)){if(this.isPivotVisible()){this.pivotIdChanged?this.pivotTable.setReload(true):this.pivotTable.showSpinner();this.pivotIdChanged=false;}else{if(this.editMode)this.endEdit(true);this.storePosition();this.storeDataValues();};var $01=Function.createDelegate(this,this.processRefresh2);__px_callback(this).execI(this,this.callbacks[0],"",$01);}};PXGrid.prototype.processRefresh2=function($02,$a,$0e){if($02){var $0f=__px_all(this)[$a];$0f.processRefresh($02,true);if($0f.$3I){$0f.rows.findExt($0f.$3I,$0f.levels[0].dataKey);$0f.clearSearchKey();};delete this.filterApplication;if(!$0e)$0f.fireEvent("afterRefresh",null);}};PXGrid.prototype.processSort=function($02,$a){var $0f=__px_all(this)[$a];this.processRefresh2($02,$a);if($0f.sortedColumn){var $0g=new Object();$0g.column=$0f.sortedColumn;$0f.fireEvent("afterColSort",null,$0g);$0f.sortedColumn=null;}};PXGrid.prototype.$3J=function($02,$a){var $0f=__px_all(this)[$a];this.processRefresh2($02,$a,true);if($0f.$3K){$0f.find($0f.$3K,$0f.$3L);$0f.$3K=$0f.$3L=null;};$0f.fireEvent("afterRefresh",null);};PXGrid.prototype.setPage=function($0h){if(this.allowPaging){var pc=this.getPageCount();if(pc>0&&($0h<0||$0h>=pc))return;if(this.pagerMode>1)this.clearSearch();this.setPageIndex($0h);if(this.getChanged()){this.refreshAfterUpdate=true;this.update();}else{(this.adjustPageSize==2)?this.adjustPage(true):this.refresh();}}};PXGrid.prototype.getPageCount=function(){var $P=this.totalRowCount;if(!this.allowPaging||$P==0)return 1;if($P<0)return -1;var $0i=($P+this.pageSize)-1;return Math.floor(($0i<0)?1:($0i/this.pageSize));};PXGrid.prototype.getDataKey=function($W){var $0j=new Array(),ar=this.activeRow;var $n=this.levels[0],$0k=$n.dataKey;if(($W||ar)&&$0k)for(var i=0;i<$0k.length;i++){var $j=$n.getColumn($0k[i]);if($j){var v=$W?$W[i]:ar.getCell($j).getValue();$0j[i]=$j.getInvariantText(v);}};return $0j?$0j:null;};PXGrid.prototype.setSearchKey=function($W){this.$3I=$W;this.viewState.update("SearchKey",this.getDataKey($W).join('|'));};PXGrid.prototype.clearSearchKey=function(){delete this.$3I;this.viewState.remove("SearchKey");};PXGrid.prototype.setPageIndex=function($B){this.pageIndex=$B;this.viewState.update("PageIndex",$B);};PXGrid.prototype.setRowsCount=function($B){if($B>=-1){this.totalRowCount=$B;this.viewState.update("TotalRowCount",this.totalRowCount);}};PXGrid.prototype.setPageSize=function($B){if($B>=1){this.pageSize=$B;this.viewState.update("PageSize",$B);}};PXGrid.prototype.setFormLevel=function($B){this.formLevel=$B;if($B==null)this.viewState.remove("FormLevel");else this.viewState.update("FormLevel",$B);};PXGrid.prototype.search=function($B,$0l){if(this.allowSearch){if($0l&&!($0l instanceof PXGridColumn))$0l=this.levels[0].getColumn($0l);if($0l){var $g=this.levels[0].columns,$0m=false;for(var i=0;i<$g.length;i++){if($g[i].sortDirection>0){if($g[i].dataField==$0l.dataField)$0m=true;else $g[i].setSortIndicator(0);break;}};if(!$0m)$0l.setSortIndicator(1);};var sc=this.$3L=this.getSearchColumn();if(sc){this.$3K=sc.getInvariantText(sc.getTypedValue($B));this.setSearchValue(this.$3K);this.viewState.update("PageIndex",this.pageIndex=0);sc.setSortIndicator(sc.sortDirection>0?sc.sortDirection:1,true);this.refresh(Function.createDelegate(this,this.$3J),true);if(this.pagerMode>1)this.clearSearch();}}};PXGrid.prototype.setSearchValue=function($T){if($T==null)this.clearSearch();this.viewState.update("SearchValue",$T);};PXGrid.prototype.getSearchValue=function(){return this.viewState.select("SearchValue");};PXGrid.prototype.setExternalSearchValue=function($T){this.viewState.update("ExternalSearch",Boolean($T));};PXGrid.prototype.clearSearch=function(){this.viewState.remove("SearchValue");this.viewState.remove("ExternalSearch");};PXGrid.prototype.clearColumnFilters=function(){var $g=this.levels[0].columns;for(i=0;i<$g.length;i++){$g[i].filter=null;$g[i].repaintDataImage();};this.storeColumnsFilter();};PXGrid.prototype.saveLayout=function($0n){var $0o=this.levels[0].getColumnKeys();var $g=this.levels[0].columns,$0p=new Array(),$0q=new Array();for(var i=0;i<$g.length;i++){$0p.push($g[i].getVisible()?1:0);$0q.push($g[i].skipTabs?1:0);};var $0r=($0n?"silent@":"")+$0o.join(",")+"|"+$0p.join(",")+"|"+$0q.join(",");__px_callback(this).execI(this,this.callbacks[9],$0r,Function.createDelegate(this,this.processLayoutSave));};PXGrid.prototype.resetLayout=function(){var $g=this.levels[0].columns;for(var i=0;i<$g.length;i++)$g[i].clearWidth();__px_callback(this).execI(this,this.callbacks[10],"",Function.createDelegate(this,this.processLayoutReset));};PXGrid.prototype.processLayoutSave=function($02,$a){var $0f=__px_all(this)[$a];if($0f){if($02)$0f.processRefresh($02,true);$0f.layoutLoaded=true;$0f.layoutChanged=false;$0f.notifyCommandState();}};PXGrid.prototype.processLayoutReset=function($02,$a){var $0f=__px_all(this)[$a];if($0f&&$02){$0f.processRefresh($02,true);$0f.restoreHeight();$0f.layoutLoaded=false;$0f.layoutChanged=false;$0f.notifyCommandState();}};PXGrid.prototype.uploadData=function(){var $0s=__px_all(this)[this.ID+"_imp_upl_pnl"];if($0s&&this.uploadCommand){$0s.show();var ds=__px_alls(this)[this.dataSourceID];if(ds){if(this.$3M==null)this.$3M=Function.createDelegate(this,this.$3N);ds.events.addEventHandler("commandPerformed",this.$3M);}}};PXGrid.prototype.$3N=function($0t,$a){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.$3N);if(this.uploadCommand.split('$')[0]==$a.command.split('$')[0]&&($a.alert==null&&ds.alert==null)){ds.setClientChanged();}};PXGrid.prototype.exportExcel=function($0g){var $0u=this.callbacks[7];if(this.getCommandState(this,$0u.name).getEnabled()&&this.$3E){this.exportManager.startExportExcel($0g,this.$3E,this.exportImages);}};PXGrid.$3O=function($0r){var $0v=new Object();if($0r){var $0w=$0r.split('|');if($0w.length>0){var $00=$0w[0].split('$');$0v.command=$00[0];if($00.length>1)$0v.type=$00[1];};if($0w.length>1)$0v.uid=$0w[1];if($0w.length>2)$0v.status=$0w[2];if($0w.length>3)$0v.seconds=$0w[3];if($0w.length>4)$0v.errors=$0w[4];};return $0v;};PXGrid.prototype.excelExportComplete=function($02,$a){};PXGrid.prototype.processExportExcel=function($02,$a){var $0f=__px_all(this)[$a];if($0f&&$0f.$3E&&$0f.$3E.inprocess){var $0x=PXGrid.$3O($02);if($0x.errors||String.compare($0x.status,"aborted",true)||String.compare($0x.status,"notexists",true)){$0f.$3P("aborted",$0x.seconds,$0x.errors);}else if(String.compare($0x.status,"completed",true)){$0f.$3P("success",$0x.seconds);var $0y=location.href.split('?')[0],$0z="/export",i=$0y.lastIndexOf('/');if(i>=0){var $0A=$0f.currentDate();if($0A==$0f.xlsDate)$0f.xlsId+=1;else{$0f.xlsDate=$0A;$0f.xlsId=0;};$0z=__doc(this).title+" "+$0A;if($0f.xlsId>0)$0z+="("+$0f.xlsId+")";$0y=$0y.substring(0,i)+'/';};if($0f.exportFrame==null){$0f.exportFrame=__doc(this).createElement("iframe");$0f.exportFrame.style.display="none";__doc(this).body.appendChild($0f.exportFrame);};$0z=$0z.replace(/\.|&|#|\?|%|\(|\)|\[|\]|\\|\/|\||\^|<|>|,|:|;|=|@|~/g,'');var $0B=$0y+"ExportExcel.axd?file="+$0z+".xlsx";if($0x.type=="xlsx")$0B=$0y+"ExportXlsx.axd?file="+$0z+".xlsx";if($0x.type=="iqy")$0B=$0y+"ExportIqy.axd?file="+$0z+".iqy";$0f.exportFrame.src=$0B;}else{$0f.$3P("inprocess",$0x.seconds,null,$0x.uid);var $0u=$0f.callbacks[7],me=this;setTimeout(function(){if($0f.$3E&&$0f.$3E.inprocess){var $0C="checkstatus";if($0x.type)$0C+="$"+$0x.type;__px_callback(me).execI($0f,$0u,$0C+"|"+$0x.uid,Function.createDelegate($0f,$0f.processExportExcel));}},5000);}}};PXGrid.prototype.$3Q=function(){if(!this.$3E||!this.exportImages)return;if(!this.$3E.inprocess){var $0D=this.exportImages.normal;var $0E=this.exportImages.normal;var $0F=this.$3E.images;$0F.normal=$0D;$0F.disabled=$0D;$0F.hover=$0E;this.$3E.setStyle();}};PXGrid.prototype.$3P=function(status,$0G,$0H,$0I){if(!this.$3E||!this.exportImages)return;if(!this.$3E.origTooltip)this.$3E.origTooltip=this.$3E.getTooltip();if($0I)this.$3E.uid=$0I;var $0J="";if($0G){var $0K=parseInt($0G);var $0L=Math.floor($0K/60);var $0M=$0K%60;if($0L<10)$0L="0"+$0L;if($0M<10)$0M="0"+$0M;$0J=this.timeStr+" "+$0L+":"+$0M;};var $0D=this.exportImages.normal;var $0E=this.exportImages.normal;var $0N=this.$3E.origTooltip;this.$3E.inprocess=false;switch(status){case "inprocess":$0D=this.exportImages.processing;$0E=this.exportImages.cancel;this.$3E.inprocess=true;if($0J)$0N=$0J;break;case "aborted":$0D=this.exportImages.cancel;$0E=this.exportImages.normal;this.$3E.inprocess=false;$0N=$0J.length>0?$0J+"; "+$0H:$0H;break;case "success":$0D=this.exportImages.normal;$0E=this.exportImages.normal;this.$3E.inprocess=false;if($0J)$0N=$0J;break;};var $0F=this.$3E.images;$0F.normal=$0D;$0F.disabled=$0D;$0F.hover=$0E;this.$3E.setStyle();this.$3E.setTooltip($0N);};PXGrid.prototype.currentDate=function(){var d=new Date();var $0O=d.getMonth()+1;if($0O<10)$0O="0"+$0O;var $0P=d.getDate();if($0P<10)$0P="0"+$0P;return ""+d.getFullYear()+$0O+$0P;};PXGrid.prototype.clearRowSelection=function($0Q){if($0Q==null)$0Q=true;var $0R=this.selectedRows;if($0R!=null){if($0Q){for(var n in $0R)if($0R[n].setSelected)$0R[n].setSelected(false);};if($0R.collection)$0R.collection.hasSelection=false;this.selectedRows=null;}};PXGrid.prototype.storeRowSelection=function($Q){var $0R=this.selectedRows;if($0R==null)this.selectedRows=$0R=new Object();var $0S="_"+$Q.xmlIndex;if($Q.getSelected()){var $P=$0R.collection;if($P!=null&&$P!=$Q.collection)this.clearRowSelection();$0R.collection=$Q.collection;$0R.collection.hasSelection=true;$0R[$0S]=$Q;}else{var $0T=$0R[$0S];if($0T)delete $0R[$0S];}};PXGrid.prototype.copySelectedRows=function(){var $0U=this.selectedRows?new Array():[this.activeRow];if(this.selectedRows){for(var n in this.selectedRows)if(this.selectedRows[n].setStatus)$0U.push(this.selectedRows[n]);};if(this.rowsToPaste)for(var i=0;i<this.rows.length;i++){var r=this.rows.getRow(i);if(r.awaitPaste){delete r.awaitPaste;r.repaintRow();}};this.rowsToPaste=$0U.map(function(r){r.awaitPaste=true;r.repaintRow();return r.getDataKey().join("|");});this.clearRowSelection();var ds=__px_alls(this)[this.dataSourceID],me=this;if(ds&&!this.keyChangeH){this.keyChangeH=function(s,e){delete me.rowsToPaste;};ds.events.addEventHandler("keyChanged",this.keyChangeH);}};PXGrid.prototype.setSize=function($x,$J,$0V,$0W,parent){var $K=this.element,$D=this.scrollDiv.parentNode;var w=parseInt($x),h=parseInt($J);if($0W){var $0X=parent?parent:__doc(this).documentElement;var $0Y=$0X.clientWidth,$0Z=$0X.clientHeight;var $10=$0X.scrollTop,$11=$0X.scrollLeft;var $12=__px(this).getElemLeftPos($K,$0X);var top=__px(this).getElemTopPos($K,$0X);if(($12+w)>($0Y+$11))w=$0Y-$12+$11;if((top+h)>($0Z+$10))h=$0Z-top+$10;};if($0V){var $13=$0V.minHeight,$14=$0V.minWidth;var $15=$0V.maxHeight,$16=$0V.maxWidth;if($13&&h<$13)h=$13;else if($15&&h>$15)h=$15;if($14&&w<$14)w=$14;else if($16&&w>$16)w=$16;};$K.style.width=w+"px";h-=($K.offsetHeight-$D.offsetHeight);this.scrollDiv.style.height=$K.style.height=$D.style.height=(h>0?h:0)+"px";this.height=this.element.offsetHeight;var $17=this.scrollDiv;if($17.scrollHeight==$17.offsetHeight&&$17.scrollTop>0)$17.scrollTop=0;};PXGrid.prototype.getAdjustSize=function($0V){var $K=this.element,$18=this.rows.dataTable;var $17=this.scrollDiv,$D=$17.parentNode;var $19=$K.offsetWidth-$D.offsetWidth;var $1a=$K.offsetHeight-$D.clientHeight;var $z=new Object();$z.width=$19;$z.height=$1a;if($18){var $1b=$18.offsetHeight,$P=$18.tBodies[0].rows;if($1b){var $1c=$P.length*$P[0].offsetHeight;if($1c>$1b)$1b=$1c;};$z.height+=$1b?$1b:$17.scrollHeight;if(this.rows.length==0)$18=this.statHTable;$z.width+=$18.offsetWidth?$18.offsetWidth:$17.scrollWidth;$z.width+=$17.offsetWidth-__px(this).getStyleWidth($17);}else{$z.height+=$17.scrollHeight;$z.width+=$17.scrollWidth;};$z.width+=__px(this).getStyleIntElement($17.parentNode,"borderLeftWidth");$z.width+=__px(this).getStyleIntElement($17.parentNode,"borderRightWidth");if($0V){var $13=$0V.minHeight,$14=$0V.minWidth;var $15=$0V.maxHeight,$16=$0V.maxWidth;if($13&&$z.height<$13)$z.height=$13;else if($15&&$z.height>$15)$z.height=$15;if($14&&$z.width<$14)$z.width=$14;else if($16&&$z.width>$16)$z.width=$16;};return $z;};PXGrid.prototype.adjustSize=function($0V,$0W,parent){var $z=this.getAdjustSize();this.setSize($z.width,$z.height,$0V,$0W,parent);};PXGrid.prototype.adjustColumns=function($1d){if(!__px(this).isVisible(this.element))return;var $n=this.levels[0],$g=$n.columns;var $18=this.rows.dataTable,$17=this.scrollDiv;if(this.rows.length==0){$18=this.statHTable;$17=this.statHDiv;};if($18&&$18.offsetWidth>0&&$g.length>0){this.adjustingColumns=true;var $1e=0,$1f=0,$1g=0;for(var i=0;i<$g.length;i++)if($g[i].getVisible()&&($g[i].allowResize||this.hiddenResizeMode)){$1e+=$g[i].getWidth();$1g=i;$1f++;};var $19=$17.clientWidth-$18.offsetWidth;if($19!=0){if($1d==null)$1d=this.autoSaveLayout;this.autoSaveLayout=false;for(var i=0;i<$g.length;i++){if(!$g[i].getVisible()||!($g[i].allowResize||this.hiddenResizeMode))continue;var $x=$g[i].getWidth();if(i==$1g)$x+=$17.clientWidth-$18.offsetWidth-(__px(this).IsIE?0.5:0);else $x+=Math.round($19*$x/$1e);$g[i].setWidth($x);};if($1d){if(!this.editMode)this.saveLayout();this.autoSaveLayout=true;}};this.adjustingColumns=undefined;this.fireEvent("afterAdjustColumns");}};PXGrid.prototype.removeSpareRows=function(){if(this.rows.length<=this.pageSize)return;var ar=this.activeRow,$1h=ar?ar.getIndex():0;var $1i=$1h>=this.pageSize||this.isLastPage,$1j,$P=this.rows;if($1i){if(!this.getSearchValue()&&!this.isLastPage){var $1k=Math.ceil(($1h+1-this.pageSize)/this.pageSize);this.setPageIndex(this.pageIndex+$1k);};this.isFirstPage=false;}else this.isLastPage=false;while($P.length>this.pageSize){if($1i&&$P.getRow(0)==ar){$1j=true;break;};$P.remove($1i?0:($P.length-1));};if($1j){this.isLastPage=false;while($P.length&&$P.length>this.pageSize)$P.remove($P.length-1);};this.setSearchMarkToFirstRow();if(ar)ar.level.navigator.setPosition();this.notifyCommandState();};PXGrid.prototype.setSearchMarkToFirstRow=function($0l){if(!this.isLastPage&&!this.isFirstPage){var $D=this.rows.getRow(0).getCell($0l?$0l:this.getSearchColumn());if($D){this.setSearchValue($D.getValue());this.setPageIndex(0);}}};PXGrid.prototype.adjustPage=function($1l,$1m){if((!this.allowPaging&&this.rows==null)||!__px(this).isVisible(this.element)||this.levels[0].columns.length==0){return;};var $u=this.calcPageSize();if(this.adjustPageSize&&this.firstAdjust==null){$1l=true;this.firstAdjust=false;this.viewState.update("PageAdjusted",true);this.viewState.forceOnReloadPost();};if(!this.waitFilterSet&&!this.isPivotMode()&&($u||$1l)){this.refresh(null,null,$1m);}};PXGrid.prototype.calcPageSize=function($1n,$1o){var $1p=null,$1q=this.rows.length,$u=false,$1r;if($1q==0)$1p=this.rows.addNew();if(this.levels[0].getVisibleColsCount()==0){$1r=true;this.levels[0].getColumn(0).setVisible(true);};if(this.rows.length>0||this.rowHeight){var $Q=this.rows.getRow(0),$17=this.scrollDiv;if($Q)this.rowHeight=$Q.element.offsetHeight;var $J=$17.clientHeight,$1s=Math.floor($J/this.rowHeight);var $1t=this.getPageCount(),$1u=this.isFirstPage&&this.isLastPage;if($1o){$1s+=$1o;this.recalcPageSize=true;};if($1s>0){$u=!(isNaN($1s)||$1s==Infinity)&&($1s!=this.pageSize);if(!$u&&!this.editMode&&$1q>$1s)$u=true;if($u&&$1u&&$1q<=$1s){$u=false;this.setPageSize($1s);};if($u&&$1t==1&&!this.hasVScroll())$u=false;};if($1p)this.rows.remove($1p);if($u){var $1v=this.totalRowCount;if($1v>0&&($1s*this.pageIndex)>=$1v)this.setPageIndex(0);this.setPageSize($1s);}};if($1r)this.levels[0].getColumn(0).setVisible(false);if($1n){this.firstAdjust=false;this.viewState.update("PageAdjusted",true);};return $u;};PXGrid.prototype.isPageAdjusted=function(){return this.viewState.select("PageAdjusted")!=null;};PXGrid.prototype.hasVScroll=function(){var $17=this.scrollDiv;return($17.clientHeight<$17.scrollHeight);};PXGrid.prototype.hasHScroll=function(){var $17=this.scrollDiv;return($17.clientWidth<$17.scrollWidth);};PXGrid.prototype.getHScroll=function(){return this.scrollDiv.scrollLeft;};PXGrid.prototype.getVScroll=function(){return this.scrollDiv.scrollTop;};PXGrid.prototype.setOverflow=function($B,$1w){var ds=this.scrollDiv.style;if($1w==null)ds.overflow=$B;else if($1w=='x')ds.overflowX=$B;else if($1w=='y')ds.overflowY=$B;};PXGrid.prototype.setHScroll=function($T){if(this.hasHScroll()){this.scrollDiv.scrollLeft=$T;this.alignStatMargins();}};PXGrid.prototype.hasQuickFilters=function(){return this.tlbFilters!=null;};PXGrid.prototype.getLocalMenu=function(){if(this.localMenu==null){var $1x=this.ID+"_menu";this.localMenu=__px_all(this)[$1x];if(!this.localMenu){var $b=__px(this).elemByID($1x);if($b&&$b.parentNode!=__win(this).theForm)__win(this).theForm.appendChild($b);this.localMenu=__px_cm(this).createControl("PXMenu",$1x);if(this.localMenu){__px_all(this)[$1x]=this.localMenu;this.localMenu.onLoad();var h=Function.createDelegate(this,this.$3R);var h2=Function.createDelegate(this,this.$3S);this.localMenu.events.addEventHandler("itemClick",h);this.localMenu.events.addEventHandler("activate",h2);}}};return this.localMenu;};PXGrid.prototype.getContextMenu=function(){var $1y=null;if(this.contextMenuID){$1y=__px_all(this)[this.contextMenuID];if($1y){var $b=$1y.element;if($b&&$b.parentNode!=__win(this).theForm)__win(this).theForm.appendChild($b);}};return $1y;};PXGrid.prototype.getMenuItem=function($1z){var $1y=this.getLocalMenu();return $1y?$1y.items.getItemByCommand($1z):null;};PXGrid.prototype.$3S=function($1y,ev){this.notifyCommandState();};PXGrid.prototype.$3R=function($1y,ev){var $1A=false,ac=this.activeCell;switch(ev.item.commandName){case PXGridCommand.FilterShow:$1A=true;if(ac&&ac.column.allowFilterDialog())this.createColumnFilter();break;case PXGridCommand.FilterSet:$1A=true;if(ac){if(this.hasQuickFilters()){var $0S=ac.column.getKey(),f=this.getQuickFilter($0S);if(f)this.removeQuickFilter($0S);}else if(ac.column.filter!=null){ac.column.filter=null;ac.column.repaintDataImage();this.storeColumnsFilter();this.refresh();}};break;};if($1A){ev.cancel=true;$1y.setActive(false);};if(!this.hasFocus)this.focus();};PXGrid.prototype.$3C=function(){var $w=[this.actionCellT,this.actionCellB],h,me=this;for(var i=0;i<$w.length;i++){var $1B=$w[i];if(!$1B||$1B.innerHTML=="")continue;__px(this).addEventHandler($1B,"mousedown",function(e){if(!Array.contains(PX.focusTags,e.target.tagName))__px(me).cancelEvent(e,false);});if($1B.getAttribute("tabsInside")!=null){this.tlbFilterTabs=__px_cm(this).createControl("PXToolBar",$1B.id+"_ft");if(this.tlbFilterTabs){h=Function.createDelegate(this,this.$3T);this.tlbFilterTabs.events.addEventHandler("buttonClick",h);};continue;};var $1C=__px_cm(this).createControl("PXActionBar",$1B.id);if(!$1C)continue;$1C.events.addEventHandler("actionClick",PXGrid.$3U);$1C.events.addEventHandler("pagerClick",PXGrid.$3V);$1C.owner=this;if(i==0)this.actionsTop=$1C;else this.actionsBottom=$1C;this.$3W($1C);if(this.cmbFilter==null){this.cmbFilter=__px_cm(this).createControl("PXDropDown",$1C.ID+"_tlb_fs");if(this.cmbFilter){var h=Function.createDelegate(this,this.$3X);this.cmbFilter.events.addEventHandler("valueChanged",h);h=Function.createDelegate(this,this.$3Y);this.cmbFilter.events.addEventHandler("editButtonClick",h);delete this.cmbFilter.bindingContainer;}};if(this.tlbFilterTabs==null){this.tlbFilterTabs=__px_cm(this).createControl("PXToolBar",$1C.ID+"_tlb_ft");if(this.tlbFilterTabs){var h=Function.createDelegate(this,this.$3T);this.tlbFilterTabs.ownerToolbar=$1C.toolBar;this.tlbFilterTabs.events.addEventHandler("buttonClick",h);}};if(this.filterBar==null)this.filterBar=__px_cm(this).createControl("PXButtonEdit",$1C.ID+"_tlb_fb");};if(this.fastFilterID&&__px_all(this)[this.fastFilterID]){var $1D=__px_all(this)[this.fastFilterID];if($1D)this.$3Z($1D);};this.tlbFilterTools=__px_cm(this).createControl("PXToolBar",this.ID+"_tf");if(this.tlbFilterTools&&this.filterBar==null)this.filterBar=__px_cm(this).createControl("PXButtonEdit",this.tlbFilterTools.ID+"_fb");this.tlbFilters=__px_cm(this).createControl("PXToolBar",this.ID+"_tf_filters");if(this.tlbFilters){h=Function.createDelegate(this,this.$40);this.tlbFilters.events.addEventHandler("buttonClick",h);this.tlbFilters.renderAsTable=false;__px_tm(this).registerContainerOverflowTip(this.tlbFilters.element);};if(this.actionsTop)this.$41(this.actionsTop.toolBar);if(this.actionsBottom)this.$41(this.actionsBottom.toolBar);if(this.filterBar)this.$3Z(this.filterBar);};PXGrid.prototype.$3D=function(){var $1C=this.extToolbar=__px_all(this)[this.externalToolBarID];if($1C){this.$3W($1C);if(this.filterBar==null){this.filterBar=__px_cm(this).createControl("PXButtonEdit",$1C.ID+"_fb");if(this.filterBar)this.$3Z(this.filterBar);};this.$41($1C);$1C.linkedGrid=this;}};PXGrid.prototype.$3W=function($1C){if(this.btnFiles==null)this.btnFiles=$1C.getButton(PXGridCommand.FilesMenu);if(this.btnEdit==null)this.btnEdit=$1C.getButton(PXGridCommand.EditRecord);if(this.allowFilter){if(this.btnFilterSet==null)this.btnFilterSet=$1C.getButton(PXGridCommand.FilterSet);};if(this.btnFilterSet)this.btnFilterSet.toggleMode=true;};PXGrid.prototype.$3Z=function($1E){var $1F=Function.createDelegate(this,this.$42);var $1G=Function.createDelegate(this,this.$43);var $1H=Function.createDelegate(this,this.$44);var $1I=Function.createDelegate(this,this.$45);$1E.events.addEventHandler("buttonClick",$1F);$1E.events.addEventHandler("keyDown",$1G);$1E.events.addEventHandler("keyPress",$1H);$1E.elemText.setAttribute("unblock",1);__px(this).addEventHandler($1E.elemText,"paste",$1I,false);__px(this).addEventHandler($1E.elemText,"cut",$1I,false);var $1J=$1E.getValue();if($1J)this.viewState.update("FastFilter",$1J);};PXGrid.prototype.$41=function(toolbar){if(!toolbar)return;var $E=toolbar.items;for(var i=0;i<$E.length;i++){var $G=$E[i];if(String.compare($G.commandName,"ExportExcel",true)||($G.autoCallBack&&String.compare($G.autoCallBack.command,"ExportExcel",true))){this.$3E=$G;break;}}};PXGrid.$3U=function($1B,ev){var $0f=$1B.owner;if($0f){if(!$0f.hasFocus)$0f.focus();var $0g=new Object();$0g.button=ev.button;$0f.fireEvent("toolsButtonClick",null,$0g);}};PXGrid.$3V=function($1B,ev){var $0f=$1B.owner,$1K=false;switch(ev.command){case "firstP":case "lastP":$1K=true;break;};if($0f.allowSearch&&$1K)$0f.clearSearch();};PXGrid.prototype.selectFilter=function($1L){$1L=parseInt($1L);if(isNaN($1L))$1L=null;if(this.isPivotEditorVisible())this.hidePivotEditor(false);var $1M=this.getPivotID();if($1M&&this.pivotTable){if(this.pivotStates==null)this.pivotStates=new Object();this.pivotStates[$1M]=this.pivotTable.viewState.elemState.value;};var $1N=this.isPivotVisible(),pt=this.filterPivots;var $1O=($1L>=0&&pt)?pt[$1L]:null;this.setFilterID($1L);this.setPivotID($1O);if($1O!=null){this.setFilterActive(true);$1N?this.refresh():this.showPivotTable();}else{if($1N)this.hidePivotTable();this.setFilter($1L!=null);}};PXGrid.prototype.$3T=function($y,ev){switch(ev.button.key){case "edit":this.showFilter();break;case "all":this.selectFilter(null);break;default:this.selectFilter(ev.button.key);break;}};PXGrid.prototype.$40=function($y,ev){var $j=this.levels[0].getColumn(ev.button.key);if($j)this.showFilterDialog($j,true);};PXGrid.prototype.$3X=function(dd,ev){this.selectFilter(dd.getValue());};PXGrid.prototype.$3Y=function(dd,ev){this.showFilter();};PXGrid.prototype.$42=function($1C,ev){if(!this.$46)this.$47($1C);delete this.$46;};PXGrid.prototype.$43=function($1C,ev){var $0S=ev.keyCode;if($0S==8||$0S==46)this.$44($1C,ev);else{switch($0S){case 38:case 40:case 33:case 34:case 27:case 114:this.focus();this.handleKeyDown(ev.event);if($0S==114)this.$46=true;break;case 13:if(this.hasSelectorEvents){this.focus();this.handleKeyDown(ev.event);};break;}}};PXGrid.prototype.$44=function($1C,ev){var $1P=(this.viewState.select("FastFilter")||"").trim()!=($1C.getValue()||"").trim();if(ev.keyCode&&(ev.keyCode!=13||$1P)){var me=this,$1Q=this.$48;if($1Q)clearTimeout($1Q);this.$48=setTimeout(function(){me.$47($1C);},800);};if(ev.keyCode==13)ev.cancel=true;};PXGrid.prototype.$45=function(ev){var $1C=this.filterBar,me=this;if($1C==null&&this.fastFilterID)$1C=__px_all(this)[this.fastFilterID];if($1C){if(this.$48)clearTimeout(this.$48);setTimeout(function(){me.$47($1C);},0);}};PXGrid.prototype.$47=function($1C,$T){if($1C)$1C.updateValue();this.viewState.update("FastFilter",$1C?$1C.getValue():$T);this.setPageIndex(0);this.clearSearch();this.repaintFastFilter();this.filterApplication=true;this.refresh(null,true);};PXGrid.prototype.applyFilter=function($T){var $1C=this.filterBar;if($1C==null&&this.fastFilterID)$1C=__px_all(this)[this.fastFilterID];if($1C){$1C.setValue($T);this.$47($1C);}else this.$47(null,$T);};PXGrid.prototype.alignStatMargins=function(){var $17=this.scrollDiv,$11=(-$17.scrollLeft);if(__px(this).isRTL()){$11=Math.abs($11);if(__px(this).IsWebKit)$11=$17.scrollWidth-$17.clientWidth-$11;};var $12=$11+"px";if(this.statHTable)this.statHTable.style.left=$12;if(this.statFTable)this.statFTable.style.left=$12;};PXGrid.prototype.getCellButton=function(){var $b=this.$49;if(!$b){this.$49=$b=__doc(this).createElement("INPUT");$b.type="button";$b.id=this.ID+"_bt";$b.style.position="absolute";var h=PXGrid.handleCellButtonEvents;__px(this).addEventHandler($b,"click",h);};if(!__px(this).elemByID($b.id))this.scrollDiv.appendChild($b);return $b;};PXGrid.prototype.checkRowChanges=function($1R,$01,$1S){var ar=this.activeRow;if(this.editMode&&ar&&ar.dataChanged){var li=ar.level.index;if(li!=null&&li>=$1R){if(confirm(this.rowChangedMsg)){this.updateArgs=$1S;this.updateHandler=$01;ar.commitChanges();return true;}else ar.cancelChanges();}}};PXGrid.prototype.checkBatchChanges=function(){if(this.batchUpdate&&this.getChanged()){if(confirm(this.gridChangedMsg)){this.update();return true;}}};PXGrid.prototype.getXslProc=function(){if(this.xslProc==null)this.xslProc=new PXXsltProcessor(this.px_context,this.xslFile,this.$3G());return this.xslProc;};PXGrid.prototype.$3G=function(){if(this.xmlDoc==null){var $o=__px(this).elemByID(this.ID+"_xml");for(var i=0;i<$o.childNodes.length;i++)if($o.childNodes[i].nodeType==8){$o=$o.childNodes[i];break;};this.xmlDocObject=new PXXmlDoc("",$o.nodeValue.replace(/%2d/g,"--"));this.xmlDoc=this.xmlDocObject.xmlDoc;};return this.xmlDocObject;};PXGrid.prototype.restorePosition=function(){var l=this.clientState,ar=null;if(!this.rows||this.rows.length==0){if(l.activeRowID&&this.lastDataKey){var $0g=new Object();$0g.keyChanged=true;$0g.row=$0g.oldRow=null;this.fireEvent("afterRowChange",null,$0g);};delete this.lastDataKey;return;};if(this.activateFirstRow){ar=this.rows.getRow(0);delete this.activateFirstRow;}else if(this.activateLastRow){ar=this.rows.getRow(this.rows.length-1);delete this.activateLastRow;}else{if(l.recordKey&&this.levels[0].dataKey)ar=this.findExt(l.recordKey,this.levels[0].dataKey);if(ar==null&&l.activeRowID)ar=this.getRowByID(l.activeRowID);if(ar==null&&l.activeRow!=null)ar=this.rows.getRow(l.activeRow);};if(ar==null&&(!this.suppressInitPosition&&l.activeRow!=-1))ar=this.rows.getRow(0);if(ar&&ar!=this.activeRow)ar.activate();if(ar){var $1T=l.activeCell?l.activeCell:0;ar.activateCell($1T);};if(l.scrollLeft!=undefined){var $17=this.scrollDiv;$17.scrollLeft=l.scrollLeft;$17.scrollTop=l.scrollTop;};this.alignStatMargins();};PXGrid.prototype.resetPositionState=function(){var l=this.clientState;delete l.recordKey;delete l.activeRowID;delete l.activeRow;};PXGrid.prototype.resetPosition=function(){var ar=this.activeRow,ac=this.activeCell;if(ar){if(ac&&ac.editMode)ac.endEdit(true);if(ar.dataChanged)ar.clearChanges(false);this.activeRow=null;this.activeCell=null;this.levels[0].navigator.hide(true);}};PXGrid.prototype.storePosition=function($1U){var r=this.activeRow,c=this.activeCell,nn="ClientState";var $1V=(r!=null)?r.element.id:"",$1W=this.clientState;var $1X=(c!=null)?c.getIndex():"0";if($1U){this.viewState.update("ActiveRowID",$1V,nn);this.viewState.update("ActiveCell",$1X,nn);};if($1V)$1W.activeRowID=$1V;$1W.activeRow=r?r.getIndex():null;$1W.activeCell=$1X;if(this.keepPosition&&r)$1W.recordKey=this.getDataKey();var $17=this.scrollDiv;if($17&&this.rows&&this.rows.length){if($1U){this.viewState.update("ScrollLeft",Math.floor($17.scrollLeft),nn);this.viewState.update("ScrollTop",Math.floor($17.scrollTop),nn);};$1W.scrollLeft=Math.floor($17.scrollLeft);$1W.scrollTop=Math.floor($17.scrollTop);}};PXGrid.prototype.storeDataKey=function(){var ar=this.activeRow,$n=this.levels[0];if(ar!=null&&$n.dataKey){while(ar.parentRow!=null)ar=ar.parentRow;this.viewState.update("DataKey",ar.getDataKey().join("|"));}};PXGrid.prototype.storeDataValues=function(){if(this.postValues)this.viewState.update("DataValues",this.calcDataValues());else this.storeDataKey();};PXGrid.prototype.calcDataValues=function(){var ar=this.activeRow,$W="";if(ar!=null){var $o=ar.getValuesXmlDoc();if($o)$W=$o.toString();};return $W;};PXGrid.prototype.getDataValues=function(){var $02=this.viewState.select("DataValues");return $02?$02:this.calcDataValues();};PXGrid.prototype.clearDataValues=function(){this.viewState.remove("DataValues");this.viewState.remove("DataKey");};PXGrid.prototype.storeLayout=function(){var nn="ClientState",$1Y=new Array();for(var i=0;i<this.levels.length;i++){var $n=this.levels[i];$1Y[i]=$n.getColumnKeys().join(",");$n.setColumnsOrder($1Y[i]);};var $0i=$1Y.join("|");this.viewState.update("ColumnsOrder",$0i,nn);this.clientState.columnsOrder=$0i;};PXGrid.prototype.fireEvent=function(id,ev,$0a){var ac=this.activeCell,me=this;switch(id){case "afterRowChange":this.notifyCommandState();this.repaintStatusBar();if(this.filesBox)this.filesBox.autoRepaint=true;var cs=this.autoCallBack;if(cs&&cs.enabled&&cs.command&&$0a.keyChanged&&this.getActualVisible()&&(!cs.fromUIOnly||$0a.eventType!=null||$0a.fromUI)){if(this.$4a){clearTimeout(this.$4a);delete this.$4a;};var $1Q=($0a.eventType=="keydown")?300:1;var $1Z=__px_callback(this),$20=cs.suppressOnReload&&$1Z.isReloadPage;if($1Z.waitCallback)this.suppressRowActivate=true;if(!$20)this.$4a=setTimeout(function(){var $0S=$0a.oldRow?$0a.oldRow.getDataKey():null;$1Z.exec(me,cs);var $21=__px_all(me)[cs.target];if($21&&$21.commandCanceled&&$0S!=null)me.rows.getRowByKey($0S).activate();delete me.suppressRowActivate;},$1Q);};break;case "afterRepaint":case "afterRepaintRow":this.repaintStatusBar();break;case "afterEnterEditMode":case "afterExitEditMode":case "afterCellUpdate":this.notifyCommandState();break;case "afterRowDelete":case "afterRowUpdate":case "afterRowInsert":var cs=this.onChangeCommand;if(cs&&cs.enabled&&cs.command)setTimeout(function(){__px_callback(me).exec(me,cs);},0);this.notifyCommandState();break;};return this.events.fireEvent(id,ev,$0a);};PXGrid.prototype.onMenuDeactivate=function($22,e){var id=this.ID,me=this;this.menuClosed=true;setTimeout(function(){me.$4b();},300);};PXGrid.prototype.$4b=function(){this.menuClosed=false;};PXGrid.prototype.onLoad=function(){if(__px_cm(this).cookie&&__px_cm(this).cookie[this.ID]){var $1W=__px_cm(this).cookie[this.ID].split(',');if($1W.length>1&&!this.clientState.activeRowID){var id=[this.ID,"row",$1W[1]];this.clientState.activeRowID=id.join("_");};if($1W.length>=3){this.xlsId=$1W[2];this.xlsDate=$1W[3];var $0A=this.currentDate();if($0A!=this.xlsDate){this.xlsId=0;this.xlsDate=$0A;}}};var $23=this.callbacks[9];$23.commitChangesIDs+=($23.commitChangesIDs?',':'')+this.serverID;if(this.adjustPageSize&&__px(this).IsSafari)this.setOverflow("hidden",'y');this.repaint();if(this.autoAdjustColumns)this.adjustColumns();var $24=this.autoSize&&this.autoSize.enabled;if(this.adjustPageSize&&!$24){if(!__px_cm(this).requiredReloadPage()){this.$4c=this.autoAdjustColumns;this.adjustPage();}else this.$4d=true;};if(this.element.offsetHeight!=0)this.height=this.element.offsetHeight;var ar=["ed","en","ec"];for(var i=0;i<ar.length;i++){var id=this.ID+"_"+ar[i];if(__px_all(this)[id])__px_cm(this).setPostState(__px_all(this)[id],false);};for(var i=0;i<this.levels.length;i++)this.levels[i].onLoad();this.customCommands=new Array();var $25=this.getToolBarCommands(this.actionsTop);for(var i=0;i<$25.length;i++)this.customCommands.push($25[i]);var $26=this.getToolBarCommands(this.actionsBottom);for(var i=0;i<$26.length;i++)this.customCommands.push($26[i]);this.pivotTable=__px_all(this)[this.ID+"_pivotT"];if(this.pivotTable)this.pivotTable.ownerID=this.ID;};PXGrid.prototype.getToolBarCommands=function($27){var $02=new Array();var toolbar=$27?$27.toolBar:null;if(toolbar){var $28=new Array();for(var i=0;i<toolbar.items.length;i++){var $G=toolbar.items[i];var $00=$G.commandName;var $21=$G.commandSourceID?$G.commandSourceID:toolbar.commandSourceID;if((!$00||!$21)&&$G.autoCallBack&&!$G.popupPanel){$00=$G.autoCallBack.command;$21=$G.autoCallBack.target;};if($00&&$21){if(!$28[$21])$28[$21]=new Array();$28[$21].push($00);}};for(var name in $28){var $29=__px_all(this)[name];if($29){var $G=new Object();$G.owner=$29;$G.commands=$28[name];$02.push($G);}}};return $02;};PXGrid.prototype.onSubmit=function(e){if(this.activeForm==null){this.storePosition(false);this.storeLayout();this.storeDataValues();}};PXGrid.prototype.onCallback=function($0u){if(this.activeForm==null){if(this.preservePage){var r=this.activeRow,$1W=this.viewState;r?$1W.update("RowIndex",r.getIndex()):$1W.remove("RowIndex");};if(this.hasNoFilterID()&&!this.quickFilters){this.quickFilters=this.quickFiltersA;this.storeQuickFilterState();};this.storeDataValues();};var ds=__px_alls(this)[this.dataSourceID];if(String.compare(ds?ds.cancelCommandName:null,$0u.name,true)){if(this.isPivotVisible())this.pivotTable.setReload(true);delete this.lastPivotID;}};PXGrid.prototype.onVisibleChanged=function($M){if($M){if(this.activeRow){var $2a=this.activeRow.level.navigator;if($2a.needsPosition)setTimeout(function(){$2a.setPosition();},1);};this.alignStatMargins();if(this.autoAdjustColumns&&this.$4e==null){var me=this;setTimeout(function(){me.adjustColumns();me.$4e=true;},1);};if(this.registerOverflowTips){this.rows.setOverflowTips();this.rows.level.navigator.update();delete this.registerOverflowTips;}}else{if(this.editMode)this.endEdit(this.awaitCommit);if(this.activeForm!=null)this.hideFormView();}};PXGrid.prototype.onUnload=function(e){if(__px_cm(this).cookie&&this.storeCookie){var r=this.activeRow;if(r!=null){if(this.xlsId==null||this.xlsId==0)__px_cm(this).cookie[this.ID]=this.pageIndex+","+r.hashCode();else __px_cm(this).cookie[this.ID]=this.pageIndex+","+r.hashCode()+","+this.xlsId+","+this.xlsDate;}}};PXGrid.prototype.updateEmptySize=function(){var $0H=this.scrollDiv.querySelector('.empty-frame');if($0H){var $x=$0H.parentNode.scrollWidth;var $2b=[420,400,380,240];for(var i=0;i<$2b.length;i++){var name="under"+$2b[i];$0H.classList.remove(name);if($x<$2b[i])$0H.classList.add(name);}}};PXGrid.prototype.onAfterResize=function(){var $2c=__doc(this).documentElement.offsetHeight;var $2d=null,id=this.ID,me=this,$2e=false;if(this.adjustPageSize==2&&this.windowHeight!=$2c){$2e=true;$2d=function(){me.$4f();delete me.adjustTimeoutID;};}else if(this.autoAdjustColumns){$2d=function(){me.adjustColumns();delete me.adjustTimeoutID;};};if($2d!=null){if($2e&&__px_cm(this).waitOwnReloadPage&&this.pagerMode<2&&!this.sqlTimeout&&!this.isPageAdjusted()){this.calcPageSize(true,1);delete this.$4d;this.viewState.forceOnReloadPost();}else if($2e&&__px_cm(this).waitReloadPage){this.$4d=true;}else if($2e&&this.waitFilterSet){this.calcPageSize(true);}else if(!this.$4d){if(this.adjustTimeoutID)clearTimeout(this.adjustTimeoutID);this.adjustTimeoutID=setTimeout($2d,(this.firstAdjust==null)?100:400);__px_cm(this).registerTimeout(this.adjustTimeoutID);}};this.fireEvent("afterResize",null);this.updateEmptySize();};PXGrid.prototype.onReLoad=function(e){if(this.$4d){var me=this;if(this.adjustTimeoutID)clearTimeout(this.adjustTimeoutID);this.adjustTimeoutID=setTimeout(function(){delete me.$4d;me.viewState.update("AdjustOnReload",1);me.$4f();me.viewState.remove("AdjustOnReload");delete me.adjustTimeoutID;},100);}};PXGrid.prototype.$4f=function(id){if(this.autoAdjustColumns)this.adjustColumns();this.$4c=this.autoAdjustColumns;this.adjustPage();this.windowHeight=__doc(this).documentElement.offsetHeight;};PXGrid.prototype.processRepaintRows=function($o){var $props=$o.rootNode.getAttribute("Props");if($props!=null)eval("$props = "+unescape($props));__px_cm(this).readProperties(this,$props,PXGrid.callbackProps);this.repaintPager($o);this.repaint($o);};PXGrid.prototype.repaintPager=function($o){var $2f=$o.xmlDoc.getElementsByTagName("Pager")[0];if($2f){var $w=[this.actionsTop,this.actionsBottom];var $2g=$2f.childNodes[0].nodeValue;for(var i=0;i<$w.length;i++){if($w[i]==null)continue;$w[i].setPagerHtml($2g);if($w[i].toolBar)$w[i].toolBar.arrangeOverflowItems();}}};PXGrid.prototype.fillFilterSelector=function($E){if(this.filterBox)this.filterBox.setFilterItems($E);if(this.tlbFilterTabs!=null){var $y=this.tlbFilterTabs,ti=$y.items;while(!this.isFilterBarEmpty())$y.removeItem(2);var $2h=$y.items["edit"],ar=$E?$E.split(';'):[];for(var i=0;i<ar.length;i++){var $2i=ar[i].split('|');var $G=$y.createButton($2h.index,$2i[1],null,true,"1");$G.key=$2i[0];};this.setFilterSelectorVisibility();}else if(this.cmbFilter){var $2j=this.cmbFilter.items[0],$2k=$2j.value+'|'+$2j.text;this.cmbFilter.setItems($2k+($E?(';'+$E):""));}};PXGrid.prototype.isFilterBarEmpty=function(){return this.tlbFilterTabs==null||this.tlbFilterTabs.items[2].key=="edit";};PXGrid.prototype.setFilterSelectorVisibility=function(){if(this.tlbFilterTabs==null)return;var $y=this.tlbFilterTabs,$2l=$y.items["edit"];var $M=$y.element.getAttribute("data-hidden")==null&&!this.isFilterBarEmpty();if(!$2l.getVisible()&&$y.getVisible()!=$M){$y.setVisible($M);__px_cm(this).notifyOnResize();}};PXGrid.prototype.tryAddNew=function(){var $2m=this.scrollDiv.querySelector('.empty-frame');var $2n=this.selector&&this.selector.toolBar&&this.selector.toolBar.items&&this.selector.toolBar.items.AddNew;if(this.isSelector&&$2n){$2n.exec();}else if(this.actionsTop){var $2o=this.actionsTop.toolBar&&this.actionsTop.toolBar.items&&this.actionsTop.toolBar.items.filter(function(_){return _.commandName=='AddNew'}).pop();if($2o){$2o.exec();}}else if(this.dataSourceID){var $2p=__px_all(this);for(var id in $2p){var $1C=$2p[id];if(id.endsWith('_'+this.dataSourceID)&&$1C.constructor==PXBaseDataSource){var $00=$1C.commandStates.filter(function(_){return _.name.toLowerCase()=='addnew'||_.name.toLowerCase()=='insert';}).pop();if($00){var $1W=$1C.getCommandState($00.name);if($1W&&$1W.getEnabled())$1C.executeCommand($00.name);}}}}};PXGrid.prototype.processRefresh=function($2q,self){var $o=new PXXmlDoc("",$2q),me=this;if($o.rootNode.nodeName=="UpdateResult"){if(this.editMode)this.endEdit(true);this.processUpdate($o);return;};var $h=($o.rootNode.getAttribute("Reload")!=null);var $2r=__px(this).isVisible(this.element);var $2s=$o.xmlDoc.getElementsByTagName("HeaderHtml")[0];if($2s){this.detachHeaderEvents(this.statHTable);this.statHDiv.innerHTML=$2s.childNodes[0].nodeValue;this.statHTable=__px(this).elemByID(this.ID+"_headerT");this.attachHeaderEvents(this.statHTable);};$2s=$o.xmlDoc.getElementsByTagName("FooterHtml")[0];if($2s&&this.statFDiv){this.statFDiv.innerHTML=$2s.childNodes[0].nodeValue;this.statFTable=__px(this).elemByID(this.ID+"_footerT");};var $2t=$o.xmlDoc.getElementsByTagName("Columns")[0];if($2t){var $props=$2t.getAttribute("Props");if($props!=null)eval("$props = "+unescape($props));this.levels[0].createColumns($props,$2t);var $2u=$o.xmlDoc.getElementsByTagName("RowTemplate")[0];if($2u){var $2v=this.levels[0].xmlNode;$2u=$2u.childNodes[0];this.rows.newRowXml=this.xmlDocObject.replaceNode($2u,$2v);};if(this.autoAdjustColumns&&$2r)setTimeout(function(){me.adjustColumns();},0);};var $props=$o.rootNode.getAttribute("Props");if($props!=null)eval("$props = "+$props);if(this.adjustPageSize==2&&!$h)$props.pageSize=this.pageSize;try{this.suppressRepaint=true;this.setProperties($props,$h);}finally{delete this.suppressRepaint;if(this.restoreHeight())this.recalcPageSize=true;};var $2w=(this.cmbFilter!=null||this.tlbFilterTabs!=null);var fp=$o.rootNode.getAttribute("Filters");if(($h||fp!=null)&&$2w){if(fp!=null){this.fillFilterSelector(fp);if(this.filterID)this.setFilterActive(true);}else this.setFilterSelectorVisibility();};if($h&&$2w){var $2x=$o.rootNode.getAttribute("DynamicFilters");if($2x){var ar=$2x.split(';');var $2y=new Array();for(var i=0;i<ar.length;i++){var $2i=ar[i].split('|');var $G=[parseInt($2i[0]),$2i[1]];$2y.push($G);};this.dynamicFilters=$2y;}};var $1O=this.getPivotID(),pt=this.pivotTable;if($1O!=null){if($h&&this.$4d){this.calcPageSize(true);delete this.$4d;};pt.quickFilters=this.quickFilters;pt.hasAdvancedFilters=this.hasAdvancedFilters;this.pivotIdChanged=false;if(!this.isPivotEditorVisible())this.showPivotTable();}else this.hidePivotTable();if(!this.isPivotMode()){if(this.recalcPageSize){this.calcPageSize();delete this.recalcPageSize;};var $2z=$o.xmlDoc.getElementsByTagName("Rows")[0];var $2A=$2z?$2z.childNodes:null;if($2A&&($2A.length>0||!this.hasAutoInsertedRow())){if((this.adjustPageSize==2||this.hasSelectorEvents)&&$2A.length>this.pageSize){var cs=this.clientState,$1h=cs.activeRow;if($1h==null&&cs.activeRowID){var ar=cs.activeRowID.split('_');$1h=parseInt(ar[ar.length-1]);};var $2B=$2A.length-this.pageSize,$1i=$1h>=this.pageSize;if($1i)this.isFirstPage=false;else this.isLastPage=false;while($2A.length>this.pageSize)$2z.removeChild($2A[$1i?0:($2A.length-1)]);if($1i&&$2B>0){if($1h)this.$3F($1h-$2B);for(var i=0;i<$2A.length;i++)$2A[i].setAttribute("i",i);}};if(this.editMode)this.endEdit(true);if($h&&__win(this).parentPanel){this.resetPositionState();this.resetPosition();};this.repaint($o);};var $g=this.levels[0].columns;for(var i=0;i<$g.length;i++){var $j=$g[i],$2C=true;if($j.allowCheckAll){if(this.rows.length>0)$2C=!this.rows.getRow(0).getCell($j).getValue();if($2C)$j.setCheckImage(false);};if(this.restrictFields)$j.dataLoaded=$j.getVisible()||$j.level.isDataKey($j.dataField);};this.repaintPager($o);this.$3Q();if(!this.adjustPageSize||this.isPageAdjusted()){this.showEmptyMessage($2A);};if(this.autoAdjustColumns&&$2r&&(this.$4c==null||this.$4c==true)){this.adjustColumns();this.$4c=false;}};$o.dispose();this.notifyCommandState();};PXGrid.prototype.$4g=function($2D,$2E,$2F){if($2F){if($2E)return($2D?this.emptyMsg.anonFilteredAddMessage:this.emptyMsg.anonFilteredMessage);return($2D?this.emptyMsg.namedFilteredAddMessage:this.emptyMsg.namedFilteredMessage).replace(new RegExp("\\{0\\"+String.fromCharCode(125),'g'),$2F);}else{return $2D?this.emptyMsg.filteredAddMessage:this.emptyMsg.filteredMessage;}};PXGrid.prototype.showEmptyMessage=function($2A){this.removeEmptyMessage();if(this.ID.substring(this.ID.length-6)=="_fe_gf")return;if($2A.length!=0||this.hasAutoInsertedRow()){return;};var $2G=this.levels[0].columns.filter(function(a){return a.filter});var $2H=$2G.length>=1&&$2G[0];var $2F=$2H&&$2H.getHeaderText&&$2H.getHeaderText().trim();var $2E;if(!$2F&&this.tlbFilterTabs){var $2I=this.tlbFilterTabs.element.querySelector('div.toolTabPushed');if($2I){$2F=$2I.textContent.trim();if($2F.length>20)$2F=$2F.substring(0,17)+'&hellip;';};$2E=$2F==this.filterAppliedMsg;}else if($2F)$2E=true;else $2F=false;var $2J=this;var $2K=function(ds,$2L){return ds&&ds.commandStates&&(ds.commandStates.some(function($1W){return String.compare($1W.name,$2L,true)}))&&ds.getCommandState($2J,$2L);};var $2M=function(ds,$2L){var $1W=$2K(ds,$2L);return $1W&&$1W.getEnabled();};var $2N=__px_cm(this).findDataSource();var $2O=$2N&&$2N.toolBar&&$2N.toolBar.items&&$2N.toolBar.items.filter(function(_){return _.element.querySelector('[icon=AddNew]')}).shift();var $2P=$2O&&$2O.getVisible()&&$2M($2N,$2O.commandName);var $2Q=this.actionsTop&&this.actionsTop.toolBar&&this.actionsTop.toolBar.items&&this.actionsTop.toolBar.items.filter(function(_){return _.commandName==($2J.addCommandName||'AddNew')}).pop();var $2R=$2Q&&$2Q.commandState&&$2Q.commandState.getEnabled&&$2Q.commandState.getEnabled();if($2Q&&!$2Q.commandState)$2R=$2Q.getEnabled&&$2Q.getEnabled()&&$2Q.getVisible&&$2Q.getVisible();var $2S=false;var $2T=false;if($2N){var $2p=__px_all(this);var $2U=__px_data(this);for(var i in $2U){if($2U[i].dataMember==$2N.primaryView){for(var j in $2p){var $2V=!j.indexOf(i+'_');var $1C=$2p[j];if($2V&&$1C.getValue){if($1C.ID.startsWith(this.ID))continue;$2T=true;var $T=$1C.getValue();if($T!=null&&$T!=""){$2S=true;break;}}};break;}}};if(this.isSelector&&this.emptyMessageMode!=1){if(this.filterActive||this.levels[0].columns.some(function(a){return a.filter})){var $E=this.selector&&this.selector.toolBar&&this.selector.toolBar.items;var $2W=$E&&$E.AddNew&&$E.AddNew.getEnabled&&$E.AddNew.getEnabled();var $2D=$2R||$2W;var $2X=this.$4g($2D,$2E,$2F);this.setEmptyMessage($2D?"inq-filter-add":"inq-filter",$2X);}else{this.setEmptyMessage("emp-selector",this.emptyMsg.selectorMessage);}}else{switch(this.emptyMessageMode){case 1:var $2Y=this.getFastFilter();if($2Y){$2Y=$2Y.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");if($2Y.length>20)$2Y=$2Y.substring(0,17)+'&hellip;';this.setEmptyMessage("search",this.emptyMsg.searchMessage.replace(new RegExp("\\{0\\"+String.fromCharCode(125),'g'),$2Y));};break;case 2:var $2Z=this.filterActive||this.levels[0].columns.some(function(a){return a.filter});var $2D=($2R||$2P)&&!this.filterActive;if($2Z&&$2T){var $2X;if($2E||!$2F)$2X=($2D?this.emptyMsg.comboAddMessage:this.emptyMsg.comboMessage);else $2X=($2D?this.emptyMsg.namedComboAddMessage:this.emptyMsg.namedComboMessage).replace(new RegExp("\\{0\\"+String.fromCharCode(125),'g'),$2F);this.setEmptyMessage($2D?"inq-add":"inq",$2X);}else if($2T){this.setEmptyMessage($2D?"inq-add":"inq",$2D?this.emptyMsg.inqAddMessage:this.emptyMsg.inqMessage);}else if($2Z){var $2X=this.$4g($2D,$2E,$2F);this.setEmptyMessage($2D?"inq-filter-add":"inq-filter",$2X);}else{this.setEmptyMessage($2D?"inq-add":"inq",$2D?this.emptyMsg.bareInqAddMessage:this.emptyMsg.bareInqMessage);};break;case 3:if($2P&&!$2R){this.setEmptyMessage("incomplete",this.emptyMsg.incompleteDataMessage);};break;case 4:if(this.filterActive||this.levels[0].columns.some(function(a){return a.filter})){var $2D=$2R&&$2P;var $2X=this.$4g($2D,$2E,$2F);this.setEmptyMessage($2D?"inq-filter-add":"inq-filter",$2X);}else if($2P&&$2R){this.setEmptyMessage("empty",this.emptyMsg.dataMessage);};break;}};this.updateEmptySize();};PXGrid.prototype.removeEmptyMessage=function(){var $2m=this.scrollDiv.querySelector('.empty-frame');if($2m){$2m.parentNode.removeChild($2m);}};PXGrid.prototype.setEmptyMessage=function($30,$2X){var $31=new RegExp(/\[a type=([A-Za-z-\u0370-\u03FF\u0400-\u04FF]+)\]([^[]+)\[\/a]/g);var $32=$2X.replace($31,function($33,$34,$35){return "<a href=# data-actiontype="+$34+">"+$35+"</a>";});var $36=1;var $37=$32.split('\n').map(function($38){return '<span class="part'+($36++)+'">'+$38.trim()+'</span>';}).join('');this.removeEmptyMessage();var $39=document.createElement('div');$39.innerHTML='<div class="empty-frame '+$30+'" ><div class="empty-inner"><div class="empty-plaque">'+$37+'</div></div></div>';this.scrollDiv.appendChild($39.firstElementChild);};PXGrid.prototype.getDataChanges=function(){var ar=this.activeRow,$02="";if(this.batchUpdate){if(this.editMode&&ar)ar.commitChanges();if(this.xslEditProc==null){var $o=this.$3G();this.xslEditProc=new PXXsltProcessor(this.px_context,this.xslEditFile,$o);this.xslEditProc.transformToDoc=true;};$02=this.xslEditProc.transform();if($02=="<RowChanges></RowChanges>"||$02=="<RowChanges/>")$02="";}else{var $Q=null;if(ar){ar.commitChanges(false);$Q=this.activeRow;if(!$Q.dataChanged&&$Q.isServerNew())$Q.setStatus(PXRowStatus.Deleted);if($Q.dataChanged)this.storeDataValues();};if($Q){var $o=$Q.getDataChangesXmlDoc(true);$02=$o.toString();}};return $02;};PXGrid.prototype.getChanged=function(){var $u=false,ar=this.activeRow,ac=this.activeCell;if(ar){$u=ar.dataChanged;if(!$u&&this.editMode&&ac&&!ac.getReadOnly(true)){var ve=ac.getEditorValue();$u=!NetType.equals(ac.column.dataType,ve,ac.getValue());};if(!$u&&ar.isServerNew())$u=true;};if(!$u&&this.batchUpdate){if(this.xslEditProc==null){var $o=this.$3G();this.xslEditProc=new PXXsltProcessor(this.px_context,this.xslEditFile,$o);};var $3a=this.xslEditProc.transform();var $3b=new PXXmlDoc("",$3a);$u=$3b.rootNode&&$3b.rootNode.childNodes.length>0;$3b.dispose();};return $u;};PXGrid.prototype.executeCallback=function($04,$1m){switch($04){case "FetchRow":this.refetchRow(this.activeRow);break;default:this.executeCommand($04,$1m);break;}};PXGrid.prototype.commitChanges=function(){if(!this.batchUpdate){var ar=this.activeRow;if(ar)ar.commitChanges();}else this.update();};PXGrid.prototype.needPostElement=function(id){if(this.isPivotMode()&&id.startsWith(this.ID+"_pivotT"))return true;var $1L=this.externalFilterEditorID?this.externalFilterEditorID+"_state":this.ID+"_fe_state";return id==$1L||(this.fastFilterID&&id.startsWith(this.fastFilterID));};PXGrid.prototype.hasErrorInfo=function(){for(var i=0;i<this.rows.length;i++){var $Q=this.rows.getRow(i);if($Q.hasErrorOrWarn())return true;};return false;};PXGrid.prototype.getErrorInfo=function(){var status=0,$A=null;for(var i=0;i<this.rows.length;i++){var $3c=this.rows.getRow(i).getErrorInfo();if($3c[0]>0){status=$3c[0];$A=$3c[1];break;}};return[status,$A];};PXGrid.prototype.showPivotTable=function(){if(this.isPivotVisible()||!this.pivotID)return;if(this.isPivotEditorVisible())this.hidePivotEditor();this.$4h();this.pivotTable.setVisible(true);this.restoreHeight();this.notifyCommandState();var pt=this.pivotTable;__px_cm(this).performAutoSize(pt);if(this.pivotIdChanged==null||this.pivotIdChanged)this.refresh();else{this.quickFilters=pt.quickFilters;this.hasAdvancedFilters=pt.hasAdvancedFilters;this.renderQuickFilters();this.setFilterHighlightState();};var ds=__px_cm(this).findDataSource();if(ds&&ds.setLayerEnabled)ds.setLayerEnabled(false);};PXGrid.prototype.hidePivotTable=function(){var $1r=this.isPivotMode();if(this.isPivotEditorVisible()){this.hidePivotEditorSilent();}else if(this.isPivotVisible()){this.pivotTable.setVisible(false);};if($1r){this.$4i();this.restoreHeight();this.notifyCommandState();this.focus();var ds=__px_cm(this).findDataSource();if(ds&&ds.setLayerEnabled)ds.setLayerEnabled(true);}};PXGrid.prototype.isPivotVisible=function(){return this.pivotTable!=null&&this.pivotTable.getVisible();};PXGrid.prototype.setPivotID=function(id){if(this.lastPivotID!=id&&id)this.pivotIdChanged=true;if(id)this.lastPivotID=this.pivotID=id;else this.pivotID=null;id?this.viewState.update("PivotID",id):this.viewState.remove("PivotID");};PXGrid.prototype.getPivotID=function(){if(this.pivotID!=null)return this.pivotID;return this.filterPivots?this.filterPivots[this.getFilterID()]:null;};PXGrid.prototype.getPivotState=function(){var id=this.getPivotID();return id?this.pivotStates[id]:null;};PXGrid.prototype.$4h=function(){if(this.pivotTable==null)return;var $3d=[this.rows.container,this.statHTable];if(this.actionsTop&&this.actionsTop.hasPager())$3d.push(this.actionCellT);if(this.actionsBottom&&this.actionsBottom.hasPager())$3d.push(this.actionCellB);this.pivotTable.hideElems=$3d;for(var i=0;i<$3d.length;i++)if($3d[i])$3d[i].style.display="none";this.levels[0].navigator.hide();if(this.statFDiv)this.statFDiv.style.display="none";};PXGrid.prototype.$4i=function(){if(this.pivotTable==null)return;var $3d=this.pivotTable.hideElems,ar=this.activeRow;for(var i=$3d.length-1;i>=0;i--)if($3d[i])$3d[i].style.display="";if(this.statFDiv)this.statFDiv.style.display="";if(ar)this.levels[0].navigator.show(ar);this.restoreHeight();this.alignStatMargins();};PXGrid.prototype.showPivotEditor=function(){if(this.pivotEditor==null)return;this.pivotEditorLoading=true;this.notifyCommandState();this.$4h();this.pivotTable.setVisible(false);if(this.filterBar!=null)this.filterBar.setEnabled(false);var $0X=this.pivotEditor.parentNode,$03,cm;__px(this).appendCss($0X,['spinner'],true);var $3e=function(){__px(me).excludeCss($0X,['spinner'],true);$0X.style.fontSize='0px';me.pivotEditor.style.display="";me.restoreHeight();if(cm)cm.notifyVisibleChanged(true);delete me.pivotEditorLoading;me.notifyCommandState();me.attachPivotEditorEvents();};var $3f=function(){try{$03=me.pivotEditor.contentWindow;}catch(ex){};__px(me).removeEventHandler(me.pivotEditor,"load",$3f);if($03)$03.suppressChanges=true;cm=$03?__px_cm($03):null;if(cm&&cm.requiredReloadPage(true)){cm.registerRequiresOnReLoad({'onReLoad':$3e},'__grid');}else $3e();};__px(this).addEventHandler(this.pivotEditor,"load",$3f);this.$4j(true);var $3g=["HidePageTitle=on"],me=this;$3g.push("ScreenID="+__px(this).getScreenID());$3g.push("PivotTableID="+this.getPivotID());__px(this).openUrl(this.editPivotTableUrl+'?'+$3g.join('&'),this.pivotEditor.id);this.viewState.update("PEditVisible",true);};PXGrid.prototype.hidePivotEditor=function($3h){if(this.pivotEditor==null)return;if($3h==null)$3h=true;var $03=null,$2N;try{$03=this.pivotEditor.contentWindow;}catch(ex){};$2N=$03?__px_cm($03).findDataSource():null;this.hidePivotEditorSilent();this.pivotTable.setVisible(true);this.pivotTable.restoreHeight();this.restoreHeight();this.notifyCommandState();if($2N&&$3h)this.pivotTable.reload();};PXGrid.prototype.hidePivotEditorSilent=function(){this.pivotEditor.style.display="none";this.pivotEditor.parentNode.style.fontSize='';if(this.filterBar!=null)this.filterBar.setEnabled(true);this.detachPivotEditorEvents();this.$4j(false);this.viewState.remove("PEditVisible");};PXGrid.prototype.isPivotEditorVisible=function(){return this.pivotEditor!=null&&this.pivotEditor.style.display!="none";};PXGrid.prototype.isPivotMode=function(){return this.pivotEditorLoading||this.isPivotVisible()||this.isPivotEditorVisible();};PXGrid.prototype.$4j=function($3i){if(this.tlbFilterTools){var $l=this.tlbFilterTools.getButton(PXGridCommand.CommandEditPivot);if($l)$l.setPushed($3i);}};PXGrid.prototype.registerCommandControl=function($3j,$04){__px_cm(this).registerCommandControl(this,$3j,$04);};PXGrid.prototype.notifyCommandState=function(){__px_cm(this).notifyCommandState(this,PXGridCommand);if(this.customCommands){for(var i=0;i<this.customCommands.length;i++){var $G=this.customCommands[i];__px_cm(this).notifyCommandState($G.owner,$G.commands);}};var ds=__px_alls(this)[this.dataSourceID];if(ds)ds.notifyCommandState();var $3k=(this.activeForm==null);var $w=[this.actionsTop,this.actionsBottom];for(var i=0;i<$w.length;i++)if($w[i]!=null)$w[i].setPagerVisible($3k);};PXGrid.prototype.executeCommand=function($04,$1m){if(!this.getCommandState(this,$04,$1m).getEnabled())return;var se=this.sourceEvent,af=this.activeForm;switch($04){case PXGridCommand.Refresh:var $M=(this.element.offsetHeight>0)&&!this.isPivotMode();if($M&&af==null&&this.adjustPageSize&&this.allowPaging)this.adjustPage(true,$1m);else this.refresh(null,null,$1m);break;case PXGridCommand.Save:if(af!=null)af.level.formView.executeCommand($04);else this.batchUpdate?this.update():this.endEdit(false);break;case PXGridCommand.Delete:this.selectedRows?this.removeSelectedRows():this.removeRow();break;case PXGridCommand.AddNew:this.addNewRow(true,$1m!=null?$1m:this.$4k().inplaceInsert);break;case PXGridCommand.Search:this.beginSearch();break;case PXGridCommand.AdjustCols:this.adjustColumns();break;case PXGridCommand.Edit:this.editMode?this.endEdit(false):this.beginEdit();break;case PXGridCommand.EditRecord:var $1r=this.$4k().allowFormEdit;if($1r)(this.activeForm==null)?this.showFormView():this.hideFormView();else __px(this).doPost(this.element.getAttribute("name"),$04);break;case PXGridCommand.PageNext:if(af!=null)this.execFormViewCommand("Next");else this.setPage(this.pageIndex+1);break;case PXGridCommand.PagePrev:if(af!=null)this.execFormViewCommand("Prev");else this.setPage(this.pageIndex-1);break;case PXGridCommand.PageFirst:if(af!=null)this.execFormViewCommand("First");else{if(this.allowSearch)this.clearSearch();this.setPage(0);};break;case PXGridCommand.PageLast:if(af!=null)this.execFormViewCommand("Last");else{var pc=this.getPageCount();if(this.allowSearch)this.clearSearch();this.setPage((pc>0)?(pc-1):-1);};break;case PXGridCommand.NoteShow:this.showNote();break;case PXGridCommand.FilesMenu:this.showFiles();break;case PXGridCommand.FilterShow:this.showFilter(se&&se.shiftKey);break;case PXGridCommand.FilterSet:this.setFilter(!this.getFilterActive());break;case PXGridCommand.FilterSavePivot:this.saveAsFilter(true);break;case PXGridCommand.FilterSave:if(!this.isFilterEditable||!!$1m||this.hasNoFilterID())this.saveAsFilter();else this.saveFilter();break;case PXGridCommand.FilterRemove:if(this.filterID)this.removeFilter(this.filterID);break;case PXGridCommand.ExportExcel:if(this.isPivotMode())this.pivotTable.executeCommand(PXPivotTableCommand.ExportExcel,$1m);else this.exportExcel($1m);break;case PXGridCommand.LayoutSave:this.saveLayout();break;case PXGridCommand.LayoutReset:this.resetLayout();break;case PXGridCommand.Upload:this.uploadData();break;case PXGridCommand.CreateProviderFile:__px_callback(this).execI(this,__px_callback(this).createCommand("CreateProviderFile",true,false,true,true),"",null,null,{'enabled':true,'command':"Refresh",'target':this.ID});break;case PXGridCommand.Copy:this.copySelectedRows();break;case PXGridCommand.Paste:if(this.rowsToPaste){this.pasteSelectedRows(this.activeRow,this.rowsToPaste);delete this.rowsToPaste;};break;case PXGridCommand.DelDefault:__px_callback(this).execI(this,__px_callback(this).createCommand(PXGridCommand.DelDefault,true,false,false,false),"",Function.createDelegate(this,function(){var $l=__px_all(this)[this.ID+"_cd_delDefault"];if($l)$l.setEnabled(false);}),null,{'enabled':true,'command':PXGridCommand.DelDefault,'target':this.ID});break;case PXGridCommand.CommandEditPivot:this.isPivotEditorVisible()?this.hidePivotEditor():this.showPivotEditor();break;};this.sourceEvent=null;};PXGrid.prototype.getCommandState=function($0t,$04,$1m){var pi=this.pageIndex,pc=this.getPageCount(),ac=this.activeCell;var ar=this.activeRow,af=this.activeForm,$1W=PXCommandState.empty;if(this.pivotEditorLoading)return new PXCommandState(true,false);if(this.isPivotEditorVisible()){switch($04){case PXGridCommand.CommandEditPivot:$1W=new PXCommandState(true,!!this.editPivotTableUrl);break;case PXGridCommand.FilterSavePivot:case PXGridCommand.FilterSave:case PXGridCommand.FilterRemove:break;default:return new PXCommandState(true,false);}}else if(this.isPivotVisible()){switch($04){case PXGridCommand.Refresh:case PXGridCommand.ExportExcel:case PXGridCommand.FilterShow:case PXGridCommand.FilterSet:case PXGridCommand.FilterSavePivot:case PXGridCommand.FilterSave:case PXGridCommand.FilterRemove:break;case PXGridCommand.CommandEditPivot:$1W=new PXCommandState(true,!!this.editPivotTableUrl);break;default:return new PXCommandState(true,false);}};switch($04){case PXPanelCommand.CreateProviderFile:return new PXCommandState(true,true);case PXGridCommand.Refresh:$1W=new PXCommandState(true,true);break;case PXGridCommand.Save:if(!this.batchUpdate)$1W=new PXCommandState(true,(af!=null)||(ar&&!!ar.dataChanged));else $1W=new PXCommandState(true,true);break;case PXGridCommand.Delete:if(af!=null||ar!=null){var $1r=this.$4k().allowDelete;$1W=new PXCommandState(true,$1r&&(af==null||!!af.level.formView.dataKey));}else $1W=new PXCommandState(true,false);break;case PXGridCommand.AddNew:var $1r=this.$4k().allowAddNew;if($1r&&ar!=null&&af==null)$1r=(ar.getStatus()!=PXRowStatus.AddNew)||(ar.dataChanged==true);$1W=new PXCommandState(true,$1r);break;case PXGridCommand.Search:$1W=new PXCommandState(true,this.allowSearch&&(af==null));break;case PXGridCommand.AdjustCols:$1W=new PXCommandState(true,(af==null));break;case PXGridCommand.Edit:$1W=new PXCommandState(true,ar!=null&&this.$4k().allowUpdate);break;case PXGridCommand.EditRecord:var $n=this.$4k(),$1r=$n.allowFormEdit;if($1r&&af==null)$1r=$n.allowAddNew||ar!=null;$1W=new PXCommandState(true,this.hasEditPage||$1r);break;case PXGridCommand.PageNext:case PXGridCommand.PageLast:$1W=new PXCommandState(true,!this.isLastPage||(af!=null));break;case PXGridCommand.PagePrev:case PXGridCommand.PageFirst:$1W=new PXCommandState(true,!this.isFirstPage||(af!=null));break;case PXGridCommand.NoteShow:$1W=new PXCommandState(true,this.allowNote&&ar!=null&&!ar.isNew());break;case PXGridCommand.FilterShow:if($0t==this.localMenu){$1W=new PXCommandState(true,ac&&ac.column.allowFilterDialog()&&!this.isColumnHasFilter(ac.column.getKey()));}else $1W=new PXCommandState(true,this.allowFilter);break;case PXGridCommand.FilterSet:if($0t==this.localMenu){$1W=new PXCommandState(true,ac&&this.isColumnHasFilter(ac.column.getKey()));}else{var fb=this.filterBox;$1W=new PXCommandState(true,this.allowFilter&&(this.filterID!=null||(fb!=null&&fb.hasFilter())));};break;case PXGridCommand.FilterSavePivot:$1W=new PXCommandState(true,this.isFilterSavable);break;case PXGridCommand.FilterSave:if($0t instanceof PXMenu||$1m)$1W=new PXCommandState(!this.isPivotMode(),this.isFilterSavable);else $1W=new PXCommandState(true,this.isFilterSavable&&(!!this.quickFilterChaged||this.isFilterChanged));break;case PXGridCommand.FilterRemove:$1W=new PXCommandState(true,this.isFilterSavable&&this.isFilterEditable&&!this.hasNoFilterID());break;case PXGridCommand.ExportExcel:$1W=new PXCommandState(true,this.exportCommand&&(this.isPivotVisible()||this.rows.length>0));break;case PXGridCommand.LayoutReset:$1W=new PXCommandState(true,this.layoutLoaded);break;case PXGridCommand.LayoutSave:case PXGridCommand.FilesMenu:$1W=new PXCommandState(true,true);break;case PXGridCommand.Upload:var $n=this.$4k();$1W=new PXCommandState(true,this.uploadCommand!=""&&$n.isUploadEnabled&&($n.allowAddNew||$n.allowUpdate));break;case PXGridCommand.DelDefault:$1W=new PXCommandState(!!this.delDefaultsVisible,!!this.delDefaultsEnabled);break;case PXGridCommand.Copy:var $1r=this.$4k().allowDelete;$1W=new PXCommandState(true,$1r&&!!this.pasteCommand);break;case PXGridCommand.Paste:$1W=new PXCommandState(true,!!this.rowsToPaste);break;};var $0g=new Object();$0g.command=$04;$0g.state=$1W;this.fireEvent("commandState",null,$0g);return $1W;};PXGrid.prototype.$4k=function(){if(this.activeForm)return this.activeForm.level;var i=this.activeRow?this.activeRow.level.index:0;if(i<this.levels.length)return this.levels[i];return null;};PXGrid.prototype.scrollToView=function($b,$30){if($30==null)$30=0;__px(this).scrollToView(this.scrollDiv,$b,$30);if($30==0||$30==2)this.alignStatMargins();};PXGrid.prototype.getElemRect=function($b){var ok=0,$3l=__doc(this).body,e=$b;var r=new Object(),z,pe=e;z=e.offsetWidth;if(z==null)z=0;r.width=z;z=e.offsetHeight;if(z==null)z=0;r.height=z;r.x=1;r.y=1;while(e!=null){if(ok<1||e==$3l){z=e.offsetLeft;if(z)r.x+=z;z=e.offsetTop;if(z)r.y+=z;};if(e.nodeName=="HTML")$3l=e;if(e==$3l)break;z=e.scrollLeft;if(z==null||z==0)z=pe.scrollLeft;if(z!=null&&z>0)r.x-=z;z=e.scrollTop;if(z==null||z==0)z=pe.scrollTop;if(z!=null&&z>0)r.y-=z;pe=e.parentNode;e=e.offsetParent;if(pe.tagName=="TR")pe=e;if(e==$3l&&pe.tagName=="DIV"){e=pe;ok++;}};r.xl=r.x+r.width;r.yl=r.y+r.height;r.isInside=function(mr,x,y){return(y>=mr.y&&y<mr.yl)&&(x>=mr.x&&x<mr.xl);};return r;};PXGrid.prototype.changeStyleIE=function(se,$3m,$3n){if(!se.runtimeStyle)return;if(!this.$4l)this.$4l=new Object();var $3o=null,$3p=false;if(this.$4l.hasOwnProperty($3m)){$3o=this.$4l[$3m];$3p=true;}else $3o=new Array();if(!$3p){var $3q=__doc(this).styleSheets,$3r=$3m.split(' ');for(var k=0;k<$3r.length;k++)for(var i=0;i<$3q.length;i++){var $3s=false,sh=$3q[i];try{var $0i=sh.rules;}catch(ex){continue;};for(var j=0;j<sh.rules.length;j++)if(sh.rules[j].selectorText==("."+$3r[k])){$3s=true;$3o[$3o.length]=sh.rules[j];break;};for(var j=0;!$3s&&j<sh.imports.length;j++)for(var m=0;!$3s&&m<sh.imports[j].rules.length;m++)if(sh.imports[j].rules[m].selectorText==("."+$3r[k])){$3s=true;$3o[$3o.length]=sh.imports[j].rules[m];break;}};this.$4l[$3m]=$3o;};if($3o.length>0){for(var i=0;i<$3o.length;i++){for(var j=0;j<$3n.length;j++){var n=$3n[j],$B=$3o[i].style[n];if($B)se.runtimeStyle[n]=$B;}}}};function PXXsltProcessor($a,$3t,$o){this.px_context=$a;this.IsIE=__px(this).IsIE||__px(this).IsIE11;var $A=PXXsltProcessor.loadXSLT($3t,this.IsIE);if(this.IsIE){var $3u=new ActiveXObject("Msxml2.FreeThreadedDOMDocument");$3u.loadXML($A);this.template=new ActiveXObject("Msxml2.XSLTemplate");this.template.stylesheet=$3u;this.xslProc=this.template.createProcessor();}else{this.xslProc=new XSLTProcessor();this.xslProc.importStylesheet($A);};if($o instanceof PXXmlDoc)this.xmlDocObject=$o;else{this.xmlDocObject=new PXXmlDoc("");if($o)this.loadXML($o);};this.xmlDoc=this.xmlDocObject.xmlDoc;};PXXsltProcessor.prototype.dispose=function(){if(this.xmlDocObject){this.xmlDocObject.dispose();delete this.xmlDocObject;};delete this.xmlDoc;delete this.template;delete this.xslProc;};PXXsltProcessor.prototype.transform=function(){if(this.IsIE){this.xslProc.input=this.xmlDoc;this.xslProc.transform();return this.xslProc.output;}else{var $3v=this.transformToDoc?this.xslProc.transformToDocument(this.xmlDoc):this.xslProc.transformToFragment(this.xmlDoc,__doc(this));var $3w=new XMLSerializer();return $3w.serializeToString($3v);}};PXXsltProcessor.loadXSLT=function($3t,$3x){if(PXXsltProcessor.files==null)PXXsltProcessor.files=new Object();var $0z=PXXsltProcessor.files[$3t];if($0z==null){if($3x){var $3y=new ActiveXObject("Microsoft.XMLHTTP");$3y.open("GET",$3t,false);$3y.send(null);PXXsltProcessor.files[$3t]=$3y.responseText;}else{var $3y=new XMLHttpRequest();$3y.open("GET",$3t,false);$3y.send(null);PXXsltProcessor.files[$3t]=$3y.responseXML;}};return PXXsltProcessor.files[$3t];};PXXsltProcessor.prototype.loadXML=function($3z){return this.xmlDocObject.loadXML($3z);};PXXsltProcessor.prototype.setParam=function(name,$B){if(this.IsIE)this.xslProc.addParameter(name,$B);else this.xslProc.setParameter(null,name,$B);};PXXsltProcessor.prototype.reset=function(){if(this.IsIE)this.xslProc=this.template.createProcessor();else this.xslProc.clearParameters();};



PXGrid.prototype.attachCommonEvents=function(){var h=Function.createDelegate(this,this.$0q);__px(this).addEventHandler(this.scrollDiv,"scroll",h);__px(this).addEventHandler(this.scrollDiv,"dblclick",h);__px(this).addEventHandler(this.scrollDiv,"click",h);__px(this).addEventHandler(this.scrollDiv,"contextmenu",h);__px(this).addEventHandler(this.element,"focus",Function.createDelegate(this,this.$0r));if(this.allowDrop||this.levels[0].allowDragRows){h=Function.createDelegate(this,this.handleDragDropEvents);__px(this).addEventHandler(this.scrollDiv,"dragover",h);__px(this).addEventHandler(this.scrollDiv,"dragenter",h);__px(this).addEventHandler(this.scrollDiv,"dragleave",h);__px(this).addEventHandler(this.scrollDiv,"drop",h);}};PXGrid.prototype.attachHeaderEvents=function($a){if(this.$0s==null)this.$0s=Function.createDelegate(this,this.$0t);var he=$a.tHead,h=this.$0s;if(he.style.display=="none")return;__px(this).addEventHandler(he,"mousedown",h);__px(this).addEventHandler(he,"mouseup",h);__px(this).addEventHandler(he,"mousemove",h);__px(this).addEventHandler(he,"mouseover",h);__px(this).addEventHandler(he,"mouseout",h);__px(this).addEventHandler(he,"contextmenu",h);if(__px(this).IsTablet){__px(this).addEventHandler(he,"touchstart",h);__px(this).addEventHandler(he,"touchmove",h);};if(this.tlbFilters){if(this.$0u==null)this.$0u=Function.createDelegate(this,this.$0v);var he=this.tlbFilters.element,h=this.$0u;__px(this).addEventHandler(he,"mousedown",h);__px(this).addEventHandler(he,"mouseup",h);__px(this).addEventHandler(he,"mousemove",h);}};PXGrid.prototype.detachHeaderEvents=function($a){var he=$a.tHead,h=this.$0s;if(h!=null){__px(this).removeEventHandler(he,"mousedown",h);__px(this).removeEventHandler(he,"mouseup",h);__px(this).removeEventHandler(he,"mousemove",h);__px(this).removeEventHandler(he,"mouseover",h);__px(this).removeEventHandler(he,"mouseout",h);__px(this).removeEventHandler(he,"contextmenu",h);if(__px(this).IsTablet){__px(this).removeEventHandler(he,"touchstart",h);__px(this).removeEventHandler(he,"touchmove",h);}};if(this.tlbFilters){var he=this.tlbFilters.element,h=this.$0u;if(h!=null){__px(this).removeEventHandler(he,"mousedown",h);__px(this).removeEventHandler(he,"mouseup",h);__px(this).removeEventHandler(he,"mousemove",h);}}};PXGrid.prototype.attachCellEvents=function($a){if(this.$0w==null)this.$0w=Function.createDelegate(this,this.$0x);var dt=$a.tBodies[0],h=this.$0w;__px(this).addEventHandler(dt,"click",h);__px(this).addEventHandler(dt,"dblclick",h);__px(this).addEventHandler(dt,"mousedown",h);__px(this).addEventHandler(dt,"mouseup",h);__px(this).addEventHandler(dt,"mousemove",h);__px(this).addEventHandler(dt,"mouseover",h);__px(this).addEventHandler(dt,"mouseout",h);__px(this).addEventHandler(dt,"selectstart",h);__px(this).addEventHandler(dt,"dragstart",h);if(__px(this).IsTablet){__px(this).addEventHandler(dt,"touchstart",h);__px(this).addEventHandler(dt,"touchend",h);__px(this).addEventHandler(dt,"touchmove",h);}};PXGrid.prototype.detachCellEvents=function($a){var dt=$a.tBodies[0],h=this.$0w;if(h!=null){__px(this).removeEventHandler(dt,"click",h);__px(this).removeEventHandler(dt,"dblclick",h);__px(this).removeEventHandler(dt,"mousedown",h);__px(this).removeEventHandler(dt,"mouseup",h);__px(this).removeEventHandler(dt,"mousemove",h);__px(this).removeEventHandler(dt,"mouseover",h);__px(this).removeEventHandler(dt,"mouseout",h);__px(this).removeEventHandler(dt,"selectstart",h);__px(this).removeEventHandler(dt,"dragstart",h);if(__px(this).IsTablet){__px(this).removeEventHandler(dt,"touchstart",h);__px(this).removeEventHandler(dt,"touchend",h);__px(this).removeEventHandler(dt,"touchmove",h);}}};PXGrid.prototype.pageUp=function(){var $b=this.activeRow,$c=null;if($b){if($b.prevRow()==null){if(!this.isFirstPage)this.setPage(this.pageIndex-1);return null;};var i=$b.getIndex();var $d=this.scrollDiv.clientHeight/$b.element.clientHeight;$d=Math.ceil($d);i-=$d;if(i<0)i=0;$c=$b.collection.getRow(i);if(!$c.getVisible())$c=$c.prevRow();};if($c){$c.activate();$c.scrollToView();};return $c;};PXGrid.prototype.pageDown=function(){var $b=this.activeRow,$c=null;if($b){if($b.nextRow()==null){if(!this.isLastPage)this.setPage(this.pageIndex+1);return null;};var i=$b.getIndex();var $d=this.scrollDiv.clientHeight/$b.element.clientHeight;$d=Math.ceil($d);i+=$d;if(i>=$b.collection.length)i=$b.collection.length-1;$c=$b.collection.getRow(i);if(!$c.getVisible())$c=$c.nextRow();};if($c){$c.activate();$c.scrollToView();};return $c;};PXGrid.prototype.$0y=function(e){var se=__px(this).eventElem(e);while(se&&se.tagName!="TD"&&se.tagName!="TR")se=se.parentNode;if(se==null||se.tagName!="TD")return null;return se;};PXGrid.prototype.$0z=function(td){if(td&&td.tagName=="TD"){var r=td.parentNode;for(var $e=0;$e<r.cells.length;$e++)if(r.cells[$e]==td)break;return $e;};return -1;};PXGrid.prototype.$0A=function(e,$f){var $g=__px_cm(this).getResizeDiv(),$h=$g.firstChild;var sh=$f.statHeaderElem?$f.statHeaderElem.offsetHeight:0;var ds=$g.style;ds.display="";ds.cursor="w-resize";ds.width=__doc(this).documentElement.clientWidth-0.1+"px";ds.height=__doc(this).documentElement.clientHeight-0.1+"px";ds=$h.style;ds.top=__px(this).getElemTopPos(this.scrollDiv)-sh+"px";ds.left=e.clientX+__doc(this).documentElement.scrollLeft+"px";ds.width="0px";ds.height=this.scrollDiv.clientHeight+sh+"px";$g.object=this;$g.column=$f;$g.initX=e.clientX;if(this.$0B==null)this.$0B=Function.createDelegate(this,this.$0C);var h=this.$0B;__px(this).addEventHandler(__doc(this),"mouseup",h,true);__px(this).addEventHandler(__doc(this),"mousemove",h,true);if($g.setCapture)$g.setCapture();};PXGrid.prototype.startColMoving=function(e,$f,se,$i){if($f.level.getVisibleColsCount()<=1&&!this.hasQuickFilters())return;if(se==null)se=$f.statHeaderElem;var $g,ds,$j=__px(this).getDocScrollElem();if(!__doc(this).body.gridDragDropDiv){$g=__doc(this).createElement("DIV");$g.style.display="none";__doc(this).body.appendChild($g);__doc(this).body.gridDragDropDiv=$g;};$g=__doc(this).body.gridDragDropDiv;ds=$g.style;$g.className=se.className;ds.cssText=se.style.cssText;ds.position="absolute";ds.zIndex=20000;ds.display="";ds.left=e.clientX+$j.scrollLeft-se.offsetWidth/2+"px";ds.top=e.clientY+$j.scrollTop-se.offsetHeight/2+"px";ds.width=se.clientWidth+"px";ds.cursor="default";$g.innerHTML=se.innerHTML;$g.object=this;$g.column=$f;$g.colElem=se;$g.toIndex=-1;$g.isFilter=$i;if(this.$0D==null)this.$0D=Function.createDelegate(this,this.$0E);var h=this.$0D;__px(this).addEventHandler(__doc(this),"mousemove",h,true);__px(this).addEventHandler(__doc(this),"mouseup",h,true);if($g.setCapture)$g.setCapture();};PXGrid.prototype.showArrowImages=function($k,cx,cy,cw){var $l=this.levels[0].getImage("arrowUp",true);var $m=this.levels[0].getImage("arrowDown",true);$l.style.display="";$l.style.left=cx-$l.offsetWidth/2+cw+"px";$l.style.top=cy+$k.offsetHeight+"px";$l.style.zIndex=20000;$m.style.display="";$m.style.left=cx-$m.offsetWidth/2+cw+"px";$m.style.top=cy-$m.offsetHeight+"px";$m.style.zIndex=20000;};PXGrid.prototype.hideArrowImages=function(){var $l=this.levels[0].getImage("arrowUp",true);var $m=this.levels[0].getImage("arrowDown",true);$m.style.display=$l.style.display="none";};PXGrid.prototype.$0F=function($b,x,y,$n){var $k=null;for(var i=0;i<$b.childNodes.length;i++){var $o=$b.childNodes[i];if(!$o.tagName||($o.tagName=="TD"&&!$o.id))continue;var r=this.getElemRect($o);if(typeof($n)=="number")r.yl+=$n;if((y>=r.y&&y<r.yl)&&(x>=r.x&&x<r.xl)){$k=$o;break;}};return $k;};PXGrid.prototype.handleKeyDown=function(e){var $p=e.keyCode,$c,$q;var $o=this.activeCell,$b=this.activeRow;var $r=($o!=null)?$o.column.level:this.levels[0];var $s=new Object();$s.key=e.keyCode;if(this.fireEvent("keyDown",e,$s)){__px(this).cancelEvent(e);return;};switch($p){case 13:if(e.altKey){__px(this).cancelEvent(e);if($b)this.showFormView();}else if($b&&$b.level.allowUpdate){if($o){__px(this).cancelEvent(e);this.beginEdit();}}else if($b&&this.defaultAction){this.execDefaultAction(e);};break;case 32:if($o&&$o.isCheckBox()&&!$o.getReadOnly(true)){__px(this).cancelEvent(e);$o.switchCheckState();};break;case 114:case 70:if(this.allowSearch&&(e.ctrlKey||$p==114)){__px(this).cancelEvent(e);if(__px(this).IsIE)e.keyCode=0;this.beginSearch();}else if($p==70&&(e.altKey||e.shiftKey)){__px(this).cancelEvent(e);if(e.altKey)this.showFilter(e.shiftKey);else this.createColumnFilter();};break;case 115:if($r.allowFormEdit){__px(this).cancelEvent(e);this.showFormView();};break;case 113:if($o)this.beginEdit();break;case 116:this.executeCommand(PXGridCommand.Refresh);__px(this).cancelEvent(e);if(__px(this).IsIE)e.keyCode=0;break;case 117:var $f=$o?$o.column:null;if($f&&$f.allowSort&&$f.dataField){var $t=($f.sortDirection<2)?($f.sortDirection+1):0;$f.sort($t);__px(this).cancelEvent(e);};break;case 119:if($b){if($b.isNew())this.removeRow();else{$b.clearErrors();$b.clearStatus(true);}};break;case 45:if(e.ctrlKey&&$o){__px(this).clipboardCopy($o.getClipboardText());}else{__px(this).cancelEvent(e);this.addNewRow(true,$r.inplaceInsert||e.shiftKey);};break;case 46:case 68:var $u=$b&&$b.level.allowDelete;if($u&&(e.ctrlKey||$p==46)){__px(this).cancelEvent(e);this.selectedRows?this.removeSelectedRows():this.removeRow();};break;case 65:if($b){if(e.ctrlKey)$b.collection.setSelected(true);else if(e.shiftKey)this.showFilter(true);};break;case 67:if((e.ctrlKey||e.metaKey)&&$o)__px(this).clipboardCopy($o.getClipboardText());break;case 74:if(e.ctrlKey&&this.allowAdjustColumns){__px(this).cancelEvent(e);this.adjustColumns();};break;case 78:var $v=$b&&$b.level.allowAddNew;if(e.ctrlKey&&$v){__px(this).cancelEvent(e);this.addNewRow(true,true);};break;case 86:if(e.ctrlKey)this.executeCommand(PXGridCommand.Paste);break;case 88:if(e.ctrlKey)this.executeCommand(PXGridCommand.Copy);break;case 38:if($b){$c=$b.prevRow();if($c!=null){if(e.shiftKey&&$r.allowRowSelect){$b.setSelected(!$c.getSelected());$c.setSelected(true);}}else if(!this.isFirstPage){this.activateLastRow=true;this.pageUp();}};break;case 40:if($b){$c=$b.nextRow();if($c!=null){if(e.shiftKey&&$r.allowRowSelect){$b.setSelected(!$c.getSelected());$c.setSelected(true);}}else if($b.level.allowAddNew){if(!e.shiftKey)this.addNewRow(true);}else if(!this.isLastPage){this.activateFirstRow=true;this.pageDown();}};break;case 33:if($b){__px(this).cancelEvent(e);this.pageUp();};break;case 34:if($b){__px(this).cancelEvent(e);this.pageDown();};break;case 36:if(e.ctrlKey){$c=$b.collection.getRow(0);if(!$c.getVisible())$c=$c.nextRow();}else{if($o){$q=$o.row.getCell(0);if(!$q.column.canHasFocus())$q=$q.nextCell();}};break;case 35:if(e.ctrlKey){var $w=$b.collection;$c=$w.getRow($w.length-1);if(!$c.getVisible())$c=$c.prevRow();}else{if($o){var r=$o.row;$q=r.getCell(r.cells.length-1);if(!$q.column.canHasFocus())$q=$q.prevCell();}};break;case 37:if($o&&$r.highlightCell)$q=$o.prevCell();break;case 39:if($o&&$r.highlightCell)$q=$o.nextCell();break;};if($q&&!$r.highlightCell){$q.scrollToView();$q=null;};if($q!=null&&$q!=$o){$q.activate();$q.scrollToView();__px(this).cancelEvent(e);}else if($c!=null&&$c!=$b){if(!e.shiftKey)this.clearRowSelection();$c.activate();$c.scrollToView();__px(this).cancelEvent(e);}};PXGrid.prototype.$0G=function(e){var $p=(e.which!=null)?e.which:e.keyCode;var $s=new Object();$s.key=$p;if(this.fireEvent("keyPress",e,$s)){__px(this).cancelEvent(e);return;};if(this.allowSearch&&!e.ctrlKey&&!e.altKey){if(__px(this).isDigit($p)||__px(this).isLetter($p)){this.beginSearch(String.fromCharCode($p));__px(this).cancelEvent(e);}}};PXGrid.prototype.$0H=function(e){var se=this.$0y(e),me=this;if(se==null)return;var $f=this.getColByID(se.id),$x=true;__px(this).cancelEvent(e,false);if($f==null||__px(this).eventButton(e)>0)return;if($f.allowResize&&e.clientX>(se.getBoundingClientRect().right-3)){this.$0A(e,$f);$x=false;};if($x){this.suppressColMove=true;setTimeout(function(){me.suppressColMove=false;},__px(this).IsTabletOrWin?100:50);$f.headerClicked=true;}};PXGrid.prototype.$0I=function(e){this.startTouchX=e.touches[0].pageX;};PXGrid.prototype.$0J=function(e){if(this.startTouchX==null)return;var $y=(e.touches[0].pageX-this.startTouchX);if(Math.abs($y)>20){this.setPage(this.pageIndex+(($y>0)?-1:1));delete this.startTouchX;}};PXGrid.prototype.$0K=function(e){var se=this.$0y(e);if(se==null)return;if(!se.id){if(!this.menuClosed&&__px(this).eventButton(e)==0){if(!this.fireEvent("gridCornerClick",e)){var l=this.levels[0],$z=l.getColumnsMenu();this.showColumnsDialog();}};return;};var $f=this.getColByID(se.id),$A=__px(this).IsTabletOrWin;if($f&&!$A)$A=$f.headerClicked;delete $f.headerClicked;if($f!=null&&$A){var $s=new Object();$s.column=$f;if(this.fireEvent("colHeaderClick",e,$s))return;var $k=__px_cm(this).resolveSpriteElement(__px(this).eventElem(e));if($f.allowCheckAll&&__px_cm(this).isSpriteOrImage($k)){var $B=$f.getCheckState($k);if($B!=null){$f.setCheckState($k,!$B);return;}};if($f.allowFilterDialog())this.showFilterDialog($f);else{switch($f.level.headerClickAction){case 2:if(!this.editMode&&$f.allowSort&&$f.dataField){var $t=($f.sortDirection<2)?($f.sortDirection+1):0;$f.sort($t);this.focus();};break;}}}};PXGrid.prototype.$0L=function(e){var se=this.$0y(e);var $f=se?this.getColByID(se.id):null;if($f==null)return;if($f.headerClicked&&$f.allowMove&&!this.suppressColMove){this.startColMoving(e,$f,se);}else if($f.allowResize){if(e.clientX>(se.getBoundingClientRect().right-3)){if($f.oldHeaderCursor==null)$f.oldHeaderCursor=se.style.cursor;se.style.cursor="w-resize";}else{if($f.oldHeaderCursor!=null){se.style.cursor=$f.oldHeaderCursor;delete $f.oldHeaderCursor;if(__px(this).IsIE){se.style.display="none";se.style.display="";}}}};if(!this.suppressColMove)delete $f.headerClicked;__px(this).cancelEvent(e,false);};PXGrid.prototype.$0M=function(e){var se=this.$0y(e),$f=se?this.getColByID(se.id):null;if($f){$f.mouseOver=true;$f.repaintDataImage(se);}};PXGrid.prototype.$0N=function(e){var $C=e.relatedTarget||e.toElement;var se=this.$0y(e),$f=se?this.getColByID(se.id):null;if($f&&!__px(this).contains(se,$C)){delete $f.mouseOver;$f.repaintDataImage(se);}};PXGrid.prototype.$0O=function(e){var $g=__win(this).theForm.resizeDiv;if($g.initX!=e.clientX){var $f=$g.column,$j=__doc(this).documentElement;if(($f.getWidth()+e.clientX-$g.initX)>0)$g.firstChild.style.left=e.clientX+$j.scrollLeft+"px";};__px(this).cancelEvent(e);};PXGrid.prototype.$0P=function(e){var $g=__win(this).theForm.resizeDiv;try{$g.style.display="none";if($g.initX!=e.clientX){var $f=$g.column;var $D=$f.getWidth();var $E=$D+e.clientX-$g.initX;if($E<=0)$E=1;if($D!=$E)$f.setWidth($E);};__px(this).cancelEvent(e);}finally{$g.object=null;$g.column=null;var h=this.$0B;if(h!=null){__px(this).removeEventHandler(__doc(this),"mouseup",h,true);__px(this).removeEventHandler(__doc(this),"mousemove",h,true);};if($g.releaseCapture)$g.releaseCapture();}};PXGrid.prototype.handleColDrag_MouseMove=function(e){var $g=__doc(this).body.gridDragDropDiv;var $f=$g.column,$F=$g.colElem,$r=$f.level;$g.toIndex=-1;$g.toFilter=$g.removeFromFilter=false;var x=e.clientX+__px(this).getDocScrollElem().scrollLeft;var y=e.clientY+__px(this).getDocScrollElem().scrollTop;$g.style.left=x-$g.offsetWidth/2+"px";$g.style.top=y-$g.offsetHeight/2+"px";var mr,$G=false,$k=null,$H=0;var $I=this.tlbFilterTools,$J=this.tlbFilters;if(!$g.isFilter){var $K=($r.index==0)?this.statHDiv:$F.parentNode;mr=this.getElemRect($K);var $L=$g.offsetHeight/2;mr.yl+=$L;if(mr.isInside(mr,x,y)){$k=this.$0F($F.parentNode,x,y,$L);$H=-this.scrollDiv.scrollLeft;}};var $M=$J&&$J.items[$f.getKey()];if($k==null&&$I!=null&&$f.allowFilterDialog()){var $o=$I.items[$I.items[0].getVisible()?0:1];mr=this.getElemRect($o.itemCell);if(mr.isInside(mr,x,y)){$G=true;if($J.items.length>0){$k=this.$0F(this.tlbFilters.elemItems,x,y,0);if($k==null)$k=$J.items[$J.items.length-1].itemCell;}else{$k=$o.itemCell;$H=20;}}else if($g.isFilter)$g.removeFromFilter=true;};var $N=true;if($k){var cw=$k.offsetWidth;var cx=__px(this).getElemLeftPos($k)+$H;var cy=__px(this).getElemTopPos($k);if((cx+cw)>mr.xl)cw=mr.xl-cx;var $O=(x<(cx+cw/2))?true:false;if($G){$g.toFilter=true;$N=false;if($H==0){$g.toIndex=$k.firstChild.object.index+($O?0:1);if($M&&$g.toIndex>$M.index)$g.toIndex--;}else $O=true;}else{var $P=this.getColByID($k.id);if($P.index!=$f.index){var $Q=$O?$P.index:($P.index+1);if($Q>$f.index)$Q--;if($Q!=$f.index){$g.toIndex=$Q;$N=false;}}};if(!$N)this.showArrowImages($k,cx,cy,($O?0:cw));};if($N)this.hideArrowImages();__px(this).cancelEvent(e);};PXGrid.prototype.handleColDrag_MouseUp=function(e){var $g=__doc(this).body.gridDragDropDiv;try{var $f=$g.column,$r=$g.column.level;var $I=this.tlbFilterTools,$J=this.tlbFilters;$g.style.display="none";var $l=$r.getImage("arrowUp",true);var $m=$r.getImage("arrowDown",true);$l.style.display="none";$m.style.display="none";if($g.toFilter){this.addQuickFilter($f.getKey(),$g.toIndex);}else if($g.removeFromFilter){this.removeQuickFilter($f.getKey());}else if($g.toIndex>=0){var $s=new Object();$s.column=$f;$s.position=$g.toIndex;if(!this.fireEvent("beforeColMove",e,$s)){$r.moveColumn($f.index,$g.toIndex);this.fireEvent("afterColMove",e,$s);}};__px(this).cancelEvent(e);}finally{$g.object=null;$g.column=null;$g.colElem=null;$g.toFilter=$g.removeFromFilter=null;var h=this.$0D;if(h!=null){__px(this).removeEventHandler(__doc(this),"mouseup",h,true);__px(this).removeEventHandler(__doc(this),"mousemove",h,true);};if($g.releaseCapture)$g.releaseCapture();}};PXGrid.prototype.$0Q=function(e,se,$R,$e){var $S=!this.hasFocus,$T=true,$r=$R.level;var fc=$r.firstColumnCell,$U=($R!=this.activeRow);var $V;if(this.searchEditor)this.endSearch(true);if($e>=fc){$V=$R.getCell($e-fc);var $f=$V?$V.column:null;var $W=new Object();$W.cell=$V;if($V&&this.fireEvent("cellClick",e,$W))return;if($V&&$V.column.allowFocus){var $X=$V.isActive();if(!$X)$V.activate();var $Y=__px(this).eventElem(e);if($Y.tagName=="NOBR")$Y=$Y.parentNode;if(e.clickCount==2){if(!$f.level.allowUpdate){if(this.defaultAction)this.execDefaultAction(e);else this.executeCommand(PXGridCommand.EditRecord);}else{if(!this.editMode)this.beginEdit();}}else if($V.isCheckBox()){$V.switchCheckState();}else if($Y.tagName=="INPUT"&&$Y.type=="button"){this.fireEvent("cellButtonClick",e,$W);}else if($Y.tagName=="A"||($Y.parentNode&&$Y.parentNode.tagName=="A")){if($f.viewLink){this.navigate($f.dataField,e);__px(this).cancelEvent(e);}else{__px(this).openUrl($Y.href,"_blank");__px(this).cancelEvent(e);}}}else if($V){var me=this;var $Y=__px(this).eventElem(e);if($f.key=="Files"&&(!this.menuClosed||$U)){$S=false;$V.row.activate();this.showFiles();}else if($f.key=="Notes"){$S=false;$V.row.activate();setTimeout(function(){me.showNote();},1);}else if($Y.tagName=="A"||($Y.parentNode&&$Y.parentNode.tagName=="A")){if($f.viewLink){this.navigate($f.dataField,e);__px(this).cancelEvent(e);}else{__px(this).openUrl($Y.href,"_blank");__px(this).cancelEvent(e);}}}}else if($e==(fc-1)){var $s=new Object();$s.row=$R;if(!e.clickCount&&!this.fireEvent("rowSelectorClick",e,$s)){if($r.allowRowSelect){if(e.ctrlKey){$T=false;var $Z=!$R.getSelected(),ar=this.activeRow;$R.setSelected($Z);if($Z&&(ar==null||!ar.getSelected()))$R.activate();}else if(e.shiftKey){var $w=$R.collection;$w.setSelected(false);$w.selectRange(this.activeRow.getIndex(),$R.getIndex());$T=false;}};if($T&&$U){if(this.editMode)this.endEdit();$R.activate();}}};if($T)this.clearRowSelection();if($S&&!this.editMode)this.focus();return $V;};PXGrid.prototype.$0R=function(e,se,$R,$e){__px(this).cancelEvent(e,false);var fc=$R.level.firstColumnCell,$00=this.$0S;if($e>=fc){var $V=$R.getCell($e-fc);if($V){var $f=$V.column;if($f.type==PXColumnType.Button&&$f.buttonDisplay==0)$V.showButton();else if($00&&$00.oCell)$00.oCell.hideButton();}}else if($00&&$00.oCell)$00.oCell.hideButton();};PXGrid.prototype.$0T=function(e,se){__px(this).cancelEvent(e);var $R=null;if(se!=this.scrollDiv){var $o=this.$0y(e);if($o!=null)$R=this.getRowObject($o.parentNode);};var $z=this.getContextMenu();if($z==null)$z=this.getLocalMenu();if($z){if(!this.editMode&&$R)$R.activate();var de=__doc(this).documentElement;var $01=de.scrollTop,$02=de.scrollLeft;$z.ownerID=this.ID;$z.showAt(e.clientX+$02,e.clientY+$01);}};PXGrid.handleCellButtonEvents=function(e){var se=__px(this).eventElem(e),$V=se?se.oCell:null;if($V==null)return;var $b=$V.row,$03=$b.level.grid;switch(e.type){case "click":if(!$b.isActive())$b.activate();var $s=new Object();$s.cell=$V;$03.fireEvent("cellButtonClick",e,$s);break;}};PXGrid.prototype.handleFocusEvents=function(e){this.event=e;switch(e.type){case "focus":if(this.getVisible()&&this.getEnabled()){this.hasFocus=true;this.repaintStatusBar();};break;case "blur":this.hasFocus=false;break;case "keydown":this.handleKeyDown(e);break;case "keypress":this.$0G(e);break;};delete this.event;};PXGrid.prototype.$0r=function(e){var $03=__px(this).eventObject(e,PXGrid);if($03&&!this.isPivotVisible()){if(!$03.editMode&&!$03.draggable)$03.focus();$03.focusAction();}};PXGrid.prototype.focusAction=function(){if(this.activeRow==null&&this.activeForm==null){if(!__px_callback(this).waitCallback)this.addNewRow();else{this.waitAddNew=true;__px(this).registerCallbackTask(this,this.addNewRow);}}};PXGrid.prototype.$0q=function(e){var $03=__px(this).eventObject(e,PXGrid);var se=__px(this).eventElem(e),ar=$03?$03.activeRow:null;switch(e.type){case "scroll":if($03==null&&e.currentTarget){se=e.currentTarget;while(se){if(se.object instanceof PXGrid){$03=se.object;break;};se=se.parentNode;}};if($03){var $g=$03.scrollDiv;if($g.childNodes.length>0)$03.alignStatMargins();var ev=new Object();ev.scroll=$g.scrollLeft;$03.fireEvent("horizontalScroll",null,ev);};break;case "contextmenu":$03.$0T(e,se);break;case "click":if($03){if(!$03.editMode&&!$03.searchMode)$03.focus();switch(e.target.getAttribute('data-actiontype')){case "clear":this.clearColumnFilters();this.applyFilter('');break;case "add":this.tryAddNew();break;}};break;case "dblclick":if($03&&se==$03.scrollDiv){if(ar&&ar.isEdit())ar.commitCellChanges();if(ar==null||ar.getStatus()!=PXRowStatus.AddNew||ar.dataChanged)setTimeout(function(){$03.addNewRow();},0);};break;}};PXGrid.prototype.$0t=function(e){switch(e.type){case "mousedown":if(!__px(this).IsTablet)return this.$0H(e);break;case "mouseup":return this.$0K(e);case "mousemove":return this.$0L(e);case "mouseover":if(!__px(this).IsTabletOrWin)return this.$0M(e);break;case "mouseout":if(!__px(this).IsTabletOrWin)return this.$0N(e);break;case "touchstart":return this.$0I(e);case "touchmove":return this.$0J(e);case "contextmenu":__px(this).cancelEvent(e);break;}};PXGrid.prototype.$0C=function(e){switch(e.type){case "mousemove":this.$0O(e);break;case "mouseup":this.$0P(e);break;}};PXGrid.prototype.$0E=function(e){switch(e.type){case "mousemove":this.handleColDrag_MouseMove(e);break;case "mouseup":this.handleColDrag_MouseUp(e);break;}};PXGrid.prototype.$0v=function(e){var $04=__px(this).eventObject(e),me=this;var $05=$04 instanceof PXToolBarButton;switch(e.type){case "mousedown":if($04&&$05){this.suppressColMove=true;setTimeout(function(){me.suppressColMove=false;},__px(this).IsTabletOrWin?100:50);$04.headerClicked=true;};break;case "mouseup":if($04&&$05)delete $04.headerClicked;break;case "mousemove":if($04&&$05&&$04.headerClicked&&!this.suppressColMove){this.startColMoving(e,this.levels[0].getColumn($04.key),$04.itemCell,true);delete $04.headerClicked;};break;}};PXGrid.prototype.localeUpdated=function($06){if(!$06)return;var $07=$06.split(';');this.activeCell.language=$07[0];this.activeCell.setValue($07[1]);if(this.localizedInlineEditor){if(this.localizedInlineEditor.localeUpdated)this.localizedInlineEditor.localeUpdated($06);this.localizedInlineEditor=undefined;}else if(this.activeCell&&this.activeCell.column.dataType==NetType.String&&this.activeCell.column.defaultLocale&&!this.activeCell.getReadOnly()){if(this.activeControl&&this.activeControl.wrapLanguage){this.activeControl.language=$07[0];this.activeControl.setValue($07[1]);this.activeControl.wrapLanguage();}};this.levels[0].navigator.update(this.activeCell);};PXGrid.prototype.$0x=function(e){var $03=__px(this).eventObject(e,PXGrid);if(!$03)return;var se=$03.$0y(e);if(se==null)return;var $R=$03.getRowObject(se.parentNode),$r=$R?$R.level:null;var $e=$03.$0z(se);if($R==null||$e<0)return;this.event=e;switch(e.type){case "dblclick":e.clickCount=2;$03.$0Q(e,se,$R,$e);break;case "click":var $Y=__px(this).eventElem(e);if($Y.tagName=="A"||($Y.parentNode&&$Y.parentNode.tagName=="A")){__px(this).cancelEvent(e);};var cm=__px_cm(this);if(cm.delayedCallback==null)cm.delayedCallback=0;cm.delayedCallback++;setTimeout(function(){$03.event=e;var $08=$03.$0Q(e,se,$R,$e)||$R.getCell($e);if(e.target.getAttribute("data-lang")&&$08&&!($08.getReadOnly&&$08.getReadOnly())){cm.showLocalizePopup($03.dataSourceID,$03.dataMember,$03.activeCell.column.getKey(),$03);};delete $03.event;if(cm.delayedCallback)cm.delayedCallback--;},0);break;case "mouseover":$03.$0R(e,se,$R,$e);break;case "selectstart":__px(this).cancelEvent(e,false);break;case "mousedown":this.cellClicked=true;break;case "mouseup":delete this.cellClicked;break;case "mousemove":if($r.allowDragRows&&this.cellClicked&&__px(this).IsIEorEdge){this.$0U($R,$e,e);};delete this.cellClicked;break;case "dragstart":if($r.allowDragRows&&e.dataTransfer.setDragImage){this.$0U($R,$e,e);}else{var i=$e-$R.level.firstColumnCell,$09=[this.ID,$R.getIndex(),i];$09.push($R.getCell(i).getInvariantText());e.dataTransfer.setData('text',__px_cm(this).setDragData($09.join('|')));e.dataTransfer.effectAllowed='linkMove';};break;case "touchstart":$03.$0V(e,se,$R,$e);break;case "touchend":case "touchmove":clearTimeout($03.$0W);$03.$0X(e);break;};delete this.event;};PXGrid.prototype.getRowsToDrag=function($b){var $w=new Array(),$0a=false;$w.push($b);if(this.selectedRows)for(var n in this.selectedRows){var sr=this.selectedRows[n];if(!sr.setStatus)continue;if($w.indexOf(sr)<0)$w.push(sr);else $0a=true;};if(!$0a){$w.length=0;$w.push($b);}else $w.sort(function(a,b){return a.getIndex()-b.getIndex();});return $w;};PXGrid.prototype.pasteSelectedRows=function(tr,$0b,$0c){var ds=__px_alls(this)[this.dataSourceID];if(ds&&this.pasteCommand){this.viewState.update("RowsToMove",$0b.join('&'));this.viewState.update("InsertPos",tr.getDataKey().join("|"));if($0c)this.viewState.update("InsertAfter","1");ds.executeCallback(this.pasteCommand);this.viewState.remove("RowsToMove");this.viewState.remove("InsertPos");this.viewState.remove("InsertAfter");}};PXGrid.prototype.$0U=function($b,$e,e){if($b.isEdit()){__px(this).cancelEvent(e);return;};if(!$b.level.getAllowDragRows())return;var $0d=this.getRowsToDrag($b);var $09=[this.ID,$0d.map(function(i){return i.getIndex();}).join(',')];var $06=__px_cm(this).setDragData($09.join('|'));if(e.dataTransfer){e.dataTransfer.setData('text',$06);e.dataTransfer.effectAllowed='linkMove';};var dt=this.$0Y($0d);if(__px(this).IsIEorEdge){dt.dragDrop();}else if(e.dataTransfer&&e.dataTransfer.setDragImage){e.dataTransfer.setDragImage(dt,0,0);}};PXGrid.prototype.$0Y=function($w){if(this.$0Z&&this.$0Z.parentNode)this.$0Z.parentNode.removeChild(this.$0Z);var t=this.$0Z=__doc(this).createElement("table");t.style.zIndex=-1;t.style.position="absolute";t.style.tableLayout="fixed";t.style.pointerEvents="none";t.border=t.cellSpacing=t.cellPadding=0;if(__px(this).IsIEorEdge)t.style.opacity=0.9;var $0e=__doc(this).createElement("colgroup");t.appendChild($0e);var $0f=this.levels[0].columns;for(var i=0;i<$0f.length;i++){if(!$0f[i].draggable)continue;var $f=__doc(this).createElement("col");$f.style.width=$0f[i].getWidth()+"px";$0e.appendChild($f);};for(var j=0;j<$w.length;j++){var $0g=t.insertRow(j);for(var i=0;i<$0f.length;i++){if(!$0f[i].draggable)continue;var td=$0g.insertCell($0g.cells.length);var $o=$w[j].getCell($0f[i]);td.className=$o.element.className;td.innerHTML=$o.element.innerHTML;}};this.scrollDiv.appendChild(t);return this.$0Z;};PXGrid.prototype.$0V=function(e,se,$R,$e){if(e.touches.length==2){this.startTouchY=e.touches[0].pageY;__px(this).cancelEvent(e);}else{var $03=this;e.clickCount=2;if(this.editMode)this.$0W=setTimeout(function(){$03.endEdit()},1000);else{this.$0W=setTimeout(function(){$03.$0Q(e,se,$R,$e);},1000);}}};PXGrid.prototype.$0X=function(e){if(this.startTouchY==null||e.touches.length!=2)return;var $y=(e.touches[0].pageY-this.startTouchY);if(Math.abs($y)>20){this.setPage(this.pageIndex+(($y>0)?-1:1));delete this.startTouchX;__px(this).cancelEvent(e);}};PXGrid.prototype.handleDragDropEvents=function(e){var $k=this.element;switch(e.type){case "dragover":case "dragenter":var $06=__px_cm(this).getDragData(),$w=this.rows;var $09=$06.split('|'),$0h=$09[0];var $0i=this.getRowObjectFromEvent(e),$0j;if($0i==null){$0i=$w.getRow(this.rows.length-1);$0j=true;};var $0k=this.allowDrop==2;this.dropAllowed=false;if($0h==this.ID&&this.levels[0].allowDragRows){$0k=true;var $0l=$09[1].split(',').map(function(i){return $w.getRow(i);});if($0j)this.dropAllowed=$0i!=$0l[$0l.length-1];else if($0l.indexOf($0i)>=0)this.dropAllowed=$0i!=$0l[0]&&$0l.indexOf($0i.prevRow())<0;else this.dropAllowed=$0l.indexOf($0i.prevRow())<0;}else{var $0m=__px_all(this)[$0h].rows.getRow($09[1]);this.dropAllowed=$0i!=$0m&&($0k||$0h!=this.ID)&&($0i==null||$0j||$0i.prevRow()!=$0m);};if(this.dropAllowed){if(this.dragTargetRow!=$0i)this.$10();if($0i&&$0k){$0i.dragover=$0j?2:1;$0i.repaint();this.dragTargetRow=$0i;};var $s=new Object();$s.data=$06;$s.targetRow=$0i;this.dropAllowed=!this.fireEvent("dragover",e,$s);if(this.dropAllowed&&$0h!=this.ID)$k.className=__px(this).appendCss($k,["dragover"]);};break;case "mouseout":case "dragleave":this.$11(e);break;case "drop":if(this.dropAllowed){var $06=__px_cm(this).getDragData(),$w=this.rows;var $09=$06.split('|'),$0h=$09[0];var $s=new Object(),tr=this.dragTargetRow;$s.data=e.dataTransfer.getData('text');$s.targetRow=(tr&&tr.dragover==1)?tr:null;if($0h==this.ID&&this.pasteCommand&&tr){var $0l=$09[1].split(',').map(function(i){return $w.getRow(i);});var $0b=$0l.map(function(r){return r.getDataKey().join("|");});this.pasteSelectedRows(tr,$0b,$s.targetRow==null);};delete this.dropAllowed;this.fireEvent("dragdrop",e,$s);};this.$10();this.$11(e);__px_cm(this).setDragData(null);break;}};PXGrid.prototype.$11=function(e){var $0i=this.getRowObjectFromEvent(e);if($0i&&this.allowDrop==2){delete $0i.dragover;$0i.repaint();};this.$10();this.element.className=__px(this).excludeCss(this.element,["dragover"]);};PXGrid.prototype.$10=function(){var $0i=this.dragTargetRow;if($0i){delete $0i.dragover;$0i.repaint();delete this.dragTargetRow;}};PXGrid.prototype.getRowObjectFromEvent=function(e){var se=this.$0y(e),re=se?se.parentNode:null;if(re&&(re.object instanceof PXGridRow))return re.object;return(re&&re.id)?this.getRowObject(re):null;};PXGrid.prototype.handlePivotEditorDragEvents=function(e){var $I=this.tlbFilterTools,$J=this.tlbFilters,$0n=null;try{$0n=this.pivotEditor&&this.pivotEditor.contentWindow;}catch(ex){};if($0n!=null)switch(e.type){case "dragover":var x=e.clientX+__px(this).getDocScrollElem().scrollLeft;var y=e.clientY+__px(this).getDocScrollElem().scrollTop;var $o=$I.items[$I.items[0].getVisible()?0:1];var $k=null,mr=this.getElemRect($o.itemCell),$H=0;if(mr.isInside(mr,x,y)){if($J.items.length>0){$k=this.$0F($J.elemItems,x,y,0);if($k==null)$k=$J.items[$J.items.length-1].itemCell;}else{$k=$o.itemCell;$H=20;}};this.insertFilterPos=$k?-1:null;if($k){var cw=$k.offsetWidth,cy=__px(this).getElemTopPos($k);var cx=__px(this).getElemLeftPos($k)+$H;if((cx+cw)>mr.xl)cw=mr.xl-cx;var $O=(x<(cx+cw/2))?true:false;if($H==0)this.insertFilterPos=$k.firstChild.object.index+($O?0:1);else $O=true;this.showArrowImages($k,cx,cy,($O?0:cw));}else this.hideArrowImages();break;case "dragleave":this.hideArrowImages();delete this.insertFilterPos;break;case "drop":var $r=this.levels[0],$0o=null,$0p=this.insertFilterPos,$f;var $06=e.dataTransfer.getData('text'),ar=$06?$06.split('|'):null;if(ar&&ar.length>3)$0o=ar[3].replace(/[\[\]=]/g,'');this.hideArrowImages();delete this.insertFilterPos;if($0p!=null&&$0o&&($f=$r.getColumn($0o))!=null)this.addQuickFilter($f.getKey(),$0p);break;}};PXGrid.prototype.attachPivotEditorEvents=function(){if(this.tlbFilterTools==null||this.pivotEditor==null)return;if(this.$12==null)this.$12=Function.createDelegate(this,this.handlePivotEditorDragEvents);var $k=this.tlbFilterTools.element;__px(this).addEventHandler($k,"dragover",this.$12);__px(this).addEventHandler($k,"dragleave",this.$12);__px(this).addEventHandler($k,"drop",this.$12);};PXGrid.prototype.detachPivotEditorEvents=function(){if(this.$12!=null){var $k=this.tlbFilterTools.element;__px(this).removeEventHandler($k,"dragover",this.$12);__px(this).removeEventHandler($k,"dragleave",this.$12);__px(this).removeEventHandler($k,"drop",this.$12);}};



PXGrid.prototype.removeRow=function(){if(this.activeForm!=null){var $a=this.activeForm.level;if($a.allowDelete){$a.formView.deleteRow();$a.refreshRows=true;};return;};var ar=this.activeRow;if(ar!=null){var $b=this.activeCell.nearColumnCell();if(this.editMode){this.endEdit(true,false);ar=this.activeRow;};if(ar&&ar.getStatus()!=PXRowStatus.Deleted)ar.removeRow();if($b&&this.activeCell==null)$b.activate();};return ar;};PXGrid.prototype.removeSelectedRows=function(){var $c=this.selectedRows;if($c==null)return;var $d=new Object();$d.rows=$c;if(this.fireEvent("beforeRowDelete",null,$d))return;if(this.editMode)this.endEdit(true);var $e=false;for(var n in $c){var $f=$c[n];if(!$f.setStatus)continue;if(!$f.isNew()){$f.setStatus(PXRowStatus.Deleted);$e=true;}else $f.remove();};if($e){var $g=this.batchUpdate;try{this.batchUpdate=true;this.update();}finally{this.batchUpdate=$g;}};this.fireEvent("afterRowDelete",null,$d);};PXGrid.prototype.removeAllRows=function(){var $h=this.rows;if($h.length>0){for(var i=0;i<$h.length;i++){var $f=$h.getRow(i);$f.setStatus(PXRowStatus.Deleted);};var $g=this.batchUpdate;try{this.batchUpdate=true;this.update();}finally{this.batchUpdate=$g;}}};PXGrid.prototype.addNewRow=function($i,$j){if(!this.getCommandState(this,PXGridCommand.AddNew).getEnabled())return null;if(this.waitAddNew){delete this.waitAddNew;if(this.activeRow!=null)return;};this.removeEmptyMessage();if(__px_callback(this).waitCallback){__px(this).registerCallbackTask(this,this.addNewRow);return;};if(this.activeForm!=null){var $a=this.activeForm.level,$k=$a.formView;this.saveFormChanges();if($a.autoInsertField)$k.checkAutoInsert=true;$k.addNew();return;};if($i==null)$i=true;var ar=this.activeRow,ac=this.activeCell;var $a=ar?ar.level:this.levels[0];var $h=ar?ar.collection:this.rows;if($j&&$a.initNewRow)this.viewState.update("InsertPos",ar.getDataKey().join("|"));var $f=$h.addNew($j),me=this;if($f==null)return $f;if($i&&ac){ac.endEdit();this.activeCell=ac=null;};if(ar&&ar.dataChanged)ar.commitChanges();if(!$a.initNewRow)for(var i=0;i<$a.columns.length;i++){var $b=$f.getCell(i);if($b)$b.setValue($a.columns[i].defaultValue);};if($a.initNewRow){if(!this.suppressFocus){if($a.autoInsert){$f.dataChanged=true;this.onTextChanged();};setTimeout(function(){me.initNewRow($f);},0);}else $f.needInitialize=true;};$f.activate();ac?ac.scrollToView():$f.scrollToView();if(!this.editMode)this.beginEdit();if(!__px(this).IsIE&&$h.length==1&&!this.suppressFocus){this.scrollDiv.focus();this.activeCell.setEditorPos(true);};return $f;};PXGrid.prototype.initNewRow=function($f){var $l=new Object();$l.ownerID=this.ID;$l.row=$f;$l.suppressFocus=this.suppressFocus;var $m=Function.createDelegate(this,this.processInitRow);var $n=$f.isActive()?"":$f.getValuesXmlDoc().toString();$f.waitInit=true;$f.waitInitContext=$l;__px_callback(this).execI(this,this.callbacks[3],$n,$m,$l);this.removeEmptyMessage();};PXGrid.prototype.processInitRow=function($o,$l){delete $l.row.waitInit;delete $l.row.waitInitContext;this.viewState.remove("InsertPos");if($o){var $p=__px_all(this)[$l.ownerID],$f=$l.row;var $q=new PXXmlDoc("",$o),$r=$q.rootNode;var $s=$r.getAttribute("Error");if($s){$f.clearChanges(false);$f.setError($s);}else{var $t=parseInt($r.getAttribute("Affected"));if($t){$p.suppressFocus=$l.suppressFocus;try{$f.commitServerChanges($r,true);}finally{delete $p.suppressFocus;};if($f.level.initNewRow)$f.clearOldValues(false);if($f.level.autoInsertField){var $b=$f.getCell($f.level.autoInsertField);var $u=$b&&Boolean($b.getValue());if($u){$f.dataChanged=true;this.onTextChanged();}}}}}};PXGrid.prototype.showFormView=function(){var ar=this.activeRow,$h=ar?ar.collection:this.rows;var $a=ar?ar.level:this.levels[0],$k=$a.editForm;if($k&&$k.style.display=="none"){if(this.editMode){ar.commitCellChanges();this.showFormAfterUpdate=ar.dataChanged;this.endEdit();if(this.showFormAfterUpdate)return;};var $v=[$h.container],$w=$a.formView;if($a.index==0)$v.push(this.statHTable);$k.hideElems=$v;$k.gridRows=$h;for(var i=0;i<$v.length;i++)if($v[i])$v[i].style.display="none";$a.navigator.hide();$w.setVisible(true);$k.style.display="";$h.container.parentNode.appendChild($k);this.restoreHeight();$a.adjustEditFormSize();this.setFormLevel($a.index);$w.clearDataKey();$w.internalRepaint=true;if(ar==null||ar.isNew()){if($a.autoInsertField)$w.checkAutoInsert=true;$w.addNew();}else $w.refresh();$w.onVisibleChanged(true);this.activeForm=$k;this.clearDataValues();this.notifyCommandState();$w.focus();if(this.btnEdit!=null){this.formViewText=this.btnEdit.getText().trim();if(this.formViewText)this.btnEdit.setText(this.gridViewText);else{this.btnEdit.toggleMode=true;this.btnEdit.setPushed(true);}}}};PXGrid.prototype.hideFormView=function(){if(this.activeForm!=null){var $k=this.activeForm,ar=this.activeRow,$a=$k.level;var $v=$k.hideElems,$w=$a.formView,me=this;if(this.saveFormChanges()){$w.hideAfterRepaint=true;return;}else delete $w.hideAfterRepaint;$k.style.display="none";try{__doc(this).body.style.overflow="hidden";for(var i=$v.length-1;i>=0;i--)if($v[i])$v[i].style.display="";}finally{setTimeout(function(){__doc(me).body.style.overflow="";},1);};if(ar==null){ar=$k.gridRows.getRow($k.gridRows.length-1);if(ar)ar.activate();};if(ar)$a.navigator.show(ar);this.restoreHeight();this.alignStatMargins();$w.onVisibleChanged(false);$w.clearChanges();this.setFormLevel(null);this.activeForm=null;this.notifyCommandState();this.focus();if(this.btnEdit!=null){if(this.formViewText)this.btnEdit.setText(this.formViewText);else this.btnEdit.setPushed(false);};var $x=new Array(),$f=this.findFormViewRow($k,$x);if(($f==null&&$a.index==0&&!Array.isEmpty($x))||$a.refreshRows){this.setPageIndex(0);if(!Array.isEmpty($x))this.setSearchKey($x);this.refresh();delete $a.refreshRows;}}};PXGrid.prototype.handleFormButtonClick=function($y,$z){this.execFormViewCommand($y.commandName);};PXGrid.prototype.execFormViewCommand=function($A){var $k=this.activeForm.level.formView,$B=null;$k.setPageIndex(0);switch($A){case "Close":this.hideFormView();break;case "Save":this.saveFormChanges();break;case "First":$k.clearDataKey();$B=PXPanelCommand.PageFirst;break;case "Last":$k.clearDataKey();$B=PXPanelCommand.PageLast;break;case "Next":$B=PXPanelCommand.PageNext;break;case "Prev":$B=PXPanelCommand.PagePrev;break;};if($B){$k.internalRepaint=true;if(!this.saveFormChanges($B))$k.executeCommand($B);}};PXGrid.prototype.findFormViewRow=function($k,$x){if($x==null)$x=new Array();if($k==null)$k=this.activeForm;var $f=null;if($k!=null){var $a=$k.level,$C=$a.dataKey;for(var i=0;i<$C.length;i++){var $D=$a.getColumn($C[i]);var $E=$D?$D.getFormEditor():null;if($E)$x[i]=$E.getValue();};$f=$k.gridRows.findExt($x,$C);};return $f;};PXGrid.prototype.saveFormChanges=function($B){var $k=this.activeForm.level.formView;if($k==null||!$k.getChanged())return false;$k.internalRepaint=true;$k.saveRow();$k.updateGridRow=true;$k.clearChanges();if($B)$k.postponeCommand=$B;return true;};PXGrid.prototype.handleFormRepaint=function($k,$z){var $a=this.activeForm?this.activeForm.level:null;if($a==null)return;var $f=$k.updateGridRow?this.findFormViewRow():null;if($f){for(var i=0;i<$a.columns.length;i++){var $D=$a.getColumn(i);var $E=$D.getFormEditor(),$b=$f.getCell($D);if($E&&$b)$b.setValue($E.getValue());};delete $k.updateGridRow;};$k.setPageIndex(0);if($k.internalRepaint)delete $k.internalRepaint;else $a.refreshRows=true;if($k.checkAutoInsert&&$a.autoInsertField){var $D=$a.getColumn($a.autoInsertField);var $E=$D?$D.getFormEditor():null;var $u=$E&&Boolean($E.getValue());if($u){$k.dataChanged=true;this.onTextChanged();}};delete $k.checkAutoInsert;$a.grid.notifyCommandState();this.repaintStatusBar();if($a.index==0)$a.grid.setVisible($k.getVisible());if($k.postponeCommand){$k.executeCommand($k.postponeCommand);delete $k.postponeCommand;};if($k.hideAfterRepaint){delete $k.hideAfterRepaint;this.hideFormView();}};PXGrid.prototype.handleFormKeyDown=function($k,$z){switch($z.keyCode){case 115:this.hideFormView();__px(this).cancelEvent($z.event);break;case 13:if($z.event.altKey)this.hideFormView();break;}};PXGrid.prototype.beginEdit=function(){var $b=this.activeCell,$D=$b?$b.column:null;var $a=$D?$D.level:null,$F=this.activeRow.isNew();if($D&&((!$F&&$a.allowUpdate)||($F&&$a.allowAddNew))){var $d=new Object();$d.cell=$b;if(this.fireEvent("beforeEnterEditMode",null,$d))return false;$b=this.activeCell;this.clearRowSelection();this.editMode=true;this.activeRow.repaint();$b.beginEdit($b);this.fireEvent("afterEnterEditMode",null,$d);return true;};return false;};PXGrid.prototype.endEdit=function($G,$H){var ac=this.activeCell,ar=this.activeRow;if(!this.editMode||!ac)return false;if(ar==null)ar=ac.row;var $d=new Object();$d.cell=this.activeCell;if(this.fireEvent("beforeExitEditMode",null,$d))return false;if(!ar.endEdit($G))return false;ar=this.activeRow;this.editMode=false;if(ar&&($H||$H==null))ar.repaint();this.focus();this.fireEvent("afterExitEditMode",null,$d);this.showEmptyMessage(this.rows.items);return true;};PXGrid.prototype.beginSearch=function($I){if(!this.allowSearch)return false;var $J=this.getSearchColumn();this.searchEditor=null;if($J&&$J.getVisible()){if(this.editMode){var $K=this.activeCell.nearColumnCell();this.endEdit();if(this.activeCell==null)$K.activate();};var $E=$J.getSearchEditor();var ar=this.activeRow?this.activeRow:this.rows.getRow(0);if($E&&ar){var $b=ar.getCell($J.index);$b.scrollToView();if($E.$0s!=$J){$E.setValue(null);$E.$0s=$J;};this.searchEditor=$E;$E.show($b.element,false);this.searchMode=true;ar.repaint();if($I){$E.setValue($I=String($I));setTimeout(function(){$E.select($I.length);},1);};return true;}};return false;};PXGrid.prototype.endSearch=function($G){var se=this.searchEditor;if(se){se.hide();this.searchMode=false;this.activeRow.repaint();if(!$G)this.search(se.getValue());this.searchEditor=null;}};PXGrid.prototype.getSearchColumn=function(){var $a=this.levels[0],$L=$a.columns,$M,$N=$a.dataKey;var $O=($N&&$N.length)?$a.dataKey[$N.length-1]:null;for(var i=0;i<$L.length;i++){if($L[i].sortDirection>0){$M=$L[i];break;};if($O&&$L[i].dataField==$O)$M=$L[i];};return $M;};PXGrid.prototype.getEditor=function($P){if(!this.hasOwnProperty("editors"))this.editors=new Object();var $N="ed"+$P;if(this.editors[$N]==null){this.editors[$N]=this.getEditorObject($P,this.scrollDiv,Function.createDelegate(this,this.handleEditorEvents));};return this.editors[$N];};PXGrid.prototype.getSearchEditor=function($P){if(!this.hasOwnProperty("searchEditors"))this.searchEditors=new Object();var $N="ed"+$P;if(this.searchEditors[$N]==null){this.searchEditors[$N]=this.getEditorObject($P,this.scrollDiv,Function.createDelegate(this,this.handleSearchEditor),"s");};return this.searchEditors[$N];};PXGrid.prototype.getDefaultEditor=function(id,$Q,$R){var $S=this.ID+"_lv0_"+id,$E=null;if(__px_all(this)[$S]){var $T="_"+$S+($R?$R:"");$E=PXInlineEditor.createControl(this.px_context,$S,this.scrollDiv,$Q,$T,this.ID);};return $E;};PXGrid.prototype.getEditorObject=function($P,$U,$Q,$R){if($R==null)$R="";var $E=null,id;switch($P){case PXEditorType.TextBox:id=this.ID+"_ei"+$R;$E=PXInlineEditor.createTextBox(this.px_context,id,$U,$Q);break;case PXEditorType.Password:id=this.ID+"_ep"+$R;$E=PXInlineEditor.createPassword(this.px_context,id,$U,$Q);break;case PXEditorType.TextArea:id=this.ID+"_ea"+$R;$E=PXInlineEditor.createTextArea(this.px_context,id,$U,$Q);break;case PXEditorType.FocusDiv:id=this.ID+"_ef"+$R;$E=PXInlineEditor.createFocusDiv(this.px_context,id,$U,$Q);break;case PXEditorType.MaskEdit:id=this.ID+"_em"+$R;$E=PXInlineEditor.createMaskEdit(this.px_context,id,$U,$Q);break;case PXEditorType.NumberEdit:id=this.ID+"_en"+$R;$E=PXInlineEditor.createNumberEdit(this.px_context,id,$U,$Q);break;case PXEditorType.DateEdit:$E=this.getDefaultEditor("ed",$Q,$R);break;case PXEditorType.DropDown:$E=this.getDefaultEditor("ec",$Q,$R);break;case PXEditorType.Selector:case PXEditorType.SegmentMask:id=($P==PXEditorType.Selector)?"es":"em";$E=this.getDefaultEditor(id,$Q,$R);if($E){$E.control.hasDataSource=true;$E.addCustomHandler("beforeDropDown",PXGrid.handleEditorDropOpen);$E.addCustomHandler("afterDropDown",PXGrid.handleEditorDropClose);};break;};if($E){$E.editorType=$P;if($E.control)$E.control.bindingContainer=this.ID;};return $E;};PXGrid.prototype.onTextChanged=function($V){if(this.dataSourceID&&this.checkChanges){var ds=__px_alls(this)[this.dataSourceID];if(ds)ds.setClientChanged();}};PXGrid.prototype.onFieldChanged=function($V){this.onTextChanged($V);};PXGrid.prototype.handleEditorEvents=function(e){var se=__px(this).eventElem(e);var $b=(se&&se.editElem)?se.editElem.object:null;if($b==null)return;var $p=$b.column.level.grid,$E=$b.editor;switch(e.type){case "keydown":if(!$E.filterInlineKey(e))$p.handleEditorKeyDown(e);break;case "keypress":if(e.keyCode==9)__px(this).cancelEvent(e);break;case "mouseup":if($b.isCheckBox())$b.switchCheckState();if($E.elemFocus)$E.elemFocus.focus();__px(this).cancelEvent(e);if($E.editorType==PXEditorType.FocusDiv&&$b.column.viewLink)this.navigate($b.column.dataField,e);break;case "mousedown":if($E.editorType==PXEditorType.FocusDiv)__px(this).cancelEvent(e);break;case "focus":$p.postponeRowInit($b.row);break;}};PXGrid.handleEditorDropClose=function($V,e){var $b=$V.element.editElem;$b=($b!=null)?$b.object:null;if(e.complete&&($b instanceof PXGridCell)){var $K=$b.column.level.grid.handleEditorTabKey(e,true);if($K!=null){$K.activate();$K.scrollToView();var $p=$b.column.level.grid;$p.goneToNextCell=true;setTimeout(function(){$p.goneToNextCell=undefined;},10);}}};PXGrid.handleEditorDropOpen=function($V,e){var $b=$V.element.editElem;$b=($b!=null)?$b.object:null;if($b)$b.column.level.grid.postponeRowInit($b.row);};PXGrid.prototype.postponeRowInit=function($f){if($f.needInitialize){delete $f.needInitialize;if($f.level.autoInsert){$f.dataChanged=true;this.onTextChanged();};this.initNewRow($f);}};PXGrid.prototype.handleEditorKeyDown=function(e){var $N=e.keyCode,$K,$W;var ac=this.activeCell,ar=this.activeRow;var $E=ac.editor,$X=$E.element;var $Y=($X.tagName=="TEXTAREA");var $Z=($X.tagName=="SELECT");var $00=(ar.getStatus()==PXRowStatus.AddNew);var $d=new Object();$d.key=$N;if(this.fireEvent("editorKeyDown",e,$d)){__px(this).cancelEvent(e);return;};switch($N){case 76:if(this.activeCell.language&&e.ctrlKey&&e.shiftKey&&!e.altKey){this.endEdit(true,false);__px_cm(this).showLocalizePopup(this.dataSourceID,this.dataMember,this.activeCell.column.getKey(),this);__px(this).cancelEvent(e);};break;case 13:if(e.altKey){var $01=ar?ar.level:this.levels[0];if($01.allowFormEdit)this.showFormView();}else if(e.ctrlKey){if(!$Y){ar.commitCellChanges();if(!$00||ar.dataChanged)this.endEdit(false);}}else{if(!this.goneToNextCell){$K=this.handleEditorTabKey(e);}};break;case 115:var $01=ar?ar.level:this.levels[0];if($01.allowFormEdit){__px(this).cancelEvent(e);this.showFormView();};break;case 9:$K=this.handleEditorTabKey(e);break;case 27:var $b=ac.nearColumnCell();__px(this).cancelEvent(e);if(!ac.column.allowUpdate)this.endEdit(true);else{if(ac.dataChanged)ac.clearChanges(true);else{var $02=ac.getValue(),$03=ac.getEditorValue();var $P=ac.column.dataType;if(!NetType.equals($P,$02,$03)){ac.setEditorValue($02);if(!NetType.equals($P,$02,ac.getEditorValue()))this.endEdit(true);}else this.endEdit(true);}};if(this.activeCell==null)$K=$b;break;case 32:if(ac.isCheckBox()&&!ac.getReadOnly(true)){__px(this).cancelEvent(e);$E.setValue(!$E.getValue());ac.updateValue(undefined,ac.column.commitChanges);};break;case 38:if(!$Y&&!$Z&&!e.altKey)$W=ar.prevRow();break;case 40:if(!$Y&&!$Z&&!e.altKey){$W=ar.nextRow();if($W==null&&ar.level.allowAddNew){ar.commitCellChanges();if(!$00||ar.dataChanged)this.addNewRow(true);}};break;};if($K!=null&&$K!=ac){__px(this).cancelEvent(e);$K.activate();$K.scrollToView();}else if($W!=null&&$W!=ar){__px(this).cancelEvent(e);$W.activate();$W.scrollToView();if(this.editMode&&this.statHDiv.focus)this.statHDiv.focus();}};PXGrid.prototype.handleEditorTabKey=function(e,$04){var ac=this.activeCell,ar=this.activeRow,$K=ac;var $00=(ar.getStatus()==PXRowStatus.AddNew);var $05=(!ac.column.commitChanges||!ac.isValueChanged());do{$K=e.shiftKey?$K.prevCell():$K.nextCell();}while($K&&(($05&&$K.getReadOnly(true))||$K.column.skipTabs));if(!$K){var $f=e.shiftKey?ar.prevRow():ar.nextRow();if($04){$K=e.shiftKey?ac.prevCell():ac.nextCell();}else if($f){$K=e.shiftKey?$f.lastCell():$f.firstCell();}else if(ar.level.allowAddNew&&!e.shiftKey){ar.commitCellChanges();__px(this).cancelEvent(e);if(!$00||ar.dataChanged)this.addNewRow();}};return $K;};PXGrid.prototype.handleSearchEditor=function(e){var se=__px(this).eventElem(e);var $b=(se&&se.editElem)?se.editElem.object:null;if($b==null)return;var $p=$b.column.level.grid;switch(e.type){case "keydown":switch(e.keyCode){case 13:case 27:case 9:$p.endSearch(e.keyCode==27);$p.focus();__px(this).cancelEvent(e);break;case 33:case 34:$p.endSearch(true);$p.focus();__px(this).cancelEvent(e);(e.keyCode==34)?$p.pageDown():$p.pageUp();break;};break;}};PXGrid.prototype.update=function(){if(this.editMode)this.endEdit();var $n=this.getDataChanges();if($n){var $l=new Object();$l.ownerID=this.ID;var $m=Function.createDelegate(this,this.handleUpdate);__px_callback(this).execI(this,this.callbacks[1],$n,$m,$l);}};PXGrid.prototype.handleUpdate=function($o,$l){if($o){var $q=new PXXmlDoc("",$o),$r=$q.rootNode;var $p=__px_all(this)[$l.ownerID];if($r.getAttribute("Repaint")!=null)$p.processRepaintRows($q);else $p.processUpdate($q);if($p.refreshAfterUpdate){delete $p.refreshAfterUpdate;$p.refresh();}}};PXGrid.prototype.processUpdate=function($q){var $06=$q.rootNode.getElementsByTagName("Rows")[0];var $07=this.rows.xmlNode,$L=this.levels[0].columns;if($06){var $08,$09,$0a,$0b,$0c,$0d;var $t,$0e,status,$0f=0,$0g=0;for(var i=0;i<$06.childNodes.length;i++){$08=$06.childNodes[i];$0e=parseInt($08.getAttribute("i"));$09=$07.childNodes[$0e];$0b=$08.getAttribute("Error");status=parseInt($09.getAttribute("Status"));if(isNaN(status))status=PXRowStatus.NotSet;if($0b){$09.setAttribute("Error",$0b);if(status==PXRowStatus.Deleted)$09.setAttribute("Status",PXRowStatus.NotSet);};$0d=!!$0b;$0b=$08.getAttribute("Warning");if($0b)$09.setAttribute("Warning",$0b);$0b=$08.getAttribute("Info");if($0b)$09.setAttribute("Info",$0b);var $0h=new Object();for(var j=0;j<$08.childNodes.length;j++){var $b=$08.childNodes[j];$0h[$b.getAttribute("DataField")]=$b;};$0a=$09.getElementsByTagName("Cells")[0];for(var j=0;j<$L.length;j++){var $D=$L[j];var $0i=$0a.childNodes[$D.serverIndex];var $0j=$0h[$D.dataField];$0i.removeAttribute("Error");$0i.removeAttribute("Warning");if($0j){var $0k=$0j.getAttribute("ReadOnly");if($0k!=null)$0i.setAttribute("ReadOnly",$0k);$0b=$0j.getAttribute("Error");$0c=$0j.getAttribute("Warning");if($0b)$0i.setAttribute("Error",$0b);else if($0c)$0i.setAttribute("Warning",$0c);else{var v=$0j.getAttribute("Value"),t=$0j.getAttribute("Text");$0i.setAttribute("Value",(v!=null)?v:"");if(t!=null)$0i.setAttribute("Text",t);else $0i.removeAttribute("Text");}}};if($0d)continue;$t=parseInt($08.getAttribute("Affected"));if($t){var $0l=PXRowStatus.NotSet;if(status==PXRowStatus.Deleted){$0l=PXRowStatus.Unbound;$0f++;}else if(status==PXRowStatus.Inserted){$0g++;};$09.setAttribute("Status",$0l);}};this.setRowsCount(this.totalRowCount-$0f);this.repaint();}};PXGrid.prototype.updateRow=function($f){var status=$f.getStatus();var $0m=(!status||status==PXRowStatus.NotSet);if(!$0m){var $n=$f.getDataChangesXmlDoc(true).toString();var $m=Function.createDelegate(this,this.handleRowUpdate);var $l=new Object();$l.ownerID=this.ID;$l.row=$f;if(status==PXRowStatus.Deleted)$l.rowStatus=status;$l.getParamsFunc=PXGrid.getUpdateRowParams;$f.waitUpdate=true;__px_callback(this).execI(this,this.callbacks[1],$n,$m,$l);}};PXGrid.getUpdateRowParams=function($l){var $f=$l.row,status=$l.rowStatus;if(status==null)status=$f.isNew()?PXRowStatus.Inserted:PXRowStatus.Modified;$f.setStatus(status);return $f.getDataChangesXmlDoc(true).toString();};PXGrid.prototype.handleRowUpdate=function($o,$l){delete $l.row.waitUpdate;if(!$o)return;var $p=__px_all(this)[$l.ownerID];var $q=new PXXmlDoc("",$o),$r=$q.rootNode;var $08=$r.getElementsByTagName("Row")[0];var $s=$08?$08.getAttribute("Error"):null;var $d=new Object();$d.row=$l.row;$l.row.clearChanges(false);if(!$s&&$r.getAttribute("Repaint")!=null){var ar=$p.activeRow,$0n,$a=$l.row.level;var $0o=(ar&&ar.getStatus()==PXRowStatus.AddNew);if($0o&&ar.waitInitContext)$0n=ar.waitInitContext;$p.processRepaintRows($q);if($0o)try{if($0n)$a.initNewRow=false;var nr=$p.addNewRow();if($0n)$0n.row=nr;}finally{if($0n)$a.initNewRow=true;}}else if($08){$p.processRowUpdate($l.row,$08);if($s)$l.row.setError($s);$p.fireEvent("afterRepaintRow",null,$d);if($p.showFormAfterUpdate){$p.showFormAfterUpdate=false;$p.showFormView();}};if($p.updateHandler){$p.updateHandler($p.updateArgs);delete $p.updateHandler;delete $p.updateArgs;};this.showEmptyMessage(this.rows.items);};PXGrid.prototype.processRowUpdate=function($f,$08){var status=parseInt($08.getAttribute("Status"));var $t=parseInt($08.getAttribute("Affected"));switch(status){case PXRowStatus.Deleted:if($t){var ac=this.activeCell,$K;$K=(ac&&ac.row==$f)?ac.nearColumnCell():null;$f.remove();if($K)$K.activate();this.setRowsCount(this.totalRowCount-1);};break;case PXRowStatus.Inserted:if($t)this.setRowsCount(this.totalRowCount+1);$f.clearErrors();$f.commitServerChanges($08);break;case PXRowStatus.Modified:$f.clearErrors();$f.commitServerChanges($08);break;};var $0p=$08.getAttribute("Warning");if($0p)$f.setWarning($0p);var $0q=$08.getAttribute("Info");if($0q)$f.setInfo($0p);if($t){if(status!=PXRowStatus.Deleted)$f.clearStatus(false);this.raiseDBEvent($f,status,true);}};PXGrid.prototype.refetchRow=function($f){var $l=new Object();$l.ownerID=this.ID;$l.row=$f;var $m=Function.createDelegate(this,this.handleRowRefetch);var $n=$f.getValuesXmlDoc(true).toString();$f.clearManualInputFlag();$f.waitRefetch=true;__px_callback(this).execI(this,this.callbacks[2],$n,$m,$l);};PXGrid.prototype.handleRowRefetch=function($o,$l){delete $l.row.waitRefetch;if(!$o)return;var $p=__px_all(this)[$l.ownerID],$f=$l.row;var $q=new PXXmlDoc("",$o),$r=$q.rootNode;var $s=$r.getAttribute("Error"),$0p=$r.getAttribute("Warning");;var $d=new Object();$d.row=$f;if(!$s&&$r.getAttribute("Repaint")!=null){$f.dataChanged=false;$p.processRepaintRows($q);}else{$f.clearErrors();$f.commitServerChanges($r,true);if($s)$f.setError($s);else if($0p)$f.setWarning($0p);var $t=parseInt($r.getAttribute("Affected"));if($t){$f.clearChanges(false);$f.clearStatus(false);};$p.fireEvent("afterRepaintRow",null,$d);}};PXGrid.prototype.raiseDBEvent=function($f,status,$0r){var $d=new Object(),ev;$d.row=$f;switch(status){case PXRowStatus.Modified:ev=$0r?"afterRowUpdate":"beforeRowUpdate";break;case PXRowStatus.Inserted:ev=$0r?"afterRowInsert":"beforeRowInsert";break;case PXRowStatus.Deleted:ev=$0r?"afterRowDelete":"beforeRowDelete";break;};if(this.fireEvent(ev,null,$d))return false;return true;};


PXGrid.prototype.showNote=function(){var ar=this.activeRow;if(ar){if((ar.noteText==undefined&&ar.hasNote())||this.noteBox==null){var $a=this.callbacks[4];if(this.getCommandState(this,$a.name).getEnabled()){var $b=new Object();$b.id=this.ID;$b.row=ar;__px_callback(this).execI(this,$a,"",Function.createDelegate(this,this.processNoteShow),$b);}}else if(this.noteBox){this.noteBox.setText(ar.getNoteText());this.noteBox.show();this.noteBox.elemText.setSelectionRange(10000,10000);}}};PXGrid.prototype.saveNote=function($c){var $a=this.callbacks[5],$b=new Object();$b.id=this.ID;$b.text=$c;$b.row=this.activeRow;__px_callback(this).execI(this,$a,$c,PXGrid.processNoteSave,$b);};PXGrid.prototype.processNoteShow=function($d,$b){if($d){var $e=__px_all(this)[$b.id],$f=$b.row,me=this;var $g=new PXXmlDoc("",$d),$h=$g.rootNode;var $i=$e.noteBox;if($h.childNodes.length>0){__px_cm(this).processHtmlData($h.childNodes[0].nodeValue);setTimeout(function(){me.initNoteBox($e,$f);},0);}else if($i){$i.setText($h.getAttribute("Note"));$f.setNoteText($i.getText());$i.show();$i.elemText.setSelectionRange(10000,10000);}}};PXGrid.prototype.initNoteBox=function($e,$f){var $i=$e.noteBox=__px_all(this)[$e.ID+"_ib"];if($i){$i.$0q=$e;$i.events.addEventHandler("afterHide",PXGrid.$0r);$e.viewState.update("InputBox",true);$f.setNoteText($i.getText());$i.show();this.noteBox.elemText.setSelectionRange(10000,10000);}};PXGrid.$0r=function($i){var $d=$i.dialogResult;if($d==1){$i.$0q.saveNote($i.getText());}};PXGrid.processNoteSave=function($d,$b){var $f=$b.row;if($f)$f.setNoteText($b.text);};PXGrid.prototype.showFiles=function(){var ds=__px_alls(this)[this.dataSourceID],ar=this.activeRow;if(ds!=null&&ar!=null){if(this.attachArgs==null)this.attachArgs="AttachEntity;"+this.ID;if(this.attachHandle==null)this.attachHandle=Function.createDelegate(this,this.showFilesCallback);if(ds.saveCommandName){var $j=ds.getCommandState(this,ds.saveCommandName);if(!ar.hasFiles()||$j.getEnabled()){ds.events.addEventHandler("commandPerformed",this.attachHandle);ds.executeCommand(ds.saveCommandName,this.attachArgs);}else this.showFilesInternal();}else this.showFilesInternal();}};PXGrid.prototype.showFilesCallback=function($k,$b){var ds=__px_alls(this)[this.dataSourceID];ds.events.removeEventHandler("commandPerformed",this.attachHandle);if($b.commandArg==this.attachArgs&&!$b.alert&&!ds.alert)this.showFilesInternal();};PXGrid.prototype.showFilesInternal=function(){if(this.filesBox==null){if(this.fileDialogId)this.filesBox=__px_all(this)[this.fileDialogId];if(this.filesBox!=null){var $l=this;this.uplComplete=Function.createDelegate(this,function(){$l.refresh()});this.filesBox.events.addEventHandler("afterUpload",this.uplComplete);this.filesboxHidden=Function.createDelegate(this,function(){delete $l.filesBox.dataMember;});this.filesBox.events.addEventHandler("afterHide",this.filesboxHidden);this.filesBox.show();}else{__px_callback(this).execI(this,this.callbacks[8],"",Function.createDelegate(this,this.processFilesShow));}}else this.showFilesBox();};PXGrid.prototype.showFilesBox=function(){this.filesBox.dataMember=this.dataMember;this.filesBox.show();this.filesBox.autoRepaint=false;};PXGrid.prototype.processFilesShow=function($d,$b){if($d){__px_cm(this).processHtmlData($d);var me=this;setTimeout(function(){me.initFilesDialog();},0);}};PXGrid.prototype.initFilesDialog=function($m){this.filesBox=__px_all(this)[this.ID+"_fb"];if(this.filesBox){var h=Function.createDelegate(this,this.uploadFileComplete);this.filesBox.events.addEventHandler("afterUpload",h);this.showFilesBox();}};PXGrid.prototype.uploadFileComplete=function($k,$n){var ar=this.activeRow;if(ar){ar.setHasFiles(true);ar.repaint();}};PXGrid.prototype.showFilterDialog=function($o,$p){var $q=($p&&this.tlbFilters)?this.tlbFilters.items[$o.getKey()]:null;if(this.filterDialog==null){var $r={'col':$o,'btn':$q,'fromFilterBar':$p};__px_callback(this).execI(this,this.callbacks[12],"",Function.createDelegate(this,this.processFilterDialogShow),$r);}else{if($p==null)$p=this.hasQuickFilters();this.filterDialog.setFilterState($o,$p);this.filterDialog.linkedBtn=$q;this.filterDialog.show($q?$q.element:$o.statHeaderElem);}};PXGrid.prototype.processFilterDialogShow=function($d,$b){if($d){__px_cm(this).processHtmlData($d);var me=this;setTimeout(function(){me.initFilterDialog($b);},0);}};PXGrid.prototype.initFilterDialog=function($b){this.filterDialog=__px_all(this)[this.ID+"_fd"];if(this.filterDialog){this.filterDialog.events.addEventHandler("afterHide",Function.createDelegate(this,this.onFilterDialogHide));if(this.fireEvent("filterDialogCreated",this)){__px(this).cancelEvent(e);return;};this.showFilterDialog($b.col,$b.fromFilterBar);}};PXGrid.prototype.onFilterDialogHide=function($m,$n){if($m.dialogResult==PXDialogResult.OK){var $o=$m.linkedCol,$q=$m.linkedBtn;var $s=$m.getFilterCondition();if(!$m.fromFilterBar){$o.filter=$s;$o.repaintDataImage();this.storeColumnsFilter();this.refresh();}else{this.updateQuickFilter($o.getKey(),$s);}}};PXGrid.prototype.storeColumnsFilter=function(){var $t=this.levels[0];this.viewState.removeNode("FilterRows");for(var i=0;i<$t.columns.length;i++){var $o=$t.getColumn(i),$s=$o.filter;var $u=$s&&$s.condition;if($u){var $v=$o.dataField;if($o.textField)$v=($o.displayMode>0)?$o.textFieldColumn:$o.textField;this.updateFilterRow(i,"DataField",$v);this.updateFilterRow(i,"Condition",($u=="True"||$u=="False")?"EQ":$u);if($s.value!=null)this.updateFilterRow(i,"Value",$s.value);if($s.value2!=null)this.updateFilterRow(i,"Value2",$s.value2);if($o.statHeaderElem)$o.statHeaderElem.setAttribute("data-filter",1);}else{if($o.statHeaderElem)$o.statHeaderElem.removeAttribute("data-filter");}}};PXGrid.prototype.updateFilterRow=function($w,name,$x){this.viewState.updateListItem("FilterRows",$w,name,$x);};PXGrid.prototype.createColumnFilter=function(){var ac=this.activeCell;if(ac){var $y=ac.getDataType(true),$o=ac.column,$z=$o.getFormEditor(false);var $A=($z&&$z.__className=="PXDropDown")?$z.items:$o.valueItems;var $u=($y==NetType.String||$o.textField)?"LIKE":"EQ",$B=false;var $C=$o.textField?ac.getText():ac.getValue();if($C==null)$u="ISNULL";var $s=this.hasQuickFilters()?this.getQuickFilter($o.getKey()):$o.filter;if($s&&$s.condition==$u&&__px(this).equals($o.getTypedValue($s.value),$C)){$B=true;};$s=new Object();$s.condition=$u;var $x=($y==NetType.DateTime)?ac.getTypedValue(ac.getText()):ac.getValue();$s.value=$o.textField?ac.getText():__px(this).getInvariantText($x);if(this.filterNames)$s.condText=this.filterNames[PXCondition[$u]];if(this.hasQuickFilters()){if(!$B)this.updateQuickFilter($o.getKey(),$s);else this.removeQuickFilter($o.getKey());}else{if(!$B)$o.filter=$s;else $o.filter=null;$o.repaintDataImage();this.storeColumnsFilter();this.refresh();}}};PXGrid.prototype.getQuickFilter=function($D){if(this.quickFilters!=null&&$D){var $E=this.quickFilters;return $E.find(function(f){return $D.toLowerCase()==f.dataField.toLowerCase();});};return null;};PXGrid.prototype.isColumnHasFilter=function($D){if(this.hasQuickFilters())return this.getQuickFilter($D)!=null;var $o=this.levels[0].getColumn($D);return $o!=null&&$o.filter!=null;};PXGrid.prototype.addQuickFilter=function($D,$F,$s){if(this.tlbFilters==null)return;if(this.quickFilters==null)this.quickFilters=new Array();var $E=this.quickFilters,$G=this.getQuickFilter($D);var $w=$G?Array.indexOf($E,$G):null;if($w==null)$G={'dataField':$D};else $E.splice($w,1);if($s){$G.condition=$s.condition;$G.condText=$s.condText;$G.value=$s.value;$G.value2=$s.value2;};($F>=0)?$E.splice($F,0,$G):$E.push($G);this.applyQuickFilter();};PXGrid.prototype.updateQuickFilter=function($D,$s){if(this.quickFilters==null)this.quickFilters=new Array();var $E=this.quickFilters,$G=this.getQuickFilter($D);if($G){if($s){$G.condition=$s.condition;$G.condText=$s.condText;$G.value=$s.value;$G.value2=$s.value2;}else{delete $G.condition;$G.value=$G.value2=null;};this.applyQuickFilter();}else if($s)this.addQuickFilter($D,-1,$s);};PXGrid.prototype.removeQuickFilter=function($D){if(this.quickFilters==null)return;var $E=this.quickFilters,$G=this.getQuickFilter($D);if($G)$E.splice(Array.indexOf($E,$G),1);this.applyQuickFilter();};PXGrid.prototype.renderQuickFilters=function(){if(this.tlbFilters==null)return;var $E=this.quickFilters,$H=new Array(),$I=this.levels[0];if($E)for(var i=0;i<$E.length;i++){var f=$E[i],$o=$I.getColumn(f.dataField);if(!$o){$E.splice(i--,1);continue;};var $c=$o.getHeaderText().trim()+': ',$J='highlight',$K="<null>";var v1=f.value,v2=$o.getDisplayText($o.getTypedValue(f.value2,null,true)),me=this;if($o.valueItems&&v1){$L=v1.split(',').map(function(v){return v==$K?me.filterEmptyMsg:$o.getDisplayText(v,null,true);});v1=$o.valueItems.multiSelect&&f.condition=="LIKE"?$L.join(" or "):$L.join(',');}else if(v1)v1=$o.getDisplayText($o.getTypedValue(v1,null,true));if(!$o.valueItems)v1=v1?("'"+v1+"'"):'';v2=v2?("'"+v2+"'"):'';if(f.condition=="EQ"&&!f.value)f.condition=null;if(!f.condText)f.condText=f.condition;switch(f.condition){case "IN":$c+=v1;break;case "EQ":$c+='= '+v1;break;case "NE":$c+='!= '+v1;break;case "GT":$c+='> '+v1;break;case "LT":$c+='< '+v1;break;case "GE":$c+='>= '+v1;break;case "LE":$c+='<= '+v1;break;default:if(f.condition){var $M=f.condition=="BETWEEN"?'':f.condText;$c+=$M+' '+v1+(v2?(' - '+v2):'');}else{$c+=this.filterAllMsg;$J=null;};break;};$H.push({'type':PXToolBarButton.prototype.type,'key':$o.getKey(),'text':$c,'menuButton':true,'css':$J});};this.tlbFilters.items=$H;var $N=$E!=null&&$E.length>0;this.tlbFilters.render();this.tlbFilterTools.items[0].setVisible(!$N);this.tlbFilterTools.items[1].setVisible($N);__px_cm(this).notifyOnResize();var tm=__px_tm(this);this.tlbFilters.items.map(function(b){tm.registerOverflowTip(b.mainCell,true);});};PXGrid.prototype.storeQuickFilterState=function(){var $E=this.quickFilters;this.clearQuickFilterState();if($E)for(var i=0;i<$E.length;i++){var $s=$E[i],$u=$s&&$s.condition;this.updateQuickFilterRow(i,"DataField",$s.dataField);this.updateQuickFilterRow(i,"Condition",($u=="True"||$u=="False")?"EQ":$u);if($s.value!=null)this.updateQuickFilterRow(i,"Value",$s.value);if($s.value2!=null)this.updateQuickFilterRow(i,"Value2",$s.value2);}};PXGrid.prototype.updateQuickFilterRow=function($w,name,$x){this.viewState.updateListItem("QuickFilters",$w,name,$x);};PXGrid.prototype.clearQuickFilterState=function(){this.viewState.removeNode("QuickFilters");};PXGrid.prototype.saveAsFilter=function($O){$O=!!$O;var me=this,$P=this.pnlSaveFilter;if($P==null){this.pnlSaveFilter=$P=__px_all(this)[this.ID+"_pnlSaveF"];var $Q=__px_all(this)[$P.ID+"_btnSave"];var $R=__px_all(this)[$P.ID+"_edName"];var $S=__px_all(this)[$P.ID+"_chkShared"];var $T=__px_all(this)[$P.ID+"_chkPivot"];var $U=Function.createDelegate(this,function(e){var $V=!!$R.elemText.value;$Q.setEnabled($V);});__px(this).addEventHandler($R.element,"input",function(e){$U();});this.pnlSaveFilter.events.addEventHandler("beforeShow",Function.createDelegate(this,function($k,ev){$S.setEnabled(this.isFilterEditable&&this.isSharedFilterEditable);$S.setValue(this.isFilterShared&&this.isSharedFilterEditable);$R.setValue(this.hasNoFilterID()?"":this.getFilterName());$T.setValue(this.getPivotID()!=null||$P.saveAsPivot);setTimeout(function(){$U();},0);}));this.pnlSaveFilter.events.addEventHandler("afterHide",Function.createDelegate(this,function($k,ev){if($k.dialogResult==PXDialogResult.OK){if(this.hasNoFilterID())delete this.quickFiltersA;var $W=this.isFilterEditable&&$S.getChecked();var $X=[1,$W?1:0,$R.getValue(),$T.getChecked()?1:0];this.commitQuickFilter($X.join('|'),$T.getChecked());}}));};if($P){$P.saveAsPivot=$O;$P.show();}};PXGrid.prototype.saveFilter=function(){if(this.isFilterEditable){var pt=this.filterPivots,$Y=(this.getPivotID()!=null);var $X=[0,this.isFilterShared?1:0,this.getFilterName(),$Y?1:0];this.commitQuickFilter($X.join('|'));}};PXGrid.prototype.commitQuickFilter=function($X,$Z){var $00=__px_callback(this).createCommand(PXGridCommand.FilterSave,true,false,false,false);var $01=this.filterID==null||this.filterID==-1;var $02=Function.createDelegate(this,function($d,$b){if($d)this.processRefresh($d,true);this.clearQuickFilterState();if(this.filterBox){if(this.isFilterShared)this.filterBox.addSharedFilter(this.filterID);else this.filterBox.removeSharedFilter(this.filterID);if($01&&this.filterBox.getFilterID()==-1)this.filterBox.clear();};delete this.quickFilterChaged;if($Z){this.setPivotID(this.getPivotID());this.showPivotEditor();};this.notifyCommandState();});if($Z)this.setPivotID(null);this.storeQuickFilterState();__px_callback(this).execI(this,$00,$X?$X:"",$02);};PXGrid.prototype.applyQuickFilter=function(){this.renderQuickFilters();this.quickFilterChaged=true;this.notifyCommandState();if(this.isPivotVisible())this.pivotTable.setReload(true);if(this.hasNoFilterID()){this.storeQuickFilterState();this.refreshSilent();}else this.commitQuickFilter();};PXGrid.prototype.removeFilter=function($03){var $04=true;try{$04=confirm(this.filterRemoveMsg);}catch(ex){$04=true;};if(!$04)return;var $00=__px_callback(this).createCommand(PXGridCommand.FilterRemove,true,false,false,false);var $02=Function.createDelegate(this,function($d,$b){if($d)this.processRefresh($d,true);this.notifyCommandState();});__px_callback(this).execI(this,$00,"",$02);};PXGrid.prototype.showFilter=function($05){if(!this.externalFilter&&this.allowFilter){if(this.filterBox==null){var $a=this.callbacks[6];if(this.getCommandState(this,$a.name).getEnabled()){var $b=new Object();$b.id=this.ID;$b.appendNewRow=$05;__px_callback(this).execI(this,$a,"",Function.createDelegate(this,this.processFilterShow),$b);}}else{this.filterBox.setFilterID(this.filterID==null?-1:this.filterID);this.filterBox.show();if($05){if(__px_callback(this).waitCallback)__px(this).registerCallbackTask(this,this.appendFilterRow);else this.appendFilterRow();}}}};PXGrid.prototype.setFilter=function($06){if(this.allowFilter){this.setPageIndex(0);this.setFilterActive($06);this.refresh(null,true);}};PXGrid.prototype.setFilterID=function(id){var $07=(this.filterID!=id);if($07){delete this.quickFilters;delete this.quickFilterChaged;};this.filterID=id?id:null;this.viewState.update("FilterID",id?id:"");if($07){delete this.pivotID;this.setPivotID(this.getPivotID());}};PXGrid.prototype.getFilterID=function(){if(this.filterID)return this.filterID;return null;};PXGrid.prototype.hasNoFilterID=function(){return this.filterID==null||this.filterID<0;};PXGrid.prototype.getFilterActive=function(){return this.filterActive;};PXGrid.prototype.setFilterActive=function($06){var $08=this.getMenuItem(PXGridCommand.FilterSet);if($08)$08.setChecked($06);if(this.btnFilterSet)this.btnFilterSet.setPushed($06);this.updateFilterUI($06?this.getFilterID():null);this.filterActive=$06;this.viewState.update("FilterActive",Boolean($06));};PXGrid.prototype.updateFilterUI=function($03){if(this.cmbFilter){var $09=this.cmbFilter.element;this.cmbFilter.setValue($03==null?-1:$03);}else if(this.tlbFilterTabs){var $E=this.tlbFilterTabs.items,$0a;if($03!=null)for(var i=2;i<$E.length;i++){if($E[i].key==$03){$E[i].setPushed($0a=true);break;}};if(!$0a)$E[1].setPushed(true);}};PXGrid.prototype.getFilterUI=function(){if(this.tlbFilterTabs){var $E=this.tlbFilterTabs.items;for(var i=2;i<$E.length;i++){var $G=$E[i];if($G.getPushed&&$G.key&&$G.getPushed())return parseInt($G.key);}}else if(this.cmbFilter)return this.cmbFilter.getValue();};PXGrid.prototype.setIsFilterVisited=function($x){if($x==null||$x=="")this.viewState.remove("IsFilterVisited");else this.viewState.update("IsFilterVisited",$x);};PXGrid.prototype.getFilterName=function(){if(!this.filterID)return "";if(this.cmbFilter){return this.cmbFilter.getDisplayText(this.cmbFilter.getValue());}else if(this.tlbFilterTabs){var $E=this.tlbFilterTabs.items;for(var i=2;i<$E.length;i++)if($E[i].key==this.filterID)return $E[i].getText().trim();};return "";};PXGrid.prototype.setFastFilter=function($x){if($x==null||$x=="")this.clearFastFilter();else{this.viewState.update("FastFilter",$x);if(this.filterBar)this.filterBar.setValue($x);};this.repaintFastFilter();};PXGrid.prototype.getFastFilter=function(){return this.viewState.select("FastFilter");};PXGrid.prototype.clearFastFilter=function(){if(this.filterBar!=null)this.filterBar.setValue("");this.viewState.remove("FastFilter");this.repaintFastFilter();};PXGrid.prototype.repaintFastFilter=function(){var fb=this.filterBar;if(fb!=null)__px(this).toggleCss(!!fb.getValue(),fb.element,["highlight"],true);};PXGrid.prototype.processFilterShow=function($d,$b){if($d){var $e=__px_all(this)[$b.id],$g=new PXXmlDoc("",$d);var $X=$g.rootNode.getAttribute("Filter"),me=this;if($X){__px_cm(this).processHtmlData(unescape($X));setTimeout(function(){me.showFilterTimeout($e.ID,$b.appendNewRow);},0);}}};PXGrid.prototype.showFilterTimeout=function(id,$05){var $e=__px_all(this)[id],$s=__px_all(this)[id+"_fe"];if($e&&$s){$e.filterBox=$s;$s.filteredGrid=$e;var ds=__px_alls($e)[$e.dataSourceID];if(ds){ds.events.addEventHandler("keyChanged",function($k,$n){$s.refreshRequired=true;});};var h=Function.createDelegate($e,$e.onFilterBoxHide);$s.events.addEventHandler("afterHide",h);$s.show();if($05)$e.appendFilterRow();}};PXGrid.prototype.onFilterBoxHide=function(fb){var $E=fb.getFilterItems(),me=this;if(this.dynamicFilters){for(var i=0;i<this.dynamicFilters.length;i++)$E.push(this.dynamicFilters[i]);};var ok=(fb.dialogResult==PXDialogResult.OK);this.waitFilterSet=true;setTimeout(function(){delete me.waitFilterSet;},1);this.setIsFilterVisited(true);if(ok){var $03=fb.getFilterID();if($03==null&&fb.hasFilter())$03=-1;if(fb.isDirty)this.fillFilterItems($E,$03);if(this.isPivotVisible())this.pivotTable.setReload(true);this.selectFilter($03);}else{var $0b=this.getFilterUI();if(fb.isDirty)this.fillFilterItems($E,this.getFilterID());var $0c=this.getFilterUI();if($0c!=$0b)this.selectFilter($0c);};this.focus();};PXGrid.prototype.fillFilterItems=function($E,$0d){var $0e=this.cmbFilter,$0f=this.tlbFilterTabs;if($0e){$0e.setItems($0e.items.slice(0,1));if($E)for(var j=0;j<$E.length;j++){$0e.addItemByValues($E[j][0],$E[j][1]);}}else if($0f){while(!this.isFilterBarEmpty())$0f.removeItem(2);if($E){var $0g=$0f.items["edit"];for(var j=0;j<$E.length;j++){var $G=$0f.createButton($0g.index,$E[j][1],null,true,"1");$G.key=$E[j][0];}};this.setFilterSelectorVisibility();if($0f.getVisible())$0f.arrangeOverflowItems();};this.updateFilterUI($0d);};PXGrid.prototype.appendFilterRow=function(){var ac=this.activeCell,fb=this.filterBox;if(ac&&fb){var $y=ac.getDataType(true),$o=ac.column;var $u=($y==NetType.String||$o.textField)?"LIKE":"EQ";fb.addRow($o.dataField,$u,$o.textField?ac.getText():ac.getValue());}};PXGrid.prototype.showColumnsDialog=function(){if(this.columnsDialog==null){__px_callback(this).execI(this,this.callbacks[13],"",Function.createDelegate(this,this.processColumnsDialogShow));}else{this.columnsDialog.fullColumns(this);this.columnsDialog.skipChanged=undefined;this.columnsDialog.show();}};PXGrid.prototype.processColumnsDialogShow=function($d,$b){if($d){__px_cm(this).processHtmlData($d);var me=this;setTimeout(function(){me.initColumnsDialog();},0);}};PXGrid.prototype.initColumnsDialog=function(){this.columnsDialog=__px_all(this)[this.ID+"_cd"];if(this.columnsDialog){this.columnsDialog.fullColumns(this);this.columnsDialog.skipChanged=undefined;this.columnsDialog.show();var h=Function.createDelegate(this,this.onColumnsDialogHide);this.columnsDialog.events.addEventHandler("afterHide",h);}};PXGrid.prototype.onColumnsDialogHide=function($m,$n){var $0h=$m.dialogResult==PXDialogResult.Yes,me=this;if($m.dialogResult==PXDialogResult.OK||$0h){this.endEdit();setTimeout(function(){if(__px_callback(me).waitCallback)__px(me).registerCallbackTask(me,me.afterColumnsDialogHide,$m);else me.afterColumnsDialogHide($m);},1);}};PXGrid.prototype.afterColumnsDialogHide=function($m){var $0h=$m.dialogResult==PXDialogResult.Yes;var $0i=$m.getColumns(),$t=this.levels[0],$07=this.columnsDialog.skipChanged,$0j;this.suppressRepaint=true;try{var $0k=new Array();for(var i=0;i<$t.columns.length;i++){var $o=$t.getColumn(i),$D=$o.getKey();var $0l=Array.contains($0i,$D),$w=Array.indexOf($0i,$D);if($o.allowShowHide!=1)$0l=$o.getVisible();if($o.getVisible()!=$0l){$o.setVisible($0l,true);$07=true;if(this.restrictFields&&$0l&&!$o.dataLoaded){$o.dataLoaded;$0j=true;}};if($0l&&$o.getVisibleIndex()!=$w){var $0m=new Object();$0m.col=$o;$0m.index=$w;$0k.push($0m);$07=true;}};var $0n=0;for(var i=0;i<$t.columns.length;i++){var $o=$t.columns[i];if($o.allowShowHide==1||$o.getVisible())break;else $0n++;};$0k.sort(function(a,b){return a.index-b.index;});for(var i=0;i<$0k.length;i++){var $0o=$0p==0&&$0n>0;var $0p=$0k[i].index+($0o?$0n:0);$t.moveColumn($0k[i].col.index,$0p,$0o?false:true);}}finally{this.suppressRepaint=false;if($07)this.repaint();};if($07){$0j?this.refresh():this.repaint();if(!$0h)this.layoutChanged=true;};if($0h&&($07||this.layoutChanged||$m.needReset)){if($m.needReset){if(this.layoutLoaded){this.resetLayout();delete $m.needReset;}}else this.saveLayout();}else if($m.needReset)$m.resetColumnsWidth(this);}


function PXGridLevel($a,$b,$c,$d){this.grid=$a;this.index=$b;this.xmlNode=$d;this.props=$c;this.px_context=$a.px_context;this.$0x($c);this.createColumns();var rs=this.rowSelectorsVisible;if(this.index==0)this.firstColumnCell=rs?1:0;else this.firstColumnCell=rs?2:1;this.navigator=new PXGridNavigator(this);};PXGridLevel.levelModeDesc=[["allowAddNew",JSType.Bool,true],["allowUpdate",JSType.Bool,true],["allowDelete",JSType.Bool,true],["allowFormEdit",JSType.Bool,false],["allowSort",JSType.Bool,true],["allowColSizing",JSType.Bool,true],["allowRowSizing",JSType.Bool,false],["allowRowSelect",JSType.Bool,true],["allowDragRows",JSType.Bool,false],["allowColMoving",JSType.Bool,true],["allowExpand",JSType.Bool,false],["headerClickAction",JSType.Int,2],["initNewRow",JSType.Bool,false],["autoInsert",JSType.Bool,false],["autoInsertField",JSType.String,""],["inplaceInsert",JSType.Bool,false]];PXGridLevel.callbackProps=[["allowAddNew",JSType.Bool,true],["allowUpdate",JSType.Bool,true,"setAllowUpdate"],["allowDelete",JSType.Bool,true],["allowSort",JSType.Bool,true],["footerVisible",JSType.Bool,false,"setFooterVisible"],["isUploadEnabled",JSType.Bool,true],["allowSkipTab",JSType.Bool,true]];PXGridLevel.prototype.setFooterVisible=function(v){if(this.index==0&&this.grid.statFDiv)this.grid.statFDiv.style.display=v?"":"none";};PXGridLevel.prototype.dispose=function(){delete this.xmlNode;delete this.px_context;delete this.editForm;delete this.formView;if(this.navigator){this.navigator.dispose();delete this.navigator;};delete this.grid;delete this.columns;};PXGridLevel.prototype.onLoad=function(){var id=this.grid.ID,i=this.index,$e=id+"_lv"+i;var $f=__px_all(this)[$e];if(!$f)$f=__px_cm(this).createControl("PXFormView",$e);if($f)$f.postVisibleOnly=true;if(!this.allowFormEdit)return;this.editForm=__px(this).elemByID(id+"_lf"+i);this.formView=$f;this.allowFormEdit=(this.editForm!=null&&this.formView!=null);if(this.allowFormEdit){__px_data(this)[$e]=this.formView;this.formView.callbacks[2]=this.grid.callbacks[1];var h=Function.createDelegate(this.grid,this.grid.handleFormRepaint);this.formView.events.addEventHandler("afterRepaint",h);h=Function.createDelegate(this.grid,this.grid.handleFormKeyDown);this.formView.events.addEventHandler("keyDown",h);var $g=["Close","First","Prev","Next","Last"];h=Function.createDelegate(this.grid,this.grid.handleFormButtonClick);for(var j=0;j<$g.length;j++){var $h=__px_cm(this).createControl("PXButton",id+"_lf"+$g[j]+i);if($h)$h.events.addEventHandler("click",h);};this.editForm.level=this;this.formView.gridMode=true;}};PXGridLevel.prototype.isDataKey=function($i){if(this.dataKey!=null){var $j=this.dataKey.length;var $k=$i.toLowerCase();for(var i=0;i<$j;i++)if(this.dataKey[i].toLowerCase()==$k)return true;};return false;};PXGridLevel.prototype.getAllowDragRows=function(){return this.allowDragRows&&this.allowDelete;};PXGridLevel.prototype.$0x=function($c){__px_cm(this).readProperties(this,$c.mode,PXGridLevel.levelModeDesc);this.nullText=$c.nullText;if($c.dataKey)this.dataKey=$c.dataKey.split(",");if(!this.allowColSizing&&!this.allowColMoving)this.grid.autoSaveLayout=false;var la=this.xmlNode.getElementsByTagName("Layout")[0];var $l=la.getAttribute("HighlightMode"),$m="True";this.footerVisible=la.getAttribute("FooterVisible")==$m;this.headerVisible=la.getAttribute("HeaderVisible")==$m;this.showRowStatus=la.getAttribute("ShowRowStatus")==$m;this.rowSelectorsVisible=la.getAttribute("RowSelectorsVisible")==$m;this.rowSelectorsWidth=la.getAttribute("RowSelectorsWidth");this.levelIndent=la.getAttribute("LevelIndent");this.highlightCell=($l!="Row");this.highlightRow=($l=="Row"||$l=="Both");var im=this.xmlNode.getElementsByTagName("Images")[0];this.images=new Object();this.images.gridCorner=im.getAttribute("GridCorner");this.images.rowLabel=im.getAttribute("RowLabel");this.images.collapse=im.getAttribute("Collapse");this.images.expand=im.getAttribute("Expand");this.images.currentRow=im.getAttribute("CurrentRow");this.images.editRow=im.getAttribute("EditRow");this.images.newRow=im.getAttribute("NewRow");this.images.sortAsc=im.getAttribute("SortAsc");this.images.sortDesc=im.getAttribute("SortDesc");this.images.arrowDown=im.getAttribute("ArrowDown");this.images.arrowUp=im.getAttribute("ArrowUp");this.images.checked=im.getAttribute("Checked");this.images.unChecked=im.getAttribute("Unchecked");this.images.deletedRow=im.getAttribute("DeletedRow");this.images.modifiedRow=im.getAttribute("ModifiedRow");this.images.insertedRow=im.getAttribute("InsertedRow");this.images.rowError=im.getAttribute("RowError");this.images.rowWarning=im.getAttribute("RowWarning");this.images.rowNote=im.getAttribute("RowNote");this.images.rowNoteEmpty=im.getAttribute("RowNoteEmpty");this.images.rowFile=im.getAttribute("RowFile");this.images.rowFileEmpty=im.getAttribute("RowFileEmpty");this.images.rowInfo=im.getAttribute("RowInfo");this.images.search=im.getAttribute("Search");this.images.filter=im.getAttribute("Filter");this.images.filterSortAsc=im.getAttribute("FilterSortAsc");this.images.filterSortDesc=im.getAttribute("FilterSortDesc");for(var n in this.images){if(this.images[n]&&this.images[n].indexOf('@')<0){var im=new Image();im.src=this.images[n];}};var st=this.xmlNode.getElementsByTagName("Styles")[0];this.styles=new Object();this.styles.row=st.getAttribute("Row");this.styles.altRow=st.getAttribute("AltRow");this.styles.selRow=st.getAttribute("SelRow");this.styles.activeCell=st.getAttribute("ActiveCell");this.styles.activeRow=st.getAttribute("ActiveRow");this.styles.error=st.getAttribute("Error");this.styles.warning=st.getAttribute("Warning");this.styles.readOnlyCell=st.getAttribute("ReadOnlyCell");this.styles.header=st.getAttribute("Header");this.styles.footer=st.getAttribute("Footer");this.styles.selHeader=st.getAttribute("SelHeader");this.styles.selFooter=st.getAttribute("SelFooter");this.styles.cellEditor=st.getAttribute("CellEditor");this.styles.editorText=st.getAttribute("EditorText");this.styles.cellButton=st.getAttribute("CellButton");this.styles.rowSelector=st.getAttribute("RowSelector");};PXGridLevel.prototype.repaint=function(){if(this.grid.suppressRepaint)return;this.grid.storePosition();this.grid.checkRowChanges(this.index);var $n=this.grid.ID+"_dataT"+this.index;var $o=__px(this).elemsByName($n,true);for(var i=$o.length-1;i>=0;i--){var ro=$o[i].object;if(ro&&(ro instanceof PXGridRows))ro.repaint();};this.grid.restorePosition();};PXGridLevel.prototype.createColumns=function($c,$d){var $p=($c!=null);if($c!=null)this.props.columns=$c;if($d!=null)this.grid.xmlDocObject.replaceNode($d,this.xmlNode);var $q=new Object();if(this.columns)for(var i=0;i<this.columns.length;i++){var $r=this.columns[i];if($r.filter)$q[$r.dataField]=$r.filter;};this.columns=new Array();var $s=this.xmlNode.getElementsByTagName("Columns")[0];if(this.props.columns)for(var i=0;i<this.props.columns.length;i++){var p=this.props.columns[i],$t=$s.childNodes[i];this.columns[i]=new PXGridColumn(this,i,p,$t);if($q[p.dataField])this.columns[i].filter=$q[p.dataField];};if($p&&this.colsMenu!=null){this.$0y();for(var i=0;i<this.columns.length;i++)this.columns[i].syncColumnsMenuState();};if($p)this.grid.restoreHeight();};PXGridLevel.prototype.setColumnsOrder=function($u){var ar=$u.split(",");for(var i=0;i<ar.length;i++){var $r=this.getColumn(ar[i]);if($r)$r.setServerIndex(i);}};PXGridLevel.prototype.getColumn=function($v){if(typeof($v)=="number")return this.columns[$v];var $r=null;for(var i=0;i<this.columns.length;i++)if(String.compare(this.columns[i].getKey(),$v,true)){$r=this.columns[i];break;};return $r;};PXGridLevel.prototype.getVisibleColsCount=function(){var $w=0,$x=this.columns;for(var i=0;i<$x.length;i++){if($x[i].getVisible())$w++;};return $w;};PXGridLevel.prototype.getColumnKeys=function(){var ar=new Array();for(var i=0;i<this.columns.length;i++){var $r=this.columns[i];var $v=$r.dataField?$r.dataField:$r.key;if($v)ar[ar.length]=$v;};return ar;};PXGridLevel.prototype.setAllowUpdate=function($y){this.allowUpdate=Boolean($y);this.xmlNode.setAttribute("AllowUpdate",__px(this).getInvariantText(this.allowUpdate));};PXGridLevel.prototype.adjustEditFormSize=function(){if(this.editForm!=null){var $z=this.editForm,$f=this.formView;var c1=$z.rows[0].cells[0],c2=$z.rows[1].cells[0];c1.style.height="10px";$f.setHeight(10);var h=__px(this).getStyleHeight($z.parentNode);c1.style.height=(h-c2.offsetHeight)+"px";__px_cm(this).performAutoSize($f);}};PXGridLevel.prototype.moveColumn=function($b,$A,$B){var $x=this.columns,$C=$x.length-1;if($b<0||$b>$C)return;if($A<0||$A>$C||$A==$b)return;if($B){for(var i=0,j=0,$D=0;i<$x.length&&j<$A;i++)if($x[i].getVisible())j++;else $D++;$A+=$D;};if($A==$b)return;var uh=Function.createDelegate2(this,this.moveColumn);if(!this.grid.suppressRepaint&&this.grid.checkRowChanges(this.index,uh,[$b,$A]))return;var $E=($b<$A)?$x[$A+1]:$x[$A];var $F=$E?this.firstColumnCell+$E.index:-1;var $r=this.columns[$b],$G;if($r.getVisible()){if($E)$G=$E.getVisibleIndex();else $G=this.getVisibleColsCount()-1;$G+=this.firstColumnCell;};if($r.statHeaderElem)this.$0z($r,$A,$F,$G,$r.statHeaderElem);if($r.statFooterElem)this.$0z($r,$A,$F,$G,$r.statFooterElem);var $H=$x.splice($b,1);$x.splice($A,0,$H[0]);var $s=$r.xmlNode.parentNode;if($E)$s.insertBefore($r.xmlNode,$E.xmlNode);else $s.appendChild($r.xmlNode);this.$0A(true);this.repaint();this.grid.layoutChanged=true;if(this.grid.autoSaveLayout&&!this.grid.suppressRepaint&&!this.grid.editMode)this.grid.saveLayout();};PXGridLevel.prototype.$0z=function($r,$A,$F,$G,$I,$J){var $K=$I.cellIndex;if($r.getVisible()){var c=$r.getColFromCell($I),cg=c.parentNode;if($F<0)cg.appendChild(c);else{for(var i=0,j=0;i<cg.childNodes.length;i++)if(cg.childNodes[i].tagName=="COL"){if(j==$G)break;j++;};cg.insertBefore(c,cg.childNodes[i]);}};var $L=$I.parentNode;if($F<0)$L.appendChild($I);else $L.insertBefore($I,$L.cells[$F]);if($J){$L=$J.parentNode;if($F<0)$L.appendChild($J);else $L.insertBefore($J,$L.cells[$F]);};var tb=$r.getTBodyFromCell($I);if(tb&&tb.rows.length>0){for(var j=0;j<tb.rows.length;j++){var $M=tb.rows[j],$N=tb.rows[j].object;if($N){var $H=$N.cells.splice($r.index,1);$N.cells.splice($A,0,$H[0]);};if($F<0)$M.appendChild($M.cells[$K]);else $M.insertBefore($M.cells[$K],$M.cells[$F]);}}};PXGridLevel.prototype.$0A=function($O){var $P=null,$Q=null;if(!$O){$P=this.columns[0].getHeaders(false);if(this.footerVisible)$Q=this.columns[0].getFooters(false);};for(var i=0;i<this.columns.length;i++){var $r=this.columns[i];$r.index=i;if($P!=null){for(var j=0;j<$P.length;j++){this.$0B($r,$P[j],"colH",true);if($Q!=null&&$Q[j])this.$0B($r,$Q[j],"colF",true);}};if($r.statHeaderElem)this.$0B($r,$r.statHeaderElem,"colHS",false);if($r.statFooterElem)this.$0B($r,$r.statFooterElem,"colFS",false);}};PXGridLevel.prototype.$0B=function($r,$R,$v,$S){var tr=$R.parentNode;var c=tr.cells[$r.index+this.firstColumnCell];c.id=$r.getElementID($v);if($S)c.setAttribute("name",c.id);};PXGridLevel.prototype.getImage=function(name,$T){var $U=this.images["_"+name];if(!$U){$U=this.createImage(name);if(!$U)return null;this.images["_"+name]=$U;if($T){$U.style.zIndex=10000;$U.style.position="absolute";$U.style.display="none";__doc(this).body.appendChild($U);}};return $U;};PXGridLevel.prototype.createImage=function(name){var $V=this.images[name];if(!$V)return null;$U=__px_cm(this).createSpriteOrImage(null,$V);if($U.tagName=="IMG")$U.border="0";return $U;};PXGridLevel.prototype.resetColumnsMargins=function(){for(var i=0;i<this.columns.length;i++){var $r=this.getColumn(i);if($r)$r.resetMargins();}};PXGridLevel.prototype.getColumnsMenu=function(){if(this.colsMenu==null){var $W=this.grid.ID+"_menu"+this.index;this.colsMenu=__px_all(this)[$W];if(!this.colsMenu){var $X=__px(this).elemByID($W);if($X&&$X.parentNode!=__win(this).theForm)__win(this).theForm.appendChild($X);this.colsMenu=__px_cm(this).createControl("PXMenu",$W);if(this.colsMenu){__px_all(this)[$W]=this.colsMenu;this.colsMenu.onLoad();}};if(this.colsMenu){var $Y=this.colsMenu.events,$a=this.grid;$Y.addEventHandler("itemCheck",PXGridLevel.$0C);$Y.addEventHandler("deactivate",Function.createDelegate($a,$a.onMenuDeactivate));this.colsMenu.$0D=this;this.$0y();}};return this.colsMenu;};PXGridLevel.prototype.$0y=function(){var $Z=this.colsMenu.items;while($Z.length>2)$Z.removeItem(0);var $x=new Object(),$00=new Array();for(var i=this.columns.length-1;i>=0;i--){var $r=this.columns[i],$v=$r.getKey(),$01=$r.getHeaderText();if($r.allowShowHide==1&&$01&&$v){var $02=new Object();$02.key=$v;$02.text=$01;$x[$v]=$r;$00.push($02);}};var $03=function sortFunction(a,b){if(a.text<b.text)return -1;if(a.text>b.text)return 1;return 0};$00.sort($03);$00.reverse();for(var i=0;i<$00.length;i++){var $r=$x[$00[i].key],$04;$04=$Z.insertItem(0,$r.getHeaderText(),null,null,true,true,$r.getVisible());$04.value=$r.getKey();}};PXGridLevel.$0C=function($05,e){var l=$05.$0D;if(e.id==5){var $r=l.getColumn(e.item.value);if($r){var $06=!e.item.getChecked();$r.setVisible($06,true);e.cancel=true;e.item.setChecked($06);if(l.grid.restrictFields&&$06&&!$r.dataLoaded){l.grid.refresh();$r.dataLoaded=true;}}}};function PXGridNavigator($07){this.level=$07;this.px_context=$07.grid.px_context;};PXGridNavigator.prototype.dispose=function(){delete this.element;delete this.px_context;delete this.row;};PXGridNavigator.prototype.create=function(){var t=this.element=__doc(this).createElement("table");t.style.tableLayout="fixed";t.style.width="0px";t.style.position="absolute";t.border=t.cellSpacing=t.cellPadding=0;t.className="RowNavigator";var $08=__win(this).theForm.style.direction=="rtl";if(__px(this).isRTL())t.style.right="0px";else t.style.left="0px";var $09=__doc(this).createElement("colgroup");var $0a=this.level.rowSelectorsVisible,$r;t.appendChild($09);if($0a){$r=__doc(this).createElement("col");$r.style.width=this.level.rowSelectorsWidth;$09.appendChild($r);};var $x=this.level.columns;for(var i=0;i<$x.length;i++){if($x[i].getVisible()){$r=__doc(this).createElement("col");$r.style.width=$x[i].getWidth()+"px";$09.appendChild($r);}};var rb=t.insertRow(0),th=t.createTHead(),rh=th.insertRow(0);var $0b=this.level.styles,$0c=this.level.images;rh.style.display="none";if($0a){this.$0E(rh,null,$0c.gridCorner,true,$0b.header,0);this.$0E(rb,null,$0c.currentRow,true,$0b.rowSelector,0);};var $0d=this.level.grid.ID;for(var i=0;i<$x.length;i++){var $0e=$x[i],$0f,$06=$0e.getVisible();$0f=this.$0E(rh,$0e.getHeaderText(),null,$06,$0b.header);$0f.id=[$0d,"colH",this.level.index,i].join("_");$0f.setAttribute("name",$0f.id);$0f.style.width=$0e.getWidth()+"px";$0f=this.$0E(rb,null,null,$06);$0f.align=$0e.textAlign;if($0e.draggable||(this.level.getAllowDragRows()&&!__px(this).IsIEorEdge))$0f.setAttribute("draggable","true");};this.level.resetColumnsMargins();this.level.grid.attachCellEvents(t);};PXGridNavigator.prototype.show=function($M){var $0g=(this.element==null||this.element.tBodies[0]==null);if(this.recreate||$0g){if(!$0g)this.level.grid.detachCellEvents(this.element);this.create();delete this.recreate;};var $0h=this.level.grid.scrollDiv;if(this.element.parentNode!=$0h){$0h.appendChild(this.element);this.level.resetColumnsMargins();};this.row=$M;this.element.tBodies[0].rows[0].object=$M;this.update();this.repaint();this.needsPosition=($M.element.offsetHeight==0);if(!this.needsPosition)this.setPosition();};PXGridNavigator.prototype.setPosition=function(){var $0h=this.level.grid.scrollDiv;var top=__px(this).getElemTopPos(this.row.element,$0h,false);this.element.style.display="";this.element.style.top=top+"px";this.needsPosition=false;};PXGridNavigator.prototype.hide=function($0i){if(this.element){var $0h=this.level.grid.scrollDiv;this.element.style.display="none";if($0i){if(this.element.parentNode==$0h)$0h.removeChild(this.element);this.recreate=true;}}};PXGridNavigator.prototype.repaint=function($0f){if(this.row==null)return;if($0f==null){for(var i=0;i<this.row.cells.length;i++)this.$0F(this.row.getCell(i));if(this.level.rowSelectorsVisible)this.repaintSelector();}else{this.$0F($0f);};this.updateRowCss();};PXGridNavigator.prototype.update=function($0f){if(this.row==null)return;if($0f==null){for(var i=0;i<this.row.cells.length;i++)this.$0G(this.row.getCell(i));}else{this.$0G($0f);};this.updateRowCss();};PXGridNavigator.prototype.updateRowCss=function(){if(this.row==null)return;var $0j=this.element.tBodies[0].rows[0];var $0k=this.row.isEdit()?"edit":"";if(this.row.dragover)$0k+=" dragover "+((this.row.dragover==2)?"after":"before");if($0j.className!=$0k)$0j.className=$0k;if(this.row.isLast())this.element.setAttribute("data-last","1");else this.element.removeAttribute("data-last");};PXGridNavigator.prototype.repaintSelector=function(){if(!this.level.rowSelectorsVisible)return;var $0l="currentRow",status=this.row.getStatus(),$0m=null;if(this.level.grid.searchMode){$0l="search";}else if(this.row.hasError()){$0l="rowError";$0m=this.row.getError();}else if(this.row.hasWarning()){$0l="rowWarning";$0m=this.row.getWarning();}else if(this.row.hasInfo()){$0l="rowInfo";$0m=this.row.getInfo();}else if(this.level.showRowStatus&&(status!=PXRowStatus.NotSet)){switch(status){case PXRowStatus.AddNew:$0l="newRow";break;case PXRowStatus.Modified:$0l="modifiedRow";break;case PXRowStatus.Inserted:$0l="insertedRow";break;case PXRowStatus.Deleted:$0l="deletedRow";break;}}else if(this.row.isEdit()){$0l=(status==PXRowStatus.AddNew)?"newRow":"editRow";};var $0j=this.element.tBodies[0].rows[0],$0n=0;var $0o=$0j.cells[0],$0p=$0o.firstChild;var $0q=$0p.type?$0p.type:"currentRow";if($0l!=$0q){$0o.removeChild($0p);$0p=__px_cm(this).repaintImage($0p,this.level.images[$0l]);$0p.type=$0l;$0o.appendChild($0p);$0o.removeAttribute("error");if($0l=="rowError")$0n=2;else if($0l=="rowWarning")$0n=1;if($0n){$0p.setAttribute("error",$0n);$0o.setAttribute("error",$0n);}};__px(this).setTitle($0o,$0m);};PXGridNavigator.prototype.$0E=function($M,$01,$0r,$06,$0s,$0t){var td=$M.insertCell($M.cells.length);if(!$06)td.style.display="none";if($0s)td.className=$0s;if($01)td.appendChild(__doc(this).createTextNode($01));if($0t!=null)td.style.padding=$0t+"px";if($0r)__px_cm(this).createSpriteOrImage(td,$0r);return td;};PXGridNavigator.prototype.$0H=function($0f){var $0j=this.element.tBodies[0].rows[0];var $b=$0f.getIndex();if(this.level.rowSelectorsVisible)$b++;return $0j.cells[$b];};PXGridNavigator.prototype.$0F=function($0f){if(this.row!=null){var $X=this.$0H($0f),$0u=this.row.isEdit();var $0s=$0u?$0f.getStaticCss():$0f.getDynamicCss();if($0s!=$X.className)$X.className=$0s;var $0v=$0f.element.getAttribute("error");if($0v)$X.setAttribute("error",$0v);else $X.removeAttribute("error");if($0u){var $0w=$X.getAttribute("draggable")!=null;if($0w){$X.removeAttribute("draggable");$X.setAttribute("was-draggable","true");}}else if($X.getAttribute("was-draggable")!=null){$X.removeAttribute("was-draggable");$X.setAttribute("draggable","true");}}};PXGridNavigator.prototype.$0G=function($0f){if(this.row!=null){var $X=this.$0H($0f);var title=__px(this).getTitle($0f.element);$X.innerHTML=$0f.element.innerHTML;if(title&&title.length)$X.setAttribute(__px_tm(this).attrName,title);else $X.removeAttribute(__px_tm(this).attrName,title);}};



var PXColumnType={NotSet:0,CheckBox:1,HyperLink:2,DropDownList:3,Button:4,Icon:5};function PXGridColumn($a,$b,$c,$d){this.level=$a;this.initialIndex=this.serverIndex=this.index=$b;this.px_context=$a.grid.px_context;this.xmlNode=$d;this.headerXml=this.xmlNode.getElementsByTagName("Header")[0];this.footerXml=this.xmlNode.getElementsByTagName("Footer")[0];this.statFooterElem=null;this.statHeaderElem=null;if($a.index==0){this.statHeaderElem=this.$0K("colHS");this.statFooterElem=this.$0K("colFS");};__px_cm(this).readProperties(this,$c);if(this.nullText==null)this.nullText=$a.nullText;if(this.allowSort==null)this.allowSort=$a.allowSort;if(this.allowFilter==null)this.allowFilter=true;if(this.allowResize==null)this.allowResize=$a.allowColSizing;if(this.allowMove==null)this.allowMove=$a.allowColMoving;this.viewLink=(this.xmlNode.getAttribute("ViewLink")!=null);this.textAlign=this.xmlNode.getAttribute("TextAlign");this.multiline=(this.xmlNode.getAttribute("Multiline")!=null);this.ellipsis=(this.xmlNode.getAttribute("Ellipsis")!=null);this.defaultLocale=this.xmlNode.getAttribute("DefaultLocale");if(this.textAlign==null)this.textAlign="";this.draggable=(this.xmlNode.getAttribute("Draggable")!=null);if(this.draggable)$a.grid.draggable=true;var st=$d.getElementsByTagName("Styles")[0],ls=$a.styles;var jf=function(s1,s2){return((new Array(s1,s2)).join(" ")).trimEnd();};var $e=st.getAttribute("Row");this.styles=new Object();this.styles.normal=jf(ls.row,$e);this.styles.alternate=jf(ls.altRow,$e);this.styles.selHeader=jf(ls.selHeader,$e);this.styles.selFeader=jf(ls.selFooter,$e);this.styles.cellButton=jf(ls.cellButton,st.getAttribute("CellButton"));PXGridColumn.readValueItems(this,$d);PXGridColumn.readMaskItems(this,$d);};PXGridColumn.prototype.dispose=function(){delete this.xmlNode;delete this.headerXml;delete this.footerXml;delete this.statHeaderElem;delete this.statFooterElem;delete this.px_context;delete this.level;};PXGridColumn.convertWidth=function($f,$g){return $g?parseInt($g):0;};PXGridColumn.convertNullable=function($f,$g){return $g&&($f.type!=PXColumnType.CheckBox);};PXGridColumn.properties=[["type",JSType.Int,0],["displayMode",JSType.Int,0],["key",JSType.String,""],["width",JSType.Int,0,PXGridColumn.convertWidth],["visible",JSType.Bool,true],["required",JSType.Bool,false],["dataType",JSType.Int,18],["dataField",JSType.String,""],["textField",JSType.String,""],["textFieldColumn",JSType.String,""],["valueField",JSType.String,""],["displayFormat",JSType.String,""],["maxLength",JSType.Int,0],["decimals",JSType.Int,0],["defaultValue",JSType.Empty,null],["viewName",JSType.String,""],["textCase",JSType.Int,0],["nullText",JSType.String,""],["isPassword",JSType.Bool,false],["timeMode",JSType.Bool,false],["formEditorID",JSType.String,""],["sortDirection",JSType.Int,0],["buttonDisplay",JSType.Int,0],["editorID",JSType.String,""],["renderEditorText",JSType.Bool,false],["commitChanges",JSType.Bool,false],["allowSort",JSType.Bool,null],["allowFilter",JSType.Bool,null],["allowResize",JSType.Bool,null],["allowMove",JSType.Bool,null],["allowUpdate",JSType.Bool,true],["allowFocus",JSType.Bool,true],["allowNull",JSType.Bool,true,PXGridColumn.convertNullable],["allowCheckAll",JSType.Bool,false],["allowShowHide",JSType.Int,1],["headerAction",JSType.Int,0],["footerSummary",JSType.Int,0],["dateMask",JSType.String,""],["matrixMode",JSType.Bool,null],["linkCommand",JSType.String,null],["popupCommandTarget",JSType.String,null],["popupCommand",JSType.String,null],["allowStrings",JSType.Bool,false],["defaultLocale",JSType.String,null],["skipTabs",JSType.Bool,false],];PXGridColumn.callbackProps=[["allowUpdate",JSType.Bool,true,"setAllowUpdate"],["visible",JSType.Bool,true,"setVisible"],["displayFormat",JSType.String,""],["defaultValue",JSType.Empty,undefined],["decimals",JSType.Int,0],["serverIndex",JSType.Int,-1,"setServerIndex"],["sortDirection",JSType.Int,0,"setSortIndicator"],["footerText",JSType.String,"","setFooterText"],["skipTabs",JSType.Bool,false]];PXGridColumn.prototype.setProperties=function($c,$h){if($c.hasError)this.clearUIVisible();__px_cm(this).readProperties(this,$c,PXGridColumn.callbackProps);if(this.level.grid.markRequired==2)this.setRequired($c.required);if($c.valueItems)this.setValueItems($c.valueItems);if($c.sortDirection>0&&$h)this.$0L("SortDirection",$c.sortDirection);if(this.formEditorID){var $i=this.getFormEditor(),$j=this.getFormEditor(true);if($i&&$i.setProperties&&$c.control){$i.setProperties($c.control);if($j)$j.setProperties($c.control);if((this.type==PXColumnType.DropDownList||this.valueItems)&&$i.__className=="PXDropDown"){this.setValueItems($i.items);}}}};PXGridColumn.readValueItems=function($k,$d){var $l=$d.getElementsByTagName("ValueItems");if($l.length>0){$l=$l[0];$k.valueItems=new Array();var $m=$l.getAttribute("Exclusive");$k.valueItems.exclusive=($m!=null)?Boolean.parse($m):true;$m=$l.getAttribute("MultiSelect");$k.valueItems.multiSelect=($m!=null)?Boolean.parse($m):false;$m=$l.getAttribute("EmptyPossible");$k.valueItems.emptyPossible=($m!=null)?Boolean.parse($m):false;for(var i=0;i<$l.childNodes.length;i++){var vi=new Object(),$n=$l.childNodes[i];vi.value=$n.getAttribute("Value");vi.displayValue=$n.getAttribute("DisplayValue");vi.enabled=Boolean.parse($n.getAttribute("Enabled"),true);vi.imageUrl=$n.getAttribute("ImageUrl");if(vi.displayValue==null)vi.displayValue=vi.value;$k.valueItems[i]=vi;}}};PXGridColumn.readMaskItems=function($k,$d){var $l=$d.getElementsByTagName("MaskItems");if($l.length>0){$l=$l[0];$k.maskItems=new Array();for(var i=0;i<$l.childNodes.length;i++){var vi=new Object(),$n=$l.childNodes[i];__px_cm($k).readXmlProperties(vi,$n,PXSegmentMask.itemsDesc);$k.maskItems[i]=vi;}}};PXGridColumn.prototype.getHeaderToolTip=function(){var he=this.statHeaderElem;if(he==null)he=this.$0K("colH");if(he)return __px(this).getTitle(he);return null;};PXGridColumn.prototype.getHeaderText=function(){var he=this.statHeaderElem;if(he==null)he=this.$0K("colH");if(he){var $o=__px(this).getElemText(he);if($o)return $o;return he.getAttribute("headerText");};return null;};PXGridColumn.prototype.getFooterText=function(){var fe=this.statFooterElem;if(fe==null)fe=this.$0K("colF");if(fe)return __px(this).getElemText(fe);return null;};PXGridColumn.prototype.setHeaderText=function($o){if(typeof($o)!="string")$o=$o.toString();if($o=="")$o="&nbsp;";var $p=this.getHeaders();for(var i=0;i<$p.length;i++)__px(this).setElemText($p[i],$o);this.$0L("Header.Text",$o);this.headerXml.setAttribute("Text",$o);};PXGridColumn.prototype.setFooterText=function($o){if(typeof($o)!="string")$o=$o.toString();var $q=this.getFooters();for(var i=0;i<$q.length;i++)__px(this).setElemText($q[i],$o);this.footerXml.setAttribute("Text",$o);};PXGridColumn.prototype.getHeaderTooltip=function(){var he=this.statHeaderElem;if(he==null)he=this.$0K("colH");return he?__px(this).getTitle(he):null;};PXGridColumn.prototype.canHasFocus=function(){return this.getVisible()&&this.allowFocus;};PXGridColumn.prototype.getRequired=function(){return this.required;};PXGridColumn.prototype.setRequired=function($r){if(this.required==$r)return;var hl=this.getHeaders();this.required=$r;for(var i=0;i<hl.length;i++){if(hl[i].parentNode.style.display=="none")continue;var $s=null,h=this.$0M(hl[i]);if(h){if($r&&h.className.indexOf("GridReq")<0)h.className+=" GridReq";else if(!$r)h.className=h.className.replace(" GridReq","");}};this.level.grid.restoreHeight();};PXGridColumn.prototype.getMatrixMode=function(){return(this.matrixMode!=null)?this.matrixMode:this.level.grid.matrixMode;};PXGridColumn.prototype.setOverflowTips=function(){var $t=this.getHeaders();for(var i=0;i<$t.length;i++){var hc=$t[i],$u=this.$0N(hc);if($u)for(var j=0;j<$u.rows.length;j++){var $v=$u.rows[j],$w=$v.cells[hc.cellIndex];var $x=$v.id?this.level.grid.getRowObject($v):null;var $y=$x?$x.getCell(this).getToolTip():null;if($w.getAttribute("error")==null&&$y==null)__px_tm(this).registerOverflowTip(this.$0M($w),true);}}};PXGridColumn.prototype.getWidth=function($z){var he=this.statHeaderElem;if($z){if(he==null)he=this.$0K("colH");return(he!=null)?he.offsetWidth:0;};if(!this.width){if(he==null)he=this.$0K("colH");if(he!=null)this.width=parseInt(this.getColFromCell(he).style.width);};return this.width;};PXGridColumn.prototype.clearWidth=function(){this.$0L("Width",null);};PXGridColumn.prototype.setWidth=function($A,$B){if(typeof($A)!="number")$A=parseInt($A);if($A<=0)return;if($B==null)$B=true;var $C=this.level.grid,$D=new Object();$D.column=this;$D.newWidth=$A;if($B&&$C.fireEvent("beforeColResize",null,$D))return;var $E=$A+"px";if(!this.getVisible()){this.width=$A;this.xmlNode.setAttribute("Width",$E);this.$0L("Width",$E);return;};var $t=this.getHeaders();if(this.statFooterElem)$t.push(this.statFooterElem);for(var i=0;i<$t.length;i++){var hc=$t[i],$F=this.getColFromCell(hc);if(!$F)$F=hc;$F.style.width=hc.style.width=$E;if(hc.parentNode.style.display=="none"){var tb=this.getTBodyFromCell(hc);if(tb&&tb.rows.length>0)tb.rows[0].cells[hc.cellIndex].style.width=$E;}};this.setOverflowTips();this.width=$A;this.xmlNode.setAttribute("Width",$E);this.$0L("Width",$E);$C.alignStatMargins();if($C.editMode&&$C.activeCell)$C.activeCell.setEditorPos(true);$C.restoreHeight();$C.layoutChanged=true;if($B)$C.fireEvent("afterColResize",null,$D);if($C.autoSaveLayout&&!$C.editMode)$C.saveLayout(true);};PXGridColumn.prototype.getVisible=function(){return this.visible;};PXGridColumn.prototype.clearUIVisible=function(){delete this.$0O;};PXGridColumn.prototype.setVisible=function($G,$H){if(this.visible==$G)return;if($H){if(this.$0O==null)this.$0O=this.visible;else if(this.$0O==$G)delete this.$0O;}else if(this.$0O!=null)return;var $I=$G?"":"none";var $t=new Array();if(this.statHeaderElem)$t.push(this.statHeaderElem);if(this.statFooterElem)$t.push(this.statFooterElem);var $E=this.getWidth()+"px";for(var i=0;i<$t.length;i++){$t[i].style.display=$I;$t[i].style.width=$E;this.$0P($t[i],$G);};if($G&&$t.length&&__px(this).IsIE){var $F=this.getColFromCell($t[0]);setTimeout(function(){PXGridColumn.$0Q($F);},1);};this.visible=Boolean($G);if($H)this.$0L("Visible",this.visible);this.syncColumnsMenuState();this.level.grid.restoreHeight();if($G)this.setOverflowTips();this.xmlNode.setAttribute("Visible",__px(this).getInvariantText(this.visible));this.xmlNode.setAttribute("Width",$E);this.level.repaint();};PXGridColumn.$0Q=function($F){var $J=$F.style.width;$F.style.width="0px";$F.style.width=$J;};PXGridColumn.prototype.getCheckState=function($K){var $L=$K.getAttribute("check");if($L!=null)$L=($L=="1");return $L;};PXGridColumn.prototype.setCheckState=function($K,$M){if(!this.allowCheckAll||$K==null)return;var $L=$K.getAttribute("check");if($L!=null){var $a=this.level,$N=$a.images;__px_cm(this).repaintImage($K,$M?$N.checked:$N.unChecked);$K.setAttribute("check",$M?1:0);var $C=$a.grid,$O=$C.rows;if($a.index>0){var ev=new Object();ev.target=$K;$O=__px(this).eventObject(ev,PXGridRows);};if($O!=null){var $P=$C.batchUpdate;try{$C.batchUpdate=true;for(var i=0;i<$O.length;i++){var $v=$O.getRow(i),$w=$v.getCell(this);if(!$w.getReadOnly(true)){$w.updateValue($M);$v.commitChanges();}}}finally{if(!$P)$C.update();$C.batchUpdate=$P;}}}};PXGridColumn.prototype.setCheckImage=function($M){if(this.allowCheckAll){var $t=this.getHeaders();for(var i=0;i<$t.length;i++){var $Q=this.$0M($t[i]);var $s=$Q.childNodes[0],$N=this.level.images;if(__px_cm(this).isSpriteOrImage($s)&&$s.getAttribute("check")!=null){__px_cm(this).repaintImage($s,$M?$N.checked:$N.unChecked);$s.setAttribute("check",$M?1:0);}}}};PXGridColumn.prototype.getVisibleIndex=function(){var $b=0,$R=this.level.columns;for(var i=0;i<this.index;i++){if($R[i].getVisible())$b++;};return $b;};PXGridColumn.prototype.getKey=function(){return this.dataField?this.dataField:this.key;};PXGridColumn.prototype.getFormEditor=function($S){var id=this.formEditorID,li=this.level.index;if(id){id=($S?"_":"")+this.level.grid.ID+"_"+this.getEditorPostfix();return __px_all(this)[id];};return null;};PXGridColumn.prototype.getEditorPostfix=function(){var id=this.formEditorID,li=this.level.index;if(id)id="lv"+this.level.index+"_"+id;return id;};PXGridColumn.prototype.setAllowUpdate=function($g){this.allowUpdate=Boolean($g);this.xmlNode.setAttribute("AllowUpdate",__px(this).getInvariantText(this.allowUpdate));};PXGridColumn.prototype.setServerIndex=function($b){if($b>=0){this.serverIndex=$b;this.xmlNode.setAttribute("i",$b);}};PXGridColumn.prototype.syncColumnsMenuState=function(){var $T=this.level.getColumnsMenu();var $U=this.colsMenuItem;if($T!=null&&$U==null)for(var i=0;i<$T.items.length;i++){var $V=$T.items.getItem(i);if($V&&$V.value==this.getKey()){this.colsMenuItem=$V;break;}};if(this.colsMenuItem)this.colsMenuItem.setChecked(this.visible);};PXGridColumn.prototype.sort=function($W){if($W==null)$W=1;if(!this.dataField||$W==this.sortDirection)return;var $C=this.level.grid;var $X=new Object();$X.column=this;if($C.fireEvent("beforeColSort",null,$X))return;if($W>0){var $R=this.level.columns;for(var i=0;i<$R.length;i++){if($R[i].sortDirection>0)$R[i].setSortIndicator(0);}};this.setSortIndicator($W);$C.restoreHeight();if($C.allowPaging){$C.setPageIndex(0);if($C.allowSearch)$C.clearSearch();};$C.sortedColumn=this;$C.refresh(Function.createDelegate($C,$C.processSort));$C.layoutChanged=true;};PXGridColumn.prototype.setSortIndicator=function($W,$Y){if($W!=this.sortDirection||$Y){this.sortDirection=$W;this.$0L("SortDirection",$W);this.repaintDataImage();}};PXGridColumn.prototype.allowFilterDialog=function(){return this.level.grid.allowFilter&&this.allowFilter&&this.dataField&&!this.allowCheckAll;};PXGridColumn.prototype.repaintDataImage=function($K){var hl=$K?[$K]:this.getHeaders(),$W=this.sortDirection;var $Z=this.mouseOver&&this.allowFilterDialog(),$C=this.level.grid;for(var i=0;i<hl.length;i++){if(hl[i].parentNode.style.display=="none")continue;var $s=null,h=this.$0M(hl[i]);for(var j=(h.childNodes.length-1);j>=0;j--){var e=h.childNodes[j];if(__px_cm(this).isSpriteOrImage(e)&&e.getAttribute("data-type")=="sort"){if($W>0||$Z)$s=e;else{var te=h.childNodes[j-1],$00=te.nodeValue;h.removeChild(e);};break;}};var $01=this.filter?this.filter:$C.getQuickFilter(this.getKey());if($01&&$01.condition==null)$01=null;if($01==null)hl[i].removeAttribute("data-filter");if($W>0||$Z||$01!=null){var $N=this.level.images,$02;if($01){switch($W){case 0:$02=$N.filter;break;case 1:$02=$N.filterSortAsc;break;case 2:$02=$N.filterSortDesc;break;}}else if($W>0)$02=($W==1)?$N.sortAsc:$N.sortDesc;if($01&&$01.condition)hl[i].setAttribute("data-filter",1);else hl[i].removeAttribute("data-filter");if($Z&&!$02)$02="control@ArrowDown";if($s==null){var $00=h.lastChild.nodeValue;$s=__px_cm(this).createSpriteOrImage(null,$02);$s.setAttribute("data-type","sort");h.appendChild($s);}else __px_cm(this).repaintImage($s,$02);}};this.level.grid.restoreHeight();};PXGridColumn.prototype.getEditor=function($03,$04){var $i,$C=this.level.grid,$05=false;var $06=$C.scrollDiv,$07=Function.createDelegate($C,$C.handleEditorEvents);var $08=!this.allowUpdate&&!$03;if($08||this.type==PXColumnType.CheckBox){$i=$C.getEditor(PXEditorType.FocusDiv);}else{$i=this.$0R($06,$07);if($i&&(this.editorID||this.formEditorID)){$i.addCustomHandler("beforeDropDown",PXGrid.handleEditorDropOpen);$i.addCustomHandler("afterDropDown",PXGrid.handleEditorDropClose);$05=true;};if(!$i)$i=$C.getEditor(this.$0S($04));};if($i){this.$0T($i,$05);if($i.editorType!=PXEditorType.FocusDiv){var $09=this.level.styles;$i.setClass($09.cellEditor,$09.editorText);}};return $i;};PXGridColumn.prototype.getSearchEditor=function(){var $i,$C=this.level.grid;var $06=$C.scrollDiv,$07=Function.createDelegate($C,$C.handleSearchEditor);if(this.type==PXColumnType.DropDownList){$i=this.$0U($06,$07,"s");}else{$i=this.$0R($06,$07,"s");if(!$i)$i=$C.getSearchEditor(this.$0S(true));};if($i){if($i.control.initInlineSearch)$i.control.initInlineSearch();this.$0T($i);$i.setClass($C.searchCss,$C.searchTextCss);};return $i;};PXGridColumn.prototype.$0S=function($04){var $0a=PXEditorType.TextBox,$0b=this.isPassword&&!$04;if(this.valueItems!=null)$0a=PXEditorType.DropDown;else if($0b&&$0c==NetType.String)$0a=PXEditorType.Password;else if(this.viewName)$0a=this.maskItems?PXEditorType.SegmentMask:PXEditorType.Selector;else if(NetType.isNumeric(this.dataType))$0a=PXEditorType.NumberEdit;else if(this.dataType==NetType.DateTime)$0a=PXEditorType.DateEdit;else if(this.displayFormat)$0a=PXEditorType.MaskEdit;else if(this.multiline)$0a=PXEditorType.TextArea;return $0a;};PXGridColumn.prototype.$0U=function($06,$07,$0d){if(this.valueItems==null)return null;if($0d==null)$0d="";if(this.$0V==null)this.$0V=new Object();var $0e="ed"+PXEditorType.ComboBox+$0d;if(this.$0V[$0e]==null){var $C=this.level.grid,vi=this.valueItems,$0f=$C.ID+"_lv0_ec";var id=$C.ID+"_el"+this.initialIndex+$0d;var $i=PXInlineEditor.createDropDown($C.px_context,$0f,$06,$07,id,$C.ID,vi);var $f=$i.control;if($f.__className=="PXDropDown"){$f.allowNull=this.allowNull;$f.nullText=this.nullText;$f.setAllowEdit(!vi.exclusive);$f.allowMultiSelect=vi.multiSelect;};this.$0V[$0e]=$i;}else{PXInlineEditor.fillValueItems(this.$0V[$0e].control,this.valueItems);};return this.$0V[$0e];};PXGridColumn.prototype.$0R=function($06,$07,$0d){if($0d==null)$0d="";if(this.$0V==null)this.$0V=new Object();var $0e="ed"+PXEditorType.Control+$0d;if(this.$0V[$0e]==null){var $C=this.level.grid,id=$C.ID+"_",$0g=false;if(this.editorID){id=this.editorID;$0g=true;$0d+=this.initialIndex;}else if(this.formEditorID){id+=this.getEditorPostfix();$0g=true;}else if(this.dataType==NetType.DateTime)id+="lv0_ed";if(__px_all(this)[id]){var $0h="_"+id+$0d+($0g?"":this.initialIndex);var $i=PXInlineEditor.createControl(this.px_context,id,$06,$07,$0h,$C.ID);var $f=$i.control;if(!$0g){$f.allowNull=this.allowNull;$f.nullText=this.nullText;if(NetType.isNumeric(this.dataType)){if($f.setDecimals)$f.setDecimals(this.decimals);else $f.decimals=this.decimals;};if(this.dataType==NetType.DateTime){$f.setTimeMode(this.timeMode);if(this.dateMask)$f.setDateMask(this.dateMask,this.dateMask);}};this.$0V[$0e]=$i;}else this.$0V[$0e]=null;};return this.$0V[$0e];};PXGridColumn.prototype.$0T=function($i,$05){var et=$i.editorType,$0i=false,$C=this.level.grid;var $0j=$i.control,$K=$i.element;var $0k=$0j.constructor,$0l=$0k.__baseType;if($0l&&$0l.__className=="PXDropDown")et=PXEditorType.DropDown;if($0k.__className=="PXDropDown")et=PXEditorType.DropDown;if($0k.__className=="PXSelector")et=PXEditorType.Selector;if($0k.__className=="PXSegmentMask")et=PXEditorType.SegmentMask;if($0k.__className=="PXNumberEdit")et=PXEditorType.NumberEdit;switch(et){case PXEditorType.TextArea:case PXEditorType.TextBox:case PXEditorType.Password:$0i=true;if(this.maxLength&&this.dataType==NetType.String)$K.maxLength=this.maxLength;else $K.maxLength=2147483647;if(__px(this).IsFirefoxFrom40){var $0m=$K.maxLength;$K.removeAttribute("maxlength");setTimeout(function(){$K.maxLength=$0m},1);};break;case PXEditorType.NumberEdit:$0i=true;if($0j.setDecimals)$0j.setDecimals(this.decimals);else $0j.decimals=this.decimals;break;case PXEditorType.DateEdit:$0j.allowNull=this.allowNull;$0j.setTimeMode(this.timeMode);if(this.dateMask)$0j.setDateMask(this.dateMask,this.dateMask);break;case PXEditorType.DropDown:$0j.allowNull=this.allowNull;$0j.valueType=this.dataType;if(this.valueItems){$0j.setAllowEdit(!this.valueItems.exclusive);$0j.allowMultiSelect=this.valueItems.multiSelect;}else $0j.setAllowEdit(true);PXInlineEditor.fillValueItems($0j,this.valueItems);break;case PXEditorType.MaskEdit:$0j.setInputMask(this.displayFormat);break;case PXEditorType.Selector:if($i.editorType==PXEditorType.Selector){$0j.setViewName(this.viewName);if(!$05)$0j.setInputMask(this.displayFormat);};$0j.ownerID=$C.ID;if($0j.sourceID)__px_all(this)[$0j.sourceID].ownerID=$C.ID;if(!$05||!$0j.valueField)$0j.valueField=this.valueField;if(!$05||(!$0j.textField&&!$0j.hintField)){$0j.valueField=this.valueField;if(this.displayMode>0&&this.textField){$0j.textField=$0j.hintField="";if(this.displayMode==1)$0j.textField=this.textField;else $0j.hintField=this.textField;$0j.setHintState();}else if(this.displayMode==0){$0j.textField=$0j.hintField="";$0j.setHintState();}};break;case PXEditorType.SegmentMask:if($i.editorType==PXEditorType.SegmentMask){$0j.setViewName(this.viewName);$0j.setItems(this.maskItems);};if(!$05||!$0j.valueField)$0j.valueField=this.valueField;$0j.ownerID=$C.ID;if($0j.sourceID)__px_all(this)[$0j.sourceID].ownerID=$C.ID;break;case PXEditorType.Control:if(this.valueItems&&$0j.setItems)PXInlineEditor.fillValueItems($0j,this.valueItems);break;};if($0i){$0j.elemText.style.textAlign=this.textAlign;$0j.allowNull=this.allowNull;$0j.nullText=this.nullText;}};PXGridColumn.prototype.getDisplayText=function($r,$w){var $0c=this.dataType,$o="",$0n=this.displayFormat;var $0o=this.isPassword,$0p=this.timeMode,vi=this.valueItems;if($w){$0c=$w.getDataType(true);$0o=$w.getIsPassword(true);$0p=$w.getTimeMode(true);if($w.displayFormat)$0n=$w.displayFormat;if($w.valueItems!=null)vi=$w.valueItems;};var $0q=NetType.isNumeric($0c);if($r==null){$o=this.nullText;}else if(this.type==PXColumnType.Icon){if(vi!=null){var vi=this.getValueItem($r,vi,$0c);if(vi!=null)$o=vi.displayValue;}else $o=$r.toString();}else if(this.renderEditorText){var ac=this.level.grid.activeCell,$i=$w?$w.getEditor(true):null;$o=$i?$i.getDisplayText($r):$r.toString();if(ac&&ac.editMode&&ac!=$w&&ac.editor==$i){ac.editor=null;ac.repaintEditor();}}else if(this.type==PXColumnType.DropDownList||vi!=null){if(vi&&vi.multiSelect){var $0r=$r.split(','),ar=new Array();for(var i=0;i<$0r.length;i++){var $V=this.getValueItem($0r[i],vi,$0c);if($V!=null)ar.push($V.displayValue);};$o=ar.join(', ');}else{var vi=this.getValueItem($r,vi,$0c);if(vi!=null)$o=vi.displayValue;}}else if($0o&&$0c==NetType.String){$o="*******";}else if($0n){if($0q&&$r.format)$o=$r.format($0n,_numbFormatInfo);else if($0c==NetType.DateTime&&$r.format)$o=$r.format($0n,_dateFormatInfo);else if($0c==NetType.String)$o=PXMaskEdit.format(PXMaskEdit.encode($0n),$r,' ');else $o=__px(this).getInvariantText($r);}else{if($0q){$o=$r.toString();$o=$o.replace(".",_numbFormatInfo.number.decimalSeparator);}else if($0c==NetType.DateTime&&$r.format){$o=$r.format($0p?"t":"d",_dateFormatInfo);}else $o=__px(this).getInvariantText($r);};return $o;};PXGridColumn.prototype.getTypedValue=function($r,$0s,$0t){if($r!=null){var $0u=(typeof($r)=="string"),$0v=$r;if(this.allowNull&&$0u&&(this.nullText==$r))$r=null;else{var $0c=$0s?$0s:this.dataType;if($0c==NetType.String&&($r instanceof Date))$r=__px(this).getInvariantText($r);else{$r=NetType.convert($r,$0c);if($0t&&isNaN($r))$r=__px(this).getInvariantText($0v);}}};return $r;};PXGridColumn.prototype.getInvariantText=function($r){var $o="";if($r==null)$o=this.nullText;else $o=__px(this).getInvariantText($r);return $o;};PXGridColumn.prototype.getValueItem=function($r,$0w,$0s){if($0w==undefined)$0w=this.valueItems;if($0s==undefined)$0s=this.dataType;if($0w==null||$r==null)return null;for(var i=0;i<$0w.length;i++){var vi=$0w[i];if($r==this.getTypedValue(vi.value,$0s))return vi;};if(!$0w.exclusive){var vi=new Object();vi.value=$r;vi.displayValue=String($r);return vi;};return null;};PXGridColumn.prototype.setValueItems=function($0r){var $0x=this.level.grid.xmlDocObject,$0y;$0x.removeNode("ValueItems",this.xmlNode);if($0r!=null){$0y=$0x.addNode("ValueItems",this.xmlNode);for(var i=0;i<$0r.length;i++){var $V=$0r[i],$0z=$0x.addNode("ValueItem",$0y);$0z.setAttribute("Value",$V.value);if($V.displayValue==null)$V.displayValue=$V.text;if($V.displayValue)$0z.setAttribute("DisplayValue",$V.displayValue);}};if(this.valueItems){$0r.exclusive=this.valueItems.exclusive;$0r.multiSelect=this.valueItems.multiSelect;$0r.emptyPossible=this.valueItems.emptyPossible;};this.valueItems=$0r;};PXGridColumn.prototype.getElementID=function(name){var ar=[this.level.grid.ID,name,this.level.index,this.index];return ar.join("_");};PXGridColumn.prototype.$0K=function(name,$0A){var ID=this.getElementID(name),ge=this.level.grid.element;return $0A?ge.querySelectorAll("td[name='"+ID+"']"):__px(this).elemByID(ID);};PXGridColumn.prototype.getHeaders=function($0B){if($0B==null)$0B=true;if(this.$0W==null)this.$0W=this.$0K("colH",true);var $p=Array.clone(this.$0W);if(this.statHeaderElem&&$0B)$p.push(this.statHeaderElem);return $p;};PXGridColumn.prototype.getFooters=function($0B){if($0B==null)$0B=true;if(this.$0X==null)this.$0X=this.$0K("colF",true);var $q=Array.clone(this.$0X);if(this.statFooterElem&&$0B)$q.push(this.statFooterElem);return $q;};PXGridColumn.prototype.resetMargins=function(){delete this.$0X;delete this.$0W;};PXGridColumn.prototype.$0M=function($Q){var $0C=$Q.childNodes;for(var i=0;i<$0C.length;i++){var $0D=$0C[i].className;if($0D&&$0D.indexOf("GridHeaderWrap")>=0)return $0C[i];};return $Q;};PXGridColumn.prototype.$0L=function($0E,$r){var $0F="Levels.i"+this.level.index+".Columns";var $M=this.level.grid.viewState;$M.updateListItem($0F,this.getKey(),$0E,$r);};PXGridColumn.prototype.getColFromCell=function($0G){var $0H=this.$0Y($0G),$F=null;if($0H){if(!this.getVisible()){$F=$0H.lastChild;while($F.tagName!="COL")$F=$F.previousSibling;}else $F=$0H.childNodes[this.$0Z($0H)];};return $F;};PXGridColumn.prototype.getTBodyFromCell=function($0G){var e=this.$0N($0G);return e?e.tBodies[0]:null;};PXGridColumn.prototype.$0N=function($0G){var e=$0G.parentNode;while(e!=null){if(e.tagName=="TABLE")break;e=e.parentNode;};return e;};PXGridColumn.prototype.$0Y=function($0G){var e=this.$0N($0G);if(e){e=e.firstChild;while(e!=null){if(e.tagName=="COLGROUP")break;e=e.nextSibling;}};return e;};PXGridColumn.prototype.$0Z=function($0H){var $b=this.getVisibleIndex()+this.level.firstColumnCell;var j=0,$0I=false;for(var i=0;i<$0H.childNodes.length;i++){var $K=$0H.childNodes[i];if($K&&$K.tagName=="COL"){if(j==$b){$b=i;$0I=true;break;};j++;}};return $0I?$b:-1;};PXGridColumn.prototype.$0P=function($w,$G){var cg=this.$0Y($w),$F;var $0J=this.$0Z(cg);if($G){$F=__doc(this).createElement("COL");if($0J<0)cg.appendChild($F);else cg.insertBefore($F,cg.childNodes[$0J]);$F.style.display="";$F.style.width=this.getWidth()+"px";}else{$F=cg.childNodes[$0J];cg.removeChild($F);};return $F;};



var PXRowStatus={NotSet:0,Modified:1,AddNew:2,Inserted:3,Deleted:4,Unbound:5};function PXGridRows($a,$b,$c,$d){this.grid=$a;this.parentRow=$b;this.xmlNode=$d;this.container=$c;this.px_context=$a.px_context;var $e=$b?($b.level.index+1):0;this.level=$a.levels[$e];this.$0K();};PXGridRows.prototype.dispose=function(){delete this.xmlNode;delete this.px_context;delete this.container;delete this.grid;delete this.level;delete this.items;delete this.dataTable;delete this.newRow;delete this.newRowXml;};PXGridRows.prototype.$0K=function(){this.dataTable=this.container.getElementsByTagName("TABLE")[0];if(this.dataTable){this.element=this.dataTable.tBodies[0];this.element.object=this.dataTable.object=this;this.grid.attachHeaderEvents(this.dataTable);this.grid.attachCellEvents(this.dataTable);var id=[this.grid.ID,"newRow"],pr=this.parentRow;if(pr)id.push(pr.hashCode());this.newRow=__px(this).elemByID(id.join("_"));var rt=this.level.xmlNode.getElementsByTagName("Row");this.newRowXml=rt?rt[0]:null;}else{this.element=null;this.newRow=this.newRowXml=null;};this.level.resetColumnsMargins();this.items=new Array();if(this.element){this.length=this.element.rows.length;if(this.grid.levels.length>1)for(var i=0;i<this.element.rows.length;i++){var r=this.element.rows[i];if(r.getAttribute("childLevel"))this.length--;};if(this.newRow!=null)this.length--;}else this.length=0;};PXGridRows.prototype.repaint=function(){var $f=this.grid.getXslProc();var $g=this.level.getAllowDragRows()&&!(__px(this).IsEdge||__px(this).IsAnyIE);$f.setParam("showDeletedRows",__px(this).getInvariantText(this.grid.batchUpdate));$f.setParam("renderDraggable",__px(this).getInvariantText($g));if(this.parentRow){var $h=this.parentRow.hashCode();this.xmlNode.setAttribute("HashCode",$h);$f.setParam("parentHash",$h);}else $f.setParam("parentHash","");if(this.dataTable){this.grid.detachHeaderEvents(this.dataTable);this.grid.detachCellEvents(this.dataTable);};this.$0L();if(this.hasSelection)this.grid.clearRowSelection(false);var $i=$f.transform(),me=this;$i=$i.replace(/@&lt;/g,"<").replace(/@&gt;/g,">");this.container.innerHTML=$i;this.$0K();if(__px_tm(this)){__px_tm(this).register(this.container);if(__px(this).isVisible(this.grid.element))this.setOverflowTips();else this.grid.registerOverflowTips=true;}};PXGridRows.prototype.setOverflowTips=function(){var $j=this.level.columns.length;for(var i=0;i<$j;i++){var $k=this.level.getColumn(i);if($k&&$k.getVisible()&&$k.getHeaderText())$k.setOverflowTips();}};PXGridRows.prototype.$0M=function($l){var $m=this.getRow($l);if($m==null)return;var $n=$m.xmlNode,i=parseInt($n.getAttribute("i"));do{$n=$n.nextSibling;if($n!=null)$n.setAttribute("i",++i);}while($n!=null);for(i=$l+1;i<this.length;i++){var $m=this.getRow(i);if($m)$m.$0M();}};PXGridRows.prototype.reset=function(){if(this.dataTable){this.grid.detachHeaderEvents(this.dataTable);this.grid.detachCellEvents(this.dataTable);this.$0L();if(this.hasSelection)this.grid.clearRowSelection(false);if(this.length>0){this.container.innerHTML="";this.element=this.dataTable=null;this.newRow=this.newRowXml=null;};if(this.items)this.items.length=this.length=0;this.level.resetColumnsMargins();}};PXGridRows.prototype.clear=function(){if(this.grid.editMode){var ar=this.grid.activeRow,pr=this.parentRow;if(ar&&(pr==null||pr.contains(ar)))this.grid.endEdit(true);};var $o=this.xmlNode.ownerDocument.createElement("Rows");$o.setAttribute("Level",this.xmlNode.getAttribute("Level"));$o.setAttribute("HashCode",this.xmlNode.getAttribute("HashCode"));this.xmlNode.parentNode.replaceChild($o,this.xmlNode);this.xmlNode=$o;this.repaint();this.grid.notifyCommandState();};PXGridRows.prototype.$0L=function(){var ar=this.grid.activeRow,pr=this.parentRow;var ac=this.grid.activeCell;if(ar&&(pr==null||pr.contains(ar))){this.grid.resetPosition();}};PXGridRows.prototype.getRow=function($p){if($p<0||$p>=this.length||!this.element.childNodes)return null;if($p>=this.items.length)this.items[this.length-1]=null;if(!this.items[$p]){var $m=null;if(this.grid.levels.length==1)$m=this.element.rows[$p];else{var cr=0,$q=this.element.rows;for(var i=0;i<$q.length;i++)if(!$q[i].getAttribute("childLevel")){if($p==cr){$m=$q[i];break;};cr++;}};if(!$m)return null;this.items[$p]=new PXGridRow($m,this,$p);};return this.items[$p];};PXGridRows.prototype.getRowByKey=function($r){return this.findExt($r,this.level.dataKey);};PXGridRows.prototype.indexOf=function($m){if(this.grid.levels.length==1)return $m.element.sectionRowIndex;var id=$m.element.id,$s=this.element.rows;var $p=-1;for(var i=0;i<$s.length;i++){if(!$s[i].getAttribute("childLevel")){$p++;if($s[i].id==id)return $p;}};return -1;};PXGridRows.prototype.setSelected=function($t){for(var i=0;i<this.length;i++){var $m=this.getRow(i);if($m)$m.setSelected($t);}};PXGridRows.prototype.selectRange=function($u,end){if(end<$u){var $v=$u;$u=end;end=$v;};var r=this.getRow($u);do{r.setSelected(true);r=r.nextRow();}while(r&&r.getIndex()<=end);};PXGridRows.prototype.addNew=function($w){if(!this.newRow||!this.newRowXml)return null;var $x=null;try{$x=this.newRow.cloneNode(true);}catch(ex){};if($x==null)return;var $d=this.newRowXml.cloneNode(true);$x.style.display="";$d.setAttribute("Visible","True");var $y=this.xmlNode.childNodes.length;var ar=this.grid.activeRow,$p=this.length;if($w&&ar&&ar.collection==this){$y=ar.xmlIndex;$p=ar.getIndex();}else $w=false;$d.setAttribute("i",$y);$x.setAttribute("xmlIndex",$y);if($w)for(var i=$p+1;i<this.length;i++)this.getRow(i);this.element.insertBefore($x,$w?ar.element:this.newRow);this.xmlNode.insertBefore($d,$w?ar.xmlNode:null);var $m=new PXGridRow($x,this,$p);$m.setStatus(PXRowStatus.AddNew);$m.recalcIndexing=$w;var id=[this.level.grid.ID,"row",$m.hashCode()];$x.id=id.join("_");this.items.splice($p,0,$m);this.length++;return $m;};PXGridRows.prototype.remove=function($m){var $p=-1;if(typeof($m)=="number"){$p=$m;$m=this.getRow($m);}else $p=$m.getIndex();if(!$m||$m.collection!=this||!this.element)return null;try{this.element.removeChild($m.element);}catch(ex){};if($m.expandable&&$m.childLevelRow)this.element.removeChild($m.childLevelRow);var status=$m.getStatus(),$z=$m.isActive();switch(status){case PXRowStatus.AddNew:this.xmlNode.removeChild($m.xmlNode);break;case PXRowStatus.Inserted:$m.setStatus(PXRowStatus.Unbound);break;case PXRowStatus.Unbound:break;default:$m.setStatus(PXRowStatus.Deleted);break;};this.items.splice($p,1);this.length--;if($m==this.grid.activeRow){this.grid.activeRow=null;this.grid.activeCell=null;if($z)this.level.navigator.hide(true);};return $m;};PXGridRows.prototype.removeRow=function($m){var $A=null;var $B=new Object();$B.row=$m;if(this.grid.fireEvent("beforeRowDelete",null,$B))return null;if($m.isClientNew()){$A=this.remove($m);this.grid.fireEvent("afterRowDelete",null,$B);}else{$m.setStatus(PXRowStatus.Deleted);if(!this.grid.batchUpdate)this.grid.updateRow($m);};return $A;};PXGridRows.prototype.find=function($C,$k,$D,$E){if($D==null)$D=0;if(!($k instanceof PXGridColumn))$k=this.level.getColumn($k);var $F=null;if($k&&$C){$C=$k.getTypedValue($C);if($k.dataType==NetType.String&&$C)$C=$C.toString().toLowerCase();for(var i=$D;i<this.length;i++){var $m=this.getRow(i);var $G=$m?$m.getCell($k):null;if($G==null)continue;var v=$G.getValue(),$H=false;if($k.dataType==NetType.String){if(v&&(($E&&String.compare(v,$C,true))||(!$E&&v.toLowerCase().indexOf($C)==0)))$H=true;}else if($k.dataType==NetType.DateTime){if(v&&v.getTime()==$C.getTime())$H=true;}else{if(v!=null&&v==$C)$H=true;};if($H){$F=$m;break;}}};if($F){$F.activate();$F.scrollToView();};return $F;};PXGridRows.prototype.findExt=function($I,$J,$D){if($D==null)$D=0;var $j=new Array(),$k;for(var i=0;i<$J.length;i++){$k=$j[i]=$J[i];if(!($k instanceof PXGridColumn))$j[i]=$k=this.level.getColumn($k);if($k==null)return null;$I[i]=$k.getTypedValue($I[i]);if($k.dataType==NetType.String&&$I[i])$I[i]=$I[i].toString().toLowerCase();};var $F=null;for(var j=$D;j<this.length;j++){var $m=this.getRow(j),$H=true;if($m==null)continue;for(var i=0;i<$j.length;i++){var $G=$m.getCell($j[i]);var $K=$G?$G.getValue():null;if($j[i].dataType==NetType.String&&$K)$K=$K.toLowerCase();if(!__px(this).equals($K,$I[i])){$H=false;break;}};if($H){$F=$m;break;}};if($F){$F.activate();$F.scrollToView();};return $F;};function PXGridRow($x,$s,$p){this.px_context=$s.px_context;this.element=$x;this.parentRow=$s.parentRow;this.collection=$s;this.level=this.collection.level;this.cells=new Array(this.level.columns.length);this.expandable=$x.getAttribute("expandable");this.childLevelRow=null;this.activationAttrs=["color","backgroundColor","border","borderTop","borderLeft","borderBottom","borderRight"];this.xmlIndex=parseInt($x.getAttribute("xmlIndex"));this.xmlNode=$s.xmlNode.childNodes[this.xmlIndex];this.cellsXml=this.xmlNode.getElementsByTagName("Cells")[0];this.style=this.xmlNode.getAttribute("Css");this.imageID=this.$0N();this.editorID=this.xmlNode.getAttribute("EditorID");var $a=this.level.grid;if(this.expandable){var e=$x.nextSibling;if(e&&e.getAttribute("childLevel")){this.childLevelRow=e;var $L=e.cells[this.level.firstColumnCell];var $M=this.xmlNode.getElementsByTagName("Rows")[0];this.rows=new PXGridRows($a,this,$L,$M);}};if(this.level.rowSelectorsVisible)this.selectorElem=$x.cells[this.level.firstColumnCell-1];$x.object=this;};PXGridRow.prototype.getCell=function($N){var $p=-1;if($N instanceof PXGridColumn)$p=$N.index;else if(typeof($N)=="number")$p=Number($N);else{var $k=this.level.getColumn($N.toString());if($k)$p=$k.index;};if($p<0||!this.cells||$p>=this.cells.length)return null;if(!this.cells[$p]){var $k=this.level.columns[$p];var $O=this.element.cells[this.level.firstColumnCell+$p];var cx=this.cellsXml;var $P=cx?cx.childNodes[$k.serverIndex]:null;this.cells[$p]=new PXGridCell($O,this,$k,$P);};return this.cells[$p];};PXGridRow.prototype.firstCell=function(){var $G=this.getCell(0);if($G&&!$G.column.canHasFocus())$G=$G.nextCell();return $G;};PXGridRow.prototype.lastCell=function(){var $G=this.getCell(this.cells.length-1);if($G&&!$G.column.canHasFocus())$G=$G.prevCell();return $G;};PXGridRow.prototype.getVisible=function(){return this.element.style.display=="";};PXGridRow.prototype.setVisible=function($Q){this.element.style.display=$Q?"":"none";if(!$Q){var $a=this.level.grid;if($a.activeRow==this){$a.activeRow=null;this.repaint();}}};PXGridRow.prototype.getSelected=function(){return this.selected==true;};PXGridRow.prototype.setSelected=function($t){if(this.selected!=$t){this.selected=Boolean($t);this.level.grid.storeRowSelection(this);this.repaint();}};PXGridRow.prototype.repaint=function(){this.repaintStatus();for(var i=0;i<this.level.columns.length;i++){var $G=this.getCell(i);if($G)$G.repaint();};this.repaintRow();if(this.isActive())this.level.navigator.updateRowCss();};PXGridRow.prototype.repaintRow=function(){var $R=new Array();if(this.dragover){$R.push("dragover ");$R.push((this.dragover==2)?"after":"before");};if(this.awaitPaste)$R.push("awaitPaste");$R=$R.length?$R.join(" ").trim():"";if(this.element.className!=$R)this.element.className=$R;};PXGridRow.prototype.getIndex=function(){if(this.collection)return this.collection.indexOf(this);return -1;};PXGridRow.prototype.$0M=function(){var $p=parseInt(this.xmlNode.getAttribute("i"));if($p!=this.xmlIndex){this.xmlIndex=$p;this.element.setAttribute("xmlIndex",$p);var id=[this.level.grid.ID,"row",this.hashCode()];this.element.id=id.join("_");}};PXGridRow.prototype.hashCode=function(){var ar=new Array();ar[0]=this.xmlIndex;var pr=this.parentRow;while(pr){ar[ar.length]=pr.xmlIndex;pr=pr.parentRow;};ar=ar.reverse();return ar.join("_");};PXGridRow.prototype.remove=function(){return this.collection.remove(this);};PXGridRow.prototype.removeRow=function(){return this.collection.removeRow(this);};PXGridRow.prototype.nextRow=function(){var r=this.getIndex()+1;while(r<this.collection.length&&!this.collection.getRow(r).getVisible())r++;if(r<this.collection.length)return this.collection.getRow(r);return null;};PXGridRow.prototype.prevRow=function(){var r=this.getIndex()-1;while(r>=0&&!this.collection.getRow(r).getVisible())r--;if(r>=0)return this.collection.getRow(r);return null;};PXGridRow.prototype.nearestRow=function(){var $m=this.nextRow();if($m==null)$m=this.prevRow();return $m;};PXGridRow.prototype.isLast=function(){return this.getIndex()==(this.collection.length-1);};PXGridRow.prototype.scrollToView=function(){this.level.grid.scrollToView(this.element,1);};PXGridRow.prototype.contains=function($m){if(!$m||$m.level.index>=this.level.index)return false;var $S=$m.parentRow;while($S){if($S==this)return true;$S=$S.parentRow;};return false;};PXGridRow.prototype.activate=function(){if(this.isActive()||!this.getVisible())return false;var $a=this.level.grid;var ac=$a.activeCell,$T=(ac!=null)?ac.getIndex():0;if(ac){var $B=new Object();$B.cell=this.getCell($T);$B.oldCell=ac;if($a.fireEvent("beforeCellChange",null,$B))return false;};if(!this.performActivate())return false;$a.activeCell=null;this.activateCell($T,false);if(ac){var $B=new Object();$B.cell=$a.activeCell;$B.oldCell=ac;$a.fireEvent("afterCellChange",null,$B);};return true;};PXGridRow.prototype.activateNearest=function(){var ar=this.nearestRow();if(ar!=null){ar.activate();return true;};return false;};PXGridRow.prototype.activateCell=function($p,$U){if(!this.isActive()||!this.getVisible())return;var $G=this.getCell($p);if(!$G)$G=this.getCell(0);if($G){if($G.column.canHasFocus())$G.activate($U);else $G.activateNearest($U);}};PXGridRow.prototype.isActive=function(){return this.level.grid.activeRow==this;};PXGridRow.prototype.isNew=function(){var st=this.getStatus();return st==PXRowStatus.Inserted||st==PXRowStatus.AddNew;};PXGridRow.prototype.isClientNew=function(){return this.isNew()&&!this.level.initNewRow;};PXGridRow.prototype.isServerNew=function(){return this.isNew()&&this.level.initNewRow;};PXGridRow.prototype.isEdit=function(){return this.isActive()&&this.level.grid.editMode;};PXGridRow.prototype.performActivate=function(){if(this.isActive())return true;var $a=this.level.grid,ar=$a.activeRow;var $V=this.getDataKey();var $r=$V==null?null:$V.join("|");var $B=new Object();$B.keyChanged=($a.lastDataKey!=$r);$B.row=this;$B.oldRow=$a.activeRow;$B.eventType=$a.event?$a.event.type:null;$B.fromUI=$a.filterApplication;if($a.fireEvent("beforeRowChange",null,$B))return false;if(ar){if($a.editMode){if(!($a.floatingEditor?ar.endEdit():$a.endEdit(false,false)))return false;};$a.activeCell=$a.activeRow=null;};$a.activeRow=this;this.level.navigator.show(this);$a.fireEvent("afterRowChange",null,$B);$a.lastDataKey=$r;return true;};PXGridRow.prototype.getDataKey=function(){var $N=this.level.dataKey,pk=new Array($N?$N.length:0);if($N)for(var i=0;i<$N.length;i++){var $G=this.getCell($N[i]);if($G)pk[i]=$G.getInvariantText();};return pk;};PXGridRow.prototype.getStatus=function(){var status=this.xmlNode.getAttribute("Status");if(status)return parseInt(status);return 0;};PXGridRow.prototype.setStatus=function(v){if(typeof(v)!="number"){status=parseInt(v);if(isNaN(v))v=PXRowStatus.NotSet;};if(v>=PXRowStatus.NotSet&&v<=PXRowStatus.Unbound){if(this.recalcIndexing&&v!=PXRowStatus.AddNew){this.collection.$0M(this.getIndex());delete this.recalcIndexing;};this.xmlNode.setAttribute("Status",v);this.repaintStatus();}};PXGridRow.prototype.hasNote=function(){return this.xmlNode.getAttribute("HasNote")!=null;};PXGridRow.prototype.getNoteText=function(){return this.noteText?this.noteText:"";};PXGridRow.prototype.setNoteText=function(v){this.noteText=v;if(v)this.xmlNode.setAttribute("HasNote",__px(this).getInvariantText(true));else this.xmlNode.removeAttribute("HasNote");this.repaintStatus();};PXGridRow.prototype.hasFiles=function(){return this.xmlNode.getAttribute("HasFiles")!=null;};PXGridRow.prototype.setHasFiles=function(v){if(v)this.xmlNode.setAttribute("HasFiles",__px(this).getInvariantText(true));else this.xmlNode.removeAttribute("HasFiles");};PXGridRow.prototype.setInfo=function($W){this.$0O("Info",$W);};PXGridRow.prototype.getInfo=function(){return this.$0P("Info");};PXGridRow.prototype.hasInfo=function(){return this.xmlNode.getAttribute("Info")!=null;};PXGridRow.prototype.$0O=function($X,$W){var n=this.xmlNode,e=this.selectorElem,$Y=false;var $Z=(this.xmlNode.getAttribute($X)!=null);if($W){$Y=!$Z;n.setAttribute($X,$W);if(e)__px(this).setTitle(e,$W);}else if($Z){$Y=true;n.removeAttribute($X);if(e)__px(this).setTitle(e,"");};if(e&&$Y)this.repaintStatus();};PXGridRow.prototype.setError=function($00){this.$0O("Error",$00);};PXGridRow.prototype.getError=function(){return this.$0P("Error");};PXGridRow.prototype.hasError=function(){return this.xmlNode.getAttribute("Error")!=null;};PXGridRow.prototype.setWarning=function($01){this.$0O("Warning",$01);};PXGridRow.prototype.getWarning=function(){return this.$0P("Warning");};PXGridRow.prototype.hasWarning=function(){return this.xmlNode.getAttribute("Warning")!=null;};PXGridRow.prototype.$0P=function($X){var $02=this.xmlNode.getAttribute($X);return $02?$02.replace(new RegExp("%0A","g"),"\r\n"):$02;};PXGridRow.prototype.hasErrorOrWarn=function(){if(this.hasError())return true;if(this.hasWarning())return true;for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i);if($G.hasError()||$G.hasWarning())return true;};return false;};PXGridRow.prototype.getErrorInfo=function(){var $02=this.getError(),status=$02?2:0;if(status==0){$02=this.getWarning();if($02)status=1;};if(status>0)return[status,$02];for(var i=0;i<this.cells.length;i++){var $03=this.getCell(i).getErrorInfo();if($03[0]>0){status=$03[0];$02=$03[1];if(status==2)break;}};return[status,$02];};PXGridRow.prototype.clearStatus=function($04){if(this.getStatus()!=PXRowStatus.AddNew)this.clearOldValues($04);this.setStatus(PXRowStatus.NotSet);};PXGridRow.prototype.clearErrors=function(){for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i);if($G&&($G.hasError()||$G.hasWarning()))$G.setError(null);};if(this.hasError())this.setError(null);if(this.hasWarning())this.setWarning(null);};PXGridRow.prototype.clearChanges=function($05){var $06=false;for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i),$07;if($G&&$G.dataChanged)if($G.clearChanges($05))$06=true;};if(!$06)this.dataChanged=false;};PXGridRow.prototype.clearManualInputFlag=function(){for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i);if($G)delete $G.manualInput;}};PXGridRow.prototype.clearOldValues=function($04){for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i);if($G)$G.clearOldValue($04);}};PXGridRow.prototype.endEdit=function($05){var $a=this.level.grid;if($a.activeCell)$a.activeCell.endEdit($05);if($05)this.cancelChanges();else if(!this.commitChanges())return false;return true;};PXGridRow.prototype.cancelChanges=function(){var $08=(this.getStatus()==PXRowStatus.AddNew);if($08&&this.autoCreated)return false;if($08){var ac=this.level.grid.activeCell;if(ac&&ac.row==this&&ac.editMode)ac.endEdit(true);if(this.level.initNewRow)this.removeRow();else this.collection.remove(this);}else if(this.dataChanged)this.clearChanges(true);return true;};PXGridRow.prototype.getEditor=function(){if(this.$0Q==null&&this.editorID&&__px_all(this)[this.editorID]){var $a=this.level.grid;var $L=$a.scrollDiv,$09=Function.createDelegate($a,$a.handleEditorEvents);var id=this.editorID,$0a="_"+id;this.$0Q=PXInlineEditor.createControl(this.px_context,id,$L,$09,$0a,$a.ID);var $0b=this.level.styles;this.$0Q.setClass($0b.cellEditor,$0b.editorText);};return this.$0Q;};PXGridRow.prototype.commitChanges=function($0c){var $a=this.level.grid,ac=$a.activeCell;var status=this.getStatus();this.commitCellChanges();var $0d=this.dataChanged;if($0d&&this.waitRefetch){$0d=false;for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i);if($G&&$G.dataChanged&&$G.manualInput){$0d=true;break;}}};if($0d){var $a=this.level.grid,$m=this;var $0e=this.isNew()?PXRowStatus.Inserted:PXRowStatus.Modified;if(!$a.raiseDBEvent(this,$0e,false))return false;if($0e!=status)this.setStatus($0e);if($0c==null)$0c=!$a.batchUpdate;if($0c){this.dataChanged=false;if(__px_cm($a).delayedCallback==null)__px_cm($a).delayedCallback=0;__px_cm($a).delayedCallback++;setTimeout(function(){$a.updateRow($m);if(__px_cm($a).delayedCallback)__px_cm($a).delayedCallback--;},0);}else{$a.raiseDBEvent(this,$0e,true);}}else if(status==PXRowStatus.AddNew){if(!this.autoCreated)this.cancelChanges();};return true;};PXGridRow.prototype.commitCellChanges=function(){if(this.isEdit()){var $G=this.level.grid.activeCell;if($G&&$G.editMode)$G.updateValue();}};PXGridRow.prototype.commitServerChanges=function($0f,$0g){var $0h=this.level;for(var i=0;i<$0f.childNodes.length;i++){var $0i=$0f.childNodes[i];var $0j=$0i.getAttribute("DataField");if(!$0j)continue;var $k=this.level.getColumn($0j),$0k=null;var $G=$k?this.getCell($k.index):null;if(!$G)continue;if($G.editMode){var $0l=$G.getEditorValue(),$0m=$G.getValue();if(!NetType.equals($G.getDataType(true),$0l,$0m))$0k=$0l;};var $0n=$0i.getAttribute("Error");var $01=$0i.getAttribute("Warning");if(($0n||$01)&&!$k.getVisible()){$0h.grid.suppressRepaint=true;$k.clearUIVisible();$k.setVisible(true);};$G.setError($0n?$0n:$01,$0n==null);var $0o=$0i.getAttribute("ReadOnly"),$0p=$G.getReadOnly(true);$G.setReadOnly($0o);var $0q=($G.getReadOnly(true)!=$0p);var $0r=$0i.getAttribute("DataType");if($0r!=null){$G.setDataType(parseInt($0r));$G.viewName=$0i.getAttribute("ViewName");$G.textField=$0i.getAttribute("TextField");$G.valueField=$0i.getAttribute("ValueField");$G.displayFormat=$0i.getAttribute("DisplayFormat");$G.setDecimals($0i.getAttribute("Decimals"));$G.valueItems=null;PXGridColumn.readValueItems($G,$0i);$0q=true;};var $0s=$0g&&($G.manualInput||$0k!=null);var v=$0i.getAttribute("Value");if(v!=null&&(!$0s||$0q)){if($G.getTextField()){var $02=$0i.getAttribute("Text");if($02!=null)$G.displayText=$02;};$G.setValue(v);};if(!$0g){$G.dataChanged=false;delete $G.manualInput;};if($G.editMode&&($0k==null||$0q)){var $0t=$G.getReadOnly(true)?$G.nextCell(false,true):null;if($0t){$0t.activate();$0t.scrollToView();}else{$G.repaintEditor();if(($0k==null))$G.editor.select();}}};if($0h.grid.suppressRepaint){delete $0h.grid.suppressRepaint;setTimeout(function(){$0h.repaint();},1);}};PXGridRow.prototype.getValuesXmlDoc=function($0u){var $0v=new PXXmlDoc("Row");this.$0R($0v,null,$0u);if(this.getStatus()==PXRowStatus.AddNew)$0v.rootNode.setAttribute("IsNew",1);return $0v;};PXGridRow.prototype.getDataChangesXmlDoc=function($0u){var $0v=new PXXmlDoc("RowChanges"),$0w;switch(this.getStatus()){case PXRowStatus.Modified:$0w="Modified";break;case PXRowStatus.Inserted:$0w="Inserted";break;case PXRowStatus.AddNew:$0w="Inserted";break;case PXRowStatus.Deleted:$0w="Deleted";break;};if($0w){var $n=$0v.addNode($0w,$0v.rootNode);this.$0R($0v,$n,$0u);};return $0v;};PXGridRow.prototype.$0R=function($0x,$0y,$0u){var $0f=$0y?$0x.addNode("Row",$0y):$0x.rootNode;var $0z=$0x.addNode("Cells",$0f);$0f.setAttribute("i",this.xmlIndex);var $r=this.level.dataKey;if($0u&&$r){for(var i=0;i<this.cells.length;i++){var $G=this.getCell(i),$N=$G.column.getKey();if(!$G.dataChanged&&!$G.hasError()&&!this.level.isDataKey($N))continue;var $0i=this.$0S($0x,$0z,$G.xmlNode);$0x.setProperty($0i,"Key",$N);};return $0f;};var $0A=this.xmlNode.getElementsByTagName("Cells")[0];for(var i=0;i<$0A.childNodes.length;i++)this.$0S($0x,$0z,$0A.childNodes[i]);return $0f;};PXGridRow.prototype.$0S=function($0x,$0y,$P){var $0i=$0x.addNode("Cell",$0y);$0x.setProperty($0i,"Value",$P.getAttribute("Value"));if(!this.isClientNew()){var $0m=$P.getAttribute("OldValue");if($0m!=null)$0x.setProperty($0i,"OldValue",$0m);};return $0i;};PXGridRow.prototype.repaintStatus=function(){if(this.selectorElem==null)return;var $0B=this.$0N(),$0C=true;var $0D=this.selectorElem,l=this.level,$0E=0;if(this.imageID!=$0B){var $0F=$0C?l.createImage($0B):l.getImage($0B);$0D.removeAttribute("error");if($0F==null){$0D.innerHTML="&nbsp;";}else{var $0G=function(){$0D.innerHTML="";$0D.appendChild($0F);$0F.onload=null;};if($0B=="rowError")$0E=2;else if($0B=="rowWarning")$0E=1;if($0E){$0F.setAttribute("error",$0E);$0D.setAttribute("error",$0E);};if($0F.tagName!="IMG"||$0F.complete)$0G();else $0F.onload=$0G;};this.imageID=$0B;};if(this.isActive())this.level.navigator.repaintSelector();var $0H=this.getCell("Notes"),$0I=this.getCell("Files");if($0H)$0H.setValue(this.hasNote()?1:0);if($0I)$0I.setValue(this.hasFiles()?1:0);};PXGridRow.prototype.$0N=function(){var $0B="rowLabel",status=this.getStatus();var $0J=(status!=PXRowStatus.NotSet)&&this.level.showRowStatus;if(this.hasError()){$0B="rowError";}else if(this.hasWarning()){$0B="rowWarning";}else if(this.hasInfo()){$0B="rowInfo";}else if($0J){switch(status){case PXRowStatus.AddNew:$0B="newRow";break;case PXRowStatus.Modified:$0B="modifiedRow";break;case PXRowStatus.Inserted:$0B="insertedRow";break;case PXRowStatus.Deleted:$0B="deletedRow";break;}};return $0B;};



function PXGridCell($a,$b,$c,$d){this.element=$a;this.row=$b;this.column=$c;this.xmlNode=$d;this.px_context=$c.px_context;this.viewName=$d.getAttribute("ViewName");this.displayFormat=$d.getAttribute("DisplayFormat");this.dateMask=$d.getAttribute("DateMask");this.textField=$d.getAttribute("TextField");this.valueField=$d.getAttribute("ValueField");this.style=this.xmlNode.getAttribute("Css");this.language=$d.getAttribute("Language");PXGridColumn.readValueItems(this,$d);PXGridColumn.readMaskItems(this,$d);this.allowStrings=$c.allowStrings;this.activationAttrs=["color","backgroundColor","border","borderTop","borderLeft","borderBottom","borderRight"];this.element.object=this;};PXGridCell.prototype.getValue=function(){if(!this.hasOwnProperty("value")){var $e=this.xmlNode.getAttribute("Value");this.value=this.getTypedValue($e);};return this.value;};PXGridCell.prototype.getTypedValue=function($e){return this.column.getTypedValue($e,this.getDataType(true),this.allowStrings)};PXGridCell.prototype.getText=function($e){if(this.displayText!==undefined)return this.displayText;if($e===undefined){var $f=this.xmlNode,$g=$f.getAttribute("Text");if($g==null)$g=$f.getAttribute("Value");return $g;};return this.column.getDisplayText($e,this);};PXGridCell.prototype.getInvariantText=function(){return this.column.getInvariantText(this.getValue());};PXGridCell.prototype.getIndex=function(){if(this.column)return this.column.index;return -1;};PXGridCell.prototype.scrollToView=function(){var $a=this.element;if(this.column.level.firstColumnCell>0){var $h=this.getIndex(),$i=($h==0);if(!$i)$i=(this.prevCell()==null);if($i)$a=this.element.parentNode.cells[0];};if(this.editor&&$a==this.element)$a=this.editor.element;this.column.level.grid.scrollToView($a);};PXGridCell.prototype.getReadOnly=function($j){var $e=this.xmlNode.getAttribute("ReadOnly"),$k=null;if($e!=null)$k=NetType.convert($e,NetType.Boolean);if($j&&$k==null)$k=!this.column.allowUpdate;return $k;};PXGridCell.prototype.setReadOnly=function($e){if($e==null)this.xmlNode.removeAttribute("ReadOnly");else{$e=NetType.convert($e,NetType.Boolean);this.xmlNode.setAttribute("ReadOnly",__px(this).getInvariantText($e));};this.repaint();};PXGridCell.prototype.getTimeMode=function($j){var $e=this.xmlNode.getAttribute("TimeMode"),$l=null;if($e!=null)$l=NetType.convert($e,NetType.Boolean);if($j&&$l==null)$l=this.column.timeMode;return $l;};PXGridCell.prototype.setTimeMode=function($e){if($e==null)this.xmlNode.removeAttribute("TimeMode");else{$e=NetType.convert($e,NetType.Boolean);this.xmlNode.setAttribute("TimeMode",__px(this).getInvariantText($e));}};PXGridCell.prototype.getDataType=function($j){var $m=this.$0K("DataType");if($j&&$m==null)$m=this.column.dataType;return $m;};PXGridCell.prototype.setDataType=function($e){if($e!=this.getDataType()){if(this.row.isEdit()&&this.oldType===undefined)this.oldType=this.getDataType();if(this.isCheckBox()&&$e!=NetType.Boolean)this.$0L();this.$0M("DataType",$e);delete this.value;this.$0N();}};PXGridCell.prototype.getTextField=function(){return this.textField?this.textField:this.column.textField;};PXGridCell.prototype.getIsPassword=function($j){var $e=this.xmlNode.getAttribute("IsPassword");var $n=($e!=null)?($e=="True"):null;if($j&&$n==null)$n=this.column.isPassword;return $n;};PXGridCell.prototype.getToolTip=function(){return this.xmlNode.getAttribute("ToolTip");};PXGridCell.prototype.getDecimals=function($j){var $o=this.$0K("Decimals");if($j&&$o==null)$o=this.column.decimals;return $o;};PXGridCell.prototype.setDecimals=function($e){this.$0M("Decimals",$e);this.decimals=$e;};PXGridCell.prototype.setViewName=function($e){this.$0M("ViewName",$e);this.viewName=$e;};PXGridCell.prototype.getViewName=function(){return this.viewName;};PXGridCell.prototype.isCheckBox=function(){return(this.column.type==PXColumnType.CheckBox)||(this.getDataType()==NetType.Boolean);};PXGridCell.prototype.$0K=function(name){var $e=this.xmlNode.getAttribute(name);return $e?parseInt($e):null;};PXGridCell.prototype.$0M=function(name,$e){if($e==null)this.xmlNode.removeAttribute(name);else this.xmlNode.setAttribute(name,$e);};PXGridCell.prototype.setValueItems=function($p){var $q=this.column.level.grid.xmlDocObject,$f;$q.removeNode("ValueItems",this.xmlNode);if($p!=null){$f=$q.addNode("ValueItems",this.xmlNode);for(var i=0;i<$p.length;i++){var $r=$p[i],$s=$q.addNode("ValueItem",$f);$s.setAttribute("Value",$r.value);if($r.displayValue)$s.setAttribute("DisplayValue",$r.displayValue);}};this.valueItems=$p;};PXGridCell.prototype.setValue=function($e){var $t=this.column,$u=this.getDataType(true);$e=this.getTypedValue($e);if((NetType.isNumeric($u)||$u==NetType.DateTime)&&!this.allowStrings&&isNaN($e)){return;};if(__px(this).equals($e,this.getValue())){if($t.level.isDataKey($t.dataField))this.$0O($e);this.$0N();return;};if($e!=null){var vi=this.valueItems;if($t.type==PXColumnType.DropDownList&&vi&&!vi.multiSelect){if($t.getValueItem($e,vi,$u)==null)return;}else if($t.type==PXColumnType.Icon&&(vi||$t.valueItems)){if($t.getValueItem($e,vi,$u)==null)return;};if($u==NetType.String){if($t.maxLength>0&&(!vi||!vi.multiSelect))$e=$e.substr(0,$t.maxLength);if($t.textCase==1)$e=$e.toUpperCase();else if($t.textCase==2)$e=$e.toLowerCase();}};this.$0O($e);this.value=$e;var $f=this.xmlNode;var $v=this.getInvariantText(),$g=this.getText($e);$f.setAttribute("Value",$v);if($g!=$v)$f.setAttribute("Text",$g);else $f.removeAttribute("Text");this.$0N();};PXGridCell.prototype.clearOldValue=function($w){var $x=this.xmlNode.getAttribute("OldValue");if($x!=null&&!this.hasError()){if($w)this.setValue($x);this.xmlNode.removeAttribute("OldValue");}};PXGridCell.prototype.$0O=function($y){if(!this.row.isNew()||this.row.level.initNewRow){var $x=this.xmlNode.getAttribute("OldValue");var $t=this.column,$z=$t.level;var $A=$z.isDataKey($t.dataField)&&this.hasError();if($x==null){if(!$A||this.getValue()==null)this.xmlNode.setAttribute("OldValue",this.getInvariantText());}else if(!$A&&__px(this).equals($y,this.getValue()))this.xmlNode.removeAttribute("OldValue");}};PXGridCell.prototype.clearChanges=function($B){if(this.dataChanged){if($B&&this.column.allowUpdate){if(this.oldType!==undefined)this.setDataType(this.oldType);this.setValue(this.oldValue);if(this.editor)this.setEditorValue(this.oldValue);};if(!this.manualInput||$B)this.dataChanged=false;if($B)delete this.manualInput;};delete this.oldValue;delete this.oldType;return this.dataChanged;};PXGridCell.prototype.updateValue=function($e,$C){var $t=this.column,$D=$t.level.grid,$b=this.row;if(this.getReadOnly(true))return false;var $E=($e===undefined);if($E&&this.editor)this.editor.storeChanges();var $y=$E?this.getEditorValue():$e;var $x=this.getValue(),$F=false,$G=false;if(!NetType.equals(this.getDataType(true),$y,$x)){var $H=new Object();$H.cell=this;if(!$D.fireEvent("beforeCellUpdate",null,$H)){if($E)this.$0P($y);this.setValue($y);this.setError(null);if(!$E)this.setEditorValue($y);if(this.oldValue===undefined)this.oldValue=$x;$b.dataChanged=this.dataChanged=true;if($b.waitRefetch||$b.waitInit)$G=true;if($b.autoCreated)delete $b.autoCreated;if($E){var $I=this.editor.getValues();if($I)for(var i=0;i<$I.length;i++){var $J=$b.getCell($I[i][0]);if($J)$J.updateValue($I[i][1]);}};$F=true;$D.fireEvent("afterCellUpdate",null,$H);if($C&&(!$D.callback||$C==2))$D.refetchRow($b);if($G)this.manualInput=true;if($D.dataSourceID){var ds=__px_alls(this)[$D.dataSourceID];if(ds&&$D.checkChanges)ds.setChanged();}}}else if(this.getTextField()&&$E){if(this.getText()!=this.editor.getDisplayText($y)){$b.dataChanged=this.dataChanged=$F=true;this.$0P($y);this.$0N();}};return $F;};PXGridCell.prototype.switchCheckState=function($K){if(!this.isCheckBox()||this.getReadOnly(true))return;var $L=this.column.level,$D=$L.grid;if($D.editMode){var $M=this.editor;if($M){$M.setValue(!$M.getValue());this.updateValue(undefined,this.column.commitChanges?2:0);if($M.elemFocus)$M.elemFocus.focus();}}else{if(this.column.allowCheckAll||$L.allowUpdate){this.updateValue(!this.getValue());this.row.commitChanges();}}};PXGridCell.prototype.getError=function(){return this.$0Q("Error");};PXGridCell.prototype.getWarning=function(){return this.$0Q("Warning");};PXGridCell.prototype.$0Q=function($N){var $g=this.xmlNode.getAttribute($N);return $g?$g.replace(new RegExp("%0A","g"),"\r\n"):$g;};PXGridCell.prototype.hasError=function(){return this.xmlNode.getAttribute("Error")!=null;};PXGridCell.prototype.hasWarning=function(){return this.xmlNode.getAttribute("Warning")!=null;};PXGridCell.prototype.getErrorInfo=function(){var $g=this.getError(),status=$g?2:0;if(status==0){$g=this.getWarning();if($g)status=1;};return[status,$g];};PXGridCell.prototype.getClipboardText=function(){var $O=this.$0R();if($O&&$O.nodeName=="#text")$O=this.element;var $g=__px(this).getInnerText($O),$P=this.getErrorInfo();if($P[0]>0)$g+=", "+$P[1];return $g.trim();};PXGridCell.prototype.setError=function($Q,$R){var n=this.xmlNode,e=this.element,$S=false;var $T=this.hasError()||this.hasWarning();if($Q){__px(this).setTitle(e,$Q);e.setAttribute("error",$R?1:2);if($R){n.removeAttribute("Error");n.setAttribute("Warning",$Q);}else{n.removeAttribute("Warning");n.setAttribute("Error",$Q);};var $O=this.$0R(),$U;var $V=this.column.level.images;if($O){var $W=$R?$V.rowWarning:$V.rowError;$U=this.$0S();if($U!=null)__px_cm(this).repaintImage($U,$W);else $U=this.$0T($O,$W);__px(this).setTitle($U,$Q);$U.setAttribute("error",$R?1:2);};if(!this.column.getVisible())$R?this.row.setWarning($Q):this.row.setError($Q);$S=true;}else if($T){var $X=this.getToolTip();__px(this).setTitle(e,($X!=null)?$X:"");n.removeAttribute("Error");n.removeAttribute("Warning");e.removeAttribute("error");var $O=this.$0R();if($O){var $U=$O.previousSibling;if($U&&__px_cm(this).isSpriteOrImage($U))$U.parentNode.removeChild($U);};$S=true;};if($S){this.repaint();if(this.row.isActive())this.row.level.navigator.update(this);}};PXGridCell.prototype.nextCell=function($Y,$Z){var nc=this.getIndex()+1,r=this.row,$00=r.cells;while(nc<$00.length){var c=r.getCell(nc);if(c.column.canHasFocus()&&(!$Z||!c.getReadOnly(true)))break;nc++;};if($Y&&nc==$00.length){nc=0;while(nc<$00.length){var c=r.getCell(nc);if(c.column.canHasFocus()&&(!$Z||!c.getReadOnly(true)))break;nc++;}};return(nc<$00.length)?r.getCell(nc):null;};PXGridCell.prototype.prevCell=function($Y,$Z){var pc=this.getIndex()-1,r=this.row;while(pc>=0){var c=r.getCell(pc);if(c.column.canHasFocus()&&(!$Z||!c.getReadOnly(true)))break;pc--;};if($Y&&pc<0){pc=r.cells.length-1;while(pc>=0){var c=r.getCell(pc);if(c.column.canHasFocus()&&(!$Z||!c.getReadOnly(true)))break;pc--;}};return(pc>=0)?r.getCell(pc):null;};PXGridCell.prototype.isLastCell=function(){var $01=true,r=this.row;for(var i=this.getIndex()+1;i<r.cells.length;i++){var c=r.getCell(i);if(c&&c.column.getVisible()){$01=false;break;}};return $01;};PXGridCell.prototype.nearColumnCell=function(){var $b=this.row.nearestRow();var $J=$b?$b.getCell(this.getIndex()):null;return $J;};PXGridCell.prototype.activate=function($02){if($02==null)$02=true;if(!this.column.canHasFocus())return false;var $L=this.column.level,$03=$L.highlightCell;var $D=$L.grid,ac=$D.activeCell;if($02){var $H=new Object();$H.cell=this;$H.oldCell=ac;if($D.fireEvent("beforeCellChange",null,$H))return false;};var $04=$D.editMode;if($D.activeRow!=this.row){if(!this.row.performActivate())return false;}else if(ac){$D.activeCell=null;if($04)ac.endEdit(false,ac.column.commitChanges&&!$D.callback);else if($03)ac.repaint();};$D.activeCell=this;if($04)this.beginEdit();else if($03)this.repaint();if($02)$D.fireEvent("afterCellChange",null,$H);return true;};PXGridCell.prototype.activateNearest=function($02){var ac=this.nextCell();if(ac==null)ac=this.prevCell();if(ac!=null)ac.activate($02);return ac!=null;};PXGridCell.prototype.isActive=function(){return this.column.level.grid.activeCell==this;};PXGridCell.prototype.repaint=function(){var $05=this.getStaticCss(),e=this.element;if(e.className!=$05)e.className=$05;if(this.row.isActive())this.row.level.navigator.repaint(this);};PXGridCell.prototype.getStaticCss=function($06){var $t=this.column,$07=(this.row.getIndex()%2==1);var $05=($07&&!$06)?$t.styles.alternate:$t.styles.normal;if(this.row.getSelected())$05=$t.level.styles.selRow;else if(this.hasError())$05+=" "+$t.level.styles.error;else if(this.hasWarning())$05+=" "+$t.level.styles.warning;else if(this.getReadOnly(true)&&$t.level.allowUpdate)$05+=" "+$t.level.styles.readOnlyCell;if($t.multiline&&$05.indexOf("wrapText")<0)$05+=" wrapText";if($t.ellipsis&&$05.indexOf("ellipsis")<0)$05+=" ellipsis";if(this.style)$05+=" "+this.style;if(this.row.style)$05+=" "+this.row.style;return $05;};PXGridCell.prototype.getDynamicCss=function($06){var $t=this.column,$L=$t.level,$D=$L.grid,$05="";if($D.activeCell==this&&$L.highlightCell)$05=$L.styles.activeCell;else if(this.row.getSelected())$05=$L.styles.selRow;else if($D.activeRow==this.row&&$L.highlightRow)$05=$L.styles.activeRow;else{var $07=(this.row.getIndex()%2==1);$05=($07&&!$06)?$t.styles.alternate:$t.styles.normal;};if(this.hasError())$05+=" "+$L.styles.error;else if(this.hasWarning())$05+=" "+$L.styles.warning;else if(this.getReadOnly(true)&&$L.allowUpdate)$05+=" "+$L.styles.readOnlyCell;if($t.multiline&&$05.indexOf("wrapText")<0)$05+=" wrapText";if($t.ellipsis&&$05.indexOf("ellipsis")<0)$05+=" ellipsis";if(this.style)$05+=" "+this.style;if(this.row.style)$05+=" "+this.row.style;return $05;};PXGridCell.prototype.beginEdit=function(){var $D=this.column.level.grid;if(!$D.editMode)return false;var $H=new Object();$H.cell=this;$D.fireEvent("beforeCellEdit",null,$H);this.editor=this.getEditor();if(this.editor){var ac=$D.activeCell;if(ac&&ac.editMode&&ac!=this)ac.endEdit(false);$D.fireEvent("cellEditorCreated",null,$H);if(!this.getReadOnly(true))this.$0U();if(!$D.hasHScroll()){$D.setOverflow("hidden","x");this.$0V=true;};this.editor.language=this.language;this.editor.show(this.element,$D.suppressFocus?null:true);this.editMode=true;this.$0W();$D.repaintStatusBar();this.scrollToView();var $H=new Object();$H.cell=this;$D.fireEvent("startCellEdit",null,$H);return true;};return false;};PXGridCell.prototype.$0W=function(){var $t=this.column,$D=$t.level.grid,et=this.editor.editorType;if(et==PXEditorType.Selector||et==PXEditorType.SegmentMask)$D.viewState.update("EditingField",this.column.getKey());};PXGridCell.prototype.endEdit=function($B,$C){var $t=this.column,$D=$t.level.grid,$F=false;if($D.editMode&&this.editMode){if(!$B&&!this.getReadOnly()){var $08=this.editor.getText(),$09=this.getText();var $0a=this.editor.control,$0b=__px_callback(this).waitCallback;if($08!=$09){if($0a.execBlurCommand)$0a.execBlurCommand();if(!$0b&&__px_callback(this).waitCallback){__px(this).registerCallbackTask(this,this.$0X,$C);return;}};this.allowStrings=($0a.allowStrings===true);try{$F=this.updateValue(undefined,$C);}catch(ex){alert(ex.type+": "+ex.message);}};$D.viewState.remove("EditingField");this.editor.hide();this.editor=null;this.editMode=false;if(this.$0V){$D.setOverflow("auto","x");delete this.$0V;};$D.alignStatMargins();var $H=new Object();$H.cell=this;$D.fireEvent("endCellEdit",null,$H);};return $F;};PXGridCell.prototype.$0X=function($C){this.endEdit(false,$C);};PXGridCell.prototype.repaintEditor=function(){if(!this.editMode)return;var $0c=this.getEditor(),$0d=false;if($0c!=this.editor){if(this.editor)this.editor.hide();this.editor=$0c;$0d=true;};if(this.editor){var $D=this.column.level.grid;if(!this.getReadOnly(true))this.$0U();if($0d)this.editor.show(this.element,$D.suppressFocus?null:true);this.$0W();}};PXGridCell.prototype.getEditorValue=function(){if(!this.getReadOnly(true)&&this.editor){var $e=this.editor.getValue(true);this.allowStrings=(this.editor.control.allowStrings===true);return this.getTypedValue($e);};return null;};PXGridCell.prototype.setEditorValue=function($e){if(this.column.allowUpdate&&this.editor){this.editor.setValue($e);var id=this.editor.id,me=this;setTimeout(function(){__px(me).selectElement(id,true);},1);}};PXGridCell.prototype.setEditorPos=function($0e){if(this.editor)this.editor.setPosition(this.element,$0e);};PXGridCell.prototype.isValueChanged=function(){if(!this.getReadOnly(true)&&this.editor){var $0f=this.getValue(),$0g=this.getEditorValue();return !NetType.equals(this.getDataType(true),$0f,$0g);};return false;};PXGridCell.prototype.$0P=function($0h){var $0i=this.getTextField();if($0i&&this.editor){this.displayText=this.editor.getDisplayText($0h);this.xmlNode.setAttribute("Text",this.displayText);}else if(!$0i){delete this.displayText;this.xmlNode.removeAttribute("Text");};return this.displayText;};PXGridCell.prototype.$0U=function(){if(!this.getReadOnly(true)&&this.editor){var et=this.editor.editorType;var $0j=(et==PXEditorType.TextBox)||(et==PXEditorType.TextArea);var v=$0j?this.getInvariantText():this.getValue();this.editor.setValue(v,this.getTextField()?this.getText():undefined);}};PXGridCell.prototype.getEditor=function($0k){var $k=this.getReadOnly(true)&&!$0k;var $m=this.getDataType(),$0l;var $D=this.column.level.grid,$M,$0m=this.getIsPassword();if($k||$m==NetType.Boolean){$M=$D.getEditor(PXEditorType.FocusDiv);}else $M=this.row.getEditor();var $0n=($m!=null||$0m!=null||this.valueItems!=null||this.displayFormat||this.viewName);if($M==null&&$0n){var $0o=-1,$0p=false;if(this.valueItems!=null)$0o=PXEditorType.DropDown;else if($0m)$0o=PXEditorType.Password;else if(this.viewName)$0o=this.maskItems?PXEditorType.SegmentMask:PXEditorType.Selector;else if(NetType.isNumeric($m))$0o=PXEditorType.NumberEdit;else if($m==NetType.DateTime)$0o=PXEditorType.DateEdit;else if(this.displayFormat)$0o=PXEditorType.MaskEdit;if($0o>=0){$0l=this.column.getEditor($0k,$0m!=null);$M=$D.getEditor($0o);if($M){var $0q=$M.control.__className;var c2=$0l.control,$0r=c2.constructor.__baseType;if($0r)$0p=($0q==$0r.__className);if($0q==c2.__className||$0p)$M=$0l;}else $M=$0l;};if($M!=null){var $0s=this.column.level.styles,$0a=$M.control;$M.setClass($0s.cellEditor,$0s.editorText);$0a.elemText.style.textAlign=this.column.textAlign;$0a.allowNull=this.column.allowNull;$0a.nullText=this.column.nullText;var $0t=$0p?$0a.constructor.__baseType.__className:$0a.__className;switch($0t){case "PXDropDown":$0a.valueType=$m;$0a.setAllowEdit(!this.valueItems.exclusive);$0a.allowMultiSelect=this.valueItems.multiSelect;PXInlineEditor.fillValueItems($0a,this.valueItems);break;case "PXNumberEdit":var $o=this.getDecimals(true);if($0a.setDecimals)$0a.setDecimals($o);else $0a.decimals=$o;break;case "PXDateTimeEdit":$0a.setTimeMode(this.getTimeMode(true));if(this.dateMask)$0a.setDateMask(this.dateMask,this.dateMask);break;case "PXMaskEdit":$0a.setInputMask(this.displayFormat);break;case "PXSelector":$0a.setViewName(this.viewName);$0a.valueField=this.valueField?this.valueField:this.column.valueField;$0a.textField=this.getTextField();$0a.setInputMask(this.displayFormat);$0a.setHintState();$0a.ownerID=$D.ID;if(this.column.displayMode==0){$0a.textField=$0a.hintField="";$0a.setHintState();};if($0a.sourceID)__px_all(this)[$0a.sourceID].ownerID=$D.ID;break;case "PXSegmentMask":$0a.setViewName(this.viewName);$0a.setItems(this.maskItems);if(!$0p||!$0a.valueField)$0a.valueField=this.valueField;$0a.ownerID=$D.ID;if($0a.sourceID)__px_all(this)[$0a.sourceID].ownerID=$D.ID;break;}}};if($M==null){var $0u=this.getReadOnly();$M=$0l?$0l:this.column.getEditor($0u===false||$0k,$0m!=null);};return $M;};PXGridCell.prototype.showButton=function(){var $t=this.column;if($t.type!=PXColumnType.Button||$t.buttonDisplay!=0)return;var $D=$t.level.grid,$a=$D.getCellButton();if($a==null||($a.oCell==this&&$a.style.display==""))return;var ce=this.element,$0v=$D.scrollDiv;var $0w=__px(this).getElemLeftPos(ce,$0v,false);var top=__px(this).getElemTopPos(ce,$0v,false);var $0x=$a.style;$0x.left=$0w+"px";$0x.top=top+"px";$0x.width=ce.clientWidth+"px";$0x.height=ce.clientHeight+"px";$a.value=this.getText();$a.className=$t.styles.cellButton;$a.oCell=this;$0x.display="";};PXGridCell.prototype.hideButton=function(){var $D=this.column.level.grid,$a=$D.getCellButton();if($a!=null&&$a.style.display==""&&$a.oCell==this){$a.style.display="none";$a.oCell=null;}};PXGridCell.prototype.$0N=function(){var $e=this.getValue(),$g=this.getText($e);switch(this.column.type){case PXColumnType.CheckBox:this.$0Y($e);break;case PXColumnType.HyperLink:this.$0Z($g);break;case PXColumnType.Button:if(this.column.buttonDisplay==1){var $0y=this.element.getElementsByTagName("INPUT")[0];if($0y)$0y.value=$g;}else __px(this).setElemText(this.element,$g?$g:"\xA0");break;case PXColumnType.Icon:if($g){var e=__px_cm(this).findSpriteOrImage(this.element);if(!e)__px_cm(this).createSpriteOrImage(this.element,$g);else __px_cm(this).repaintImage(e,$g);}else this.element.innerHTML="&nbsp;";break;default:if(this.isCheckBox()){this.$0Y($e);}else if(this.column.viewLink){if(__px(this).getInnerText(this.element)!=$g.trimEnd())this.$10($g);}else if(__px(this).getInnerText(this.element)!=$g.trimEnd()){var $0z=this.element.getElementsByTagName("span");$g=$g?$g:"\xA0";var $0A=this.language||(!this.row.level.grid.matrixMode&&this.column.defaultLocale);var $0B='<a href="javascript:void 0" data-lang="true" class="lang">'+$0A+'</a><span class="text">'+$g+'</span>';if($0z.length>0){if($0A)this.element.innerHTML=$0B;else this.element.innerHTML=$g;}else{if($0A)this.element.innerHTML=$0B;else __px(this).setElemText(this.element,$g);}};break;};if(this.row.isActive())this.row.level.navigator.update(this);};PXGridCell.prototype.$11=function($g){var $0C="",$W=$g,$0D=$g;var $0E=$W.indexOf("@");if($0E>-1){$0C="_blank";$W=$g.substr($0E+1);var $0D=$g.substr(0,$0E);if($W[0]=='['){var $0F=$W.indexOf(']');if($0F>-1){$0C=$W.substr(1,$0F-1);$W=$W.substr($0F+1);}}};return[$W,$0C,$0D];};PXGridCell.prototype.$0Z=function($g){var e=this.element.getElementsByTagName("A")[0];var $0G=this.$11($g);e.href=$0G[0];e.target=$0G[1]?$0G[1]:"_self";__px(this).setElemText(e,$0G[2]?$0G[2]:"");this.xmlNode.setAttribute("Href",$0G[0]);this.xmlNode.setAttribute("Target",$0G[1]);};PXGridCell.prototype.$10=function($g){var e=this.element.getElementsByTagName("A")[0];if($g){if(!e){var te=__px(this).findTextElem(this.element);if(te)te.parentNode.removeChild(te);e=__px(this).createElement("A",this.element);e.href="javascript:void 0";};var $0z=e.getElementsByTagName("span");if($0z.length>0)e.innerHTML=$g;else __px(this).setElemText(e,$g);}else{if(e)e.parentNode.removeChild(e);else this.element.innerHTML="\xA0";}};PXGridCell.prototype.$0Y=function($K){var $e=Boolean.parse($K,null);var name=$e?"checked":"unChecked";var $W=this.column.level.images[name];if(!$W)this.element.innerHTML=$e?"v":"&nbsp;";else{var im=this.$0R();if(im!=null)__px_cm(this).repaintImage(im,$W);else{var $U=__px_cm(this).createSpriteOrImage(null,$W);$U.setAttribute("check",1);this.element.innerHTML="";this.element.appendChild($U);}}};PXGridCell.prototype.$0R=function(){var e=this.element;if(this.isCheckBox())return __px_cm(this).findSpriteOrImage(this.element,"check");switch(this.column.type){case PXColumnType.HyperLink:return e.getElementsByTagName("A")[0];case PXColumnType.Button:return e.getElementsByTagName("INPUT")[0];};if(this.column.viewLink){var $0H=e.getElementsByTagName("A")[0];if($0H!=null)return $0H;};var $0I=e.querySelector('.text');return $0I?$0I:__px(this).findTextElem(e);};PXGridCell.prototype.$0T=function($O,$W){var $U=__px_cm(this).createSpriteOrImage(null,$W);var $0J=(this.column.textAlign=="right")?"left":"right";$U.setAttribute("error",2);if($U.tagName=="IMG")$U.align=$0J;else $U.style.cssFloat=$0J;$O.parentNode.insertBefore($U,$O);return $U;};PXGridCell.prototype.$0S=function($O){return __px_cm(this).findSpriteOrImage(this.element,"error");};PXGridCell.prototype.$0L=function(){var im=__px_cm(this).findSpriteOrImage(this.element,"check");if(im!=null)im.parentNode.removeChild(im);};



function PXFilterEditor($a,$b,$c,$d){PXFilterEditor.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXFilterEditor.properties);this.readFilters($c);this.stringCond=["LIKE","RLIKE","LLIKE","NOTLIKE","IN","NI"];this.dateCond=["TODAY","OVERDUE","TODAY_OVERDUE","TOMMOROW","THIS_WEEK","NEXT_WEEK","THIS_MONTH","NEXT_MONTH"];this.nullCond=["ISNULL","ISNOTNULL"];this.viewState=new PXStateBag(this,"PXFilterEditor");if(this.elemContent){var $e=this.elemContent.rows;this.controlCell=$e[0].cells[0];if(this.buttonsPosition==1){this.actionsCell=$e[0].cells[1];this.buttonsCell=$e[1].cells[0];}else{this.actionsCell=$e[1].cells[0];this.buttonsCell=$e[1].cells[1];}};var e=__px(this).elemByID($b.id+"_gf");if(e){var $f=__px_cm(this).createControl("PXGrid",e.id);if($f){this.grid=__px_all(this)[e.id]=$f;this.grid.onLoad();$f.checkChanges=false;var h1=Function.createDelegate(this,this.handleRowUpdate);var h2=Function.createDelegate(this,this.handleRowDeleting);var h3=Function.createDelegate(this,this.handleCellUpdated);var h4=Function.createDelegate(this,this.handleRowChanged);var h5=Function.createDelegate(this,this.handleCommandState);var h6=Function.createDelegate(this,this.handleBeforeCellEdit);var h7=Function.createDelegate(this,this.handleStartCellEdit);$f.events.addEventHandler("afterRowUpdate",h1);$f.events.addEventHandler("afterRowInsert",h1);$f.events.addEventHandler("beforeRowDelete",h2);$f.events.addEventHandler("afterCellUpdate",h3);$f.events.addEventHandler("afterRowChange",h4);$f.events.addEventHandler("afterEnterEditMode",h4);$f.events.addEventHandler("commandState",h5);$f.events.addEventHandler("beforeCellEdit",h6);$f.events.addEventHandler("cellEditorCreated",h7);if($f.rows.length>0){this.filterStored=true;}}};var e=__px(this).elemByID($b.id+"_dd");if(e){var dd=__px_cm(this).createControl("PXDropDown",e.id);if(dd){this.dropDown=__px_all(this)[e.id]=dd;var h1=Function.createDelegate(this,this.handleFilterChanging);var h2=Function.createDelegate(this,this.handleFilterChanged);dd.events.addEventHandler("selectionChanging",h1);dd.events.addEventHandler("selectionChanged",h2);if(dd.items.length)this.storeFilterID();}};this.removeCall=__px_callback(this).createCommand("RemoveFilter",true);this.insertCall=__px_callback(this).createCommand("InsertFilter",true);this.updateCall=__px_callback(this).createCommand("UpdateFilter",true);this.inputCall=__px_callback(this).createCommand("InputBox",true);this.persistCall=__px_callback(this).createCommand("PersistFilter",true);this.initializeButtons();this.initializeCheckBox();this.setButtonsState();if(this.dragManager)this.dragManager.showContent=true;};PXFilterEditor.__baseType=PXSmartPanel;PXFilterEditor.properties=[["linkedGridID",JSType.String,""],["buttonsPosition",JSType.Int,0],["allowRowsCommit",JSType.Bool,false]];PXFilterEditor.prototype.setProperties=function($c){this.readFilters($c);this.setCheckersState_($c.filterID);this.setButtonsState();};PXFilterEditor.prototype.readFilters=function($c){this.defaultFilters=$c.defaultFilters?$c.defaultFilters:[];this.sharedFilters=$c.sharedFilters?$c.sharedFilters:[];this.quickFilters=$c.quickFilters?$c.quickFilters:[];this.systemFilters=$c.systemFilters?$c.systemFilters:[];this.strangeFilters=$c.strangeFilters?$c.strangeFilters:[];this.ownedFilters=$c.ownedFilters?$c.ownedFilters:[];this.isSharedEditable=$c.isSharedEditable?$c.isSharedEditable:false;this.isSharedVisible=$c.isSharedVisible?$c.isSharedVisible:false;this.allowSharedFilterSaving=$c.allowSharedFilterSaving?$c.allowSharedFilterSaving:false;};PXFilterEditor.prototype.setCheckersState_=function($g){var $h=Array.contains(this.defaultFilters,$g);var $i=Array.contains(this.sharedFilters,$g);var $j=Array.contains(this.quickFilters,$g);var $k=Array.contains(this.systemFilters,$g);if(this.chkDefault)this.chkDefault.setChecked($h);if(this.chkShared)this.chkShared.setChecked($i);if(this.chkShortcut)this.chkShortcut.setChecked($j);if(this.chkSystem)this.chkSystem.setChecked($k);};PXFilterEditor.prototype.addSharedFilter=function($g){if(!Array.contains(this.sharedFilters,$g))this.sharedFilters.push($g);};PXFilterEditor.prototype.removeSharedFilter=function($g){Array.remove(this.sharedFilters,$g);};PXFilterEditor.prototype.show=function($l){PXFilterEditor.callBase(this,"show",[$l]);if(this.grid){if(this.grid.activeRow==null){var ar=this.grid.rows.getRow(0);if(ar)ar.activate();};this.grid.adjustColumns();this.grid.focus();this.grid.onVisibleChanged(true);if(this.refreshRequired&&this.getFilterID())this.grid.refresh();delete this.refreshRequired;};this.isDirty=false;};PXFilterEditor.prototype.hide=function(){var $m=(this.dialogResult==PXDialogResult.Cancel||this.dialogResult==PXDialogResult.None);this.grid.endEdit($m);if(!$m){if(this.dropDown&&this.hasFilterID()&&this.grid.getChanged()){this.updateGrid(false);};this.storeFilter();};PXFilterEditor.callBase(this,"hide");};PXFilterEditor.prototype.setHeight=function($n){$n=this.getEffectiveHeight($n);if(this.buttonsPosition==0){var $o=this.elemContent.offsetHeight-this.controlCell.offsetHeight;$n-=$o;};var ar=[this.controlCell,this.elemContent,this.contentCell,this.element];if(this.grid)this.grid.setHeight($n-this.grid.element.offsetTop);for(var i=0;i<ar.length;i++)ar[i].style.height=$n+"px";};PXFilterEditor.prototype.getFilterID=function(){var $p=this.dropDown?this.dropDown.getValue():null;return($p!=null)?parseInt($p):null;};PXFilterEditor.prototype.setFilterID=function(id){if(this.dropDown&&id!=null&&(id!=this.getFilterID()||this.needRefresh)){this.dropDown.setValue(id);this.handleFilterChanged(this.dropDown);delete this.needRefresh;}};PXFilterEditor.prototype.hasFilterID=function(){var id=this.getFilterID();return id!=null&&id>0;};PXFilterEditor.prototype.getFilterItems=function(){if(this.dropDown){var $q=this.dropDown.items;var $r=new Array();for(var i=1;i<$q.length;i++){var $s=[parseInt($q[i].value),$q[i].text];$r.push($s);};return $r;};return null;};PXFilterEditor.prototype.setFilterItems=function($q){if(this.dropDown){var $t=this.dropDown.items[0],$u=$t.value+'|'+$t.text;this.dropDown.setItems($u+($q?(';'+$q):""));if(!this.dropDown.getValue()){this.clear();this.needRefresh=true;}}};PXFilterEditor.prototype.hasFilter=function(){if(this.filterStored){if(this.hasFilterID())return true;if(this.grid&&this.grid.rows.length>0)return true;};return false;};PXFilterEditor.prototype.getFilteredGrid=function(){return this.filteredGrid?this.filteredGrid:__px_all(this)[this.linkedGridID];};PXFilterEditor.prototype.isEditable=function($g){return(!Array.contains(this.strangeFilters,$g)||Array.contains(this.sharedFilters,$g));};PXFilterEditor.prototype.handleUpdateFilterCheckFilterInsert=function($v,$a){var $w=this.getFilterID();var $i=Array.contains(this.sharedFilters,$w);if($v&&$i){var $x=parseInt($v);var name=this.dropDown.getDisplayText($w);var $j=Array.contains(this.quickFilters,$w);var $k=Array.contains(this.systemFilters,$w);var $y=Array.contains(this.strangeFilters,$w);var $z=Array.contains(this.ownedFilters,$w);var $h=Array.contains(this.defaultFilters,$w);this.chkShared.setChecked(false);this.dropDown.removeItem($w);Array.remove(this.sharedFilters,$w);if($j){Array.remove(this.quickFilters,$w);this.quickFilters.push($x);};if($k){Array.remove(this.systemFilters,$w);};if($y){Array.remove(this.strangeFilters,$w);};this.ownedFilters.push($x);if($z)Array.remove(this.ownedFilters,$w);if($h){Array.remove(this.defaultFilters,$w);this.defaultFilters.push($x);};var $A=new Object();$A.filterName=name;this.handleInsertFilter($v,$A);}};PXFilterEditor.prototype.save=function(){var $g=this.getFilterID();if(!this.hasFilterID()){var $B=this.inputBox;this.saveAsMode=false;if(!$B){var $C=Function.createDelegate(this,this.handleInputBox);__px_callback(this).execI(this,this.inputCall,"",$C);}else $B.show();}else{if(this.grid.getDataChanges()){var $D=Array.contains(this.sharedFilters,$g);if($D){var $E=true;try{$E=confirm(this.grid.filterChangesInSharedMsg);}catch(ex){$E=true;};if(!$E)return;};var $i=this.chkShared.getChecked(),$F=__px(this).getInvariantText($i);if($i&&!this.isSharedEditable){var $G=__px(this).getInvariantText(this.chkDefault.getChecked());var $H=__px(this).getInvariantText(this.chkShortcut.getChecked());var ar=[$G,$F,$H,name];var $C=Function.createDelegate(this,this.handleUpdateFilterCheckFilterInsert);__px_callback(this).execI(this,this.persistCall,ar.join("|"),$C);}else this.updateGrid();}else if(this.headerChanged){var $G=__px(this).getInvariantText(this.chkDefault.getChecked());var $F=__px(this).getInvariantText(this.chkShared.getChecked());var $H=__px(this).getInvariantText(this.chkShortcut.getChecked());var ar=[$G,$F,$H,name];var $C=Function.createDelegate(this,this.handleUpdateFilterCheckFilterInsert);__px_callback(this).execI(this,this.persistCall,ar.join("|"),$C);};delete this.headerChanged;};this.setButtonsState();};PXFilterEditor.prototype.saveAs=function(){if(this.hasFilterID()){var $B=this.inputBox;this.saveAsMode=true;if(!$B){var $C=Function.createDelegate(this,this.handleInputBox);__px_callback(this).execI(this,this.inputCall,"",$C);}else $B.show();}};PXFilterEditor.prototype.remove=function(){var $g=this.getFilterID();if(this.hasFilterID()&&this.isEditable($g)){var $E=true;try{$E=confirm(this.grid.filterRemoveMsg);}catch(ex){$E=true;};if(!$E)return;var $G=__px(this).getInvariantText(this.chkDefault.getChecked());var $F=__px(this).getInvariantText(this.chkShared.getChecked());var $H=__px(this).getInvariantText(this.chkShortcut.getChecked());var name=this.dropDown.getDisplayText($g);var ar=[$G,$F,$H,name,$g];var $C=Function.createDelegate(this,this.handleRemoveFilter);__px_callback(this).execI(this,this.removeCall,ar.join("|"),$C);}};PXFilterEditor.prototype.clear=function(){if(this.dropDown==null){this.grid.rows.clear();this.setButtonsState();}else{var $I=new Object();if(this.handleFilterChanging(this.dropDown,$I)){this.dropDown.setValue(-1);this.handleFilterChanged(this.dropDown,$I,true);}}};PXFilterEditor.prototype.addRow=function($J,$K,$L){var $e=this.grid.rows,ev=new Object();var $M=($e.length>0)?$e.getRow($e.length-1):null;if($M==null||!$M.autoCreated)$M=this.grid.addNewRow();$M.getCell("IsUsed").updateValue(true);$M.getCell("OpenBrackets").updateValue("0");$M.getCell("DataField").updateValue($J);$M.getCell("Condition").updateValue($K);$M.getCell("Value").updateValue($L);$M.getCell("CloseBrackets").updateValue("0");$M.getCell("Operator").updateValue("0");ev.cell=$M.getCell("Value");this.handleBeforeCellEdit(this.grid,ev);};PXFilterEditor.prototype.updateFilter=function(){var $g=this.getFilterID();if(this.hasFilterID()&&this.isEditable($g)){var name=this.dropDown.getDisplayText($g);var $N=__px(this).getInvariantText(this.chkDefault.getChecked());var $F=__px(this).getInvariantText(this.chkShared.getChecked());var $H=__px(this).getInvariantText(this.chkShortcut.getChecked());var $C=Function.createDelegate(this,this.handleUpdateFilter);this.storeFilterID();var ar=[$N,$F,$H,name];__px_callback(this).execI(this,this.updateCall,ar.join("|"),$C);this.headerChanged=true;}};PXFilterEditor.prototype.initializeButtons=function(){var $O=this.buttonsCell.childNodes;var $C=Function.createDelegate(this,this.handleActionClick);for(var i=0,j=0;i<$O.length;i++){var $b=$O[i];if($b.tagName!="BUTTON")continue;var $v=(i==0)?PXDialogResult.OK:PXDialogResult.Cancel;var $c=new Object(),$P;$c.dialogResult=$v;$c.styles=new Object();$c.styles.normal=$b.className;$b.id=this.ID+"_"+j;__px_all(this)[$b.id]=$P=new PXButton(this.px_context,$b,$c);if(this.linkedGridID){switch(i){case 0:this.btnOk=$P;break;case 1:this.btnCancel=$P;break;};$P.events.addEventHandler("click",$C);};j++;};$O=this.actionsCell.childNodes;for(var i=0,j=0;i<$O.length;i++){var $b=$O[i],$c=new Object(),$P;if($b.tagName!="BUTTON")continue;$c.styles=new Object();$c.styles.normal=$b.className;$b.id=this.ID+"_a"+j;__px_all(this)[$b.id]=$P=new PXButton(this.px_context,$b,$c);switch(j){case 0:this.btnClear=$P;break;case 1:this.btnSave=$P;break;case 2:this.btnSaveAs=$P;break;case 3:this.btnRemove=$P;break;};$P.events.addEventHandler("click",$C);j++;}};PXFilterEditor.prototype.initializeCheckBox=function(){var $C=Function.createDelegate(this,this.handleActionClick);var $Q=["_cd","_cs","_ch","_ss"],$b;for(var i=0;i<$Q.length;i++){$b=__px(this).elemByID(this.element.id+$Q[i]);if($b){var $P=new PXCheckBox(this.px_context,$b,new Object());__px_all(this)[$b.id]=$P;$P.events.addEventHandler("click",$C);switch(i){case 0:this.chkDefault=$P;break;case 1:this.chkShared=$P;break;case 2:this.chkShortcut=$P;break;case 3:this.chkSystem=$P;this.chkSystem.setEnabled(false);break;}}}};PXFilterEditor.prototype.setButtonsState=function(){if(this.dropDown){var $g=this.getFilterID(),$R=this.hasFilterID();var $k=$R&&!this.isEditable($g);var $i=$R&&Array.contains(this.sharedFilters,$g);var $S=!$i||($i&&this.allowSharedFilterSaving);this.btnRemove.setEnabled($R&&$S&&!$k);this.btnSave.setEnabled($S);this.btnSaveAs.setEnabled($R);this.chkDefault.setEnabled($R&&!$k&&$S);if(this.isSharedVisible)this.chkShared.setEnabled($R&&!$k&&this.allowSharedFilterSaving&&this.isSharedEditable);this.chkShortcut.setEnabled($R&&!$i&&!$k);this.grid.levels[0].allowUpdate=Boolean($S);this.grid.levels[0].allowAddNew=Boolean($S);this.grid.levels[0].allowDelete=Boolean($S);this.grid.levels[0].getColumn("IsUsed").allowCheckAll=$S;}};PXFilterEditor.prototype.setConditionsState=function(){var $T=this.calculateRowInformation(),$M=this.grid.activeRow;var $U=this.grid.levels[0].getColumn("Condition"),vi=$U.valueItems;for(var i=0;i<vi.length;i++){var $V=vi[i].value,$W=true;if(!$T.isDate&&Array.contains(this.dateCond,$V))$W=false;if(!$T.isString&&Array.contains(this.stringCond,$V))$W=false;vi[i].enabled=$W;};vi[vi.length-1].enabled=false;vi[vi.length-2].enabled=false;if($M){var $X=$M.getCell($U);if($X&&$X.editMode)$X.repaintEditor();}};PXFilterEditor.prototype.setValuesState=function($Y){var $T=this.calculateRowInformation($Y);var $M=$Y?$Y:this.grid.activeRow;if($M){$M.getCell("ValueSt").allowStrings=$T.isDate;$M.getCell("ValueSt2").allowStrings=$T.isDate;}};PXFilterEditor.prototype.calculateRowInformation=function($Y){var $M=$Y?$Y:this.grid.activeRow;$Z=false,$00=false,$01=false,$02=false;if($M){var $J=$M.getCell("DataField").getValue();if($J)$J=$J.slice(0,1).toLowerCase()+$J.slice(1);var fg=this.getFilteredGrid();if(fg){var $U=fg.levels[0].getColumn($J);if($U){var $03=$U.textField?NetType.String:$U.dataType;$Z=($03==NetType.DateTime);$00=NetType.isNumeric($03);$01=($03==NetType.String);$02=($03==NetType.Boolean);}}};var $04=new Object();$04.isDate=$Z;$04.isNumber=$00;$04.isString=$01;$04.isBool=$02;return $04;};PXFilterEditor.prototype.correctDefaultValues=function($05){var $M=this.grid.activeRow;if($M){var $T=this.calculateRowInformation();var $06=$M.getCell("ValueSt");var $07=$M.getCell("ValueSt2");if($05){$06.setValue(null);$07.setValue(null);return;};var $p=$06.getValue();if(!$p){if($T.isNumber)$06.setValue(0);if($T.isString)$06.setValue('');if($T.isBool)$06.setValue(false);if($T.isDate)$06.setValue(null);};var $08=$06.getValue();if(!$08){if($T.isNumber)$07.setValue(0);if($T.isString)$07.setValue('');if($T.isBool)$07.setValue(false);if($T.isDate)$07.setValue(null);}}};PXFilterEditor.prototype.storeFilter=function(){var $g=this.storeFilterID();this.viewState.removeNode("FilterRows");if(this.grid&&!this.hasFilterID()&&!this.allowRowsCommit){var $e=this.grid.rows;for(var i=0;i<$e.length;i++){var $M=$e.getRow(i),status=$M.getStatus();if(status==PXRowStatus.Deleted||status==PXRowStatus.Unbound)continue;var $J=$M.getCell("DataField").getInvariantText(),$09,$08;var $U=this.getFilteredGrid().levels[0].getColumn($J);this.setValuesState($M);if($U&&$U.textField){$J=($U.displayMode>0)?$U.textFieldColumn:$U.textField;$09=$M.getCell("ValueSt").getText();$08=$M.getCell("ValueSt2").getText();}else{$09=$M.getCell("ValueSt").getInvariantText();$08=$M.getCell("ValueSt2").getInvariantText();};this.updateRow(i,"IsUsed",$M.getCell("IsUsed").getInvariantText());this.updateRow(i,"OpenBrackets",$M.getCell("OpenBrackets").getInvariantText());this.updateRow(i,"DataField",$J);this.updateRow(i,"Condition",$M.getCell("Condition").getInvariantText());this.updateRow(i,"ValueSt",$09);this.updateRow(i,"ValueSt2",$08);this.updateRow(i,"CloseBrackets",$M.getCell("CloseBrackets").getInvariantText());this.updateRow(i,"Operator",$M.getCell("Operator").getInvariantText());this.updateRow(i,"OrOperator",$M.getCell("Operator").getInvariantText()=="1");};if(!$e.length)this.viewState.addNode("FilterRows");};this.filterStored=true;};PXFilterEditor.prototype.updateRow=function($0a,name,$p){this.viewState.updateListItem("FilterRows",$0a,name,$p);};PXFilterEditor.prototype.storeFilterID=function(){var $g=null;if(this.dropDown){$g=this.dropDown.getValue();this.viewState.update("FilterID",$g?$g:"");};return $g;};PXFilterEditor.prototype.updateGrid=function($0b){if($0b||$0b==null)this.viewState.remove("CommitChanges");else this.viewState.update("CommitChanges",false);this.storeFilterID();this.grid.update();};PXFilterEditor.prototype.handleActionClick=function($0c,ev){if($0c==this.btnClear){this.clear();}else if($0c==this.btnSave){this.save();}else if($0c==this.btnSaveAs){this.saveAs();}else if($0c==this.btnRemove){this.remove();}else if($0c==this.chkDefault||$0c==this.chkShared||$0c==this.chkShortcut){this.updateFilter();}else if($0c==this.btnOk){var $f=__px_all(this)[this.linkedGridID];if(this.grid.getChanged())this.updateGrid(false);if($f){this.storeFilter();var $g=this.getFilterID();if(!$g)$f.externalFilterEditorID=this.ID;$f.setFilterID($g);$f.setFilter(this.hasFilter());}}};PXFilterEditor.prototype.handleFilterChanging=function(dd,ev){if(this.grid.getChanged()){};return !ev.cancel;};PXFilterEditor.prototype.handleFilterChanged=function(dd,ev,$0d){this.viewState.removeNode("FilterRows");this.storeFilterID();delete this.headerChanged;delete this.refreshRequired;var $g=this.getFilterID();if($g&&!$0d)this.grid.refresh();else this.grid.rows.clear();this.setCheckersState_($g);this.setButtonsState($g);};PXFilterEditor.prototype.handleRowUpdate=function($f,ev){if((this.dropDown==null||!this.hasFilterID())&&!this.allowRowsCommit){ev.row.clearStatus(false);ev.row.clearChanges();}};PXFilterEditor.prototype.handleRowDeleting=function($f,ev){if((this.dropDown!=null&&this.hasFilterID())||this.allowRowsCommit)return;if(ev.rows){for(var n in ev.rows){var $M=ev.rows[n];if($M.setStatus)$M.setStatus(PXRowStatus.AddNew);}}else ev.row.setStatus(PXRowStatus.AddNew);};PXFilterEditor.prototype.handleRowChanged=function($f,ev){if($f.editMode){this.setConditionsState();};this.setValuesState();};PXFilterEditor.prototype.handleCommandState=function($f,ev){if(ev.command==PXGridCommand.Refresh){ev.state.setEnabled(this.hasFilterID()||this.allowRowsCommit);}};PXFilterEditor.prototype.handleBeforeCellEdit=function($f,ev){var $X=ev.cell;var $0e=$X.column.dataField;if(String.compare($0e,"ValueSt",true)||String.compare($0e,"ValueSt2",true)){var $0f=$X.row.getCell("DataField");var $J=$0f.getValue();if($J)$J=$J.slice(0,1).toLowerCase()+$J.slice(1);var $U=this.getFilteredGrid().levels[0].getColumn($J);if($U){var $0g=false,$0h=$U.displayFormat;var $0i=$U.displayMode>0?$U.textField:"";var $03=$0i?NetType.String:$U.dataType;if($X.getDataType()!=$03)$0g=true;$X.setDataType($03);var $0j=$U.viewName?$U.viewName:null;if($X.getViewName()!=$0j)$0g=true;$X.setViewName($0j);var $0k=$U.getFormEditor(false);$X.valueField=$U.valueField;if($0j&&$0k)$X.textField=$0k.textField;else{$X.textField=$0i;if($0i)$U.valueField=$0i;};var $0l=(parseInt($U.decimals)<=0)?null:$U.decimals;if(NetType.isNumeric($03)&&$0h&&$0h.length>1){var $0m=parseInt($0h.substring(1));if(!isNaN($0m))$0l=$0m;};$X.setDecimals($0l);if($U.dataType==NetType.String)$X.displayFormat=$0h;else $X.displayFormat=null;var $0n=($0k&&$0k.__className=="PXDropDown")?$0k.items:$U.valueItems;if($0n)for(var i=0;i<$0n.length;i++){var $s=$0n[i];if(!$s.displayValue&&$s.text)$s.displayValue=$s.text;};$X.setValueItems($0n);if($X.valueItems)$X.valueItems.exclusive=true;delete $X.promptChar;if($0j&&$0k){if($0k.__className=="PXSelector")$X.promptChar=$0k.promptChar;else if($0k.__className=="PXSegmentMask"&&$0k.items)$X.promptChar=$0k.items[0].promptChar;};if($U.dataType==NetType.DateTime){var $0o=($0k&&$0k.__className=="PXDateTimeEdit")?$0k.timeMode:false;$X.setTimeMode($0o);$X.dateMask=($0k?$0k.editMask:$U.dateMask);$X.allowStrings=!$0o;$X.getEditor().control.allowCustomItems=!$0o;}else{$X.setTimeMode(null);$X.allowStrings=false;};if($0g){if($03==NetType.Boolean)$X.setValue(false);if($03==NetType.String&&!$0j)$X.setValue('');if(NetType.isNumeric($03)&&!$0j)$X.setValue(0);}}}};PXFilterEditor.prototype.handleStartCellEdit=function($f,ev){var $0p=ev.cell.editor.control;if($0p.__className=="PXSelector"){if(ev.cell.promptChar)$0p.setPromptChar(ev.cell.promptChar);$0p.textMode=$0p.textField?1:0;if($0p.setHintState)$0p.setHintState();}};PXFilterEditor.prototype.handleCellUpdated=function($f,ev){var $X=ev.cell,$0e=$X.column.dataField;if($0e=="DataField"){var c1=$X.row.getCell("ValueSt"),c2=$X.row.getCell("ValueSt2");c1.updateValue(null);c2.updateValue(null);this.correctDefaultValues();$X.row.getCell("IsUsed").setValue(c1.getValue()!=null);var $J=$X.getValue();if($J)$J=$J.slice(0,1).toLowerCase()+$J.slice(1);var $U=this.getFilteredGrid().levels[0].getColumn($J);if($U)this.setConditionsState();var $0q=new Object();$0q.cell=$X.row.getCell("ValueSt");this.handleBeforeCellEdit($f,$0q);$0q.cell=$X.row.getCell("ValueSt2");this.handleBeforeCellEdit($f,$0q);}else if($0e=="ValueSt"){var c1=$X.row.getCell("IsUsed");c1.setValue(ev.cell.getValue()!=null);}else if($0e=="Condition"){var c1=$X.row.getCell("IsUsed"),$V=ev.cell.getValue();if(Array.contains(this.dateCond,$V)||Array.contains(this.nullCond,$V))c1.setValue(true);this.correctDefaultValues(Array.contains(this.nullCond,$V));};if(this.chkShared!=null&&!this.chkShared.getEnabled())this.chkShared.setChecked(false);};PXFilterEditor.prototype.handleRemoveFilter=function($v,$a){this.dropDown.removeItem(this.getFilterID());var $f=this.getFilteredGrid();if($f)$f.setFilterID(this.getFilterID());this.handleFilterChanged(this.dropDown);this.isDirty=true;};PXFilterEditor.prototype.handleInsertFilter=function($v,$a){if($v){var ar=$v.split('|'),$g=parseInt(ar[0]);this.dropDown.addItemByValues($g,$a.filterName);this.dropDown.setValue($g);this.isDirty=true;this.setCheckersState_();if(this.grid.rows.length>0){var $e=this.grid.rows;if(this.saveAsMode){for(var i=0;i<$e.length;i++){var $M=$e.getRow(i),status=$M.getStatus();if(status!=PXRowStatus.AddNew)$M.setStatus(PXRowStatus.Inserted);}}else{for(var i=0;i<$e.length;i++){var $M=$e.getRow(i);if($M.getStatus()==PXRowStatus.NotSet)$M.setStatus(PXRowStatus.Modified);}};this.updateGrid();};this.defaultFilters=new Array();if(ar.length>1){var $0r=ar[1].split(',');for(var i=0;i<$0r.length;i++)this.defaultFilters.push(parseInt($0r[i]));};if(this.saveAsMode&&!this.isSharedEditable&&this.chkShared.getChecked()){this.chkShared.setChecked(false);if(this.chkShortcut.getChecked())this.quickFilters.push($g);};if(this.chkSystem!=null)this.chkSystem.setChecked(false);this.setButtonsState();}};PXFilterEditor.prototype.handleUpdateFilter=function($v,$a){var $g=this.getFilterID();var $h=this.chkDefault.getChecked();if($h)this.defaultFilters.push($g);else Array.remove(this.defaultFilters,$g);var $F=this.chkShared.getChecked();if($F)this.sharedFilters.push($g);else Array.remove(this.sharedFilters,$g);if(this.chkShortcut.getChecked())this.quickFilters.push($g);else Array.remove(this.quickFilters,$g);if($h){var $0s=new Array();for(var i=0;i<this.defaultFilters.length;i++){var $0t=this.defaultFilters[i];if($0t==$g)continue;if(!Array.contains(this.systemFilters,$0t)&&Array.contains(this.sharedFilters,$0t)==$F){$0s.push($0t);}};for(var i=0;i<$0s.length;i++){var $0t=$0s[i];Array.remove(this.defaultFilters,$0t);}}};PXFilterEditor.prototype.handleInputBox=function($v,$a){if($v){__px_cm(this).processHtmlData($v);var $B=this.inputBox=__px_all(this)[this.ID+"_ib"];if($B){$B.events.addEventHandler("afterHide",Function.createDelegate(this,this.handleInputHide));$B.show();}}};PXFilterEditor.prototype.handleInputHide=function($B){var name=null;if($B.dialogResult==PXDialogResult.OK)name=$B.getText();if(name){var $G=__px(this).getInvariantText(this.chkDefault.getChecked());var $H=__px(this).getInvariantText(this.chkShortcut.getChecked());var $F=false;if(this.allowSharedFilterSaving)$F=__px(this).getInvariantText(this.chkShared.getChecked());var ar=[$G,$F,$H,name];var $C=Function.createDelegate(this,this.handleInsertFilter);var $a=new Object();$a.filterName=name;__px_callback(this).execI(this,this.insertCall,ar.join("|"),$C,$a);}}


function PXSelectorBase($a,$b,$c,$d){this.px_context=$a;this.ID=$b.id;this.element=$b;this.hasFocus=false;this.isSimple=($b.tagName=="INPUT");this.adjustSize=true;this.localizedCaptionPrefix=$c.localizedCaptionPrefix;this.autoCompletePage=0;__px_cm(this).readProperties(this,$c,PXSelectorBase.properties);try{if(__win(this)["disableAutoSuggest"])this.autoComplete=0;}catch(ex){};this.autoCompleteNM=this.autoComplete==1;this.hintLabel=$c.hintLabelID?__px(this).elemByID($c.hintLabelID):null;__px_cm(this).setStackElements(this);var cs=this.autoCallBack;if(this.hasHint&&cs&&!cs.command&&!cs.target&&!this.onValueChange){cs.enabled=cs.manual=true;cs.target=this.ID;cs.command="Search";};this.hasAction=cs.command!=""||this.onValueChange>0;this.callBackMode.optimizePostData=false;this.callbacks=new Array();this.callbacks[0]=__px_callback(this).copyCommand("DropDown",this.callBackMode);this.callbacks[1]=__px_callback(this).copyCommand("Search",this.callBackMode);this.callbacks[2]=__px_callback(this).copyCommand("Edit",this.callBackMode);this.callbacks[3]=__px_callback(this).copyCommand("AddNew",this.callBackMode);this.callbacks[4]=__px_callback(this).copyCommand("Suggest",this.callBackMode);this.sizeLimit=new Object();__px_cm(this).readProperties(this.sizeLimit,$c,PXSelectorBase.sizeLimitDesc);this.elemText=this.elemFocus=this.getTextElem();this.trange=new PXTextRange($a,this.elemText);if(this.getDisabled())__px_cm(this).repaintEditState(this);this.elemText.object=this;this.setHintState();if(this.hasHintText)this.hintText=this.getText();if(!this.isSimple){var ar=Array.clone($b.getElementsByTagName("DIV"));if(ar==null)ar=new Array();Array.addRange(ar,$b.getElementsByTagName("IMG"));for(var i=0;i<ar.length;i++){var $e=ar[i].getAttribute("type");switch($e){case "sel":this.elemButton=ar[i];break;case "edit":this.elemEdit=ar[i];break;case "menu":this.elemDrop=ar[i];break;}};this.hasEditLink=this.allowEdit&&!this.getEnabled();};this.attachEventHandlers();__px_cm(this).registerRequiresOnLoad(this,$b.id);this.events=new PXEventList(this,PXSelectorBase.events,$c.clientEvents);this.viewState=new PXStateBag(this,"PXSelector",$d);if(this.value)this.saveValueInState(this.value);};PXSelectorBase.prototype.initInlineEditor=function($f){this.hasAction=this.autoCallBack.command!=""||this.onValueChange>0;if(this.elemEdit){var $b=this.elemEdit.parentNode.parentNode;$b.style.display="none";this.element.removeAttribute("edit");}};PXSelectorBase.prototype.initInlineSearch=function(){var $b=this.elemButton;if($b){$b.style.display="none";this.elemText.parentNode.style.marginRight="0px";this.suppressDropDown=true;}};PXSelectorBase.prototype.filterInlineKey=function(e){var k=e.keyCode?e.keyCode:e.which;if(this.inlineEditor==true){switch(k){case 38:case 40:if(this.autoComplete&&this.autoCompleteOpen)return true;break;}};return false;};PXSelectorBase.prototype.setHintState=function(){this.hasHint=Boolean(this.hintField);this.hasHintLabel=this.hasHint&&this.hintLabel;this.hasHintText=this.hasHint&&this.hintLabel==null&&!this.textField;this.suppressEdit=this.selectOnly||(this.textField&&this.textMode==0&&!this.autoComplete);};PXSelectorBase.prototype.onLoad=function(){if(this.syncStateWithCommand)__px_cm(this).registerCommandExecutor(this);this.$1y(this.getText());};PXSelectorBase.prototype.commandStateCallback=function($g,$h){this.setReadOnly(!$g.getEnabled());};PXSelectorBase.prototype.onVisibleChanged=function($i){if($i)this.$1y(this.getText());};PXSelectorBase.sizeLimitDesc=[["minDropWidth",JSType.Int,300,null,"minWidth"],["maxDropWidth",JSType.Int,800,null,"maxWidth"],["minDropHeight",JSType.Int,300,null,"minHeight"],["maxDropHeight",JSType.Int,800,null,"maxHeight"]];PXSelectorBase.convertKey=function($j,$k){return $k.split(",");};PXSelectorBase.setText=function($j,$k){if($j.textField){var $l=$j.elemText.tagName=="A";var $m=$j.oldText=$k?$k.trimEnd():"";if($l)__px(this).setElemText($j.elemText,$m);else $j.elemText.value=$m;}};PXSelectorBase.imagesDesc=[["normal",JSType.String,"control@SelectorN"],["disabled",JSType.String,"control@SelectorD"],["hover",JSType.String,"control@SelectorH"],["pushed",JSType.String,"control@SelectorP"]];PXSelectorBase.imagesDescD=[["normal",JSType.String,"control@DropMenuN"],["disabled",JSType.String,"control@DropMenuD"],["hover",JSType.String,"control@DropMenuH"],["pushed",JSType.String,"control@DropMenuP"]];PXSelectorBase.imagesDescE=[["normal",JSType.String,"control@EditN"],["disabled",JSType.String,"control@EditD"],["hover",JSType.String,"control@EditH"],["pushed",JSType.String,"control@EditP"]];PXSelectorBase.properties=[["value",JSType.String,undefined],["autoPostBack",JSType.Bool,false],["autoRefresh",JSType.Bool,false],["autoComplete",JSType.Int,0],["selectOnFocus",JSType.Bool,true],["hideEnterKey",JSType.Bool,false],["bindingContainer",JSType.String,""],["hasDataSource",JSType.Bool,true],["dataKey",JSType.Empty,"",PXSelectorBase.convertKey],["labelID",JSType.String,""],["valueField",JSType.String,""],["textField",JSType.String,""],["hintField",JSType.String,""],["allowNull",JSType.Bool,true],["required",JSType.Bool,false],["nullText",JSType.String,""],["allowEdit",JSType.Bool,false],["allowAddNew",JSType.Bool,false],["editPageUrl",JSType.String,""],["newPageUrl",JSType.String,""],["asciiCharSet",JSType.Bool,false],["onValueChange",JSType.Int,0],["syncStateWithCommand",JSType.Bool,false],["callBackMode",JSType.Object,PXCallbackManager.commandDesc],["autoCallBack",JSType.Object,PXCallbackManager.settingsDesc],["images",JSType.Object,PXSelectorBase.imagesDesc],["imagesD",JSType.Object,PXSelectorBase.imagesDescD],["imagesE",JSType.Object,PXSelectorBase.imagesDescE],["textMode",JSType.Int,0],["suggestIconTypes",JSType.String,"","suggestTypeMapping"],["selectOnly",JSType.Bool,false],["suggestOnly",JSType.Bool,false],["simpleSelect",JSType.Bool,false],["nextLabel",JSType.String,""],["prevLabel",JSType.String,""]];PXSelectorBase.callbackProps=[["hidden",JSType.Bool,false,PXControl.setHidden],["enabled",JSType.Bool,true,"setEnabled"],["readOnly",JSType.Bool,false,"setReadOnly"],["value",JSType.Empty,null,"setValue"],["hintText",JSType.String,"","setHintText"],["text",JSType.String,"",PXSelectorBase.setText],["required",JSType.Bool,null]];PXSelectorBase.prototype.setProperties=function($c){if(this.syncStateWithCommand)$c.readOnly=this.getReadOnly();__px_cm(this).readProperties(this,$c,PXSelectorBase.callbackProps);};PXSelectorBase.events={$initialize:0,$keyDown:1,$keyPress:2,$keyUp:3,$mouseDown:4,$mouseUp:5,$mouseMove:6,$mouseOver:7,$mouseOut:8,$click:9,$focus:10,$blur:11,$valueChanging:12,$valueChanged:13,$beforeDropDown:14,$afterDropDown:15,$dropDownShown:16};PXSelectorBase.prototype.attachEventHandlers=function(){var $n=PXSelectorBase.$1z;if(__px(this).IsTablet)__px(this).addEventHandler(this.elemText,"touchstart",$n);__px_cm(this).addBaseHandlers(this.elemText,$n);__px(this).addEventHandler(this.elemText,"paste",$n,false);__px(this).addEventHandler(this.elemText,"cut",$n,false);__px(this).addEventHandler(this.elemText,"input",$n,false);this.attachDDEventHandlers();if(!this.isSimple){var h=PXSelectorBase.$1A;if(this.elemButton)this.$1B(this.elemButton,h);if(this.elemDrop)this.$1B(this.elemDrop,h);if(this.elemEdit)this.$1B(this.elemEdit,h);}};PXSelectorBase.prototype.detachEventHandlers=function(){var $n=PXSelectorBase.$1z;if(__px(this).IsTablet)__px(this).removeEventHandler(this.elemText,"touchstart",$n);__px_cm(this).removeBaseHandlers(this.elemText,$n);__px(this).removeEventHandler(this.elemText,"paste",$n,false);__px(this).removeEventHandler(this.elemText,"cut",$n,false);__px(this).removeEventHandler(this.elemText,"input",$n,false);this.detachDDEventHandlers();if(!this.isSimple){var h=PXSelectorBase.$1A;if(this.elemButton)this.$1C(this.elemButton,h);if(this.elemDrop)this.$1C(this.elemDrop,h);if(this.elemEdit)this.$1C(this.elemEdit,h);}};PXSelectorBase.prototype.attachDDEventHandlers=function(){var $o=Function.createDelegate(this,this.$1D);var $p=this.ddTable;if($p){__px(this).addEventHandler($p,"mousedown",$o);__px(this).addEventHandler($p,"mouseup",$o);__px(this).addEventHandler($p,"mouseout",$o);__px(this).addEventHandler($p,"mouseover",$o);__px(this).addEventHandler($p,"selectstart",$o);__px(this).addEventHandler($p,"contextmenu",$o);};$o=Function.createDelegate(this,this.$1E);var $q=this.ddLinksDiv;if($q)__px(this).addEventHandler($q,"click",$o);};PXSelectorBase.prototype.detachDDEventHandlers=function(){var $o=Function.createDelegate(this,this.$1D);var $p=this.ddTable;if($p){__px(this).removeEventHandler($p,"mousedown",$o);__px(this).removeEventHandler($p,"mouseup",$o);__px(this).removeEventHandler($p,"mouseout",$o);__px(this).removeEventHandler($p,"mouseover",$o);__px(this).removeEventHandler($p,"selectstart",$o);__px(this).removeEventHandler($p,"contextmenu",$o);};$o=Function.createDelegate(this,this.$1E);var $q=this.ddLinksDiv;if($q)__px(this).removeEventHandler($q,"click",$o);};PXSelectorBase.prototype.$1B=function($b,h){__px(this).addEventHandler($b,"mousedown",h);__px(this).addEventHandler($b,"mouseup",h);__px(this).addEventHandler($b,"mouseover",h);__px(this).addEventHandler($b,"mouseout",h);};PXSelectorBase.prototype.$1C=function($b,h){__px(this).removeEventHandler($b,"mousedown",h);__px(this).removeEventHandler($b,"mouseup",h);__px(this).removeEventHandler($b,"mouseover",h);__px(this).removeEventHandler($b,"mouseout",h);};PXSelectorBase.prototype.getEnabled=function(){return __px(this).getEnabled(this.element);};PXSelectorBase.prototype.setEnabled=function($r){if($r!=this.getEnabled()){__px_cm(this).setEnabled(this,$r);if(this.elemButton){this.$1F(this.elemButton,this.images);this.elemButton.style.display=this.getDisabled()?"none":"";};this.$1G($r);this.onStateChanged();}};PXSelectorBase.prototype.getReadOnly=function(){return __px(this).getReadOnly(this.elemText);};PXSelectorBase.prototype.setReadOnly=function($s){if($s!=this.getReadOnly()){__px_cm(this).setReadOnly(this,$s);if(this.elemButton){this.$1F(this.elemButton,this.images);this.elemButton.style.display=this.getDisabled()?"none":"";};this.onStateChanged();}};PXSelectorBase.prototype.getDisabled=function(){return !this.getEnabled()||this.getReadOnly();};PXSelectorBase.prototype.onStateChanged=function(){if(this.getDisabled()&&this.dropDownOpen)this.hideDropDown();};PXSelectorBase.prototype.$1G=function($r){var et=null,$t=null;if(this.hasEditLink&&$r){et=__doc(this).createElement("input"),$t=this.elemText;et.type="text";this.hasEditLink=false;}else if(this.allowEdit&&!$r){et=__doc(this).createElement("a"),$t=this.elemText;et.href="javascript:void 0";this.hasEditLink=true;};if(et){et.id=$t.id;et.name=$t.name;et.className=$t.className;__px_cm(this).removeBaseHandlers($t,PXSelectorBase.$1z);$t.parentNode.replaceChild(this.elemText=this.elemFocus=et,$t);if(this.trange)this.trange.element=et;__px_cm(this).addBaseHandlers(et,PXSelectorBase.$1z);this.onEditorElementChanged($t,et);}};PXSelectorBase.prototype.onEditorElementChanged=function($u,$v){};PXSelectorBase.prototype.getVisible=function(){return this.element.style.display!="none";};PXSelectorBase.prototype.setVisible=function(v){if(v!=this.getVisible()){var $w=v?"":"none";this.element.style.display=$w;__px_cm(this).setStackElementsVisible(this,v);if(this.boundImage)this.boundImage.style.display=$w;if(this.labelID){var $x=__px(this).elemByID(this.labelID);if($x)$x.style.display=$w;}}};PXSelectorBase.prototype.getTextElem=function(){return this.isSimple?this.element:__px(this).elemByID(this.ID+"_text");};PXSelectorBase.prototype.focus=function(){try{this.elemText.focus();}catch(e){}};PXSelectorBase.prototype.getText=function(){var $l=this.elemText.tagName=="A",$m;$m=$l?__px(this).getElemText(this.elemText):this.elemText.value;return $m?$m.trimEnd():$m;};PXSelectorBase.prototype.setText=function($k){var $l=this.elemText.tagName=="A";var $m=$k?$k.trimEnd():"";if($l)__px(this).setElemText(this.elemText,$m);else this.elemText.value=$m};PXSelectorBase.prototype.getLabelText=function(){var $x,$m="";if(this.labelID)$x=__px(this).elemByID(this.labelID);else if(this.labelWrapper)$x=this.labelWrapper.getElementsByTagName("label")[0];if($x)$m=__px(this).getElemText($x);return $m;};PXSelectorBase.prototype.setSize=function($y,$z){var w=parseInt($y),h=parseInt($z);this.element.style.width=w+"px";this.element.style.height=h+"px";};PXSelectorBase.prototype.adjustTextSize=function(){if(this.isSimple)return true;var $A=this.element.clientWidth,$B;var $C=[this.elemButton,this.elemDrop,this.elemEdit];for(var i=0;i<$C.length;i++){var $D=$C[i];if($D){$B=$D.parentNode;$A-=$B.offsetWidth;}};$B=this.elemText.parentNode;$A-=$B.offsetWidth-__px(this).getStyleWidth($B);if($A>0){this.elemText.style.width=__px(this).getStyleWidth(this.elemText,$A)+"px";return true;};return false;};PXSelectorBase.prototype.$1y=function($m){var $E=$m?__px(this).getTextWidth($m,this.elemText.className):0;if(this.elemText.clientWidth>0&&this.element.getAttribute("error")==null)__px(this).setTitle(this.elemText,($E>this.elemText.clientWidth)?$m:null);};PXSelectorBase.prototype.maximize=function(){if(!this.dropDownOpen)return;var es=this.dropDown.style,$F=__px(this).getDocScrollElem();var $G=__doc(this).documentElement,ge=this.grid.element;if(this.$1H==null){this.$1H=ge.offsetWidth;this.$1I=ge.offsetHeight;};es.left=$F.scrollLeft+"px";es.top=$F.scrollTop+"px";this.grid.setSize($G.clientWidth,$G.clientHeight);this.grid.onAfterResize();this.$1J=true;};PXSelectorBase.prototype.restore=function(){if(!this.dropDownOpen)return;if(this.$1J){this.grid.setSize(this.$1H,this.$1I);this.grid.onAfterResize();this.$1K();delete this.$1H;delete this.$1I;this.$1J=false;}};PXSelectorBase.prototype.setHintText=function($m,$H){if(this.hasHint){if(this.hasHintLabel)this.hintLabel.innerHTML=$m?$m:"";if(this.hasHintText){if($H==null)$H=true;this.hintText=$m?$m:"";if($H)this.$1L(this.isEditMode());}}};PXSelectorBase.prototype.getHintText=function($I,$J,$K){if($J){if($K)$J=(new PXHTMLEncoder()).htmlEncode($J);else $J=String($J);}else $J="";if(typeof($I)=="string")$I=$I?$I.trimEnd():"";return($I&&this.hasHintText)?($I+($J?(" - "+$J):"")):$J;};PXSelectorBase.prototype.$1M=function(){if(this.hasHint){if(this.hasHintLabel)this.hintLabel.innerHTML="";if(this.hasHintText)delete this.hintText;}};PXSelectorBase.prototype.getValue=function($L){if(this.textField||(this.hasHintText&&!this.editMode)||(this.value!==undefined&&!$L))return this.value;var v=this.getCorrectValue(this.getText());return(this.allowNull&&this.isNullValue(v))?null:v;};PXSelectorBase.prototype.getLastSelectedItem=function(){return this.$1N;};PXSelectorBase.prototype.setValue=function(v,$m,$M){this.value=v=this.getCorrectValue(v);if(this.needValueInState()){this.saveValueInState(v);if(this.hasHintText)this.hintText=$m;};if(!$M)if(this.textField){if($m!=null)$m=$m.trimEnd();this.oldText=this.$1L(this.isEditMode(),v,$m);}else this.$1L(this.isEditMode(),v);this.oldValue=this.getValue();if(this.editWindow)this.reloadWindow=true;};PXSelectorBase.prototype.needValueInState=function(){return(this.textField||this.hasHintText||this.hasEditLink);};PXSelectorBase.prototype.saveValueInState=function(v){this.value=v;this.viewState.update("Value",(v!=null)?v:"");};PXSelectorBase.prototype.getCorrectValue=function($k){if(this.asciiCharSet&&$k){var $I=$k.toString();$k="";for(var i=0;i<$I.length;i++)if($I.charCodeAt(i)<127)$k+=$I.charAt(i);};if(typeof($k)=="string"&&$k)$k=$k.replace(/[\x00-\x19]/g,"");return $k;};PXSelectorBase.prototype.getCorrectText=function($m,$k){return $m;};PXSelectorBase.prototype.$1L=function($N,$k,$m){var v=($k===undefined)?this.getValue():$k;var t=($m==null)?($N?this.getEditText(v):this.getDisplayText(v)):$m;this.editMode=$N;this.setText(this.getCorrectText(t,v));var $m=this.getText();this.$1y($m);if($N&&this.hasFocus&&this.selectOnFocus)if(!this.getDisabled()&&__px(this).isVisible(this.element))this.selectAll();return $m;};PXSelectorBase.prototype.isEditMode=function(){return this.hasFocus&&!this.getDisabled()&&!this.suppressEdit;};PXSelectorBase.prototype.getDisplayText=function(v){if(this.allowNull&&v==null)return this.nullText;if(!this.inlineEditor||v==this.getValue()){if(this.textField)return this.getText();if(this.hasHintText&&this.hintText)return this.hintText;};return(v!=null)?v.toString():"";};PXSelectorBase.prototype.getEditText=function(v){if(this.allowNull&&v==null)return "";if(this.textField){var t=this.getText();return t==this.nullText?"":t;};return(v!=null)?v.toString():"";};PXSelectorBase.prototype.getDisplayValue=function(v){return v;};PXSelectorBase.prototype.isNullValue=function(v){var $O=String(v);if(v==null||$O=="")return true;if(this.allowNull&&$O==this.nullText)return true;return false;};PXSelectorBase.prototype.getSearchValue=function(){var $m=this.textField?this.getText():this.getValue(true);if($m)$m=$m.toString().replace(/[\x00-\x19]/g,"");return $m;};PXSelectorBase.prototype.getSearchClientValue=function(){return this.getValue(true);};PXSelectorBase.prototype.getValueField=function(){var $P=this.valueField;if(!$P){var pk=this.dataKey;if(pk&&pk.length!=null)$P=pk[pk.length-1];};return $P;};PXSelectorBase.prototype.select=function($Q,$R){if(this.hasFocus&&this.getVisible()){this.trange.select($Q,$R);this.selStart=this.trange.selStart;this.selEnd=this.trange.selEnd;}};PXSelectorBase.prototype.selectAll=function(){if(this.elemText.select)this.elemText.select();};PXSelectorBase.prototype.getSelectedText=function(){var $m=this.trange.getSelectedText();this.selStart=this.trange.selStart;this.selEnd=this.trange.selEnd;return $m;};PXSelectorBase.prototype.resetDropDown=function(){if(this.dropDown!=null){var $S=this.dropDown.parentNode,pc=this.dropDown.processContainer;if($S)$S.removeChild(this.dropDown);if(pc&&pc.parentNode)pc.parentNode.removeChild(pc);delete this.dropDown;};this.adjustSize=true;if(this.grid){delete __px_all(this)[this.grid.ID];delete this.grid;};if(this.panel){delete __px_all(this)[this.panel.ID];delete this.panel;};if(this.sourceID){var $T=__px_all(this)[this.sourceID];if($T)$T.resetDropDown();}};PXSelectorBase.prototype.setViewName=function($U){if(this.viewName==null||this.viewName!=$U){this.viewName=$U;this.viewState.update("ViewName",$U);this.resetDropDown();}};PXSelectorBase.prototype.search=function(){var $o=Function.createDelegate(this,this.$1O);var $V=this.getSearchValue();__px_callback(this).execI(this,this.callbacks[1],$V,$o);};PXSelectorBase.prototype.$1O=function($W,$a){var $X=__px_all(this)[$a];if($W&&$X){var $Y=new PXXmlDoc("",$W);this.$1P($Y,$a);}};PXSelectorBase.prototype.$1P=function($Z,$a){var $props=$Z.rootNode.getAttribute("Props");if($props!=null)eval("$props = "+$props);var $I=($props.value===undefined)?null:$props.value;if(__px(this).equals($I,this.oldValue))$props.text=this.oldText;else if(this.textField)this.updateValue($I);this.setProperties($props);};PXSelectorBase.prototype.executeCallback=function($h,$00){if(this.hasDataSource)switch($h){case "DropDown":this.showDropDown();break;case "Search":this.search();break;case "Suggest":this.suggest();break;}};PXSelectorBase.prototype.suggest=function($01){if(this.getDisabled())return;var $o=Function.createDelegate(this,this.$1Q);if($01!=undefined)this.$1R=$01;this.$1R=this.$1R?this.$1R:"";var $V='1|'+this.$1R+'|'+this.autoCompletePage;__px_callback(this).execI(this,this.callbacks[4],$V,$o);};PXSelectorBase.prototype.$1Q=function($W,$a){delete this.$1S;if(!$W||!__px(this).isVisible(this.element)){delete this.$1R;if(this.autoCompleteOpen)this.hideDropDown();return;};this.$1T($W);};PXSelectorBase.prototype.$1U=function(){return this.getText().replace(/_/g,'');};PXSelectorBase.prototype.processCallback=function($Z,$a){if($a.preProcessData==null)return;var $02=$a.preProcessData.split('|')[0];switch($02){case "Search":this.$1P($Z,$a);break;case "Suggest":this.$1Q($Z.rootNode.childNodes[0].nodeValue);break;}};PXSelectorBase.prototype.updateValue=function($k,$m){var $03=new Object();var $04=(this.oldValue===undefined)?this.getValue(true):this.oldValue;var $05=($k===undefined)?this.getValue(true):$k;var $06=this.hasHintText?this.hintText:this.getText();this.$1V();if(!__px(this).equals($05,$04)){var $07=this.fireEvent(12,null);if($07){this.setValue($04,$06);return false;};this.viewState.remove("DataValues");this.$1M();this.setValue($05,$m);this.fireEvent(13,null);__px_cm(this).notifyOwnerChanged(this);__px_cm(this).processPostData(this,$03);if($03.commandCanceled){this.setValue($04,$06);return false;};return true;}else if($m!=null){if(this.getText()!=$m)this.$1L(this.editMode);}};PXSelectorBase.prototype.fireEvent=function(id,ev,$03){var $08=($03!=null)?$03:new Object();switch(id){case 1:case 2:case 3:if(ev.keyCode)$08["keyCode"]=ev.keyCode;break;case 12:$08["oldValue"]=this.oldValue;$08["value"]=this.getValue();break;case 13:$08["value"]=this.getValue();break;};return this.events.fireEvent(id,ev,$08);};PXSelectorBase.prototype.editRecord=function($09){if(__px(this).popupAllowFocus()&&this.$1W())return;if($09==null)$09=true;if(this.editPageUrl)this.$1X(this.editPageUrl,true);else if($09||this.getValue()){var $o=Function.createDelegate(this,this.$1Y);var $a=new Object();$a.id=this.ID;__px_callback(this).execI(this,this.callbacks[2],"",$o,$a);}};PXSelectorBase.prototype.newRecord=function(){if(__px(this).popupAllowFocus()&&this.$1W())return;if(this.newPageUrl)this.$1X(this.newPageUrl);else{var $o=Function.createDelegate(this,this.$1Y);var $a=new Object();$a.id=this.ID;$a.isNew=true;__px_callback(this).execI(this,this.callbacks[3],"",$o,$a);}};PXSelectorBase.prototype.$1Y=function($W,$a){if(!$W)return;var ac=new Object();ac.enabled=true;ac.popupHandler=Function.createDelegate(this,this.$1Z);this.$1X($W,false,ac);};PXSelectorBase.prototype.$1Z=function($0a){var vf=this.getValueField(),$0b=null;if($0a.closePopup&&($0a.keyFields||$0a.clearKey)&&!this.getDisabled()){if($0a.keyFields){var vf=this.getValueField();for(var n in $0a.keyFields)if(String.compare(vf,n,true)){$0b=n;break;}};var $I=$0b?$0a.keyFields[$0b]:null;if($I||$0a.clearKey){this.hideDropDown();this.updateValue($I);this.focus();this.$20(true);}}};PXSelectorBase.prototype.$1W=function(){if(this.editWindow&&!this.editWindow.closed&&!this.reloadWindow){this.editWindow.focus();return true;};return false;};PXSelectorBase.prototype.$21=function(){if(this.$22==null){var $0c=(this.sourceID?this.sourceID:this.ID)+"_menu";this.$22=PXMenu.createMenuControl($0c,this.px_context);if(this.$22){var ev=this.$22.events;ev.addEventHandler("deactivate",PXSelectorBase.$23);this.$22.linkedSelector=this;}};return this.$22;};PXSelectorBase.prototype.$1F=function($b,$0d){var $0e="",$0f=($0d==this.images);if(this.getDisabled()&&$0f)$0e=$0d.disabled;else if($b.$24)$0e=$0d.pushed;else if($b.$25)$0e=$0d.hover;__px_cm(this).repaintImage($b,$0e?$0e:$0d.normal);};PXSelectorBase.prototype.$1X=function($0e,$0g,$0h){if($0g){var $0i=this.getValueField();if($0i)$0e+="?"+$0i+"="+this.getValue();};this.editWindow=__px(this).openUrl($0e,this.ID,false,true,$0h);if(this.reloadWindow&&this.editWindow){this.editWindow.focus();this.reloadWindow=false;}};PXSelectorBase.prototype.showDropDown=function(){if(this.dropDownOpen||this.getDisabled()||this.suppressDropDown)return;this.$1N=undefined;__px_cm(this).closeActiveDropDown(this);if(this.sourceID){var $T=__px_all(this)[this.sourceID];if($T.dropDown)this.dropDown=$T.dropDown;};if(!this.onShowDropDown())return;this.adjustSize=true;if(this.dropDown==null){var $o=Function.createDelegate(this,this.$26);var $V=this.getSearchValue();this.$27(1);__px_callback(this).execI(this,this.callbacks[0],$V,$o);}else{var $0j=this.dropDown,$X=this;if(!__px(this).elemByID($0j.id))__win(this).theForm.appendChild($0j);if(!this.panel)this.$28();if(!this.grid)this.$29();this.grid.selector=this;this.grid.postVisibleOnly=false;this.$2a=!this.$2b;setTimeout(function(){if($X.$2b){$X.$2c(true);$X.$1K();};$X.$2d($X.$2b);$X.$2b=false;setTimeout(function(){$X.fireEvent(16,null);},0);},0);}};PXSelectorBase.prototype.$26=function($W,$a){this.viewState.remove("PageSize");if($W){this.$2b=true;__px_cm(this).processHtmlData($W);var $0j=__px(this).elemByID(this.$2e()+"_pnl"),$X=this;$0j.style.display="none";$0j.processContainer=$0j.parentNode;__win(this).theForm.appendChild($0j);if(this.sourceID){var $T=__px_all(this)[this.sourceID];$T.dropDown=$0j;};this.dropDown=$0j;setTimeout(function(){$X.$2f();},0);}};PXSelectorBase.prototype.$2f=function(){__px_cm(this).handleLoad();this.showDropDown();var $0k=this.grid;setTimeout(function(){var $p=$0k.rows.dataTable,$0j=$0k.scrollDiv;if($0k.rows.length==0){$p=$0k.statHTable;$0j=$0k.statHDiv;};if($p&&$p.offsetWidth<$0j.clientWidth)$0k.adjustColumns(false);},0);};PXSelectorBase.prototype.$2g=function($0l,$0m){if(!this.hasDataSource||this.suggestOnly)return;if(this.simpleSelect){if(!this.autoCompleteOpen){var $m=this.$1R,$06=this.$2h;if($06===undefined||$m!=$06||this.autoRefresh){this.suggest();this.$2h=$m?$m:"";}else this.$1T();}else if(!$0l){this.hideDropDown();this.focus();}}else if(!this.$1S){if(!this.dropDownOpen){if($0m)this.keyboardOpening=true;this.showDropDown();}else if(!$0l){this.hideDropDown();this.focus();}}};PXSelectorBase.prototype.hideDropDown=function($0n){if(this.autoCompleteOpen){if($0n)this.$2i();__px_cm(this).setDropDownVisible(this,false);delete this.autoCompleteOpen;return this.onHideDropDown($0n);};var $0j=this.dropDown,$W=false;if(!$0j||!this.dropDownOpen)return false;try{this.grid.endSearch(true);if($0n){var $0o=null;var ar=this.grid.activeRow,$B=null,$0p;if(ar){$0o=this.grid.getDataValues();var $P=this.getValueField();$B=ar.getCell($P?$P:0);};if($B){var cs=this.autoCallBack,$07;try{if(cs.manual)cs.enabled=false;$07=!this.onSelect($B.getValue(),ar);}finally{if(cs.manual)cs.enabled=true;};if(!$07){if(this.hasHint&&($0p=ar.getCell(this.hintField))!=null){var $m=$0p.getValue();if($m){var dv=this.getDisplayValue(this.getValue());$m=this.getHintText(dv,$m,this.hasHintLabel);this.setHintText($m,false);}};this.$1L(this.editMode);}};if($0o)this.viewState.update("DataValues",$0o);else this.viewState.remove("DataValues");}else if(this.getText()!=this.oldText){}}finally{delete this.keyboardOpening;this.grid.postVisibleOnly=true;this.$2c(false);$W=this.onHideDropDown($0n);};return $W;};PXSelectorBase.prototype.$2d=function($0q){if(!this.grid)return;var g=this.grid,$0r=this.getSearchValue(),$0s=false;var $0t=this.textField?this.textField:this.getValueField();var $0u=this.autoRefresh&&!$0q;if(!$0u){var $0v=this.getValueField(),$0w=this.getSearchClientValue();if($0v&&$0w){var $0x=g.find($0w,$0v,null,true);if($0x!=null&&this.textField){var $B=$0x.getCell(this.textField);if($B&&$B.getValue()!=$0r)$0x=null;};$0s=($0x!=null);if(!$0q)$0u=!$0s;}else if(this.textField&&$0r)$0u=true;};if($0u){if($0t){g.clearFastFilter();g.search($0r,$0t);}else{if(this.autoRefresh){g.clearFastFilter();g.refresh();}else $0u=false;};g.resetPositionState();}else if(this.$2b&&$0s){g.setSearchMarkToFirstRow($0t);};if(this.$2a&&!$0u){this.$2a=false;this.$2c(true);this.$1K(false);}};PXSelectorBase.prototype.$2e=function(){return this.sourceID?this.sourceID:this.ID;};PXSelectorBase.prototype.$1K=function($0y){this.$2j($0y);var $0z=__px(this).getDropDownPos(this.element,this.dropDown,2);this.dropDown.style.left=$0z.left+"px";this.dropDown.style.top=$0z.top+"px";};PXSelectorBase.prototype.$2j=function($0y,$0A){if(!this.dropDownOpen)__px_cm(this).setDropDownVisible(this,true);var $0B=this.sizeLimit,$0k=this.grid,$0C=this.adjustSize;if(this.adjustSize){var $E=$0k.getAdjustSize();var $y=$E.width+1,$z=$E.height+1;var $0D=this.grid.getActionBarWidth();if($0D>$y)$y=$0D;var $0E=$0k.rows.dataTable;this.panel.setWidth($y,true);if($0E.offsetHeight>0){if(__px(this).IsSafari)this.panel.setOverflow("auto",'y');if(this.toolBar!=null)$z+=this.toolBar.element.offsetHeight;this.panel.setHeight($z,true);};this.adjustSize=false;};var $0F=__doc(this).documentElement,pe=this.panel.element;var $y=pe.offsetWidth,$z=pe.offsetHeight,$F=__px(this).getDocScrollElem();var top=__px(this).getElemTopPosAbs(this.element,null,false)-$F.scrollTop;var $0G=($0F.clientHeight-top-this.element.offsetHeight-1);var $0H=$0C?$0B.minHeight:0,$0I=$0C?$0B.minWidth:0;var $0J=$0C?$0B.maxHeight:0,$0K=$0C?$0B.maxWidth:0;if($0J==0||$0J>top||$0J>$0G)$0J=Math.max(top,$0G);if($0J==0||$0J>$0F.clientHeight)$0J=$0F.clientHeight;if($0K==0||$0K>$0F.clientWidth)$0K=$0F.clientWidth;if($0I&&$y<$0I)$y=$0I;if($0K&&$y>$0K){$y=$0K;$z+=18;};if($0H&&$z<$0H)$z=$0H;if($0J&&$z>$0J)$z=$0J;if($y!=pe.offsetWidth)this.panel.setWidth($y);if($z!=pe.offsetHeight){if(__px(this).IsSafari)this.panel.setOverflow("auto",'y');this.panel.setHeight($z);};this.$2k=($0y!=null&&!$0y)||this.$2b;if($0A||$0A==null)setTimeout(function(){__px_cm($0k).notifyOnResize(true,pe);},1);else __px_cm(this).notifyOnResize(true,pe);};PXSelectorBase.prototype.$2c=function($i){var $0j=this.dropDown,ds=$0j.style,$0k=this.grid,me=this;if($i){__px_cm(this).setDropDownVisible(this,true);if($0k){if(!this.$2l)setTimeout(function(){me.$2m($0k);},1);$0k.onVisibleChanged(true);delete this.$2l;}}else __px_cm(this).setDropDownVisible(this,false);};PXSelectorBase.prototype.$2m=function($0k){if($0k.filterBar&&!__px(this).IsTablet)$0k.filterBar.focus();else $0k.focus();};PXSelectorBase.prototype.$29=function(){var $0L=this.$2e()+"_pnl_gr";var $0M=this.sourceID?(this.sourceID+"_pnl_gr"):null;if(!__px_all(this)[$0L]){this.grid=__px_cm(this).createControl("PXGrid",$0L,$0M);__px_all(this)[$0L]=this.grid;}else this.grid=__px_all(this)[$0L];if(!this.grid.hasSelectorEvents){var ev=this.grid.events,bh=Function.createDelegate(this,this.$2n);ev.addEventHandler("cellClick",Function.createDelegate(this,this.$2o));ev.addEventHandler("keyDown",Function.createDelegate(this,this.$2p));ev.addEventHandler("keyPress",Function.createDelegate(this,this.$2q));ev.addEventHandler("beforeRefresh",Function.createDelegate(this,this.$2r));ev.addEventHandler("afterRefresh",Function.createDelegate(this,this.$2s));ev.addEventHandler("toolsButtonClick",bh);ev.addEventHandler("afterResize",Function.createDelegate(this,this.$2t));if(this.grid.extToolbar)this.grid.extToolbar.events.addEventHandler("buttonClick",bh);this.grid.hasSelectorEvents=true;};this.grid.setOverflow("hidden",'y');this.grid.bindingContainer=this.bindingContainer;this.grid.keepPosition=true;this.grid.postVisibleOnly=true;this.grid.autoSize.minHeight=0;this.grid.ownerID=this.sourceID?this.sourceID:this.ID;this.grid.storeCookie=this.grid.postValues=false;if(this.viewName)this.dataKey=this.grid.levels[0].dataKey;this.grid.isSelector=true;this.grid.showEmptyMessage(this.grid.rows&&this.grid.rows.items);};PXSelectorBase.prototype.$27=function($0N){if(PXSelectorBase.gridRowSize==null)return;var $0O=this.gridSizeShift?this.gridSizeShift:PXSelectorBase.gridSizeShift;var $z=$0O+20*PXSelectorBase.gridRowSize,e=this.element;var $0F=__doc(this).documentElement,$F=__px(this).getDocScrollElem();var top=__px(this).getElemTopPosAbs(e,null,__px(this).IsSafari)+e.offsetHeight;var $0P=$0F.clientHeight,$0Q=$F.scrollTop,$E;var $0R=top-e.offsetHeight-$0Q,$0S=$0P-$0R-e.offsetHeight;if((top+$z)>($0P+$0Q)&&$0R>$0S)$E=top-e.offsetHeight-$0Q;else $E=$0Q+$0P-top;var $0T=20;if($E<$z){$0T=Math.floor(($E-$0O)/PXSelectorBase.gridRowSize)+($0N?$0N:0);};if(this.grid)this.grid.setPageSize($0T);else this.viewState.update("PageSize",$0T);};PXSelectorBase.prototype.$28=function(){var $0U=this.$2e()+"_pnl";var $0M=this.sourceID?(this.sourceID+"_pnl"):null;if(!__px_all(this)[$0U]){this.panel=__px_cm(this).createControl("PXGrid",$0U,$0M);__px_all(this)[$0U]=this.panel;}else this.panel=__px_all(this)[$0U];if(this.panelCaption)this.panel.setCaption(this.panelCaption);else this.panel.setCaption(this.getPanelCaption());if(!this.panel.hasSelectorEvents){this.panel.events.addEventHandler("beforeHide",Function.createDelegate(this,this.$2u));this.panel.events.addEventHandler("beforeResize",Function.createDelegate(this,this.$2v));this.panel.events.addEventHandler("afterResize",Function.createDelegate(this,this.$2w));this.panel.hasSelectorEvents=true;};this.toolBar=__px_all(this)[$0U+"_tlb"];};PXSelectorBase.prototype.getPanelCaption=function(){var lt=this.getLabelText();if(lt){if(lt.endsWith(':'))lt=lt.substr(0,lt.length-1);return this.localizedCaptionPrefix+" - "+lt;}};PXSelectorBase.prototype.$2u=function($0V,ev){ev.cancel=true;var $X=this.$2x($0V);if($X){$X.hideDropDown();$X.focus();}};PXSelectorBase.prototype.$2x=function($0V){var id=$0V.element.getAttribute("controlID");return __px_all(this)[id];};PXSelectorBase.prototype.$2o=function($0W,ev){if(ev.event.clickCount==2){var $X=$0W.selector;if($X&&$X.hideDropDown(true))this.selectInputElement();}};PXSelectorBase.prototype.$2q=function($0W,ev){};PXSelectorBase.prototype.$2p=function($0W,ev){var $X=null,$0n=false;switch(ev.key){case 13:$X=$0W.selector;if($X)$0n=$X.hideDropDown(true);ev.cancel=true;break;case 27:$X=$0W.selector;if($X)$0n=$X.hideDropDown();ev.cancel=true;break;};if($0n)this.selectInputElement(10);};PXSelectorBase.prototype.selectInputElement=function($0A){var id=this.elemText.id,$X=this;setTimeout(function(){__px($X).selectElement(id,1);},$0A?$0A:1);};PXSelectorBase.prototype.$2s=function($0k,ev){var $X=$0k.selector;delete $X.$1S;if($X.$2a){$X.$2a=false;$X.$2c(true);$X.$1K(false);return;};if($X.dropDownOpen&&($0k.hasVScroll()||$X.adjustSize||$0k.getActionBarWidth()>$0k.getWidth())){$X.$1K(false);}};PXSelectorBase.prototype.$2r=function($0k,ev){var h=$0k.element.offsetHeight;if(__px(this).IsSafari&&h>0&&(h!=$0k.getHeight()||!$0k.element.style.height))$0k.setHeight(h);if(this.adjustSize)this.$27();};PXSelectorBase.prototype.$2n=function($0k,ev){var $X=$0k.linkedGrid?$0k.linkedGrid.selector:$0k.selector,$0n=false;switch(ev.button.key){case "AddNew":$X.newRecord();break;case "Maximize":$X.$1J?$X.restore():$X.maximize();break;case "Close":$0n=$X.hideDropDown();ev.button.setNormalState();break;case "Select":$0n=$X.hideDropDown(true);break;};if($0n)this.selectInputElement();};PXSelectorBase.prototype.$2v=function($0V,ev){if(__px(this).IsSafari)$0V.setOverflow("auto",'y');};PXSelectorBase.prototype.$2w=function($0V,ev){var $X=this.$2x($0V);if($X){$X.adjustSize=false;if(__px(this).IsSafari)$0V.setOverflow("hidden",'y');}};PXSelectorBase.prototype.$2t=function($0k,ev){if(__px(this).IsSafari)$0k.setOverflow("auto",'y');if(__px(this).IsSafari&&!__px(this).IsTablet)$0k.setOverflow($0k.hasHScroll()?"auto":"hidden",'x');var pe=this.panel.element,$0E=$0k.rows.dataTable;if($0E.offsetHeight>0){var $0X=pe.offsetHeight-$0E.parentNode.offsetHeight+($0k.hasHScroll()?17:0);this.gridSizeShift=$0X;if(PXSelectorBase.gridSizeShift==null||$0X>PXSelectorBase.gridSizeShift)PXSelectorBase.gridSizeShift=$0X;PXSelectorBase.gridRowSize=$0E.tBodies[0].rows[0].offsetHeight;};if(this.$2k){$0k.calcPageSize();$0k.removeSpareRows();}else $0k.adjustPage();this.$2k=false;if(__px(this).IsSafari)$0k.setOverflow("hidden",'y');};PXSelectorBase.$1z=function(e){var $X=__px(this).eventObject(e,PXSelectorBase);if($X&&$X.$1z!=null&&__px(this).isVisible($X.element))$X.$1z(e);};PXSelectorBase.prototype.onDocumentHideDropDown=function(e){if(!__px(this).containsObject(this,e)&&(!this.grid||!__px(this).containsObject(this.grid,e))){if(!this.textField){this.updateValue();this.$1L(false);}else this.$1L(false);return true;}};PXSelectorBase.$23=function($0Y,e){var $X=$0Y.linkedSelector;if(e.id==2&&$X)setTimeout(function(){$X.$2y();},300);};PXSelectorBase.prototype.$2y=function(){this.$2z=false;};PXSelectorBase.prototype.$20=function($0n){var $03=new Object();$03.select=$0n;$03.complete=$0n;return !this.fireEvent(15,null,$03);};PXSelectorBase.prototype.onFocus=function(e){if(!this.isSimple&&!this.adjusted){}};PXSelectorBase.prototype.onBlur=function(e){};PXSelectorBase.prototype.onKeyDown=function(e){return true;};PXSelectorBase.prototype.onKeyUp=function(e){return true;};PXSelectorBase.prototype.onKeyPress=function(e){return true;};PXSelectorBase.prototype.onClick=function(e){return true;};PXSelectorBase.prototype.onShowDropDown=function(){this.getSelectedText();if(this.oldValue===undefined)this.oldValue=this.getValue(true);return !this.fireEvent(14,null);};PXSelectorBase.prototype.onHideDropDown=function($0n){return this.$20($0n);};PXSelectorBase.prototype.onSelect=function($k,$0x){var $B=null,$m=null;if($0x!=null&&typeof($0x)!="string"){if(this.textField)$B=$0x.getCell(this.textField);else if(this.hasHint)$B=$0x.getCell(this.hintField);if($B)$m=$B.getValue();}else $m=$0x;$k=this.getCorrectValue($k);if($m)$m=this.getHintText($k,$m);return this.updateValue($k,$m);};PXSelectorBase.prototype.$1z=function(e){var $e=PXEvent.baseEventID(e.type),me=this;if(this.fireEvent($e,e)&&$e<10){__px(this).cancelEvent(e);return;};switch(e.type){case "keydown":this.handleKeyDown(e);break;case "keyup":switch(this.textMode){case 1:if(this.textField){var $m=this.getText();if(!this.oldText||this.oldText!=$m){this.setValue($m,$m,true);this.oldText=$m;}};break;default:this.getSelectedText();if(!this.onKeyUp(e))__px(this).cancelEvent(e);break;};break;case "keypress":this.$2A(e);break;case "input":if(!this.suppressTyping&&__px(this).isVisible(this.element))__px_cm(this).notifyOwnerTyping(this);break;case "touchstart":if(!this.hasEditLink&&this.textMode!=1){if(__px(this).getTitle(this.element))__px_tm(this).handleTouchStart(e);else this.$2g();__px(this).cancelEvent(e);};break;case "mousedown":this.mouseClicked=true;break;case "mouseup":if(this.lockMouseUp){__px(this).cancelEvent(e);delete this.lockMouseUp;};delete this.mouseClicked;break;case "click":if(this.hasEditLink)this.editRecord(false);else this.getSelectedText();if(!this.onClick(e))__px(this).cancelEvent(e);break;case "focus":this.handleFocus(e);delete this.mouseClicked;break;case "blur":this.handleBlur(e);break;case "cut":if(this.autoComplete&&!this.suppressDropDown)this.$2B();break;case "paste":var $V=e.clipboardData?e.clipboardData:__win(this).clipboardData;if($V!=null){var $0Z=$V.getData("Text");if($0Z)__px_cm(this).notifyOwnerTyping(this);}else __px_cm(this).notifyOwnerTyping(this);if(this.autoComplete&&!this.suppressDropDown)this.$2B();break;}};PXSelectorBase.prototype.handleKeyDown=function(e){this.getSelectedText();if(!this.onKeyDown(e))__px(this).cancelEvent(e);var k=e.keyCode,me=this;switch(k){case 27:__px(this).cancelEvent(e,false);break;case 13:case 9:var $10=this.dropDownOpen||this.autoCompleteOpen;if($10&&this.$1S==null&&k==13){this.hideDropDown(true);this.$1L(this.isEditMode());}else{if($10)this.hideDropDown(false);if(!this.inlineEditor){this.execBlurCommand(false);this.$2C=true;setTimeout(function(){delete me.$2C;},1);}};break;case 38:case 40:if(this.dropDownOpen){var $0x=this.grid.activeRow;if($0x)$0x=(k==40)?$0x.nextRow():$0x.prevRow();if($0x)$0x.activate();this.grid.focus();}else if(this.autoCompleteOpen){this.$2D(k==38);__px(this).cancelEvent(e);};break;case 114:if(this.hasDataSource&&!this.suggestOnly){this.$2g(true,true);__px(this).cancelEvent(e);};break;case 8:case 46:if(this.textField&&!this.getDisabled()&&!this.selectOnly){if(this.suppressEdit){this.updateValue(null);__px(this).cancelEvent(e);return;}else if(this.textMode!=1){var $11=this.getText().length;var $12=this.selStart==0&&this.selEnd==$11;$12|=$11==1&&this.selStart==0&&k==46;$12|=$11==1&&this.selStart==1&&k==8;if($12){this.saveValueInState(null);return;}}};if(this.getReadOnly())__px(this).cancelEvent(e);break;};switch(k){case 8:case 46:if((__px(this).IsAnyIE||__px(this).IsSafari||__px(this).IsFirefoxFrom65)&&!this.getDisabled()){e.keyC=(k==46)?7:k;this.$2E(e);}}};PXSelectorBase.prototype.$2A=function(e){if((this.suppressEdit||this.getDisabled())&&e.keyCode!=9){if(!e.ctrlKey)__px(this).cancelEvent(e);return;};if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&!this.getDisabled()){e.keyC=e.keyCode;if(e.which!=null){e.keyC=e.which;if(e.keyCode==46&&e.keyC==0)e.keyC=7;};this.getSelectedText();if(e.keyC&&e.keyC!=13){if(this.asciiCharSet&&e.keyC>127)__px(this).cancelEvent(e);else this.$2E(e);}}};PXSelectorBase.prototype.$2E=function(e){var $13=this.onKeyPress(e);if(!$13){__px(this).cancelEvent(e);if($13===false)return;};if(this.autoComplete&&!this.suppressDropDown)this.$2B();};PXSelectorBase.prototype.$2B=function(){if(this.$1S)this.$2F();this.autoCompletePage=0;var me=this;setTimeout(function(){var $m=me.$1U();if(!$m||$m.length==1){if(me.autoCompleteOpen)me.hideDropDown();me.$1V();}else me.$1S=setTimeout(function(){me.$2G();},500);},0);};PXSelectorBase.prototype.$2F=function(){if(this.$1S){clearTimeout(this.$1S);delete this.$1S;}};PXSelectorBase.prototype.$1V=function(){if(this.autoComplete){delete this.$2H;delete this.$1R;}};PXSelectorBase.prototype.handleFocus=function(e){this.hasFocus=true;this.onFocus(e);if(!this.getDisabled()&&!this.suppressEdit){if(!this.$2H)this.oldText=this.$1L(true);if(this.oldValue===undefined)this.oldValue=this.getValue();};if(this.selectOnFocus){this.selectAll();this.lockMouseUp=true;var me=this;if(this.mouseClicked&&__px(this).IsEdge)setTimeout(function(){me.selectAll();},0);};this.getSelectedText();__px_cm(this).notifyOwnerActivate(this);};PXSelectorBase.prototype.handleBlur=function(e){this.hasFocus=false;this.onBlur(e);if(this.getDisabled())return;if(this.$2I){this.elemText.removeAttribute("unblock");delete this.$2I;};if(this.dropDownOpen||this.autoCompleteOpen){if(!this.autoComplete)this.getValue(true);}else{this.$1V();this.execBlurCommand(true);}};PXSelectorBase.prototype.execBlurCommand=function($H){if(this.suppressEdit||this.getDisabled())return;if(this.$1S)this.$2F();var $14=(this.textField&&this.textMode==2),$15=this.getText();var $16=!this.inlineEditor&&($15&&this.oldText!=$15);if(this.$2C)$16=false;if($14&&$16){if(this.hasAction){this.preProcessData="Search|"+$15;__px_cm(this).processPostData(this);delete this.preProcessData;}else this.search();}else{if(this.textField&&this.autoComplete)this.updateAutoCompleteText();this.updateValue();if($H)this.$1L(false);}};PXSelectorBase.prototype.updateAutoCompleteText=function(){var $15=this.getText();var $16=!this.inlineEditor&&($15&&this.oldText!=$15);if($16){if(!$15&&this.allowNull){this.saveValueInState(null);}else this.setText(this.oldText);}};PXSelectorBase.$1A=function(e){var $X=__px(this).eventObject(e),$17=__px(this).eventElem(e);if($X&&$17){if($17&&__px_cm(this).isSpriteOrImage($17.parentNode))$17=$17.parentNode;var $18=($17==$X.elemDrop),$19=($17==$X.elemEdit);var $0f=($17==$X.elemButton),$0d=$X.images;if($18)$0d=$X.imagesD;else if($19)$0d=$X.imagesE;if($0f){var $1a=__px_all(this)[this.parentNode.parentNode.parentNode.id];if($1a.complexSuggest){return;}};if(!$X.getDisabled()||!$0f)switch(e.type){case "mouseover":$17.$25=true;$X.$1F($17,$0d);break;case "mouseout":$17.$24=$17.$25=false;$X.$1F($17,$0d);break;case "mousedown":$17.$24=true;$X.$1F($17,$0d);if($18){var $1b=$X.$21();if($1b){if(!$X.$2z){if($X.dropDownOpen)$X.hideDropDown();$1b.show($X.element,true);$X.$2z=true;}else $1b.setActive(false,true);}}else if($0f){if($X.hasDataSource&&!$X.$1S)$X.$2g();}else if($19){$X.editRecord();};__px(this).cancelEvent(e,false);break;case "mouseup":$17.$24=false;$X.$1F($17,$0d);break;}}};PXSelectorBase.prototype.getDropDown=function(){return this.autoCompleteOpen?this.dropDown2:this.dropDown;};PXSelectorBase.prototype.$1T=function($1c){if(typeof($1c)=="string")this.autoCompleteItems=$1c=this.$2J($1c);if($1c!=undefined&&$1c.length==0){if(this.autoCompleteOpen)this.hideDropDown();return;};if(this.dropDown2==null)this.createDropDown($1c);else if($1c!=undefined)this.$2K($1c);if(this.$1R)this.$2H=true;if(!this.autoCompleteOpen){__px_cm(this).closeActiveDropDown(this);this.autoCompleteOpen=true;__px_cm(this).setDropDownVisible(this,true);this.$2L();__px(this).setDropDownPos(this.element,this.dropDown2,2);this.dropDownOpen=false;}else{this.$2L();__px(this).setDropDownPos(this.element,this.dropDown2,2);};this.$2M(0);};PXSelectorBase.prototype.$2J=function($1c){var $1d=$1c.indexOf('$');if($1d>-1){this.isLastDDPage=parseInt($1c.substring(0,$1d),10)>0;var ar=eval($1c.substring($1d+1));var $1e=this;ar.forEach(function($1f){var $m=$1f.originalText;if(!$1e.textField||!$1f.text){$1f.text=$1f.formattedValue?($1f.formattedValue+($m?(" - "+$m):"")):$m;};if($1f.type){$1f.icon=$1e.suggestMap[$1f.type];}});};return ar;};PXSelectorBase.prototype.$2G=function(){var $m=this.$1U(),me=this;if(this.dropDownOpen)this.hideDropDown();if(!$m){if(this.autoCompleteOpen)this.hideDropDown();delete this.$1S;}else if($m){if(this.elemText.getAttribute("unblock")==null){this.elemText.setAttribute("unblock","1");this.$2I=true;};this.$1R=this.$2h=$m;this.suggest();}};PXSelectorBase.prototype.createDropDown=function($1c){var $0j=__px(this).createElement("div",__doc(this).forms[0]);this.dropDown2=$0j;var $1g=__px(this).createElement("div",$0j);$1g.style.overflow="auto";var $1h=this.ddTable=__px(this).createElement("table",$1g);$1h.id=this.ID+"_dd";$1h.cellSpacing=$1h.cellPadding=0;$0j.className="selDropTable";$0j.style.position="absolute";var $1i=this.ddLinksDiv=__px(this).createElement("div",$0j);$1i.className="selDropLinks";var ln=this.ddLinkN=__px(this).createElement("a",$1i);var lp=this.ddLinkP=__px(this).createElement("a",$1i);ln.setAttribute("data-cmd","n");lp.setAttribute("data-cmd","p");ln.innerHTML=this.nextLabel;lp.innerHTML=this.prevLabel;lp.href=ln.href="javascript:void 0";lp.className=ln.className="selDropLink";$1h.object=$0j.object=this;if($1c)this.$2K($1c);this.attachDDEventHandlers();};PXSelectorBase.prototype.$2K=function($1c){if($1c==null)return;var $1h=this.ddTable,$0x=null,$B=null;while($1h.rows.length>0)$1h.deleteRow(-1);this.ddItemsCount=$1c.length;for(var i=0;i<$1c.length;i++){var $1f=$1c[i];$0x=$1h.insertRow(i);var $1j=$1f.text?$1f.text:$1f.value;if(this.complexSuggest){var $1k=$0x.insertCell(0);$1k.innerHTML=$1f.icon;};var $1l=$0x.insertCell(this.complexSuggest?1:0);if($1j&&this.$1R){var $1m=this.$1R.replace(/\ /g,'|');$1m=$1m.replace("+","\\+").replace("?","\\?").replace("*","\\*");$1m=$1m.replace("\\","\\\\").replace("(","\\(").replace(")","\\)");var re=new RegExp($1m,'ig'),$1n=function($1o,p1,p2,$1p,s){return '<span class="searchTextMark">'+$1o+'</span>';};$1j=$1j.replace(re,$1n);};if(__px(this).isRTL())$1l.style.textAlign="right";$1l.className="selDropItem";if($1j==""||typeof($1j)!="undefined"&&$1j.trim&&$1j.trim().length==0)$1l.innerHTML="&nbsp;";else $1l.innerHTML=$1j;};delete this.currentDropDownRow;this.$2N();this.setDropDownSize();};PXSelectorBase.prototype.setDropDownSize=function(){var scroll=false,$1h=this.ddTable,$1g=$1h.parentNode;var $0j=this.dropDown2,$i=($0j.style.display==""),me=this;if(!$i){$0j.style.top=$0j.style.left="-999px";$0j.style.display="";};var $1q=$1h.rows.length;if($1q>0){var $z=0;for(var i=0;i<$1q;i++)if($1h.rows[i].offsetHeight>0){$z=$1h.rows[i].offsetHeight;break;};$z*=15;$1h.style.width="";if($z>0&&$z<$1h.offsetHeight){$1g.style.height=$z+"px";$1g.style.width=($1h.offsetWidth+17)+"px";scroll=true;}else{$1g.style.width=$1g.style.height="";}};if(!$i)$0j.style.display="none";};PXSelectorBase.prototype.$2L=function(){var ew=this.element.offsetWidth;var $1h=this.ddTable,$1g=$1h.parentNode;$1h.style.width="";if(ew>$1h.offsetWidth){var $1r=($1g.offsetHeight<$1h.offsetHeight)?17:0;$1h.style.width=ew-$1r+"px";var w=$1h.offsetWidth+$1r;$1g.style.width=(ew>w?ew:w)+"px";}};PXSelectorBase.prototype.$2N=function(){var $1h=this.ddTable,$1s=$1h.rows.length<20;var $1t=!this.autoCompletePage&&($1s||this.isLastDDPage);this.ddLinksDiv.style.display=$1t?"none":"";if(!$1t){__px(this).setEnabled(this.ddLinkN,!this.isLastDDPage);__px(this).setEnabled(this.ddLinkP,this.autoCompletePage>0);}};PXSelectorBase.prototype.$1D=function(e){var me=this,$0x,$1u=function(){var $b=__px(me).eventElem(e);while($b!=null&&$b.tagName!="TR")$b=$b.parentNode;return $b;};switch(e.type){case "selectstart":case "contextmenu":return __px(this).cancelEvent(e,false);case "mouseover":$0x=$1u();if($0x&&$0x.rowIndex!==this.currentDropDownRow)this.$2M($0x.rowIndex);break;case "mouseup":$0x=$1u();if($0x){this.hideDropDown(true);this.focus();};break;}};PXSelectorBase.prototype.$1E=function(e){var $b=__px(this).eventElem(e);if($b&&$b.tagName=="A"&&__px(this).getEnabled($b)){switch($b.getAttribute("data-cmd")){case "n":this.autoCompletePage++;break;case "p":this.autoCompletePage--;break;};this.suggest();}};PXSelectorBase.prototype.$2M=function($1d){var $0x=this.ddTable.rows[$1d],$1v=this.currentDropDownRow;if($1v>=0){var $B=this.ddTable.rows[$1v].cells[0];$B.className=__px(this).excludeCss($B,["selected"]);if(this.complexSuggest){var $1w=this.ddTable.rows[$1v].cells[1];$1w.className=__px(this).excludeCss($1w,["selected"]);}};this.currentDropDownRow=$1d;$0x.cells[0].className=__px(this).appendCss($0x.cells[0],["selected"]);if(this.complexSuggest){$0x.cells[1].className=__px(this).appendCss($0x.cells[1],["selected"]);};__px(this).scrollToView(this.ddTable.parentNode,$0x);};PXSelectorBase.prototype.$2D=function(back){var $1d=this.currentDropDownRow,$1c=this.autoCompleteItems;if($1d!=null){$1d+=back?-1:1;if($1d>=$1c.length)$1d=$1c.length-1;else if($1d<0)$1d=0;}else $1d=0;this.$2M($1d);return $1d;};PXSelectorBase.prototype.$2i=function(){var i=this.currentDropDownRow,$1c=this.autoCompleteItems;if(i==null||$1c==null)return;var cs=this.autoCallBack,$1f=$1c[i];this.$1N=$1f;try{if(cs.manual)cs.enabled=false;if(this.textField&&this.value==null)this.oldValue=null;this.onSelect($1f.value,$1f.originalText);}finally{if(cs.manual)cs.enabled=true;};if(this.hasHint){var $m=this.getHintText($1f.value,$1f.originalText,this.hasHintLabel);this.setHintText($m,false);}};PXSelectorBase.prototype.suggestTypeMapping=function($1x){if($1x){this.suggestMap=JSON.parse($1x);this.complexSuggest=true;}else{this.suggestMap={};this.complexSuggest=false;}};



function PXSelector($a,$b,$c,$d){PXSelector.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXSelector.properties);this.$n();};PXSelector.__baseType=PXSelectorBase;PXSelector.properties=[["inputMask",JSType.String,''],["promptChar",JSType.String,'_']];PXSelector.prototype.setHintState=function(){PXSelector.callBase(this,"setHintState");this.$n();};PXSelector.prototype.setInputMask=function($e){if(this.inputMask!=$e){this.inputMask=$e;this.$n();}};PXSelector.prototype.setPromptChar=function($f){this.promptChar=$f;if(this.maskEdit!=null)this.maskEdit.promptChar=$f;};PXSelector.prototype.$n=function(){if(this.inputMask&&!this.textField&&this.elemText.tagName=="INPUT"){if(this.maskEdit==null){var $g=new Object();$g.inputMask=this.inputMask;$g.allowNull=this.allowNull;$g.nullText=this.nullText;$g.promptChar=this.promptChar;$g.asciiCharSet=this.asciiCharSet;$g.bindingContainer=this.bindingContainer;this.maskEdit=new PXMaskEdit(this.px_context,this.elemText,$g);this.maskEdit.owner=this;this.maskEdit.allowRepaintText=false;if(this.autoCompleteNM)this.maskEdit.validateEdit=false;this.suppressTyping=true;}else this.maskEdit.setInputMask(this.inputMask);}else{this.suppressTyping=false;if(this.maskEdit){this.maskEdit.owner=null;this.maskEdit.detachEventHandlers();};this.maskEdit=null;this.elemText.object=this;}};PXSelector.prototype.getValue=function($h){if(this.textField)return PXSelector.callBase(this,"getValue",[$h]);if(this.value===undefined||($h&&this.editMode)){if(this.maskEdit!=null)this.value=this.maskEdit.getValue(true);else this.value=PXSelector.callBase(this,"getValue",[$h]);};return this.value;};PXSelector.prototype.getCorrectValue=function(v){if(this.maskEdit!=null&&!this.textField)return this.value=this.maskEdit.calculateValue(v,0,0);return PXSelector.callBase(this,"getCorrectValue",[v]);};PXSelector.prototype.onEditorElementChanged=function($i,$j){PXSelector.callBase(this,"onEditorElementChanged",[$i,$j]);if(this.maskEdit){this.maskEdit.detachEventHandlers();delete this.maskEdit;};this.$n();};PXSelector.prototype.getDisplayText=function(v){if(this.maskEdit!=null&&(!this.hasHintText||this.hintText==null))return this.maskEdit.getDisplayText(v);else return PXSelector.callBase(this,"getDisplayText",[v]);};PXSelector.prototype.getEditText=function(v){if(this.maskEdit!=null)return this.maskEdit.getEditText(v);else return PXSelector.callBase(this,"getEditText",[v]);};PXSelector.prototype.getHintText=function($k,$l,$m){if(this.maskEdit!=null)$k=this.maskEdit.getDisplayText($k);return PXSelector.callBase(this,"getHintText",[$k,$l,$m]);};PXSelector.prototype.detachEventHandlers=function(){PXSelector.callBase(this,"detachEventHandlers");if(this.maskEdit!=null)this.maskEdit.detachEventHandlers();};


function PXMultiSelector($a,$b,$c,$d){this.itemsClickH=Function.createDelegate(this,this.$A);PXMultiSelector.initializeBaseA(this,[$a,$b,$c,$d]);__px_cm(this).readProperties(this,$c,PXMultiSelector.properties);this.setHintState();this.valueTempl='{0'+String.fromCharCode(125);this.textTempl='{1'+String.fromCharCode(125);};PXMultiSelector.properties=[["valuesSeparator",JSType.String,';'],["valueTemplate",JSType.String,''],["closingSeparator",JSType.Bool,false],["allowCustomItems",JSType.Bool,true]];PXMultiSelector.__baseType=PXSelectorBase;PXMultiSelector.prototype.attachEventHandlers=function(){PXMultiSelector.callBase(this,"attachEventHandlers");__px(this).addEventHandler(this.elemText.parentNode,"mousedown",this.itemsClickH,false);};PXMultiSelector.prototype.detachEventHandlers=function(){PXMultiSelector.callBase(this,"detachEventHandlers");__px(this).removeEventHandler(this.elemText.parentNode,"mousedown",this.itemsClickH,false);};PXMultiSelector.prototype.setHintState=function(){PXMultiSelector.callBase(this,"setHintState");this.suppressEdit=this.selectOnly||(this.textField&&!this.autoComplete&&!this.allowCustomItems);};PXMultiSelector.prototype.getValue=function($e){if(this.value===undefined||$e){var $f=this.elemText.parentNode,ar=new Array();for(var i=0;i<$f.childNodes.length;i++){var $g=$f.childNodes[i];if($g==this.elemText)break;if($g.getAttribute==null)continue;var $h=$g.getAttribute("data-value");if($h)ar.push($h);};var v=this.$B(ar);this.value=(this.allowNull&&this.isNullValue(v))?null:v;};return this.value;};PXMultiSelector.prototype.setValue=function($h){if($h)$h=$h.toString().trim();if($h&&this.closingSeparator&&!$h.endsWith(this.valuesSeparator))$h+=this.valuesSeparator;this.viewState.update("Value",($h!=null)?$h:"");this.value=this.oldValue=$h;this.$C($h);};PXMultiSelector.prototype.getDisplayText=function(v){return "";};PXMultiSelector.prototype.getEditText=function(v){return "";};PXMultiSelector.prototype.getSearchValue=function(){var $i=PXMultiSelector.callBase(this,"getSearchValue");if($i)$i=$i.split(this.valuesSeparator)[0];return $i;};PXMultiSelector.prototype.getSearchClientValue=function(){return null;};PXMultiSelector.prototype.$C=function(v){var $j=this.$D(v);var $f=this.elemText.parentNode;while(this.elemText.previousSibling!=null)$f.removeChild(this.elemText.previousSibling);var $k=[];var $l={};for(var i=0;i<$j.length;i++){if(!$j[i])continue;var $i=$j[i].trim(),$g=$i,vt=this.valueTemplate;if(vt&&vt.indexOf(this.valueTempl)>=0&&vt.indexOf(this.textTempl)>=0){var vi=vt.indexOf(this.valueTempl),ti=vt.indexOf(this.textTempl);var i1=Math.min(vi,ti),i2=Math.max(vi,ti),tl=vt.length;$i=$i.substr(0,$i.length-(tl-i2-3));$i=$i.substr(i1);var $m=vt.substr(i1+3,i2-(i1+3)).trim();var $n=$i.split($m,2);if($n.length==2){$k.push({'email':$n[1],'item':$g,'name':$n[0]});$l[$n[0]]=($l[$n[0]]||0)+1;$i=$n[(ti==i1)?0:1];}else{$k.push({'text':$g,'item':$g});}}else $k.push({'item':$g,'text':$i});};for(var i=0;i<$k.length;i++){var $o=$k[i];var $g=$o.item;var $i=($o.name&&$l[$o.name]>1)?$o.email:($o.name||$o.text);var $p=__doc(this).createElement("div");$p.className="selItem";$p.setAttribute("data-value",$g);$f.insertBefore($p,this.elemText);var $q=__doc(this).createElement("div");$q.className="selItemText";if($g!=$i)__px(this).setTitle($q,$g);$q.innerHTML=$i;$p.appendChild($q);if(!this.getDisabled())__px_cm(this).createSpriteOrImage($p,"control@ClearN");}};PXMultiSelector.prototype.onStateChanged=function(){PXMultiSelector.callBase(this,"onStateChanged");this.$C(this.getValue());};PXMultiSelector.prototype.onSelect=function($r,$s){var $t=null,$i="",$u=this.getValue(),$h=$r;if(typeof($s)!="string"){if(this.textField)$t=$s.getCell(this.textField);if($t)$i=$t.getValue();}else $i=$s;var name=$i.replace(/\([^)]*[)]\s*$/,'').replace(/&quot;/g,'"').trim();while(name.slice(0,1)=='"'&&name.slice(-1)=='"')name=name.slice(1,-1);if(name.indexOf(',')>-1)name='"'+name+'"';var $v=this;if(name&&this.valueTemplate)$h=$r.split(/[;,]/).map(function(v){return $v.valueTemplate.replace($v.valueTempl,v).replace($v.textTempl,name);}).join($v.valuesSeparator);if($u)$h=this.$E($h);return this.updateValue($h);};PXMultiSelector.prototype.$E=function($h){var ar=this.$D(this.getValue());for(var i=0;i<ar.length;i++)if(ar[i].trim()==$h){ar.splice(i,1);break;};ar.push($h);return this.$B(ar);};PXMultiSelector.prototype.$F=function(){var ar=this.$D(this.getValue());ar.pop();return this.$B(ar);};PXMultiSelector.prototype.$D=function($h){var ar=$h?$h.toString().split(this.valuesSeparator):[];var $w=new Array();for(var i=0;i<ar.length;i++)if(ar[i]&&ar[i].trim())$w.push(ar[i].trim());return $w;};PXMultiSelector.prototype.$B=function(ar){var $w=new Array();for(var i=0;i<ar.length;i++)if(ar[i]&&ar[i].trim())$w.push(ar[i].trim());var $r=$w.join(this.valuesSeparator+' ');if($r&&this.closingSeparator)$r+=this.valuesSeparator;return $r;};PXMultiSelector.prototype.$G=function(){var $r=this.getText();if($r){this.setText("");this.updateValue(this.$E($r));return true;}};PXMultiSelector.prototype.$A=function(e){if(!this.getDisabled()){var $b=__px(this).eventElem(e),$h;do{var $x=$b.getAttribute("icon");if($x&&$x.startsWith("Clear")){$h=$b.parentNode.getAttribute("data-value");break;};$b=$b.parentNode;}while($b!=this.element);if($h){var ar=this.$D(this.getValue());Array.remove(ar,$h);this.updateValue(this.$B(ar));}};__px(this).cancelEvent(e);this.focus();};PXMultiSelector.prototype.onBlur=function(e){if(!this.allowCustomItems)this.setText("");this.elemText.style.width="";};PXMultiSelector.prototype.updateValue=function($r,$i){if(this.allowCustomItems&&!this.autoCompleteOpen)this.$G();PXMultiSelector.callBase(this,"updateValue",[$r,$i]);};PXMultiSelector.prototype.updateAutoCompleteText=function(){};PXMultiSelector.prototype.onKeyPress=function(e){var $y=e.which||e.keyCode,me=this,et=this.elemText;switch($y){case 44:case 59:if(this.allowCustomItems&&this.$G())return false;break;};setTimeout(function(){var $z=__px(me).getTextWidth(me.getText(),et.className);if($z<100)$z=100;et.style.width=$z+5+"px";},1);return true;};PXMultiSelector.prototype.onKeyDown=function(e){switch(e.keyCode){case 8:case 46:if(!this.getDisabled()&&!this.getText()&&this.getValue())this.updateValue(this.$F());break;};return true;};



function PXSegmentMask($a,$b,$c,$d){PXSegmentMask.initializeBaseA(this,[$a,$b,$c,$d]);this.autoRefreshBase=this.autoRefresh;__px_cm(this).readProperties(this,$c,PXSegmentMask.properties);if(this.selectMode>0)this.autoCompleteNM=this.autoComplete=0;this.$V=this.$W();};PXSegmentMask.__baseType=PXSelectorBase;PXSegmentMask.itemsDesc=[["editMask",JSType.Int,0],["length",JSType.Int,3],["validate",JSType.Bool,false],["selectable",JSType.Bool,true],["readOnly",JSType.Bool,false],["textCase",JSType.Int,0],["textAlign",JSType.Int,1],["emptyChar",JSType.String,' '],["promptChar",JSType.String,'_'],["separator",JSType.String,'.'],["title",JSType.String,'']];PXSegmentMask.properties=[["selectMode",JSType.Int,0],["alignSegments",JSType.Bool,true],["wildcard",JSType.String,""],["valueField2",JSType.String,""],["items",JSType.Array,PXSegmentMask.itemsDesc]];PXSegmentMask.callbackProps=[["items",JSType.Array,PXSegmentMask.itemsDesc]];PXSegmentMask.prototype.setProperties=function($c){if($c.items!=null){__px_cm(this).readProperties(this,$c,PXSegmentMask.callbackProps);this.$V=this.$W();};PXSegmentMask.callBase(this,"setProperties",[$c]);};PXSegmentMask.prototype.setItems=function($e){var $c=new Object();$c.items=$e;__px_cm(this).readProperties(this,$c,PXSegmentMask.callbackProps);this.$V=this.$W();};PXSegmentMask.prototype.initInlineEditor=function($f){PXSegmentMask.callBase(this,"initInlineEditor",[$f]);this.items=$f.items;this.$V=$f.$V;};PXSegmentMask.prototype.getValue=function($g){if(this.textField)return PXSegmentMask.callBase(this,"getValue",[$g]);if(this.value===undefined||($g&&this.editMode)){var $h=this.$X(this.elemText.value,this.autoCompleteNM?false:true);if($h!==undefined)this.value=$h;};return this.value;};PXSegmentMask.prototype.getCorrectValue=function(v){if(!this.textField)return this.value=this.$X(v,false);return PXSegmentMask.callBase(this,"getCorrectValue",[v]);};PXSegmentMask.prototype.getDisplayValue=function(v){return this.getEditText(v,true,true);};PXSegmentMask.prototype.getSearchValue=function(){if(!this.isInValueMode()&&this.items){var $i=this.$Y(this.selStart);return this.$Z($i);};return PXSegmentMask.callBase(this,"getSearchValue");};PXSegmentMask.prototype.getSearchClientValue=function(){if(!this.isInValueMode()&&this.items)return this.getSearchValue();return PXSegmentMask.callBase(this,"getSearchClientValue");};PXSegmentMask.prototype.isInValueMode=function(){return this.selectMode==0||(this.selectMode==2&&this.$00==null);};PXSegmentMask.prototype.getValueField=function(){if(this.selectMode==2&&!this.isInValueMode())return this.valueField2;return PXSegmentMask.callBase(this,"getValueField");};PXSegmentMask.prototype.$01=function($i,ch){if(ch==$i.emptyChar)return ch;if(this.wildcard.indexOf(ch)>=0&&ch!=$i.promptChar)return ch;if(ch==$i.promptChar||(this.asciiCharSet&&ch.charCodeAt(0)>127))return null;var $j=true;switch($i.editMask){case 1:$j=__px(this).isLetter(ch)||__px(this).isDigit(ch);break;case 2:$j=__px(this).isDigit(ch);break;case 3:$j=__px(this).isLetter(ch);break;};if($j){switch($i.textCase){case 1:ch=ch.toUpperCase();break;case 2:ch=ch.toLowerCase();break;}}else ch=null;return ch;};PXSegmentMask.prototype.$X=function($k,$l){if(this.isNullValue($k)||this.items==null)return this.allowNull?null:"";var $m=$k.length,j=0,$n="",$o=true;for(var i=0;i<this.items.length;i++){var $i=this.items[i];for(var k=0;k<$i.length;k++){if(j<$m){var ch=this.$01($i,$k.charAt(j));if(ch!=null&&ch!=$i.emptyChar){$n+=ch;$o=false;}else $n+=$i.emptyChar;j++;}else break;};if($l||(j<$m&&$k.charAt(j)==$i.separator))j++;if(j>=$m)break;};return $o?(this.allowNull?null:""):$n.trimEnd();};PXSegmentMask.prototype.$W=function(){var $p=""
if(this.items!=null){var $m=this.items.length;for(var i=0;i<$m;i++){var $i=this.items[i],ch=String.fromCharCode($i.editMask);var $q=String.fromCharCode($i.editMask+10);for(var j=0;j<$i.length;j++)$p+=$i.readOnly?$q:ch;if(i<($m-1))$p+=String.fromCharCode(i+20);}};return $p;};PXSegmentMask.prototype.getEditText=function($n,$r,$s){if(this.items==null)return "";if(this.textField)return this.getText();if($n==null)$n="";if(!$s&&this.autoCompleteNM)return $n;var $k="",$m=$n.length,j=0,ch;for(var i=0;i<this.items.length;i++){var $i=this.items[i];var $t=$r?$i.emptyChar:$i.promptChar;var $u=$i.emptyChar.charCodeAt(0)>32;for(var k=0;k<$i.length;k++){if(j<$m){ch=$n.charAt(j++);if(ch==$i.emptyChar){$k+=$u?$i.emptyChar:$t;}else $k+=ch;}else $k+=$t;};if(i<(this.items.length-1))$k+=$i.separator;};return $k;};PXSegmentMask.prototype.getDisplayText=function($n){if(this.allowNull&&$n==null)return this.nullText;if(!this.inlineEditor||$n==this.getValue()){if(this.textField)return this.getText();if(this.hasHintText&&this.hintText)return this.hintText;};return this.getEditText($n,true,true);};PXSegmentMask.prototype.onKeyUp=function(e){if(this.items&&!this.dropOpen&&!this.autoCompleteNM)this.$02();return true;};PXSegmentMask.prototype.onKeyDown=function(e){if(this.items&&this.items.length>1&&e.ctrlKey)if(e.keyCode==39||e.keyCode==37){this.selectNextSegment(e.keyCode==37);return false;};return true;};PXSegmentMask.prototype.onClick=function(e){if(this.items&&!this.dropOpen&&!this.autoCompleteNM)this.$02();return true;};PXSegmentMask.prototype.onBlur=function(e){if(this.selStart==this.selEnd&&this.items&&!this.getDisabled()&&!this.textField&&!this.autoCompleteNM&&this.alignSegments){var et=this.elemText;et.value=this.$03(et.value,this.selStart);}};PXSegmentMask.prototype.onFocus=function(e){PXSegmentMask.callBase(this,"onFocus",[e]);if(!this.dropOpen)delete this.lastPos;};PXSegmentMask.prototype.onShowDropDown=function(){if(!PXSegmentMask.callBase(this,"onShowDropDown"))return false;switch(this.selectMode){case 0:return true;case 2:if(this.keyboardOpening==null){if(this.panel)this.panel.setCaption(this.getPanelCaption());this.autoRefresh=(this.$00!=null)?true:this.autoRefreshBase;delete this.$00;this.viewState.remove("ActiveSegment");return true;};break;};var $v=this.$04(this.selStart);var $i=this.items[$v],$w=false,$x;if($i.selectable&&!$i.readOnly){$w=true;if(this.needValueInState()){var $y=this.value,$n=this.getValue(true);this.saveValueInState($n);if($n!=$y)$x=true;};if($v!=this.$00){this.$00=$v;this.viewState.update("ActiveSegment",$v);$x=true;if(this.panel)this.panel.setCaption($i.title);else this.panelCaption=$i.title;};if($x)this.autoRefresh=true;else this.autoRefresh=this.autoRefreshBase;};return $w;};PXSegmentMask.prototype.onSelect=function($h,$z){if(this.textField||this.isInValueMode())return PXSegmentMask.callBase(this,"onSelect",[$h,$z]);else{var $i=this.items[this.$00];this.$05($i,$h);__px_cm(this).notifyOwnerTyping(this);if(!this.isInValueMode()){var $A=true;for(var i=this.$00+1;i<this.items.length;i++)if(!!this.$Z(this.items[i])){$A=false;break;};return $A;}};return true;};PXSegmentMask.prototype.onHideDropDown=function($B){var $C=this.isInValueMode();var $D=new Object();$D.select=$B;$D.complete=($C&&$B);if(!$C){var $v=this.$00,$E=this.$06(this.items[$v]);var $A=($v==(this.items.length-1)),me=this;if($B&&!$A)$E=this.$06(this.items[$v+1]);if(__px(this).IsIE)this.focus();setTimeout(function(){me.selectPos($E);},0);$D.complete=$A&&$B;};if(this.fireEvent(15,null,$D))return false;return $C;};PXSegmentMask.prototype.selectPos=function($E){if(!__px(this).IsIE)this.focus();var $F=this;if(__px(this).IsEdge)setTimeout(function(){$F.select($F.lastPos=$E);},10);else{this.select(this.lastPos=$E);}};PXSegmentMask.prototype.onKeyPress=function(e){var $G=e.keyC;if(this.textField||this.autoCompleteNM)return true;if($G<7||($G>8&&$G<32)||!this.items)return false;if(this.items.length>1){var $H=this.items[0].separator.charCodeAt(0);if($G==$H){this.selectNextSegment(false);return false;}};var $k=this.elemText.value,$m=$k.length;var $I=this.selStart,$J=this.selEnd;if($I!=$J){$k=this.$07($k,$I,$J);}else if($G==7){$I=this.$08($I,false);if($I>=0){$k=this.$07($k,$I);$I++;}}else if($G==8){$I=this.$08(--$I,true);if($I>=0)$k=this.$07($k,$I);};if($G>20&&$I<$m){var ar=this.$09($k,String.fromCharCode($G),$I);if(ar[0]>=0){$I=(ar[0]<$m)?this.$08(ar[0]):$m;$k=ar[1];}else return false;};this.elemText.value=$k;this.select($I);__px_cm(this).notifyOwnerTyping(this);};PXSegmentMask.prototype.$08=function(i,$K){var $m=this.$V.length,$L=-1;while(i<$m&&i>=0){if(this.$V.charCodeAt(i)<10){$L=i;break;};i+=$K?-1:1;};return $L;};PXSegmentMask.prototype.$06=function($i){var $E=0,$M=false;for(var i=0;i<this.items.length;i++){if(this.items[i]==$i){$M=true;break;};$E+=this.items[i].length+1;};return $M?$E:-1;};PXSegmentMask.prototype.$04=function(i){if(i==null)return 0;var $m=this.$V.length,$v=-1;while(i<$m){var $N=this.$V.charCodeAt(i);if($N>=20){$v=$N-20;break;};i++;};if($v<0)$v=(this.items.length-1);return $v;};PXSegmentMask.prototype.$Y=function(i){return this.items[this.$04(i)];};PXSegmentMask.prototype.$Z=function($i,$k){if($k===undefined)$k=this.elemText.value;var $O=this.$06($i),v="";if($O>=0&&$O<$k.length){var $n=$k.substring($O,$O+$i.length);for(var i=0;i<$n.length;i++){var ch=$n.charAt(i);if(ch!=$i.promptChar)v+=ch;};return v;}};PXSegmentMask.prototype.$05=function($i,$n,$k){var $P=($k===undefined);if($P)$k=this.elemText.value;var $Q=$k;var $O=this.$06($i);if($O>=0&&$O<$k.length){var $R=$i.length-$n.length;if($R>0){var s="",$K=($i.textAlign==1);while($R--)s+=$i.promptChar;if($K)$n=$n+s;else $n=s+$n;}else if($R<0){$n=$n.substring(0,$i.length);};var end=$O+$i.length;$k=$k.substring(0,$O)+$n+$k.substring(end);if(this.selectMode==2&&$k!=$Q){var $S=this.items.indexOf($i);if($S>=0){$S=$S+1;if($S<this.items.length){$k=this.$05(this.items[$S],"",$k);}}}};if($P){this.elemText.value=$k;delete this.value;};return $k;};PXSegmentMask.prototype.$09=function($k,ch,i){var $E=this.$08(i),$L=-1;if($E>=0&&$E<$k.length){var $i=this.$Y($E);if($i&&(ch=this.$01($i,ch))!=null){$k=$k.substring(0,$E)+ch+$k.substring($E+1);$L=$E+1;}};return[$L,$k];};PXSegmentMask.prototype.$07=function($k,$T,to){var $m=$k.length;if($T<0)$T=0;if(to!=null&&to>$m)to=$m;if(to==null)to=$T+1;while(--to>=$T){if(this.$V.charCodeAt(to)<10){var $i=this.$Y(to);if($i){var ch=$i.promptChar;$k=$k.substring(0,to)+ch+$k.substring(to+1);}}};return $k;};PXSegmentMask.prototype.selectNextSegment=function(back){var $v=this.$04(this.selStart);if(back){$v--;if($v<0)$v=this.items.length-1;}else{$v++;if($v>=this.items.length)$v=0;};var $E=this.$06(this.items[$v]),me=this;setTimeout(function(){me.selectPos($E);},0);};PXSegmentMask.prototype.$03=function($k,i){var $i=this.$Y(i);var $O=$i?this.$06($i):-1;if($O>=0&&$O<$k.length){var end=$O+$i.length,v="";for(var i=$O;i<end&&i<$k.length;i++){var ch=$k.charAt(i);if(ch!=$i.promptChar)v+=ch;else v+=$i.emptyChar;};v=v.trimEnd();if(v.length!=$i.length){$k=this.$05($i,v,$k);}};return $k;};PXSegmentMask.prototype.$02=function(){if(!this.alignSegments)return false;var $I=this.selStart,$U=false,et=this.elemText;if($I!=this.lastPos&&this.selStart==this.selEnd){var $i=this.$Y($I);if(this.lastItem!=$i&&this.lastPos!=null){et.value=this.$03(et.value,this.lastPos);this.select($I);$U=true;};this.lastItem=$i;this.lastPos=$I;};return $U;};


function PXFilterDialog($a,$b,$c,$d){PXFilterDialog.initializeBaseA(this,[$a,$b,$c,$d]);this.autoHide=true;this.fromLocalized=$c.fromLocalized;this.toLocalized=$c.toLocalized;this.valueLocalized=$c.valueLocalized;this.dateFilters=PXFilterDialog.dateFilters;};PXFilterDialog.__baseType=PXSmartPanel;PXFilterDialog.stringFilters=["EQ","NE","ISNULL","ISNOTNULL","LIKE","RLIKE"];PXFilterDialog.stringFiltersOlap=["EQ","NE","LIKE","RLIKE","GT","GE","LT","LE","BETWEEN"];PXFilterDialog.numberFilters=["EQ","NE","GT","GE","LT","LE","BETWEEN"];PXFilterDialog.dateFilters=["EQ","NE","GT","GE","LT","LE","BETWEEN","TODAY","THIS_MONTH"];PXFilterDialog.boolFilters=["True","False"];PXFilterDialog.nonConditions=["SA","SD","Clear","SelectAll","ClearAll"];PXFilterDialog.valueFilters=["EQ","NE","GT","GE","LT","LE","BETWEEN","LIKE","RLIKE"];PXFilterDialog.emptyValueFilters=["ISNULL","ISNOTNULL","TODAY","TOMMOROW","THIS_WEEK","THIS_MONTH","True","False"];PXFilterDialog.prototype.onLoad=function(){this.tlbMode=__px_all(this)[this.ID+"_mode"];if(this.tlbMode){var h=Function.createDelegate(this,this.$S);this.tlbMode.events.addEventHandler("buttonClick",h);};this.menuCond=__px_all(this)[this.ID+"_cond"];var h=Function.createDelegate(this,this.$T);this.menuCond.events.addEventHandler("itemClick",h);this.menuItems=__px_all(this)[this.ID+"_items"];h=Function.createDelegate(this,this.$U);this.menuItems.events.addEventHandler("itemClick",h);this.itemsFilter=__px_all(this)[this.ID+"_srch"];h=Function.createDelegate(this,this.$V);__px(this).addEventHandler(this.itemsFilter.elemText,"keypress",h,false);__px(this).addEventHandler(this.itemsFilter.elemText,"keydown",h,false);__px(this).addEventHandler(this.itemsFilter.elemText,"paste",h,false);this.edText=__px_all(this)[this.ID+"_txt"];this.edText2=__px_all(this)[this.ID+"_txt2"];this.edSel=__px_all(this)[this.ID+"_sel"];this.edNum1=__px_all(this)[this.ID+"_num1"];this.edNum2=__px_all(this)[this.ID+"_num2"];this.edDate1=__px_all(this)[this.ID+"_date1"];this.edDate2=__px_all(this)[this.ID+"_date2"];this.editors=[this.edText,this.edText2,this.edSel,this.edNum1,this.edNum2,this.edDate1,this.edDate2,this.menuItems];h=Function.createDelegate(this,this.$W);for(var i=0;i<this.editors.length;i++){delete this.editors[i].bindingContainer;this.editors[i].events.addEventHandler("valueChanged",h);};PXFilterDialog.callBase(this,"onLoad");};PXFilterDialog.prototype.$W=function($e,$f){this.$X();};PXFilterDialog.prototype.fireEvent=function(id,ev,$f){switch(id){case "afterHide":this.menuCond.setActive(false);this.menuItems.setActive(false);this.itemsFilter.setValue(null);break;};return PXFilterDialog.callBase(this,"fireEvent",[id,ev,$f]);};PXFilterDialog.prototype.show=function($g){if(this.menuItems&&this.menuItems.getVisible()){var $h=__win(this).theForm?__win(this).theForm:__doc(this).body;if(this.element.parentNode!=$h)$h.appendChild(this.element);this.element.style.left="-999px";this.element.style.display="";this.menuItems.items.ensureScroller(300);this.element.style.display="none";};PXFilterDialog.callBase(this,"show",[$g]);};PXFilterDialog.prototype.$T=function($e,$f){switch($f.item.value){case "Clear":var $i=this.menuItems.items;for(var i=0;i<$i.length;i++)$i.getItem(i).setChecked(false);$i=this.menuCond.items;for(var i=0;i<$i.length;i++){var $j=$i.getItem(i);if(!Array.contains(PXFilterDialog.nonConditions,$j.value))$j.setChecked(false);};this.edText.setValue(null);this.edText2.setValue(null);this.edSel.setValue(0);this.edNum1.setValue(0);this.edNum2.setValue(0);this.edDate1.setValue(null);this.edDate2.setValue(null);this.$Y(false);this.dialogResult=PXDialogResult.OK;this.hide();this.dialogResult=PXDialogResult.None;break;case "AddQuick":if(this.linkedCol){this.dialogResult=PXDialogResult.None;this.hide();this.linkedCol.level.grid.addQuickFilter(this.linkedCol.getKey(),-1);};break;case "RemoveQuick":if(this.linkedCol){this.dialogResult=PXDialogResult.None;this.hide();this.linkedCol.level.grid.removeQuickFilter(this.linkedCol.getKey());};break;case "SelectAll":case "ClearAll":var $i=this.menuItems.items;for(var i=0;i<$i.length;i++)$i.getItem(i).setChecked($f.item.value=="SelectAll");break;case "SA":if(this.linkedCol)this.linkedCol.sort($f.item.getChecked()?1:0);this.hide();break;case "SD":if(this.linkedCol)this.linkedCol.sort($f.item.getChecked()?2:0);this.hide();break;};this.$Y($f.item.value=="BETWEEN");this.$X();};PXFilterDialog.prototype.$U=function($e,$f){this.$X();};PXFilterDialog.prototype.$X=function(){var $i=this.menuCond.items,$k=false,$l;for(var i=0;i<$i.length;i++){var $j=$i.getItem(i);if(Array.contains(PXFilterDialog.emptyValueFilters,$j.value)&&$j.getChecked())$k=true;if(Array.contains(PXFilterDialog.valueFilters,$j.value)&&$j.getChecked()){var $m=this.getFilterValues();if($m.value!=null)$k=true;};if($j.value=="Clear")$l=$j;};if(this.menuItems.getVisible()){$i=this.menuItems.items;for(var i=0;i<$i.length;i++)if($i.getItem(i).getChecked()){$k=true;break;}};$l.setEnabled($k);};PXFilterDialog.prototype.$Y=function($n){if(this.edText.getVisible()){this.edText2.setVisible($n);__px_cm(this).setControlLabel(this.edText,$n?this.fromLocalized:this.valueLocalized);};if(this.edNum1.getVisible()){this.edNum2.setVisible($n);__px_cm(this).setControlLabel(this.edNum1,$n?this.fromLocalized:this.valueLocalized);};if(this.edDate1.getVisible()){this.edDate2.setVisible($n);__px_cm(this).setControlLabel(this.edDate1,$n?this.fromLocalized:this.valueLocalized);}};PXFilterDialog.prototype.setFilterState=function($o,$p){var $q=$o.getFormEditor(false),$r=$o.displayFormat;var $s=$o.textField?NetType.String:$o.dataType,$t;var $u=($q&&$q.__className=="PXDropDown")?$q.items:$o.valueItems;var $v=($u&&$u.length>1),$w=$o.level.grid;var $m=$p?$w.getQuickFilter($o.getKey()):$o.filter;var $x="<null>";for(var i=0;i<this.editors.length;i++)if(this.editors[i])this.editors[i].setVisible(false);this.itemsFilter.setVisible(false);var v1=$m?$m.value:null;if(v1===undefined)v1=null;var v2=$m?$m.value2:null;if(v2===undefined)v2=null;if($v){var $i=this.menuItems.items;while($i.length>0)$i.removeItem(0);var $y=($m&&!!$m.value)?$m.value.split(','):null,mi;if($o.valueItems.emptyPossible)if($m&&$m.condition=="ISNULL")$y=[$x];for(var i=0;i<$u.length;i++){var $j=$u[i];var $z=$j.displayValue?$j.displayValue:$j.text;mi=$i.insertItem($i.length,$z!=null?$z:"",null,null,true,true,$y==null||Array.contains($y,$j.value));mi.value=$j.value;};if($o.valueItems.emptyPossible){mi=$i.insertItem($i.length,$w.filterEmptyMsg,null,null,true,true,$y==null||Array.contains($y,$x));mi.value=$x;};this.menuItems.setVisible(true);if(this.menuItems.items.length>10)this.itemsFilter.setVisible(true);if($m&&$m.condition){if($m.condition=="ISNULL")$m.value=$x;$m.condition="IN";}}else if($s==NetType.DateTime){$t=this.dateFilters;this.edDate1.setVisible(true);this.edDate2.setVisible(true);this.edDate1.setTimeMode($o.timeMode);this.edDate2.setTimeMode($o.timeMode);if($o.dateMask){this.edDate1.setDateMask($o.dateMask,$o.dateMask);this.edDate2.setDateMask($o.dateMask,$o.dateMask);};this.edDate1.setValue(v1);this.edDate2.setValue(v2);}else if(NetType.isNumeric($s)){$t=PXFilterDialog.numberFilters;this.edNum1.setVisible(true);this.edNum2.setVisible(true);var $A=(parseInt($o.decimals)<=0)?null:$o.decimals;if($r&&$r.length>1){var $B=parseInt($r.substring(1));if(!isNaN($B))$A=$B;};this.edNum1.valueType=$s;this.edNum2.valueType=$s;this.edNum1.setDecimals($A);this.edNum2.setDecimals($A);this.edNum1.setValue(v1!=null?parseFloat(v1):null);this.edNum2.setValue(v2!=null?parseFloat(v2):null);}else if($s==NetType.Boolean){$t=PXFilterDialog.boolFilters;}else{$t=PXFilterDialog.stringFilters;if($o.viewName){this.edSel.setVisible(true);this.edSel.setViewName($o.viewName);this.edSel.valueField=$o.valueField;this.edSel.textField=this.edSel.hintField="";if($o.displayMode>0&&$o.textField){if($o.displayMode==1)this.edSel.textField=$o.textField;else this.edSel.hintField=$o.textField;};this.edSel.textMode=this.edSel.textField?1:0;this.edSel.setHintState();this.edSel.setValue(v1);}else{this.edText.setInputMask($r);this.edText2.setInputMask($r);if(!$r){this.edText.element.maxLength=$o.maxLength?$o.maxLength:2147483647;this.edText2.element.maxLength=$o.maxLength?$o.maxLength:2147483647;};this.edText.setVisible(true);this.edText.setValue($m?$m.value:null);this.edText2.setVisible(true);this.edText2.setValue($m?$m.value2:null);}};var $i=this.menuCond.items,$j,$C,$D;if(!$v&&$s!=NetType.Boolean){if($s==NetType.DateTime||NetType.isNumeric($s))$C="BETWEEN";else if($o.viewName)$C="EQ";else $C="LIKE";};for(var i=0;i<$i.length;i++){$j=$i.getItem(i);switch($j.value){case "SA":$j.setVisible($o.allowSort&&$o.dataField);$j.setChecked($o.sortDirection==1);break;case "SD":$j.setVisible($o.allowSort&&$o.dataField);$j.setChecked($o.sortDirection==2);break;case "Clear":$j.setVisible(!$v);break;case "SelectAll":case "ClearAll":$j.setVisible($v);break;case "AddQuick":$j.setVisible($w.hasQuickFilters()&&!$p&&$w.getQuickFilter($o.getKey())==null);break;case "RemoveQuick":$j.setVisible($p&&$w.getQuickFilter($o.getKey())!=null);break;default:if($j.value){$j.setVisible($t&&Array.contains($t,$j.value));if($m&&$m.condition){if($s==NetType.Boolean)$j.setChecked($m.value==$j.value);else $j.setChecked($m.condition==$j.value);}else $j.setChecked($C==$j.value);if($j.getChecked())$D=$j;};break;}};this.linkedCol=$o;this.fromFilterBar=$p;$j.element.nextSibling.style.display=$v?"none":"";this.$X();this.$Y($D&&$D.value=="BETWEEN");this.viewState.update("DataField",$o.dataField);};PXFilterDialog.prototype.getFilterCondition=function(){var $i=this.menuCond.items,$j,$E;for(var i=0;i<$i.length;i++){$j=$i.getItem(i);if(!Array.contains(PXFilterDialog.nonConditions,$j.value)&&$j.getChecked()){$E=$j;break;}};var $m=null,$o=this.linkedCol;if($E){$m=new Object();$m.condition=$E.value;$m.condText=$E.getText().trim();if($E.value=="True"||$E.value=="False"){$m.condition="EQ";$m.value=$E.value;}else this.getFilterValues($m);if((Array.contains(PXFilterDialog.valueFilters,$m.condition)&&$m.value==null)||($m.condition=="BETWEEN"&&($m.value==null||$m.value2==null)))return null;if($m.value)$m.value=__px(this).getInvariantText($m.value);if($m.value2)$m.value2=__px(this).getInvariantText($m.value2);}else if(this.menuItems.getVisible()){var $i=this.menuItems.items,ar=new Array(),$j,i=0;if($o.valueItems.emptyPossible){$j=$i.getItem(i++);if($j.getVisible()&&$j.getChecked())ar.push($j.value);};for(;i<$i.length;i++){$j=$i.getItem(i);if($j.getVisible()&&$j.getChecked())ar.push($j.value);};if(ar.length>0&&ar.length<$i.length){$m=new Object();$m.condition=$o.valueItems.multiSelect?"LIKE":"IN";$m.value=ar.join(',');}};return $m;};PXFilterDialog.prototype.getFilterValues=function($m){if($m==null)$m=new Object();if(this.edDate1.getVisible()){$m.value=this.edDate1.getValue();$m.value2=this.edDate2.getValue();}else if(this.edNum1.getVisible()){$m.value=this.edNum1.getValue();$m.value2=this.edNum2.getValue();}else if(this.edSel.getVisible()){var tf=this.linkedCol&&this.linkedCol.textField;$m.value=tf?this.edSel.getText():this.edSel.getValue();}else if(this.edText.getVisible()){$m.value=this.edText.getValue();$m.value2=this.edText2.getValue();};return $m;};PXFilterDialog.prototype.setFilterStateOlap=function($F,$G){var $m=$F.filter,$s=$F.dataType,$t;var $v=$F.valueItems&&$F.valueItems.length>0,$H;for(var i=0;i<this.editors.length;i++)if(this.editors[i])this.editors[i].setVisible(false);this.itemsFilter.setVisible(false);var $I=$G==null;if($I&&$m&&$m.condition&&$m.condition!="IN")$G=true;if(this.tlbMode&&$I){this.tlbMode.setVisible($v);this.tlbMode.items[$G?"cond":"items"].setPushed(true);};if($v&&!$G){var $i=this.menuItems.items;while($i.length>0)$i.removeItem(0);var $y=null,$J=null;if($m){if($m.selected)$y=$m.selected.split('|');if($m.unselected)$J=$m.unselected.split('|');};for(var i=0;i<$F.valueItems.length;i++){var $j=$F.valueItems[i],$K=true;if($J!=null)$K=!Array.contains($J,$j.value);if($y!=null)$K=Array.contains($y,$j.value);var $z=$j.text!=null?$j.text:$j.value;mi=$i.insertItem(i,$z!=null?$z:"",null,null,true,true,$K);mi.value=$j.value;};this.menuItems.setVisible(true);if(!$I)this.menuItems.items.ensureScroller(300);if(this.menuItems.items.length>10)this.itemsFilter.setVisible(true);$H=true;}else if(NetType.isNumeric($s)){$t=PXFilterDialog.numberFilters;this.edNum1.setVisible(true);this.edNum2.setVisible(true);this.edNum1.valueType=$s;this.edNum2.valueType=$s;if($s>=NetType.Single&&$s<=NetType.Decimal)this.edNum1.decimals=this.edNum2.decimals=2;else this.edNum1.decimals=this.edNum2.decimals=0;this.edNum1.setValue($m?$m.value:null);this.edNum2.setValue($m?$m.value2:null);}else if($s==NetType.DateTime){$t=PXFilterDialog.numberFilters;this.edDate1.setVisible(true);this.edDate2.setVisible(true);this.edDate1.setValue($m?$m.value:null);this.edDate2.setValue($m?$m.value2:null);}else if($s==NetType.String){$t=PXFilterDialog.stringFiltersOlap;this.edText.setVisible(true);this.edText.setValue($m?$m.value:null);this.edText2.setVisible(true);this.edText2.setValue($m?$m.value2:null);};var $i=this.menuCond.items,$j,$D;var $C=$H?null:"BETWEEN";if(!$H){if($s==NetType.DateTime||NetType.isNumeric($s))$C="BETWEEN";else $C="LIKE";};for(var i=0;i<$i.length;i++){$j=$i.getItem(i);switch($j.value){case "SD":$j.setVisible(false);$j.element.nextSibling.style.display="none";break;case "SA":case "AddQuick":case "RemoveQuick":$j.setVisible(false);break;case "Clear":$j.setVisible(!$H);break;case "SelectAll":case "ClearAll":$j.setVisible($H);break;default:$j.setVisible(false);if($j.value){$j.setVisible($t&&Array.contains($t,$j.value));if($m&&$m.condition)$j.setChecked($m.condition==$j.value);else $j.setChecked($C==$j.value);if($j.getChecked())$D=$j;};break;}};$j.element.nextSibling.style.display=$H?"none":"";this.$X();this.$Y($D&&$D.value=="BETWEEN");this.linkedField=$F;};PXFilterDialog.prototype.getOlapFilterCondition=function(){if(this.menuItems.getVisible()){var $i=this.menuItems.items,$m=null;var $L=new Array(),$M=new Array();for(var i=0;i<$i.length;i++){var $j=$i.getItem(i),$N=$j.value;if($j.getChecked()&&$j.getVisible())$L.push($N);else $M.push($N);};if($L.length>0&&$L.length<$i.length){$m=new Object();$m.condition="IN";if($L.length<$M.length)$m.selected=$L.join('|');else $m.unselected=$M.join('|');};return $m;};return this.getFilterCondition();};PXFilterDialog.prototype.$S=function($e,$f){if($f.button.getPushed()&&$f.button.key){this.setFilterStateOlap(this.linkedField,$f.button.key=="cond");}};PXFilterDialog.prototype.$Z=function(){this.itemsFilter.updateValue();var $m=this.itemsFilter.getValue(),$i=this.menuItems.items;if($m)$m=$m.toLowerCase();var fo,$K,$O;if(this.linkedCol){fo=this.linkedCol.filter;$K=(fo&&fo.value!=null)?fo.value.split(','):null;}else if(this.linkedField){fo=this.linkedField.filter;$K=(fo&&fo.selected)?fo.selected.split('|'):null;$O=(fo&&fo.unselected)?fo.unselected.split('|'):null;};for(var i=0;i<$i.length;i++){var $j=$i.getItem(i),$z=$j.getText();var $n=!$m||($z&&$z.toLowerCase().indexOf($m)>=0);if($n){$j.setChecked(!!$m||fo==null||($K&&Array.contains($K,$j.value))||($O&&!Array.contains($O,$j.value)));};$j.setVisible($n);};this.menuItems.items.ensureScroller(300);};PXFilterDialog.prototype.$V=function(ev){var $P=false,$Q=200,$R=ev.which?ev.which:ev.keyCode;switch(ev.type){case "keypress":$P=($R&&$R!=13);break;case "keydown":$P=($R==8||$R==46);break;case "paste":$P=true;$Q=0;break;};if($P){var me=this,$Q=this.$00;if($Q)clearTimeout($Q);this.$00=setTimeout(function(){me.$Z();},$Q);}};


function PXColumnsDialog($a,$b,$c,$d){PXColumnsDialog.initializeBaseA(this,[$a,$b,$c,$d]);this.colsOrder=$c.colsOrder;this.colsWidth=$c.colsWidth;this.colsTabs=$c.colsTabs;this.canFocus=$c.canFocus||"This cell can be focused by using the Tab button";this.cannotFocus=$c.cannotFocus||"This cell cannot be focused by using the Tab button";__px_cm(this).registerRequiresOnLoad(this,$b.id);this.initColumnsCall=__px_callback(this).createCommand("InitColumns",true);this.initColumnsHandler=Function.createDelegate(this,this.handleInitColumns);this.updateColumnsCall=__px_callback(this).createCommand("UpdateColumns",true);this.$0c=new Map();};PXColumnsDialog.__baseType=PXSmartPanel;PXColumnsDialog.prototype.onLoad=function(){this.events.addEventHandler("afterHide",Function.createDelegate(this,this.updateColumns));this.menuAvail=__px_all(this)[this.ID+"_availC"];this.menuSel=__px_all(this)[this.ID+"_selC"];this.menuSel.multiSelect=this.menuAvail.multiSelect=true;var me=this,$e=this.menuAvail.events,$f=this.menuSel.events;$e.addEventHandler("itemClick",function(){me.setButtonsState();});$f.addEventHandler("itemClick",function(){me.setButtonsState();});$e.addEventHandler("itemCheck",function(m,e){if(e.item.checked&&me.menuCheckedItems(me.menuAvail)==1)e.cancel=true;});$f.addEventHandler("itemCheck",function(m,e){if(e.item.checked&&me.menuCheckedItems(me.menuSel)==1)e.cancel=true;});__px(this).addEventHandler(this.menuAvail.element,"dblclick",function(){me.handleAddButton();});__px(this).addEventHandler(this.menuSel.element,"dblclick",function(){me.handleDelButton();});this.btnUp=__px_all(this)[this.ID+"_up"];if(this.btnUp){var h=Function.createDelegate(this,this.handleUpButton);this.btnUp.events.addEventHandler("click",h);};this.btnDown=__px_all(this)[this.ID+"_down"];if(this.btnDown){var h=Function.createDelegate(this,this.handleDownButton);this.btnDown.events.addEventHandler("click",h);};this.btnAdd=__px_all(this)[this.ID+"_add"];if(this.btnAdd){var h=Function.createDelegate(this,this.handleAddButton);this.btnAdd.events.addEventHandler("click",h);};this.btnDel=__px_all(this)[this.ID+"_del"];if(this.btnDel){var h=Function.createDelegate(this,this.handleDelButton);this.btnDel.events.addEventHandler("click",h);};this.btnReset=__px_all(this)[this.ID+"_reset"];if(this.btnReset){var h=Function.createDelegate(this,this.handleResetButton);this.btnReset.events.addEventHandler("click",h);};this.btnAllUser=__px_all(this)[this.ID+"_allUser"];if(this.btnAllUser)this.btnAllUser.setEnabled(false);var $g=["_fb1","_fb2"];this.filterBars=new Array();for(var i=0;i<$g.length;i++){var $h=__px_all(this)[this.ID+$g[i]];if($h){var $i=Function.createDelegate(this,this.handleFilterBarKeyDown);var $j=Function.createDelegate(this,this.handleFilterBarKeyPress);var $k=Function.createDelegate(this,this.handleFilterBarPaste);this.filterBars.push($h);$h.linkedList=(i==0)?this.menuAvail:this.menuSel;$h.events.addEventHandler("keyDown",$i);$h.events.addEventHandler("keyPress",$j);__px(this).addEventHandler($h.elemText,"paste",$k,false);}};if(this.menuSel){this.menuSel.events.addEventHandler("beforeItemDown",function($l,e){me.clickTabSkip($l,e);});};this.events.addEventHandler("beforeShow",Function.createDelegate(this,this.initColumns));};PXColumnsDialog.prototype.getColumns=function(){var $m=new Array(),$n=this.menuSel.items;for(var i=0;i<$n.length;i++)$m.push($n.getItem(i).value);return $m;};PXColumnsDialog.prototype.fullColumns=function($o,$p,$q){var $n=this.menuAvail.items,$r=this.menuSel.items;while($n.length>0)$n.removeItem(0);while($r.length>0)$r.removeItem(0);for(var i=0;i<this.filterBars.length;i++)this.filterBars[i].setValue(null);var $s=$o.levels[0].columns,$t=new Object();var $m=new Array(),$u=new Array();for(var i=$s.length-1;i>=0;i--){var $v=$s[i],$w=$v.getKey();var $x=$v.getHeaderText(),$y=$v.getHeaderToolTip();var $z=$x?$x:$y;if(!$z&&$v.headerXml)$z=$v.headerXml.getAttribute('Text');if($w){var $A=new Object();$A.key=$w;$A.enabled=($v.allowShowHide==1);$A.text=$z?$z:$w;if($p)$A.index=Array.indexOf($p,$w);$t[$w]=$v;var $B=$p?Array.contains($p,$w):$v.getVisible();if($B)$u.push($A);else if($A.enabled)$m.push($A);}};var $C=function(a,b){if(a.text<b.text)return -1;if(a.text>b.text)return 1;return 0};$m.sort($C);$m.reverse();if($p){$C=function(a,b){if(a.index<b.index)return -1;if(a.index>b.index)return 1;return 0};$u.sort($C);$u.reverse();};for(var i=0;i<$m.length;i++){var $v=$t[$m[i].key],$D;$D=$n.insertItem(0,$m[i].text,null,null,true,true,false);$D.value=$v.getKey();$D.checkGroup="1";};var $E=$o.levels[0].allowSkipTab;for(var i=0;i<$u.length;i++){var $v=$t[$u[i].key],$D;$D=$r.insertItem(0,$u[i].text,null,null,true,true,false);if($E){if(undefined !==$q)$v.skipTabs=$q.indexOf($v.key+":"+$v.dataField)>-1;this.$0d($D,$v);};$D.value=$v.getKey();$D.checkGroup="1";if($D.elemImage)$D.elemImage.style.cssFloat="right";if(!$u[i].enabled)$D.suppressHide=true;};this.linkedGrid=$o;this.setButtonsState();};PXColumnsDialog.prototype.$0e=function(){var $F=this.linkedGrid.levels[0].columns.filter(function(a){return a.visible&&a.skipTabs;}).map(function(b){return b.key+":"+b.dataField});$F.sort();return $F.join(",");};PXColumnsDialog.prototype.$0d=function($D,$v){var $G=__doc(this).createElement('span');$G.className="ac ac-2x "+($v.skipTabs?"ac-TabOff":"ac-TabOn");__px(this).setTitle($G,$v.skipTabs?this.cannotFocus:this.canFocus);this.$0c.set($G,$v);var $H=$D.element.firstElementChild;$H.style.position="relative";$H.insertBefore($G,$H.firstElementChild);$H.classList.add($v.skipTabs?"Off":"On");};PXColumnsDialog.prototype.clickTabSkip=function($l,e){var $I=e.event.target.querySelector('.ac')||e.event.target.parentNode.querySelector('.ac');if($I){var $J=$I.getBoundingClientRect();if(e.event.clientX<$J.x||e.event.clientX>($J.x+$J.width))return;var $K=this.$0c.get($I);if($K){$K.skipTabs=!$K.skipTabs;$I.classList.toggle('ac-TabOn');$I.classList.toggle('ac-TabOff');$I.parentNode.classList.toggle('On');$I.parentNode.classList.toggle('Off');__px(this).setTitle($I,$I.classList.contains('ac-TabOff')?this.canFocus:this.cannotFocus);this.setButtonsState();this.skipChanged=true;delete this.needReset;}}};PXColumnsDialog.prototype.moveMenuItems=function($L,to,$M){var $n=$L.items,$N=to.items,$O,$m,si,$P=[];if($M){$m=new Array();for(var i=0;i<$N.length;i++)$m.push($N.getItem(i).getText());for(var i=0;i<$n.length;i++){var $D=$n.getItem(i);if($D.checked)$m.push($D.getText());};$m.sort();};for(var i=0;i<$n.length;i++){var $D=$n.getItem(i);if($D.checked&&!$D.suppressHide){if(!$O){for(var j=0;j<$N.length;j++)$N.getItem(j).setChecked(false);$O=true;};var $Q=this.removeMenuItem($n,i--),$R=-1;if($M)$R=Array.indexOf($m,$Q.text);$P.push(si=this.moveMenuItem($N,$R,$Q));}};if(si)si.scrollToView();return $P;};PXColumnsDialog.prototype.moveMenuItem=function($S,$R,$T){var i=$S.insertItemFromStore($R,$T);i.suppressHide=$T.suppressHide;this.$0d(i,$T.col);if(i.elemImage)i.elemImage.style.cssFloat="right";return i;};PXColumnsDialog.prototype.removeMenuItem=function($n,i){var $D=$n.getItem(i),$Q=$n.removeItem(i);$Q.suppressHide=$D.suppressHide;if(this.linkedGrid){$Q.col=this.linkedGrid.levels[0].columns.filter(function(_){return _.dataField==$Q.value;}).pop();};return $Q;};PXColumnsDialog.prototype.menuHasSelection=function($l){for(var i=0;i<$l.items.length;i++){var $D=$l.items.getItem(i);if($D.checked&&!$D.suppressHide)return true;};return false;};PXColumnsDialog.prototype.menuCheckedItems=function($l){for(var i=0,j=0;i<$l.items.length;i++){var $D=$l.items.getItem(i);if($D.checked)j++;};return j;};PXColumnsDialog.prototype.canMoveDown=function($l){for(var i=$l.items.length-2;i>=0;i--){var $D=$l.items.getItem(i);if($D.checked&&!$l.items.getItem(i+1).checked)return true;};return false;};PXColumnsDialog.prototype.canMoveUp=function($l){for(var i=1;i<$l.items.length;i++){var $D=$l.items.getItem(i);if($D.checked&&!$l.items.getItem(i-1).checked)return true;};return false;};PXColumnsDialog.prototype.setButtonsState=function(){this.btnAdd.setEnabled(this.menuHasSelection(this.menuAvail));this.btnDel.setEnabled(this.menuHasSelection(this.menuSel));this.btnUp.setEnabled(this.canMoveUp(this.menuSel));this.btnDown.setEnabled(this.canMoveDown(this.menuSel));var $t=this.menuSel.items,ar=this.colsOrder.split(',');var $U=(ar.length!=$t.length)||(this.linkedGrid&&this.linkedGrid.layoutLoaded&&!this.needReset);if(!$U)for(var i=0;i<ar.length;i++)if(Array.indexOf(ar,$t.getItem(i).value)!=i){$U=true;break;};if(this.linkedGrid&&this.colsTabs!=this.$0e())$U=true;this.btnReset.setEnabled($U);};PXColumnsDialog.prototype.actionPostProsess=function(){delete this.needReset;this.setButtonsState();};PXColumnsDialog.prototype.resetColumnsWidth=function($o){var $V=$o.levels[0],$W=$o.autoSaveLayout;var ar=this.colsOrder.split(','),$X=this.colsWidth.split(',');try{$o.autoSaveLayout=false;for(var i=0;i<ar.length;i++){var $v=$V.getColumn(ar[i]),$Y=parseInt($X[i]);if($v&&$v.getWidth()!=$Y){$v.setWidth($Y);$v.clearWidth();}}}finally{$o.autoSaveLayout=$W;}};PXColumnsDialog.prototype.handleUpButton=function($Z,$00){var $n=this.menuSel.items,fi=null;for(var i=1;i<$n.length;i++){var $D=$n.getItem(i);if($D.checked&&!$n.getItem(i-1).checked){var j=this.getNextVisibleItem($n,i,-1);this.moveMenuItem($n,j,this.removeMenuItem($n,i));if(fi==null)fi=$n.getItem(j);}};this.actionPostProsess();if(fi)fi.scrollToView();};PXColumnsDialog.prototype.handleDownButton=function($Z,$00){var $n=this.menuSel.items,fi=null;for(var i=$n.length-2;i>=0;i--){var $D=$n.getItem(i);if($D.checked&&!$n.getItem(i+1).checked){var j=this.getNextVisibleItem($n,i,1);this.moveMenuItem($n,j,this.removeMenuItem($n,i));if(fi==null)fi=$n.getItem(j);}};this.actionPostProsess();if(fi)fi.scrollToView();};PXColumnsDialog.prototype.getNextVisibleItem=function($n,i,$01){while(i>=0&&i<$n.length){i+=$01;if($n.getItem(i).getVisible())break;};return i;};PXColumnsDialog.prototype.handleAddButton=function($Z,$00){this.moveMenuItems(this.menuAvail,this.menuSel).forEach(function($D){});this.actionPostProsess();};PXColumnsDialog.prototype.handleDelButton=function($Z,$00){this.moveMenuItems(this.menuSel,this.menuAvail,true);this.actionPostProsess();};PXColumnsDialog.prototype.handleResetButton=function($Z,$00){if(this.linkedGrid)this.fullColumns(this.linkedGrid,this.colsOrder.split(','),this.colsTabs.split(','));else this.handleInitColumns(this.cachedColumns);this.needReset=true;this.setButtonsState();};PXColumnsDialog.prototype.handleFilterBarKeyDown=function($02,ev){var $w=ev.keyCode;if($w==8||$w==46)this.handleFilterBarKeyPress($02,ev);};PXColumnsDialog.prototype.handleFilterBarKeyPress=function($02,ev){if(ev.keyCode&&ev.keyCode!=13){var me=this,$03=this.$0f;if($03)clearTimeout($03);this.$0f=setTimeout(function(){me.applyFastFilter($02);},200);}};PXColumnsDialog.prototype.handleFilterBarPaste=function(ev){var $02=__px(this).eventObject(ev),me=this;if(this.$0f)clearTimeout(this.$0f);setTimeout(function(){me.applyFastFilter($02);},0);};PXColumnsDialog.prototype.applyFastFilter=function($02){$02.updateValue();var $04=$02.getValue(),$n=$02.linkedList.items;if($04)$04=$04.toLowerCase();for(var i=0;i<$n.length;i++){var $D=$n.getItem(i),$z=$D.getText();var $B=!$04||($z&&$z.toLowerCase().indexOf($04)>=0);$D.setVisible($B);if(!$B)$D.setChecked(false);}};PXColumnsDialog.prototype.initColumns=function(){if(!this.linkedGrid){__px_callback(this).execI(this,this.initColumnsCall,undefined,this.initColumnsHandler);}};PXColumnsDialog.prototype.updateColumns=function(){if(!this.linkedGrid&&this.dialogResult==PXDialogResult.OK){__px_callback(this).execI(this,this.updateColumnsCall,this.menuSel.items.items.map(function(i){return i.value}).join(','));}};PXColumnsDialog.prototype.handleInitColumns=function($05,$a){this.cachedColumns=$05;var $n=this.menuAvail.items,$r=this.menuSel.items;while($n.length>0)$n.removeItem(0);while($r.length>0)$r.removeItem(0);for(var i=0;i<this.filterBars.length;i++)this.filterBars[i].setValue(null);var $m=new Array(),$u=new Array();var $06=$05.split('~');if($06.length!=4)return;var $07=$06[0].split(';'),$08=$06[1].split(';'),$t=new Object(),$09=$06[2].split(';'),$0a=$06[3].split(';');this.colsOrder=$09.map(function(i){return $07[i];}).join(',');for(var i=0;i<$07.length;i++){var $w=$07[i];var $z=decodeURIComponent($08[i]).replace(/\+/g,' ');if($w){var $A=new Object();$A.key=$w;$A.enabled=true;$A.text=$z?$z:$w;var $0b=$09.indexOf(i.toString());var $B=$0b>-1;if($B)$A.index=$0b;$t[$w]=$A;if($B)$u.push($A);else $m.push($A);}};var $C=function(a,b){if(a.text<b.text)return -1;if(a.text>b.text)return 1;return 0};$m.sort($C);$m.reverse();if($09.length){$C=function(a,b){if(a.index<b.index)return -1;if(a.index>b.index)return 1;return 0};$u.sort($C);$u.reverse();};for(var i=0;i<$m.length;i++){var $v=$t[$m[i].key],$D;$D=$n.insertItem(0,$m[i].text,null,null,true,true,false);$D.value=$v.key;$D.checkGroup="1";};for(var i=0;i<$u.length;i++){var $v=$t[$u[i].key],$D;$D=$r.insertItem(0,$u[i].text,null,null,true,true,false);$D.value=$v.key;$D.checkGroup="1";if($D.elemImage)$D.elemImage.style.cssFloat="right";if(!$u[i].enabled)$D.suppressHide=true;};this.setButtonsState();};


